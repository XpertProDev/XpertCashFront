<!-- pos-journal-caisse.component.html -->
<div class="journal-container">
  <!-- Header amélioré -->
   <nav class="header_pos_caisse">
      <div class="content_header_pos_caisse_left">
          <ul>
              <li>
                  <div class="double">
                      <div class="icon_retour" (click)="goBack()">
                          <i class="ri-arrow-left-s-line"></i>
                      </div>
                      <div class="name_pos">
                          <p style="font-size: 16px;">Journal des Caisses</p>
                      </div>
                      <select class="content_select" name="boutique" 
                              [(ngModel)]="selectedBoutiqueIdForList"
                              (ngModelChange)="onBoutiqueChange()">
                          <option *ngFor="let boutique of boutiques" [ngValue]="boutique.id" [disabled]="!boutique.actif">
                              {{ boutique.nomBoutique }}
                          </option>
                      </select>
                  </div>
              </li>
          </ul>
      </div>
      <div class="content_header_pos_caisse_right">

          <span class="o_pager_counter"><span class="">1-1</span><span> / </span><span class="o_pager_limit">1</span></span>
          
          <span class="btn-group d-print-none" aria-atomic="true">
              <button type="button" class="o_pager_previous" aria-label="Précédent" data-tooltip="Précédent" ><i class="ri-arrow-left-s-line"></i></button>
              <button type="button" class="o_pager_next" aria-label="Suivant" data-tooltip="Suivant"><i class="ri-arrow-right-s-line"></i></button>
          </span>

          <div class="barre"></div>
          
          <div class="header-actions">
            <div class="search-container">
              <i class="ri-search-line"></i>
              <input 
                type="text" 
                placeholder="Rechercher..." 
                [(ngModel)]="searchTerm"
              />
              <select [(ngModel)]="statusFilter" class="filter-select">
                <option value="">Tous les statuts</option>
                <option value="OUVERTE">Ouvertes</option>
                <option value="FERMEE">Fermées</option>
              </select>
            </div>


            <div class="barre"></div>
            
            <!-- Bouton de bascule de vue -->
            <div class="view-toggle">
              <button 
                class="view-btn" 
                [class.active]="viewMode === 'card'"
                (click)="viewMode = 'card'"
                title="Vue cartes">
                <i class="ri-grid-line"></i>
              </button>
              <button 
                class="view-btn" 
                [class.active]="viewMode === 'list'"
                (click)="viewMode = 'list'"
                title="Vue liste">
                <i class="ri-table-line"></i>
              </button>
            </div>
            
            <button class="sort-button" (click)="toggleSortDirection()">
              <i class="ri-sort-desc" *ngIf="sortDirection === 'desc'"></i>
              <i class="ri-sort-asc" *ngIf="sortDirection === 'asc'"></i>
            </button>
          </div>
      </div>
  </nav>

  <!-- Section de filtres améliorée -->
  <div class="filters-section">
    <div class="filter-tags">
      <span class="filter-tag" *ngIf="statusFilter">
        Statut: {{ statusFilter === 'OUVERTE' ? 'Ouvertes' : 'Fermées' }}
        <i class="ri-close-line" (click)="statusFilter = ''"></i>
      </span>
      <span class="filter-tag" *ngIf="searchTerm">
        Recherche: "{{ searchTerm }}"
        <i class="ri-close-line" (click)="searchTerm = ''"></i>
      </span>
    </div>
    <div class="summary">
      <span>{{ filteredCaisses.length }} opération(s)</span>
    </div>
  </div>

  <!-- États améliorés -->
  <div *ngIf="isLoading" class="state-container">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>Chargement de l'historique...</p>
    </div>
  </div>

  <div *ngIf="!isLoading && errorMessage" class="state-container">
    <div class="error-content">
      <i class="ri-error-warning-fill"></i>
      <p>{{ errorMessage }}</p>
      <button (click)="loadCaisses()">Réessayer</button>
    </div>
  </div>

  <div *ngIf="!isLoading && !errorMessage && filteredCaisses.length === 0" class="state-container">
    <div class="empty-content">
      <i class="ri-file-list-3-line"></i>
      <p>Aucune opération de caisse trouvée</p>
      <button (click)="loadCaisses()">Actualiser</button>
    </div>
  </div>

  <!-- Vue cartes -->
  <div *ngIf="!isLoading && !errorMessage && filteredCaisses.length > 0 && viewMode === 'card'" class="caisse-cards">
    <div class="card" *ngFor="let caisse of filteredCaisses">
      <div class="card-header">
        <!-- <span class="card-id">#{{caisse.id}}</span> -->
        <span class="status-badge" [class.open]="caisse.statut === 'OUVERTE'" [class.closed]="caisse.statut === 'FERMEE'">
          {{ caisse.statut === 'OUVERTE' ? 'Ouverte' : 'Fermée' }}
        </span>
      </div>
      
      <div class="card-body">
        <div class="info-row">
          <i class="ri-calendar-event-line"></i>
          <div>
            <label>Ouverture</label>
            <p>{{ formatDate(caisse.dateOuverture) }}</p>
          </div>
        </div>
        
        <div class="info-row">
          <i class="ri-calendar-check-line"></i>
          <div>
            <label>Fermeture</label>
            <p>{{ caisse.dateFermeture ? formatDate(caisse.dateFermeture) : 'En cours' }}</p>
          </div>
        </div>
      </div>
      
      <div class="card-footer">
        <div class="amount">
          <label>Initial</label>
          <p>{{ caisse.montantInitial | currency:'XOF ':'symbol':'1.0-0' }}</p>
        </div>
        <div class="amount">
          <label>Final</label>
          <p>{{ caisse.montantCourant | currency:'XOF ':'symbol':'1.0-0' }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Vue tableau -->
  <div *ngIf="!isLoading && !errorMessage && filteredCaisses.length > 0 && viewMode === 'list'" class="caisse-table">
    <table>
      <thead>
        <tr>
          <th (click)="sortCaisses('dateOuverture')">
            <div class="th-content">
              Date Ouverture
              <i class="ri-arrow-up-s-line" *ngIf="sortField === 'dateOuverture' && sortDirection === 'asc'"></i>
              <i class="ri-arrow-down-s-line" *ngIf="sortField === 'dateOuverture' && sortDirection === 'desc'"></i>
            </div>
          </th>
          <th (click)="sortCaisses('dateFermeture')">
            <div class="th-content">
              Date Fermeture
              <i class="ri-arrow-up-s-line" *ngIf="sortField === 'dateFermeture' && sortDirection === 'asc'"></i>
              <i class="ri-arrow-down-s-line" *ngIf="sortField === 'dateFermeture' && sortDirection === 'desc'"></i>
            </div>
          </th>
          <th>Statut</th>
          <th (click)="sortCaisses('montantInitial')">
            <div class="th-content">
              Montant Initial
              <i class="ri-arrow-up-s-line" *ngIf="sortField === 'montantInitial' && sortDirection === 'asc'"></i>
              <i class="ri-arrow-down-s-line" *ngIf="sortField === 'montantInitial' && sortDirection === 'desc'"></i>
            </div>
          </th>
          <th (click)="sortCaisses('montantCourant')">
            <div class="th-content">
              Montant Final
              <i class="ri-arrow-up-s-line" *ngIf="sortField === 'montantCourant' && sortDirection === 'asc'"></i>
              <i class="ri-arrow-down-s-line" *ngIf="sortField === 'montantCourant' && sortDirection === 'desc'"></i>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let caisse of filteredCaisses">
          <td>{{ formatDate(caisse.dateOuverture) }}</td>
          <td>{{ caisse.dateFermeture ? formatDate(caisse.dateFermeture) : '-' }}</td>
          <td>
            <span class="status-badge" [class.open]="caisse.statut === 'OUVERTE'" [class.closed]="caisse.statut === 'FERMEE'">
              {{ caisse.statut === 'OUVERTE' ? 'Ouverte' : 'Fermée' }}
            </span>
          </td>
          <td>{{ caisse.montantInitial | currency:'XOF ':'symbol':'1.0-0' }}</td>
          <td>{{ caisse.montantCourant | currency:'XOF ':'symbol':'1.0-0' }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
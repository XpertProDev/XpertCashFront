<div class="section_contenu_container">
  <!-- // section contenu left -->
  <div class="section_contenu_left">
    <!-- // section favory produit -->
    <div class="section_favory_produit">
      <!-- // section favory -->
      <div class="section_favory">
        <!-- // ul pour le favory  -->
        <!-- <ul class="ul_section_favory">
          <li class="li_section_favory" style="display: flex; align-items: center; justify-content: space-between;">
            <div class="double">
              <div class="icon_favory">
                <i class="ri-heart-fill"></i>
              </div>
              <p class="title_favory">Favorie</p>
            </div>

            <div class="nombre_favory">
              03
            </div>
          </li>
        </ul> -->
        <!-- // categorie -->
        <div class="titre_categorie" [class.selected]="selectedCategoryId === null">
          <p (click)="showAllProducts()" class="allCate">
           Toutes les catégories</p>
        </div>
        <ul class="ul_name_categorie" *ngIf="categories.length">
          <!-- Boucle sur les catégories -->
          <li *ngFor="let categorie of categories" 
              class="ul_li_name_categorie"
              [class.selected]="selectedCategoryId === categorie.id"
              (click)="selectCategory(categorie.id)" >
            <div class="name_categorie">
              <span>{{ categorie.nom }}</span>
            </div>
            <div class="nombre">
                {{ categorie.produitCount || 0 }}
            </div>
          </li>
        </ul>
      </div>
      <!-- // section produit -->
      <div class="section_produit">
        <!-- on transforme cadre_produit en container de grille -->
        <div class="cadre_produit product-grid" *ngIf="isListView">
          
          <div class="product-card" 
               *ngFor="let produit of displayedProducts"
                  [class.disabled]="getAvailableStock(produit) <= 0"
                  (click)="addToCart(produit)"
                  (pointerdown)="startPress($event, produit)"
                  (pointerup)="endPress()"
                  (pointerleave)="endPress()">
            <!-- pastille de stock en haut à gauche -->
            <span class="stock-badge" *ngIf="getSelectedQuantity(produit.id) > 0">
              {{ getSelectedQuantity(produit.id) }}
            </span>

            <!-- image produit -->
            <img [src]="getProductImage(produit.photo)" alt="" class="product-img">

            <!-- cœur favori -->
            <!-- <i class="ri-heart-line favorite-icon"></i> -->

            <!-- zone texte -->
            <div class="card-body">
              <p class="product-name">{{ produit.nom }}</p>
              <p class="product-stock">Stocks : {{ getAvailableStock(produit) }}</p>
            </div>

            <div class="bottom_price_sub">
              <div class="product-price">
                <p>{{ produit.prixVente | currency:'CFA ':'symbol':'1.0-0' }}</p>
              </div>
              <button class="btn-decrement" (click)="decreaseQuantity(produit); $event.stopPropagation()">
                <i class="ri-subtract-line"></i>
              </button>
            </div>
          </div>

          <div *ngIf="!categories.length" class="loading-indicator">
            <i class="ri-loader-4-line"></i> Chargement des produits...
          </div>

        </div>

        <!-- Mode Liste -->
        <div class="cadre_produit_list product-list" *ngIf="!isListView">
          <ul class="ul_list">
            <li class="li_list" 
                 *ngFor="let produit of displayedProducts"
                  [class.disabled]="getAvailableStock(produit) <= 0"
                  (click)="addToCart(produit)"
                  (pointerdown)="startPress($event, produit)"
                  (pointerup)="endPress()"
                  (pointerleave)="endPress()">
              <div class="list_left">
                <div class="double">
                  <div class="img_product_list">
                    <img [src]="getProductImage(produit.photo)" alt="">
                  </div>
                  <div class="name_stock_list">
                    <p class="product-name-list">{{ produit.nom }}</p>
                    <p class="product-stock-list">Stocks : {{ getAvailableStock(produit) }}</p>
                  </div>
                </div>
              </div>
              
              <div class="list_right">
                <div class="double" style="gap: 15px;">
                  <div class="product-price">
                    <p>{{ produit.prixVente | currency:'CFA ':'symbol':'1.0-0' }}</p>
                  </div>
                  <div class="btn_badge">
                    <span class="stock-badge-list" *ngIf="getSelectedQuantity(produit.id) > 0">
                      {{ getSelectedQuantity(produit.id) }}
                    </span>
                  </div>
                  <button class="btn-decrement" (click)="decreaseQuantity(produit); $event.stopPropagation()">
                    <i class="ri-subtract-line"></i>
                  </button>
                  <div class="btn_fovory">
                    <i class="ri-heart-line favorite-icon-list"></i>
                  </div>
                </div>
              </div>
            </li>
          </ul>
          <div *ngIf="displayedProducts.length === 0 && categories.length" class="empty-category">
            Aucun produit dans cette catégorie
          </div>
        </div>
      </div>

    </div>
  </div>
  <!-- // section contenu right -->
  <div class="section_contenu_right" style="background-color: #ffffff; height: 100vh; box-shadow: rgba(0, 0, 0, 0.04) 0px 3px 5px;">
    <div class="list_produit_select">
      <!-- // Tout les liste de produc select  -->
      <ul class="ul_list_produit_select">
        <li class="li_list_produit_select" 
            *ngFor="let item of getCartItems()">
          <div class="double">
            <div class="nombre_select">
              {{ item.quantity }}
            </div>
            <div class="name_produit_select">
              <p style="margin: 0;">
                {{ item.product.nom }}
                <span>({{ item.product.prixVente | currency:'CFA ':'symbol':'1.0-0' }})</span>
              </p>
            </div>
          </div>
          <div class="double">
            <div class="price_produit">
              {{ (item.quantity * item.product.prixVente) | currency:'CFA ':'symbol':'1.0-0' }}
            </div>
            <div class="icon_close_select" (click)="removeProduct(item.product.id)">
              <i class="ri-close-circle-fill"></i>
            </div>
          </div>
        </li>
      </ul>
    </div>
    
    <!-- 2. Récapitulatif : Remise / Taxes / Total -->
    <div class="summary_panel">
      <!-- <div class="double_row">
        <span>Remise</span>
        <span>00 CFA</span>
      </div> -->
      <div class="double_row">
        <span>Taxes</span>
        <span>00 CFA</span>
      </div>
      <div class="double_row total">
        <strong>Total</strong>
        <strong>{{ getTotalCart() | currency:'CFA ':'symbol':'1.0-0' }}</strong>
      </div>
    </div>

    <!-- <div class="quantity-input-display" *ngIf="selectedProduct">
      Produit: {{ selectedProduct.nom }} - Qté: {{ currentQuantityInput || '0' }}
    </div> -->

    <!-- Client et facture -->
    <div class="client_facture" style="padding-top: 5px;">
      <div class="double_client_facture">
        <div class="paiement_btn btn_client">
          <p>Client</p>
        </div>
        <div class="paiement_btn btn_facture">
          <p>Facture</p>
          <input type="checkbox">
        </div>
      </div>
    </div>

    <!-- 3. Clavier numérique + actions -->
    <div class="keypad">
      <button (click)="handleKeyPress('1')">1</button>
      <button (click)="handleKeyPress('2')">2</button>
      <button (click)="handleKeyPress('3')">3</button>
      <button class="btn_keypad_action btn_keypad_active">Qté</button>
      
      <button (click)="handleKeyPress('4')">4</button>
      <button (click)="handleKeyPress('5')">5</button>
      <button (click)="handleKeyPress('6')">6</button>
      <button class="btn_keypad_action">%</button>
      
      <button (click)="handleKeyPress('7')">7</button>
      <button (click)="handleKeyPress('8')">8</button>
      <button (click)="handleKeyPress('9')">9</button>
      <button class="btn_keypad_action">Prix</button>
      
      <button (click)="handleKeyPress('+/-')">+/-</button>
      <button (click)="handleKeyPress('0')">0</button>
      <button (click)="handleKeyPress(',')">,</button>
      <button class="backspace" (click)="handleKeyPress('backspace')">
        <i class="ri-delete-back-2-line"></i>
      </button>
    </div>

    <!-- 4. Bouton de paiement -->
    <div class="btn_content">
      <button class="btn-payment" (click)="openPaymentPopup()">Paiement</button>
    </div>
  </div>
</div>

<!-- Popup de paiement -->
<div *ngIf="showPaymentPopup" class="payment-popup-overlay">
  <div class="payment-popup">
    <div class="popup-header">
      <button (click)="closePaymentPopup()" class="close-btn">
        <i class="ri-close-line"></i>
      </button>
    </div>

    <div class="section_popup_paiement">
      <div class="cadre_section_contenu_left_prise">
        <div class="section_contenu_left_prise">

          <!-- 1. Montant du paiement -->
          <div class="montant_paiement">
            <h1>{{ totalAmount | currency:'CFA ':'symbol':'1.0-0' }}</h1>
            <span>CFA</span>
          </div>

          <!-- 2. Moyens de paiement -->
          <div class="moyen_paiement_price">
            <div class="moyen_paiement">
              <p>{{ selectedPaymentMethod }}</p>
            </div>
            <div class="moyen_prise_du">
              <div class="price_du">
                <p>{{ paymentAmount | currency:'CFA ':'symbol':'1.0-0' }}</p>
                <i class="ri-close-line clear-icon" (click)="enteredAmount = ''; calculatePayment()"></i>
              </div>
            </div>
          </div>

          <div class="paiement_restant">
            <div class="moyen_paiement_restant">
              <p [style.color]="paymentAmount >= totalAmount ? '#008000' : '#ff0000'">
                {{ paymentAmount >= totalAmount ? 'Monnaie' : 'Restant' }}
              </p>
            </div>
            <div class="moyen_prise_du">
              <div class="price_du">
                <p [style.color]="paymentAmount >= totalAmount ? '#008000' : '#ff0000'">
                  {{ changeDue | currency:'CFA ':'symbol':'1.0-0' }}
                </p>
              </div>
            </div>
          </div>

          <!-- 3. Remise par produit -->
          <div class="discount-input">
            <button class="btn-currency">
              <!-- $ -->
              CFA
            </button>
            <input
              type="text"
              placeholder="0"
              class="input-discount"
            />
            <!-- <span class="discount-unit">CFA</span> -->
            <button class="btn-percent">
              %
            </button>
          </div>
          <div class="discount-label">
            <p>Remise par produit</p>
          </div>

        </div>
      </div>

      <div class="section_contenu_right" style="background-color: #ffffff; height: 80vh; box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;">
        <div class="list_produit_select">
          <!-- Moyens de paiement avec sélection -->
          <div class="methode_paiement">
            <div class="cadre_paiement" 
                [class.selected_mode_pay]="selectedPaymentMethod === 'Espèces'"
                (click)="selectPaymentMethod('Espèces')">
              <div class="img_paiement">
                <img src="assets/img/payer.png" alt="">
              </div>
              <div class="title_paiement">
                <p>Espèces</p>
              </div>
            </div>
            
            <div class="cadre_paiement" 
                [class.selected_mode_pay]="selectedPaymentMethod === 'card'"
                (click)="selectPaymentMethod('Carte')">
              <div class="img_paiement img_paiement_carte">
                <img src="assets/img/carte-de-credit.png" alt="">
              </div>
              <div class="title_paiement">
                <p>Carte</p>
              </div>
            </div>
            
            <div class="cadre_paiement" 
                [class.selected_mode_pay]="selectedPaymentMethod === 'account'"
                (click)="selectPaymentMethod('Compte client')">
              <div class="img_paiement img_paiement_compte">
                <img src="assets/img/compte-rendu.png" alt="">
              </div>
              <div class="title_paiement">
                <p>Compte client</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 2. Récapitulatif : Client et facture -->
        <div class="client_facture">
          <div class="double_client_facture">
            <div class="paiement_btn btn_client">
              <p>Client</p>
            </div>
            <div class="paiement_btn btn_facture">
              <p>Facture</p>
              <input type="checkbox">
            </div>
          </div>
        </div>

        <!-- Clavier numérique -->
        <div class="keypad" style="padding-top: 5px;">
          <button (click)="handlePaymentKeyPress('1')">1</button>
          <button (click)="handlePaymentKeyPress('2')">2</button>
          <button (click)="handlePaymentKeyPress('3')">3</button>
          <button>Qté</button>
          
          <button (click)="handlePaymentKeyPress('4')">4</button>
          <button (click)="handlePaymentKeyPress('5')">5</button>
          <button (click)="handlePaymentKeyPress('6')">6</button>
          <button>%</button>
          
          <button (click)="handlePaymentKeyPress('7')">7</button>
          <button (click)="handlePaymentKeyPress('8')">8</button>
          <button (click)="handlePaymentKeyPress('9')">9</button>
          <button>Prix</button>
          
          <button (click)="handlePaymentKeyPress('+/-')">+/-</button>
          <button (click)="handlePaymentKeyPress('0')">0</button>
          <button (click)="handlePaymentKeyPress(',')">,</button>
          <button class="backspace" (click)="handlePaymentKeyPress('backspace')">
            <i class="ri-delete-back-2-line"></i>
          </button>
        </div>

        <!-- 4. Bouton de paiement -->
        <div class="btn_content">
          <button class="btn-payment-pop" 
                  [disabled]="!isAmountEntered"
                  (click)="completePayment()">
            Valider Paiement
          </button>
        </div>
      </div>
    </div>
    
  </div>
</div>


<!-- Popup de détail produit -->
<div *ngIf="showDetailPopup" class="detail-popup-overlay">
  <div class="detail-popup">
    <!-- En-tête -->
    <div class="popup-header">
      <h3>Information des produits</h3>
      <button (click)="closeDetailPopup()" class="close-btn">
        <i class="ri-close-line"></i>
      </button>
    </div>

    <!-- Corps principal -->
    <div class="popup-body">
      <!-- Titre de la boutique -->
      <h4 class="shop-name">Ma Boutique Orix</h4>


        <!-- Colonne gauche : image -->
        <div class="detail-image">
          <img
            [src]="selectedProductForDetail ? getProductImage(selectedProductForDetail.photo) : ''"
            alt="Image produit"
          />
        </div>

      <!-- Colonne droite : infos produit -->
          <div class="detail-info">
            <div class="detail_info_left">
              <div class="info-row">
              <span class="label">Nom produit</span>
              <span class="value">Oridinateur HP</span>
            </div>
            <div class="info-row">
              <span class="label">Prix de vente</span>
              <span class="value">23 000 CFA</span>
            </div>
            <div class="info-row">
              <span class="label">Catégorie</span>
              <span class="value">Formation X</span>
            </div>
            <div class="info-row">
              <span class="label">Unité de mesure</span>
              <span class="value">Carton</span>
            </div>
          </div>
          <div class="detail_info_right">
            <div class="info-row">
              <span class="label">Stocks actuel</span>
              <span class="value">300</span>
            </div>
            <div class="info-row">
              <span class="label">Code</span>
              <span class="value">P-12345</span>
            </div>
            <div class="info-row">
              <span class="label">Code barre</span>
              <span class="value">001234567890</span>
            </div>
          </div>
        </div>

      <!-- Description en bas -->
      <div class="detail-description">
        <span class="label">Description</span>
        <span class="value">Lorem ipsum dolor sit amet consectetur adipisicing elit. Rem, deleniti.</span>
      </div>
    </div>

    <!-- Pied de popup -->
    <div class="popup-actions">
      <button class="btn-add" (click)="addToCart(selectedProductForDetail!); closeDetailPopup();">
        Ajouter au panier
      </button>
    </div>
  </div>
</div>


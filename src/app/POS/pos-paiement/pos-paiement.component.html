<div class="container_paiement">
  <div class="content_paiement">
    <!-- // paiement left  -->
    <div class="paiement_left">
      <div class="content_paiement_left">
        <div class="card status-card" *ngIf="vente; else loadingTpl">
            <div class="status-icon">✔︎</div>
            <div class="status-text">Paiement réussi</div>
        </div>

        <div class="card amount-card" *ngIf="vente">
            <div class="amount">{{ vente.montantTotal | currency:'CFA ':'symbol':'1.0-0' }}</div>
            <div class="method">/ {{ paymentMethod }}</div>
        </div>

        <button class="btn btn-secondary" (click)="modifyPaymentRecu()">Modifier le paiement</button>
        <button class="btn btn-secondary" (click)="impressionReceipt()">Imprimer le reçu</button>

        <div class="email-send">
            <input type="email" placeholder="example@gmail.com" />
            <button class="btn-send"><i class="ri-send-plane-fill"></i></button>
        </div>

        <button class="btn btn-primary btn-new-order" (click)="newOrder()">Nouvelle commande</button>
      </div>
    </div>

    <!-- // paiement right -->
    <div class="paiement_right">
      <div class="receipt" #receipt>
        <div class="receipt-header">
          <img [src]="logo || 'assets/img/TCHAKEDA.png'"
            (error)="onLogoError()"
            alt="Logo XpertPro"
            class="logo" />
          <div class="ticket-info">
            <div>Ticket : {{ vente?.venteId ?? '—' }}</div>
            <div>{{ vente?.dateVente | date:'dd/MM/yyyy HH:mm' }}</div>
            <div>Servi par : {{ vente?.nomVendeur ?? '—' }}</div>
            <div>Boutique : {{ vente?.nomBoutique ?? '—' }}</div>
          </div>
        </div>

        <ul class="items-list">
          <li class="item" *ngFor="let item of getLignes()">
            <span class="qty">{{ item.quantite }}</span>
            <div class="desc">
              <div class="name">{{ item.nomProduit }}</div>
              <div class="unit-price">{{ item.prixUnitaire | currency:'CFA ':'symbol':'1.0-0' }} / Unité(s)</div>
            </div>
            <span class="total">{{ item.montantLigne | currency:'CFA ':'symbol':'1.0-0' }}</span>
          </li>
          <li *ngIf="(getLignes()).length === 0" class="no-items">Aucun produit trouvé</li>
        </ul>

        <div class="divider"></div>

        <div class="totals">
          <div class="line">
            <span>Sous-total</span><span class="paleft">{{ vente?.montantTotal | currency:'CFA ':'symbol':'1.0-0' }}</span>
          </div>
          <div class="line total-line">
            <span>Total</span><span class="paleft">{{ vente?.montantTotal | currency:'CFA ':'symbol':'1.0-0' }}</span>
          </div>
        </div>

        <div class="divider"></div>

        <div class="payments-breakdown">
          <div class="line">
            <span>{{ paymentMethod }}</span><span class="paleft">{{ paymentAmount | currency:'CFA ':'symbol':'1.0-0' }}</span>
          </div>
          <div class="line" *ngIf="paymentAmount >= (vente?.montantTotal ?? 0)">
            <span>Monnaie</span><span class="paleft">{{ changeDue | currency:'CFA ':'symbol':'1.0-0' }}</span>
          </div>

          <div class="line" *ngIf="paymentAmount < (vente?.montantTotal ?? 0)">
            <span>Reste à payer</span><span class="paleft">{{ changeDue | currency:'CFA ':'symbol':'1.0-0' }}</span>
          </div>
        </div>


        <div class="receipt-footer">
          Généré par Tchakeda
        </div>
      </div>

      <ng-template #loadingTpl>
        <div class="loading">Chargement du reçu...</div>
      </ng-template>
    </div>
  </div>
</div>

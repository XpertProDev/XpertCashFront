<div class="content_formulaire">
    <div class="modal-body">
        <form class="container_formulaire" (ngSubmit)="creerFactureProforma()">
            <!-- Titre -->
            <div class="Title">
              <h3>Ajouter une facture proforma</h3>
            </div>
          
            <div class="form_left_right">
              <div class="formulaire">
          
                <!-- Informations facture -->
                <div class="information_cadre">
                  <div class="info_titre_input">
                    <div class="double_input">
          
                      <!-- Description -->
                      <div class="champ_input champ_input2">
                        <input
                          type="text"
                          class="input_focus"
                          id="description"
                          name="description"
                          [(ngModel)]="description"
                          [ngModelOptions]="{ standalone: true }"
                          placeholder="Saisis la description"
                        />
                        <label for="description" class="label">Description</label>
                      </div>
          
                      <!-- Client / Entreprise -->
                      <div class="champ_input champ_input2">
                        <div class="title_input">
                          <label>
                            <input
                              type="radio"
                              name="typeDestinataire"
                              value="client"
                              [(ngModel)]="typeDestinataire"
                              [ngModelOptions]="{ standalone: true }"
                            />
                            Client
                          </label>
                          <label style="margin-left: 20px;">
                            <input
                              type="radio"
                              name="typeDestinataire"
                              value="entreprise"
                              [(ngModel)]="typeDestinataire"
                              [ngModelOptions]="{ standalone: true }"
                            />
                            Entreprise
                          </label>
                        </div>
          
                        <!-- Select Client -->
                        <select
                          *ngIf="typeDestinataire === 'client'"
                          class="input_focus"
                          [(ngModel)]="selectedClientId"
                          name="client_id"
                          required
                          [ngModelOptions]="{ standalone: true }"
                        >
                          <option value="">Sélectionner un client</option>
                          <option *ngFor="let client of clients" [value]="client.id">
                            {{ client.nomComplet }} <span *ngIf="client.entrepriseClient"> - {{ client.entrepriseClient.nom }}</span>
                          </option>
                        </select>
          
                        <!-- Select Entreprise -->
                        <select
                          *ngIf="typeDestinataire === 'entreprise'"
                          class="input_focus"
                          [(ngModel)]="selectedEntrepriseId"
                          name="entreprise_id"
                          required
                          [ngModelOptions]="{ standalone: true }"
                        >
                          <option value="">Sélectionner une entreprise</option>
                          <option *ngFor="let entreprise of entreprises" [value]="entreprise.id">
                            {{ entreprise.nom }}
                          </option>
                        </select>
                      </div>
          
                    </div>
                  </div>
                </div>
          
                <!-- Lignes de facture dynamiques -->
                <div class="information_cadre">
                  <div class="info_titre_input">
                    <h4>Produits</h4>
          
                    <div *ngFor="let ligne of lignesFacture; let i = index" class="double_input" style="align-items: center;">
                      <div class="champ_input champ_input2">
                        <select
                          required
                          class="input_focus"
                          [(ngModel)]="ligne.produitId"
                          [ngModelOptions]="{ standalone: true }"
                        >
                          <option value="">Sélectionner un produit</option>
                          <option *ngFor="let produit of produits" [value]="produit.id">
                            {{ produit.nom }}
                          </option>
                        </select>
                      </div>
          
                      <div class="champ_input champ_input2">
                        <input
                          type="number"
                          class="input_focus"
                          [(ngModel)]="ligne.quantite"
                          [ngModelOptions]="{ standalone: true }"
                          placeholder="Quantité"
                        />
                        <label class="label">Quantité</label>
                      </div>

                      <td>
                        <!-- // Button de ajouter  -->
                        <div class="btn_delete" (click)="supprimerLigneFacture(i)" *ngIf="lignesFacture.length > 1" >
                          <i class="ri-delete-bin-5-fill"></i>
                        </div>
                      </td>

                      <td>
                        <!-- // Button de ajouter  -->
                        <div class="btn_ajouter" (click)="ajouterLigneFacture()" >
                          <i class="ri-add-fill"></i>
                        </div>
                      </td> 
          
                    </div>
          
                   
                  </div>
                </div>
          
                <!-- Remise et TVA -->
                <div class="information_cadre">
                  <div class="info_titre_input">
                    <h4>Remise et TVA</h4>
          
                    <div class="champ_input_inventaire">
                      <p>Application de remise et TVA</p>
                      <label class="switch">
                        <input
                          type="checkbox"
                          [(ngModel)]="remiseTVAActive"
                          (change)="onToggleRemiseTVA()"
                          [ngModelOptions]="{standalone: true}"
                        />
                        <span class="slider round"></span>
                      </label>
                    </div>
          
                    <div class="double_input" *ngIf="remiseTVAActive" style="margin-top: 15px;">
                      <div class="champ_input champ_input2">
                        <input
                          type="number"
                          step="0.01"
                          class="input_focus"
                          name="remisePourcentage"
                          [(ngModel)]="remisePourcentage"
                          placeholder="Remise en %"
                        />
                        <label class="label">Remise (%)</label>
                      </div>
          
                      <div class="champ_input champ_input2">
                        <input
                          type="number"
                          class="input_focus"
                          name="tva"
                          [(ngModel)]="tva"
                          placeholder="TVA"
                        />
                        <label class="label">TVA</label>
                      </div>
                    </div>
          
                  </div>
                </div>
          
              </div>
            </div>
          
            <!-- Boutons -->
            <div class="information_cadre information_cadre_save">
              <div class="info_titre_input info_titre_input_btn" style="display: flex; justify-content: flex-end; gap: 10px;">
                <div class="btn_annuler">
                  <button class="btn_cancel" type="button" (click)="goToFacture()">Annuler</button>
                </div>
                <div class="btn_ajouter">
                  <button class="btn_save" type="submit">Ajouter</button>
                </div>
              </div>
            </div>
          </form>
          
    </div>

      
</div>
  
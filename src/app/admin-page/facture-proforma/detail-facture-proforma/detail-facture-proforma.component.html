<div class="container_global">
    <div *ngIf="isLoading" class="loading-overlay">
        <div class="loading-content">
          <div class="spinner"></div>
          <p>Connexion en cours...</p>
        </div>
    </div>

    <div *ngIf="factureProForma" class="content_formulaire">
        <div class="modal-body">
            <form class="container_formulaire">
                <!-- // Titre -->
                <div class="Title">
                    <h3>Détails de la facture pro forma</h3>
                </div>
                <!-- Les informations de l'etat  -->
                <div class="information_cadre">
                    <div class="info_titre_etat">
                      <h4>État</h4>
                      <div class="etat_container">
                        <!-- Section des états -->
                        <div class="etat_content" [class.has-active]="factureProForma.statut">

                            <!-- Bouton Brouillon -->
                            <div class="etat_brouillon">
                                <button class="btn_etat" 
                                        [class.active]="factureProForma.statut === statusOptions.BROUILLON"
                                        [disabled]="!canTransitionTo(statusOptions.BROUILLON)"
                                        (click)="openStatusConfirmation(statusOptions.BROUILLON)">
                                Brouillon
                                </button>
                            </div>

                             <!-- Bouton Approbation -->
                             <div class="etat_approbation" *ngIf="!factureProForma.dateApprobation">
                                <button class="btn_etat" 
                                        [class.active]="factureProForma.statut === statusOptions.APPROBATION"
                                        [disabled]="!canTransitionTo(statusOptions.APPROBATION)"
                                        (click)="openStatusConfirmation(statusOptions.APPROBATION)">
                                  Approbation
                                </button>
                              </div>
                            
                            <!-- Bouton Approuver -->
                            <div class="etat_approuver">
                                <button class="btn_etat" 
                                        [class.active]="factureProForma.statut === statusOptions.APPROUVE"
                                        [disabled]="!canTransitionTo(statusOptions.APPROUVE)"
                                        (click)="openStatusConfirmation(statusOptions.APPROUVE)">
                                Approuver
                                </button>
                            </div>
                            
                            <!-- Bouton Envoyer -->
                            <div class="etat_envoyer">
                                <button class="btn_etat" 
                                        [class.active]="factureProForma.statut === statusOptions.ENVOYE"
                                        [disabled]="!canTransitionTo(statusOptions.ENVOYE)"
                                        (click)="openStatusConfirmation(statusOptions.ENVOYE)">
                                  Envoyer
                                </button>
                            </div>
                            
                            <!-- Bouton Valider -->
                            <div class="etat_valider">
                                <button class="btn_etat" 
                                        [class.active]="factureProForma.statut === statusOptions.VALIDE"
                                        [disabled]="!canTransitionTo(statusOptions.VALIDE)"
                                        (click)="openStatusConfirmation(statusOptions.VALIDE)">
                                  Valider
                                </button>
                            </div>
                        </div>
  
                        <!-- Popup de confirmation -->
                        <div *ngIf="showStatusConfirmation" class="status-confirmation-popup">
                            <div class="popup-content">
                            <h4>Confirmer le changement de statut</h4>
                            <p>Voulez-vous vraiment passer la facture au statut "{{ selectedStatutLabel }}" ?</p>
                            <div class="popup-actions">
                                <button class="btn btn-secondary" (click)="cancelStatusChange()">Annuler</button>
                                <button class="btn btn-primary" (click)="confirmStatusChange()">Confirmer</button>
                            </div>
                            </div>
                        </div>
                      </div>
                    </div>
                </div>

                <!-- Les informations de facture  -->
                <div class="information_cadre">
                    <div class="info_titre_input info_titre_input_proforma">
                        <h2>FACTURE PRO FORMA : <span> {{ factureProForma.numeroFacture }} </span></h2>
                        <p style="text-align: right;">{{siege}}, le {{ factureProForma.dateCreation | date:'dd-MM-yyyy' }}</p>
                    </div>
                </div>

                <!-- Les informations de facture  -->
                <div class="information_cadre">
                    <div class="info_titre_input">
                        <div class="champ_input">
                            <!-- <input [value]="factureProForma.description" autocomplete="off" type="text" class="input_focus" required placeholder="Saisis l'object"> -->
                            <textarea [(ngModel)]="factureProForma.description" [ngModelOptions]="{standalone: true}" autocomplete="off" type="text" class="input_focus2" required placeholder="Saisis l'object"></textarea>
                            <label for="object" class="label"> Object </label>
                        </div>
                    </div>
                </div>
                

                <!-- Les informations pour utilisateur  -->
                <div class="information_cadre">
                    <div class="info_titre_input">
                        <div *ngIf="factureProForma.client">
                            <h5>Client</h5>
                            <!-- // Nom complet et email  -->
                             <!-- <div>
                                {{factureProForma | json}}
                             </div> -->
                            <div class="double_input_grid">
                                <div class="champ_input">
                                    <input autocomplete="off" style="cursor: no-drop;" readonly [value]="factureProForma.client.email" type="email" class="input_focus" required placeholder="Saisis l'email">
                                    <label for="email" class="label"> Email </label>
                                </div>
    
                                <div class="champ_input">
                                    <input autocomplete="off" style="cursor: no-drop;" readonly [value]="factureProForma.client.nomComplet" type="text" class="input_focus" required placeholder="Saisis le nom et prénom">
                                    <label for="nomComplet" class="label"> Droit </label>
                                </div>
                            </div>
    
                            <!-- // Adresse et téléphone  -->
                            <div class="double_input_grid">
                                <div class="champ_input">
                                    <input autocomplete="off" style="cursor: no-drop;" readonly [value]="factureProForma.client.adresse" type="text" class="input_focus" required placeholder="Saisis l'adresse">
                                    <label for="adresse" class="label"> Adresse </label>
                                </div>
    
                                <div class="champ_input">
                                    <input autocomplete="off" style="cursor: no-drop;" readonly [value]="factureProForma.client.telephone" type="number" class="input_focus" required placeholder="00 00 00 00">
                                    <label for="numero" class="label"> Numéro téléphone </label>
                                </div>
                            </div>
                        </div>
                        <!-- /////////////////////////////// Entreprise ///////////////////////////////  -->
                        <!-- Début de la section Entreprise - Afficher uniquement si entrepriseClient existe -->
                        <div *ngIf="factureProForma.entrepriseClient">
                            <div class="name_icon">
                                <h5>Entreprise clients</h5>
                                <div class="iconEntrepriseList">
                                    <i class="ri-git-branch-fill" title="Affiliation d'Entreprise"></i>
                                </div>
                            </div>

                            <!-- Les chaps d'entreprise -->
                            <div class="double_input_grid">
                                <div class="champ_input">
                                    <input autocomplete="off" style="cursor: no-drop;" readonly [value]="factureProForma.entrepriseClient.nom || 'Non vide' " 
                                        type="text" class="input_focus" required placeholder="Saisis le nom ">
                                    <label for="nom" class="label">Nom</label>
                                </div>

                                <div class="champ_input">
                                    <input autocomplete="off" style="cursor: no-drop;" readonly [value]="factureProForma.entrepriseClient.email || 'Nom email' " 
                                        type="email" class="input_focus" required placeholder="Saisis l'email">
                                    <label for="totalFacture" class="label">Email</label>
                                </div>
                            </div>

                            <div class="double_input_grid">
                                <div class="champ_input">
                                    <input autocomplete="off" style="cursor: no-drop;" readonly [value]="factureProForma.entrepriseClient.adresse || 'Nom adresse' " 
                                        type="text" class="input_focus" required placeholder="Saisis l'adresse">
                                    <label for="adresse" class="label">Adresse</label>
                                </div>

                                <div class="champ_input">
                                    <input autocomplete="off" style="cursor: no-drop;" readonly [value]="factureProForma.entrepriseClient.telephone || 'Nom téléphone' " 
                                        type="number" class="input_focus" required placeholder="00 00 00 00">
                                    <label for="numero" class="label">Numéro téléphone</label>
                                </div>
                            </div>
                        </div>
                        <!-- Fin de la section conditionnelle -->

                    </div>
                </div>

                <div class="information_cadre">
                    <div class="info_titre_input">
                        <div class="add_new_quantite_stock">
                            <h4>Produits</h4>
                        </div>

                        <div class="containerTable">
                            <table>
                                <thead>
                                    <tr class="titleTableProduit">
                                        <th class="title_table_name">Désignation</th>
                                        <th class="">Description</th>
                                        <th class="">Quantité</th>
                                        <th class="">Prix Unitaire</th>
                                        <th class="">Montant (FCFA)</th>
                                    </tr>
                                </thead>
                                <!-- List produit quantite  --> 
                                <tbody>
                                    <tr class="tr_stock" style="border-top: 1px solid #f0f2f5;" *ngFor="let ligne of confirmedLignes; let i = index">
                                        <!-- // Produit  -->
                                        <td>
                                            <div class="champ_input" style="margin-right: 15px;">
                                                <input [value]="getProduitNom(ligne.produitId)" class="input_focus_type" type="text" readonly class="input_table" placeholder="Nom produit">
                                            </div>
                                        </td>
                                        <!-- // Description -->
                                        <td>
                                            <div class="champ_input" style="margin-right: 15px;">
                                              <textarea style="margin-bottom: -7px; min-width: 120px; resize: none;"
                                                type="text" [(ngModel)]="ligne.ligneDescription" 
                                                [ngModelOptions]="{standalone: true}"  
                                                class="input_focus_type"
                                                placeholder="Description"></textarea>
                                            </div>                         
                                        </td>
                                        <!-- // Quantité  -->
                                        <td>
                                            <div class="champ_input" style="margin-right: 15px;">
                                                <!-- <input  [value]="ligne.quantite" type="number" class="input_focus_type" id="addQuantite" name="addQuantite" placeholder="Quantité"> -->
                                                <input [(ngModel)]="ligne.quantite" [ngModelOptions]="{standalone: true}" type="number" class="input_focus_type" id="addQuantite" name="addQuantite" placeholder="Quantité">
                                            </div>
                                        </td>
                                        <!-- // Prix Unitaire  -->
                                        <td>
                                            <div class="champ_input" style="margin-right: 15px;">
                                              <input 
                                              [value]="getPrixVente(ligne.produitId) | customNumber"
                                                type="text" 
                                                class="input_focus_type" 
                                                placeholder="Prix unitaire"
                                                readonly
                                                style="cursor: no-drop;"
                                              >
                                            </div>
                                        </td>
                                        <!-- // Stock actuel -->
                                        <td>
                                            <div class="champ_input" style="margin-right: 15px;">
                                              <input  [value]="getMontantTotal(ligne) | customNumber"
                                                     type="text" 
                                                     class="input_focus_type" 
                                                     disabled
                                                     style="cursor: no-drop;" >
                                            </div>                         
                                          </td>
                                        <td>
                                            <!-- // Button de delele  -->
                                            <div class="btn_delete_icon_add" (click)="supprimerLigneConfirmee(i)">
                                              <i class="ri-delete-bin-5-fill"></i>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                                <!-- Ajouter produit quantite  -->
                                <tbody>
                                    <tr class="tr_stock" style="border-top: 1px solid #f0f2f5;"  *ngFor="let ligne of inputLignes; let i = index; trackBy: trackByFn">
                                        <!-- // Produit  -->
                                        <div class="champ_input" style="margin-right: 15px;">
                                            <td>
                                                <!-- <select class="input_focus_type input_focus_type_select" 
                                                [(ngModel)]="ligne.produitId" 
                                                (ngModelChange)="updateCalculs()" 
                                                [ngModelOptions]="{standalone: true}">
                                                  <option [ngValue]="null">Sélectionner un produit</option>
                                                  <option *ngFor="let produit of produits" [ngValue]="produit.id">
                                                    {{ produit.nom }}
                                                  </option>
                                                </select> -->

                                                <select 
                                                    class="input_focus_type input_focus_type_select" 
                                                    [ngModel]="ligne.produitId"
                                                    (ngModelChange)="onProduitChange($event, ligne)"
                                                    [ngModelOptions]="{ standalone: true }" 
                                                    required>
                                                    <option [ngValue]="null">Sélectionner un produit</option>
                                                    <option *ngFor="let produit of produits" [ngValue]="produit.id">
                                                        {{ produit.nom }}
                                                    </option>
                                                </select>
                                              </td>
                                        </div>
                                        <!-- // Description -->
                                        <td>
                                            <div class="champ_input" style="margin-right: 15px;">
                                                <textarea style="margin-bottom: -7px; min-width: 120px; resize: none;"
                                                type="text"
                                                [(ngModel)]="ligne.ligneDescription"
                                                [ngModelOptions]="{ standalone: true }"
                                                class="input_focus_type"
                                                placeholder="Description"></textarea>
                                            </div>                         
                                        </td>
                                        <!-- // Quantité  -->
                                        <td>
                                            <div class="champ_input" style="margin-right: 15px;">
                                                <input type="number" [(ngModel)]="ligne.quantite" 
                                                   (ngModelChange)="updateCalculs()" [ngModelOptions]="{standalone: true}"
                                                   class="input_focus_type" 
                                                   placeholder="Quantité">
                                            </div>
                                        </td>
                                        <!-- // Prix Unitaire  -->
                                        <td>
                                            <div class="champ_input" style="margin-right: 15px;">
                                                <input [value]="getPrixVente(ligne.produitId) | customNumber" 
                                                    class="input_focus_type" 
                                                    readonly
                                                    style="cursor: no-drop;"
                                                >
                                            </div>
                                        </td>
                                        <!-- // Stock actuel -->
                                        <td>
                                            <div class="champ_input" style="margin-right: 15px;">
                                                <input [value]="getMontantTotal(ligne) | customNumber" 
                                                    class="input_focus_type" 
                                                    readonly
                                                    style="cursor: no-drop;"
                                                >
                                            </div>
                                          </td>
                                        <!-- // Button de ajouter  -->
                                        <td>
                                          <div class="btn_ajouter_icon_add" (click)="ajouterLigneFacture(i)">
                                            <i class="ri-add-fill"></i>
                                          </div>
                                        </td>
                                    </tr>
                                </tbody>
                                <!-- Montant total HT  -->
                                <tfoot>
                                    <tr class="tr_stock">
                                        <!-- // Produit  -->
                                        <td >
                                            <h4>MONTANT TOTAL HT </h4>
                                        </td>
                                        <!-- // Description -->
                                        <td></td>
                                        <!-- // Quantité  -->
                                        <td></td>
                                        <!-- // Prix Unitaire  -->
                                        <td></td>
                                        <!-- // Stock actuel -->
                                        <td>
                                            <div class="champ_input" style="margin-right: 15px;">
                                              <input 
                                                type="text" 
                                                class="input_focus_type" 
                                                disabled 
                                                [value]="getTotalHT() | customNumber" 
                                                style="cursor: no-drop; text-align: center;"
                                              >
                                            </div>                         
                                        </td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Remise -->
                <div class="information_cadre">
                    <div class="info_titre_input">
                    <!-- <h4>Remise</h4> -->
            
                    <div class="champ_input_inventaire">
                        <p>Application de REMISE</p>
                        <label class="switch">
                            <input type="checkbox" [(ngModel)]="activeRemise" (change)="onToggleRemise()" [ngModelOptions]="{standalone: true}"/>
                            <span class="slider round"></span>
                        </label>
                    </div>
            
                    <div class="double_input_grid" *ngIf="activeRemise" style="margin-top: 15px;">
                        <div class="champ_input champ_input2">
                            <input [value]="factureProForma.remise | number" type="number" step="0.01" class="input_focus" name="remisePourcentage" [(ngModel)]="remisePourcentage" placeholder="Remise en %" />
                            <label class="label">
                                REMISE <span *ngIf="remisePourcentage !== null">({{ remisePourcentage }}%)</span>
                            </label>
                        </div>
            
                        <div class="champ_input champ_input2">
                            <input 
                        type="text" 
                        class="input_focus" 
                        readonly
                        [value]="getMontantRemise() | customNumber" style="cursor: no-drop;"/>
                            <label class="label">Montant (CFA)</label>
                          </div>
                    </div>
            
                    </div>
                </div>

                 <!-- // Toatal TTC  -->
            <div class="information_cadre">
                <div class="info_titre_input">
                    <!-- // Remise et Total hors taxe  -->
                    <div class="double_input_ttc">
                        <h4> MONTANT COMMERCIAL </h4>
                        <!-- Montant Commercial -->
                        <div class="montantTTC">
                            <!-- <h4> -->
                                {{ getTotalCommercial() | customNumber  }} CFA
                            <!-- </h4> -->
                        </div>
                    </div>
                </div>
            </div>

                <!-- TVA -->
                <div class="information_cadre">
                    <div class="info_titre_input">
                    <!-- <h4> TVA </h4> -->
            
                    <div class="champ_input_inventaire">
                        <p>Application de TVA</p>
                        <label class="switch">
                            <input type="checkbox" [(ngModel)]="activeTva" (change)="onToggleTVA()" [ngModelOptions]="{standalone: true}"/>
                            <span class="slider round"></span>
                        </label>
                    </div>
            
                    <div class="double_input_grid" *ngIf="activeTva" style="margin-top: 15px;">
                        <div class="champ_input">
                            <input type="number" class="input_focus" readonly [value]="18" />
                            <label class="label">TVA (%)</label>
                        </div>
                        
                        <div class="champ_input champ_input2">
                            <input type="text" class="input_focus" readonly [value]="getMontantTVA() | customNumber" style="cursor: no-drop;"/>
                            <label class="label">Montant (CFA)</label>
                        </div>
            
                    </div>
            
                    </div>
                </div>

                <!-- // Toatal ht et ttc  -->
                <div class="information_cadre">
                    <div class="info_titre_input">
                        <!-- // Remise et Total hors taxe  -->
                        <div class="double_input_ttc">
                            <h4>MONTANT TOTAL TTC </h4>
                            <div class="montantTTC">
                                {{ getTotalTTC() | customNumber }} CFA
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Buttom ajouter et annuler  -->
                <div class="information_cadre">
                    <!-- Message d'erreur global -->
                    <div class="container_error_message">
                        <div *ngIf="errorMessage" class="error-message">
                            {{ errorMessage }}
                        </div>
                    </div>
    
                    <div class="info_titre_input info_titre_input_btn">
                        <!-- Input de produits  -->
                        <div class="btn_annuler">
                            <button class="btn_cancel" routerLink="/facture-proforma">Annuler</button>
                        </div>
        
                        <div class="btn_ajouter">
                            <button class="btn_save" type="submit" (click)="submitUpdateForm()">Modifier</button>
                        </div>
                    </div>
                </div>
            </form>
            
        </div>
    </div>

    <!-- Brouillon  -->
    <div class="container_brouillon_facture">
        <div class="brouillon_facture">
            <!-- Créé par -->
            <div class="brouillon_double">
                <h5 class="titre_brouillont">Crée par :</h5>
                <div class="contenue_brouillont">
                    <h6>{{ factureProForma.utilisateurCreateur?.nomComplet || 'Non spécifié' }}</h6>
                </div>
            </div>
        
            <!-- Modifié par -->
            <div class="brouillon_double">
                <h5 class="titre_brouillont">Modifier par :</h5>
                <div class="contenue_brouillont">
                    <h6>{{ factureProForma.utilisateurModificateur?.nomComplet || 'Aucune modification' }}</h6>
                </div>
            </div>
        
            <!-- Section "Approuver par" modifiée -->
            <div class="brouillon_double">
                <h5 class="titre_brouillont">
                {{ factureProForma.statut === statusOptions.APPROBATION ? 'Personnes à approuver' : 'Approuvé par' }} :
                </h5>
                <div class="contenue_brouillont">
                <!-- Mode approbation en cours -->
                <div *ngIf="factureProForma.statut === statusOptions.APPROBATION">
                    <h6 *ngFor="let approbateur of factureProForma.approbateurs">
                    {{ approbateur.nomComplet }} (en attente)
                    </h6>
                </div>
            
                <!-- Mode déjà approuvé -->
                <div *ngIf="factureProForma.statut !== statusOptions.APPROBATION">
                    <!-- Afficher uniquement l'approbateur effectif -->
                    <h6 *ngIf="factureProForma.utilisateurApprobateur">
                    {{ factureProForma.utilisateurApprobateur.nomComplet }}
                    </h6>
                    <h6 *ngIf="!factureProForma.utilisateurApprobateur">
                    Aucune approbation validée
                    </h6>
                </div>
                </div>
            </div>
    
             <!-- Action par -->
             <div class="brouillon_double">
                <h5 class="titre_brouillont">Dernière action :</h5>
                <div class="contenue_brouillont">
                  <h6>
                    <!-- Affichage personnalisé du statut -->
                    <span *ngIf="factureProForma.statut === statusOptions.APPROBATION">
                      En attente d'approbation
                    </span>
                    <span *ngIf="factureProForma.statut !== statusOptions.APPROBATION">
                      {{ factureProForma.statut || 'Aucune activité' }}
                    </span>
                  </h6>
                </div>
              </div>
    
            <!-- Validé par (si le statut est VALIDE) -->
            <div class="brouillon_double" *ngIf="factureProForma.statut === 'VALIDE'">
                <h5 class="titre_brouillont">Valider par :</h5>
                <div class="contenue_brouillont">
                    <!-- Utilisateur approbateur direct -->
                    <!-- <h6 *ngIf="factureProForma.utilisateurApprobateur?.nomComplet">
                        {{ factureProForma.utilisateurApprobateur?.nomComplet }}
                    </h6> -->
                    <h6>{{ factureProForma.utilisateurModificateur?.nomComplet || 'Aucune modification' }}</h6>
                    
                    <!-- Premier approbateur de la liste -->
                    <h6 *ngIf="!factureProForma.utilisateurApprobateur && (factureProForma.approbateurs ?? []).length > 0">
                        {{ (factureProForma.approbateurs ?? [])[0].nomComplet }}
                        <!-- {{ getFirstApprobateurName() }} -->
                    </h6>
            
                    <!-- Fallback si aucune information -->
                    <h6 *ngIf="!factureProForma.utilisateurApprobateur && (factureProForma.approbateurs ?? []).length === 0">
                        Information non disponible
                    </h6>
                </div>
            </div>
        
            <!-- Date de création -->
            <div class="brouillon_double">
                <h5 class="titre_brouillont">Date de création :</h5>
                <div class="contenue_brouillont">
                    <h6>{{ factureProForma.dateCreation | date: 'dd/MM/yyyy' }}</h6>
                </div>
            </div>
        
            <!-- Date de modification (si disponible) -->
            <div class="brouillon_double" *ngIf="factureProForma.dateApprobation">
                <h5 class="titre_brouillont">Date d'approbation :</h5>
                <div class="contenue_brouillont">
                    <h6>{{ factureProForma.dateApprobation | date: 'dd/MM/yyyy' }}</h6>
                </div>
            </div>
        </div>
    </div>

</div>


<div *ngIf="showDuplicatePopup" class="duplicate-popup">
    <div class="popup-content">
      <p>Ce produit est déjà dans la liste.</p>
      <button (click)="closePopup()">OK</button>
    </div>
</div>

<!-- Popup de confirmation -->
<div *ngIf="showStatusConfirmation" class="status-confirmation-popup">
    <div class="popup-content">
      <h4>Confirmer le changement de statut</h4>
      <p>Êtes-vous sûr de vouloir <span class="highlighted-status">{{ selectedStatutLabel }}</span> cette facture ?</p>
      <!-- Date de relance si ENVOYE -->
      <div *ngIf="pendingStatut === 'ENVOYE'" class="form-group">
        <label for="relanceDate" style="font-size: 12px;">Date de relance (facultative) :</label>
        <input type="datetime-local" id="relanceDate" [(ngModel)]="dateRelance" class="form-control"/>
      </div>
  
      <div class="popup-actions">
        <button class="btn btn-secondary" (click)="cancelStatusChange()">Annuler</button>
        <button class="btn btn-primary" (click)="confirmStatusChange()">Confirmer</button>
      </div>
    </div>
</div>

<!-- Liste des utilisateurs à cocher si statut = Approbation -->
<div *ngIf="showStatusConfirmation" class="status-confirmation-popup">
<div class="popup-content">
    <h4>Confirmer le changement de statut</h4>
    <p>
    Êtes-vous sûr de vouloir 
    <span class="highlighted-status">{{ selectedStatutLabel }}</span> 
    cette facture ?
    </p>

    <!-- Affichage conditionnel selon le statut -->
    <div *ngIf="pendingStatut === 'ENVOYE'" class="form-group">
    <label for="relanceDate" style="font-size: 12px;">Date de relance (facultative) :</label>
    <input type="datetime-local" id="relanceDate" [(ngModel)]="dateRelance" class="form-control" />
    </div>

    <!-- ✅ Liste des utilisateurs pour l'approbation -->
    <div *ngIf="pendingStatut === 'APPROBATION'" class="form-group">
    <label style="font-size: 12px;">Sélectionnez les utilisateurs à notifier :</label>
    <div *ngIf="users.length === 0">Aucun utilisateur à afficher</div>

        <div *ngFor="let user of users" style="display: flex; align-items: center;">
        <input
            type="checkbox"
            [(ngModel)]="user.selected"
            id="user_{{ user.id }}"
            style="margin-right: 8px; margin-bottom: 8px;"
        />
        <label for="user_{{ user.id }}">
            {{ user.nomComplet }} - {{ user.phone }}
        </label>
        </div>

    </div>

    <div class="popup-actions">
    <button class="btn btn-secondary" (click)="cancelStatusChange()">Annuler</button>
    <button class="btn btn-primary" (click)="confirmStatusChange()">Confirmer</button>
    </div>
</div>
</div>


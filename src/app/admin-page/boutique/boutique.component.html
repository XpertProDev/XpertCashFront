<div class="toast-container">
    <div *ngIf="successMessage" class="alert alert-success toast-message-success">
      {{ successMessage }}
    </div>
  
    <div *ngIf="errorMessage" class="alert alert-danger toast-message-danger">
      {{ errorMessage }}
    </div>
</div>
  
<div class="containerTable">

  <div *ngIf="isLoading" class="loading-overlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <p>Creation en cours...</p>
    </div>
  </div>

    <!-- En-tête : titre, actions et barre de recherche -->
    <div class="tasks-header">
      <h1 class="title">Mes boutiques</h1>
      <!-- <div>{{boutiques | json}}</div> -->
  
      <div class="actions">
        <button class="add-task" (click)="openPopup()">Créer </button>
        <div class="contentIcon">
          <div class="bare"></div>
           <div class="filter-container">
              <div class="iconDrop">
                <i class="ri-filter-3-line" (click)="toggleFiltreDropdown()"></i>
              </div>

              <div class="filter-dropdown" *ngIf="showFiltreDropdown">
                <div class="filter-option" (click)="filtrerParType('ALL')">Tous</div>
                <div class="filter-option" (click)="filtrerParType('BOUTIQUE')">Boutiques</div>
                <div class="filter-option" (click)="filtrerParType('ENTREPOT')">Entrepôts</div>
              </div>
            </div>
        </div>
        <div class="inputSearch">
          <input [(ngModel)]="searchTerm" type="text" placeholder="Recherche..." (input)="filterBoutiques()" />
          <i [ngClass]="searchTerm ? 'ri-close-line red-icon' : 'ri-search-2-line'" (click)="clearSearch()"></i>
        </div>
      </div>
    </div>
  
    <!-- Tableau des produits -->
    <table>
      <thead>
        <tr class="titleTableProduit">
          <th>Nom </th>
          <th>Email </th>
          <th>Adresse </th>
          <th>Téléphone </th>
          <th>Date de Creation </th>
          <th>Type</th>
          <th>Statut</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let boutique of paginatedBoutiques" (click)="openBoutiqueDetail(boutique.id)">
          <td>{{ boutique.nomBoutique }}</td>
          <td>{{ boutique.email || 'Non email' }}</td>
          <td>{{ boutique.adresse || 'Non adresse'  }}</td>
          <td>{{ boutique.telephone || 'Non téléphone'  }}</td>
          <td>{{ boutique.createdAt | date: 'dd/MM/yyyy HH:mm' }}</td>
          <!-- <td [ngClass]="boutique.typeBoutique === 'ENTREPOT' ? 'entrepot' : 'boutique'">
            {{ boutique.typeBoutique === 'ENTREPOT' ? 'Entrepôt' : 'Boutique' }}
          </td> -->

          <td class="type-indicator">
            <ng-container *ngIf="boutique.typeBoutique === 'ENTREPOT'; else boutiqueText">
              <span class="dot" style="background-color: #e67e22;"></span>
              Entrepôt
            </ng-container>
            <ng-template #boutiqueText>
              Boutique
            </ng-template>
          </td>

          <td class="content_statut_boutique">
            <span class="statut_boutique" 
                  [ngStyle]="{
                    'background-color': boutique.actif ? '#008000' : '#dc3545', 
                    'color': 'white'
                  }">
              {{ boutique.actif ? 'Actif' : 'Inactif' }}
            </span>
          </td>
          
        </tr>
      </tbody>
    </table>

    <!-- Pagination pour les boutiques -->
    <div class="pagination_global" *ngIf="boutiques.length > 0">
      <div class="pager">
        <div class="pager-info">
          <span>Boutiques par page:</span>
          <select [(ngModel)]="pageSize" (change)="onPageSizeChange()" class="page-size-select">
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
          </select>
          <span class="page-info">{{ getPageInfo() }}</span>
        </div>
        
        <div class="pager-navigation">
          <button 
            class="pager-btn" 
            [disabled]="currentPage === 0"
            (click)="goToPage(0)"
            title="Première page">
            <i class="ri-skip-back-line"></i>
          </button>
          
          <button 
            class="pager-btn" 
            [disabled]="currentPage === 0"
            (click)="goToPage(currentPage - 1)"
            title="Page précédente">
            <i class="ri-arrow-left-s-line"></i>
          </button>
          
          <div class="page-numbers">
            <button 
              *ngFor="let page of getVisiblePages()" 
              class="page-number"
              [class.active]="page === currentPage"
              (click)="onPageClick(page)"
              [disabled]="page === '...'">
              {{ page }}
            </button>
          </div>
          
          <button 
            class="pager-btn" 
            [disabled]="currentPage >= totalPages - 1"
            (click)="goToPage(currentPage + 1)"
            title="Page suivante">
            <i class="ri-arrow-right-s-line"></i>
          </button>
          
          <button 
            class="pager-btn" 
            [disabled]="currentPage >= totalPages - 1"
            (click)="goToPage(totalPages - 1)"
            title="Dernière page">
            <i class="ri-skip-forward-line"></i>
          </button>
        </div>
      </div>
    </div>
  
</div>
  
    
    <!-- Popup overlay -->
<div class="popup-overlay" *ngIf="showPopup">
  <div class="popup-content">
      <div class="popup-header">
          <h4>Ajouter une boutique</h4>
          <button class="close-btn" (click)="closePopup()">&times;</button>
      </div>
      <form [formGroup]="boutiqueForm">
        <div class="triple">
          <div class="radio-group">
              <div class="radio-option">
                <input type="radio"
                      id="typeBoutique"
                      formControlName="type"
                      name="type"
                      value="BOUTIQUE"
                      class="radio-input">
                <label for="typeBoutique" class="radio-label">
                  <span class="radio-custom"></span> Boutique
                </label>
              </div>

              <div class="radio-option">
                <input type="radio"
                      id="typeEntrepot"
                      formControlName="type"
                      name="type"
                      value="ENTREPOT"
                      class="radio-input">
                <label for="typeEntrepot" class="radio-label">
                  <span class="radio-custom"></span> Entrepôt
                </label>
              </div>
          </div>
        </div>

        <div class="popup-body">
          
          <div class="champ_grid">
            <!-- Input de nom de boutique  -->

            <div class="champ_input">
              <input class="input_focus" type="text" formControlName="nomBoutique" placeholder="Saisis le nom de boutique">
              <label class="label">Nom de la boutique</label>
              <div *ngIf="boutiqueForm.get('nomBoutique')?.invalid && boutiqueForm.get('nomBoutique')?.touched">
                <small class="error">Le nom de la boutique est vide.</small>
              </div>
            </div> 

            <!-- Input d'email'  -->
            <div class="champ_input">
              <input class="input_focus" type="email" formControlName="email" placeholder="Saisis l'email">
              <label class="label">Email</label>
              <div *ngIf="boutiqueForm.get('emailBoutique')?.invalid && boutiqueForm.get('emailBoutique')?.touched">
                <small class="error">Un email valide est vide.</small>
              </div>
            </div>

          </div>


          <!-- Input pour pays et phone  -->
          <div class="champ_grid">
            <!-- // Input de telephone Boutique  -->
            <div class="champ_input ">
              <input class="input_focus" type="number" formControlName="telephone" placeholder="00 00 00 00">
              <label class="label">Téléphone</label>
              <div *ngIf="boutiqueForm.get('telephoneBoutique')?.invalid && boutiqueForm.get('telephoneBoutique')?.touched">
                <small class="error">Le numéro de téléphone est requis.</small>
              </div>
            </div>

            <!-- Input Numero de téléphone  -->
            <div class="champ_input">
                <input class="input_focus" type="text" formControlName="adresse" placeholder="Saisis l'adresse">
                <label class="label">Adresse boutique</label>
                <div *ngIf="boutiqueForm.get('adresseBoutique')?.invalid && boutiqueForm.get('adresseBoutique')?.touched">
                    <small class="error">L'adresse boutique valide est vide.</small>
                </div>
            </div>
          </div>

          
        </div>
        <div class="popup-footer">
            <button class="btn-cancel" (click)="closePopup()">Annuler</button>
            <button class="btn-submit" 
                    [disabled]="boutiqueForm.invalid" 
                    [style.backgroundColor]="boutiqueForm.valid ? '#0672E4' : '#0671e434'"
                    [style.color]="boutiqueForm.valid ? '#ffffff' : '#00000073'"
                    [style.cursor]="boutiqueForm.valid ? 'pointer' : 'no-drop'"  (click)="onSubmit()">
              Ajouter
            </button>
        </div>
      </form>
  </div>
</div>
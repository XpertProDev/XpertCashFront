<div class="containerTable">
  <!-- En-tête : titre, actions et barre de recherche -->
  <div class="tasks-header">
    <h1 class="title">Mes Stocks</h1>
    <div class="actions">
      <button class="add-task" routerLink="/stock_ajustement" >Créer un ajustement de stock</button>
      <div class="contentIcon">
        <i class="ri-refresh-line"></i>
        <div class="bare"></div>
        <div class="export-container">
          <div class="iconDrop">
            <i class="ri-printer-cloud-line" (click)="toggleExportDropdown()"></i>
          </div>
          <div class="export-dropdown" *ngIf="showExportDropdown">
            <div class="export-option" (click)="downloadExcel()">Télécharger en Excel</div>
            <div class="export-option" (click)="downloadPDF()">Télécharger en PDF</div>
            <div class="export-option" (click)="downloadCSV()">Télécharger en CSV</div>
          </div>
        </div>
      </div>
      <div class="inputSearch">
        <i class="ri-search-2-line"></i>
        <input type="text" [(ngModel)]="searchText" placeholder="Recherche...." />
      </div>
    </div>
  </div>

  <div class="container_list_boutique">
    <div class="content_list_boutique">
      <div class="name_boutique">
        <ng-container *ngIf="(boutiques?.length || 0) > 0; else noBoutiques">
          <!-- Option "Toutes les boutiques" -->
          <div class="all_boutique" 
               [class.name_boutique_active]="selectedBoutique === null"
               (click)="selectBoutique(null)">
            <p class="all_boutique">Toutes les boutiques</p>
          </div>
          
          <!-- Liste des boutiques -->
          <ng-container *ngFor="let boutique of boutiques; let i = index">
            <p 
              [class.name_boutique_active]="boutique.id === selectedBoutique?.id && boutique.actif"
              [class.suspended-boutique]="!boutique.actif"
              [style.color]="boutique.actif"
              (click)="boutique.actif ? selectBoutique(boutique) : showSuspendedBoutiqueDialog()">
              {{ boutique.nomBoutique }}
              <i *ngIf="!boutique.actif" class="ri-error-warning-line warning-icon"></i>
            </p>
            <div *ngIf="i !== boutiques.length - 1" class="barre"></div>
          </ng-container>
        </ng-container>
        <ng-template #noBoutiques>
          <p class="no-boutiques-message">Aucune boutique trouvée</p>
        </ng-template>
      </div>
    </div>
  </div>
  

  <!-- Tableau des produits -->
  <table>
    <thead>
      <tr class="titleTableProduit">
        <th>Code</th>
        <th>Photo</th>
        <th>Nom produit</th>
        <!-- <th>Description</th> -->
        <th>Catégorie</th>
        <th>Prix Vente</th>
        <th>Coût du produit</th>
        <th style="background-color: #0671e44a;">En stock</th>
        <th>Unité</th>
        <th>Seuil Alerte</th>
        <th>Boutique</th>
      </tr>
    </thead>
    <tbody>
      <!-- Boucle sur la liste filtrée et paginée -->
      <!-- (click)="openStockDetail(stock.id)"  -->
      <tr *ngFor="let product of filteredProducts(); let i = index" style="font-size: 10px;" (click)="openStockDetail(product.id)" >
        <td [innerHTML]="highlightMatch(product.codeGenerique || '')"></td>
        <td>
          <div class="imgProduit">
            <img [src]="product.photo">
            <!-- <img [src]="(!product.photo || product.photo === 'null' || product.photo.trim() === '') ? 'assets/img/lait.jpeg' : product.photo"> -->
          </div>
          <div class="modal" *ngIf="imagePopup">
            <div class="modal-content" (click)="$event.stopPropagation()">
              <img [src]="imagePopup" alt="Produit">
            </div>
          </div>
        </td>
        <!-- <td>{{product | json}}</td> -->
        <td [innerHTML]="highlightMatch(product.nom)"></td> 
        <!-- <td class="description-cell" (mouseover)="showDescription = true" (mouseout)="showDescription = false">
        <td class="description-cell" (mouseover)="showDescription = true" (mouseout)="showDescription = false">
          {{ product.description | slice:0:20 }}{{ product.description.length > 20 ? '...' : '' }}
          <div class="description-hover" *ngIf="showDescription">{{ product.description }}</div>
        </td>-->
        <td [innerHTML]="highlightMatch(product.nomCategorie || 'Non catégorie')"></td>
        <td>{{ product.prixVente | customNumber}}</td>
        <td>{{ product.prixAchat | customNumber}}</td>
        <td style="background-color: #0671e410;" [innerHTML]="highlightMatch(product.quantite.toString())"></td>
        <td>{{ product.nomUnite || 'Non unité' }}</td>
        <td>{{ product.seuilAlert }}</td>
        <td> Name boutique </td>
      </tr>
      <!-- Message si aucun produit ne correspond à la recherche -->
      <tr *ngIf="tasks.length > 0 && filteredProducts().length === 0">
        <td colspan="10" style="text-align: center;">Aucun produit trouvé.</td>
      </tr>
    </tbody>
  </table>

  <!-- Message si aucun produit n'est présent -->
  <div *ngIf="tasks.length === 0" style="text-align: center; margin-top: 20px;">
    <p style="color: red;">Vous n'avez pas de produit</p>
  </div>

  <!-- Pagination -->
  <div class="pagination">
    <mat-paginator [length]="tasks.length"
                   [pageSize]="pageSize"
                   [pageSizeOptions]="[5, 10, 25, 100]"
                   (page)="onPageChange($event)">
    </mat-paginator>
  </div>
</div>

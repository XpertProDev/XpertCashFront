<div class="global_container_facture">
    <div class="container_facture">

        <!-- <div class="title">
            <h3>Mes facture</h3>
        </div> -->


        <div class="tasks-header">
          <h1 class="title">Factures</h1>
          
          <div class="actions">
            <!--Les recherche-->
            <div class="inputSearch">
              <i class="ri-search-2-line"></i>
              <input type="text" placeholder="Recherche...." />
            </div>
          </div>
        </div>

         <!-- Message quand il n'y a pas de factures -->
        <div *ngIf="noFacturesAvailable" class="no-facture-message">
          {{ messageNoFacture }}
        </div>

        <div class="factures">
            <mat-accordion *ngIf="!noFacturesAvailable" class="example-headers-align">
                <mat-expansion-panel class="cadre_panel" *ngFor="let facture of factures; let i = index" [expanded]="step() === i" (opened)="setStep(i)" hideToggle>
                    <!-- // header facture  -->
                    <mat-expansion-panel-header>
                        <mat-panel-title class="title_facture"> Facture : <span class="title_facture_code">{{ facture.numeroFacture }}</span> </mat-panel-title>
                        <!-- icon arrow icon_arrow -->
                        <div class="icon_export">
                            <div class="export-container" style="display: flex; align-items: center;">
                                <!-- Icon pour afficher/masquer la description -->
                                <div class="iconDrop" style="margin-right: 20px;" (click)="toggleDescription($event)">
                                    <i class="ri-chat-check-line" *ngIf="!showDescription; else openIcon" title="Afficher la description"></i>
                                    <ng-template #openIcon>
                                        <i class="ri-chat-off-line" title="Fermer la description"></i>
                                    </ng-template>
                                </div>
                        
                                <!-- Autres icônes -->
                                <div class="iconDrop">
                                    <i class="ri-printer-cloud-line" (click)="toggleExportDropdown($event)"></i>
                                </div>
                                <div class="export-dropdown" *ngIf="showExportDropdown">
                                    <div class="export-option">Télécharger en PDF</div>
                                    <div class="export-option">Imprimer</div>
                                </div>
                        
                                <!-- Flèche -->
                                <div class="iconDrop" style="margin-left: 20px;">
                                    <i class="ri-arrow-down-s-fill"></i>
                                </div>
                            </div>
                        </div>
                        
                    </mat-expansion-panel-header>
              
                    <!-- // contenu de la facture  -->
                     <div class="content_facture">

                        <!-- // info de produit  -->
                        <div class="title_produit">
                            <h4>Informations de la boutique</h4>
                        </div>

                        <div class="bare"></div>

                        <!-- // Imprimate  -->
                        <div class="container_imprimate">
                            <div class="content_imprimate">
                    
                            <!-- Les autres infos restent inchangées -->
                            <div class="double_info_content">
                                <!-- // left  -->
                                <div class="info_content">
                                    <div class="info">
                                      <p class="info_title">Boutique :</p>
                                      <p class="info_value" style="color: #0672E4;">{{ boutiqueName }}</p>
                                    </div>
                                    <div class="info">
                                      <p class="info_title">Date de creation :</p>
                                      <p class="info_value">{{ facture.dateFacture | date:'dd/MM/yyyy à HH:mm' }}</p>
                                    </div>
                                    <div class="info">
                                      <p class="info_title">Créé par :</p>
                                      <p class="info_value">{{ facture.nomUtilisateur }}</p>
                                    </div>
                                    <div class="info">
                                      <p class="info_title">Téléphone :</p>
                                      <p class="info_value">{{ facture.telephoneUtilisateur }}</p>
                                    </div>
                                    <div class="info">
                                      <p class="info_title">Type de mouvement :</p>
                                      <p class="info_value" style="color: #008000; font-weight: 600;">{{facture.type}}</p>
                                    </div>
                                </div>

                                <!-- //  right  -->
                                 <!-- Description : affichage conditionnel -->
                                <div class="description_detail" *ngIf="showDescription">
                                    <textarea readonly >{{ facture.description || 'Non description' }}</textarea>
                                </div>
                            </div>

                            <!-- // info de produit  -->
                            <div class="title_produit" style="margin-top: 25px;">
                                <h4>Informations sur les produits</h4>
                            </div>

                            <!-- // barre  -->
                            <div class="bare"></div>

                          </div>
                    
                            <!-- Le reste du template (table, signature, etc.) -->
                            <div class="containerTable">
                              <div class="table_title">
                                <p>Produits</p>
                              </div>
                              <div class="mat-elevation-z8">
                                <table mat-table [dataSource]="facture.dataSource">
                              
                                  <ng-container matColumnDef="codeGenerique">
                                    <th mat-header-cell *matHeaderCellDef>Code</th>
                                    <td mat-cell *matCellDef="let p">{{ p.codeGenerique }}</td>
                                  </ng-container>
                        
                                  <ng-container matColumnDef="nomProduit">
                                    <th mat-header-cell *matHeaderCellDef>Produit</th>
                                    <td mat-cell *matCellDef="let p">{{ p.nomProduit }}</td>
                                  </ng-container>
                        
                                  <ng-container matColumnDef="prixUnitair">
                                    <th mat-header-cell *matHeaderCellDef>Prix unitaire</th>
                                    <td mat-cell *matCellDef="let p">{{ p.prixUnitair }}</td>
                                  </ng-container>
                        
                                  <ng-container matColumnDef="quantite">
                                    <th mat-header-cell *matHeaderCellDef>Quantité</th>
                                    <td mat-cell *matCellDef="let p">{{ p.quantite }}</td>
                                  </ng-container>
                        
                                  <ng-container matColumnDef="total">
                                    <th mat-header-cell *matHeaderCellDef>Total</th>
                                    <td mat-cell *matCellDef="let p" style="color: #ff0000;">{{ p.total }}</td>
                                  </ng-container>
                        
                                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                                </table>
                              
                                <!-- Ici, vous devez avoir un paginator pour chaque table -->
                                <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons aria-label="Select page of produits"
                                  #paginator>
                                </mat-paginator>
                              </div>
                              
                            </div>
                    
                            <!-- Signature -->
                            <div class="container_signature">
                              <div class="content_signature">
                                <div class="signature">
                                  <p>Signature</p>
                                </div>
                                <div class="approuve">
                                  <p>Approuvé par</p>
                                </div>
                                <div class="recu">
                                  <p>Reçu par</p>
                                </div>
                              </div>
                            </div>
                        </div>

                     </div>
                </mat-expansion-panel>
                <!-- // new mat-expansion-panel  -->
                <!-- <div class="icon_more">
                    <i class="ri-more-2-fill"></i>
                </div> -->
                
            </mat-accordion>
              

        </div>
    </div>
</div>
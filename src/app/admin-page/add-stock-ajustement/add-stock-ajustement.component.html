<div class="container_global">
  <div class="content_formulaire">
    <div class="modal-body">
      <form class="container_formulaire">
        <!-- Titre d'ajout de produits -->
        <div class="Title">
          <h3>Ajustements des stocks</h3>
        </div>

        <div class="form_left_right">
          <div class="formulaire">
            <!-- Cadre contenant le select et la description -->
            <div class="information_cadre">
              <div class="info_titre_input">
                <div class="double_input">
                  <!-- // Type ajouter et reduire  -->
                  <div class="champ_input champ_input2">
                    <div class="title_input">Type</div>
                    <!-- On lie le select à "selectedAction" -->
                    <select required name="action" class="input_focus" [(ngModel)]="selectedAction">
                      <!-- <option value="">Choisissez-en un</option> -->
                      <option value="ajouter">Ajouter</option>
                      <option value="reduire">Reduire</option>
                    </select>
                  </div>
                  <!-- // Boutique  -->
                  <div class="champ_input champ_input2">
                    <div class="title_input">Boutique</div>
                    <input type="text" class="input_focus" disabled id="boutique" [value]="boutiqueName" name="boutique" style="cursor: no-drop; color: #0672E4;">
                  </div>
                </div>

                <form [formGroup]="ajusteForm">
                  <div class="double_input" *ngIf="selectedAction === 'ajouter'">
                    <!-- // Description  -->
                    <div class="champ_input champ_input2">
                      <textarea class="input_focus2" formControlName="descriptionAjout" id="descriptionAjout" name="descriptionAjout" placeholder="Saisis Une description pour ce produit"></textarea>
                      <label for="descriptionAjout" class="label labelColor">Description (Facultatif)</label>
                      <div *ngIf="a['descriptionAjout'].touched && a['descriptionAjout'].invalid" class="error-message">
                        <span *ngIf="a['descriptionAjout'].errors?.['minlength']">La description doit avoir au moins 2 caractères.</span>
                        <span *ngIf="a['descriptionAjout'].errors?.['maxlength']">La description ne doit pas dépasser 100 caractères.</span>
                      </div>
                    </div>
                    <!-- // Fournisseur  -->
                    <div class="champ_input champ_input2">
                      <div class="title_input">Fournisseur</div>
                      <!-- On lie le select à "selectedActionFournisseur" -->
                      <select required name="action" class="input_focus">
                        <option value="">Choisissez-en un</option>
                        <!-- <option value="ajouter">Ajouter</option> -->
                      </select>
                    </div>
  
                  </div>
                </form>

                <div class="double_input" *ngIf="selectedAction === 'reduire'">
                  <!-- // Description  -->
                  <div class="champ_input champ_input2">
                    <textarea class="input_focus2" [(ngModel)]="descriptionRetire" id="description" name="description" placeholder="Saisis Une description pour ce produit"></textarea>
                    <label for="description" class="label labelColor">Description re (Facultatif)</label>
                  </div>
                  <!-- // Fournisseur  -->
                  <div class="champ_input champ_input2">
                    <div class="title_input">Fournisseur</div>
                    <!-- On lie le select à "selectedActionFournisseur" -->
                    <select required name="action" class="input_focus">
                      <option value="">Choisissez-en</option>
                      <!-- <option value="ajouter">Ajouter</option> -->
                    </select>
                  </div>

                </div>
                
              </div>
            </div>

            <!-- Cadre pour "Ajouter" -->
            <div class="information_cadre" *ngIf="selectedAction === 'ajouter'">
              <div class="info_titre_input">

                <div class="add_new_quantite_stock">
                    <h4>Gestion des stocks</h4>
                </div>

                <div class="containerTable">
                  <table>
                    <thead>
                      <tr class="titleTableProduit">
                        <th class="title_table_name">Mes produits</th>
                        <th class="title_table_contenu">Stock actuel</th>
                        <th class="title_table_contenu" style="color: #0672E4;">Quantité à ajouter</th>
                        <th class="title_table_contenu">Coût unitaire</th>
                        <th class="title_table_contenu">Stock après</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="tr_stock" style="border-top: 1px solid #f0f2f5;">
                        <td>
                          <div class="champ_input">
                            <select required name="selectedProduct" class="input_focus_type input_focus_type_select" [(ngModel)]="selectedProduct">
                              <option [ngValue]="null">Sélectionner un produit</option>
                              <option *ngFor="let produit of tasks" [ngValue]="produit">
                                {{ produit.nom }}
                              </option>
                            </select>
                          </div>
                        </td>                        
                        <td>
                          <!-- // Quantité  -->
                          <div class="champ_input" style="margin-right: 15px;">
                            <input type="text" disabled class="input_focus_type" id="stockActuel" 
                              [value]="selectedProduct ? selectedProduct.quantite : 0" 
                              name="stockActuel" style="cursor: no-drop; text-align: center;">
                          </div>                         
                        </td>
                        <td>
                          <form>
                            <div class="champ_input" style="margin-right: 15px;">
                              <input type="number" class="input_focus_type"
                                     id="addQuantite"
                                     [(ngModel)]="quantiteAjoute"
                                     name="addQuantite"
                                     style="text-align: center;"
                                     min="0">
                            </div>
                          </form>
                        </td>
                        <td>
                          <!-- // prix Vente  -->
                          <div class="champ_input" style="margin-right: 15px;">
                            <input type="text" disabled class="input_focus_type" id="CoutUnitaire" 
                              [value]="selectedProduct ? selectedProduct.prixVente : 0" 
                              name="CoutUnitaire" style="cursor: no-drop; text-align: center;">
                          </div>
                        </td>                        
                        <td>
                          <div class="champ_input">
                            <input type="text" disabled 
                                   class="input_focus_type" 
                                   id="stockApres" 
                                   [value]="stockApres" 
                                   name="stockApres" 
                                   style="text-align: center;">
                          </div>
                        </td>                                                               
                      </tr>
                    </tbody>

                    <tbody *ngIf="stocksVisible">
                        <tr *ngFor="let stock of adjustedStocks" class="tr_stock" style="border-top: 1px solid #f0f2f5;">
                            <td>
                              <div class="champ_input_list_stock" style="margin-right: 10px;">
                                  <input type="text" readonly class="input_table" [value]="getProductName(stock)">
                              </div>
                            </td>
                            <td>
                              <div class="champ_input_list_stock" style="margin-right: 15px;">
                                  <input type="text" readonly class="input_table" [value]="stock.stockActuel" style="text-align: center;">
                              </div>
                            </td>
                            <td>
                              <div class="champ_input_list_stock" style="margin-right: 15px;">
                                <input type="text" readonly class="input_table" 
                                  [value]="stock.quantiteAjoute && stock.quantiteAjoute > 0 ? stock.quantiteAjoute : stock.quantiteRetirer" 
                                  style="text-align: center;">
                              </div>
                            </td>
                            <td>
                              <div class="champ_input_list_stock" style="margin-right: 15px;">
                                <input type="text" readonly class="input_table" [value]="getProductPrixVente(stock)" style="text-align: center;">
                              </div>
                            </td>
                            <td>
                              <div class="champ_input_list_stock">
                                <input type="text" readonly class="input_table" 
                                [value]="stock.stockApres" style="text-align: center;">
                              </div>
                            </td>
                        </tr>
                    </tbody>
                  </table>

                  <div *ngIf="errorMessage" class="error-message">
                    {{ errorMessage }}
                  </div>
                </div>

                <!-- // button de ajustement -->
                <!-- <div class="btn_ajuster">
                  <button>Ajouter plus</button>
                </div> -->
              </div>
            </div>

            <!-- Cadre pour "Reduire" -->
            <div class="information_cadre" *ngIf="selectedAction === 'reduire'">
              <div class="info_titre_input">

                <div class="add_new_quantite_stock">
                    <h4>Gestion des stocks</h4>
                </div>

                <div class="containerTable">
                  <table>
                    <thead>
                        <tr class="titleTableProduit">
                            <th class="title_table_name">Mes produits</th>
                            <th class="title_table_contenu">Stock actuel</th>
                            <th class="title_table_contenu" style="color: red;">Quantité à reduire</th>
                            <th class="title_table_contenu">Coût unitaire</th>
                            <th class="title_table_contenu">Stock après</th>
                        </tr>
                    </thead>
                    <tbody>
                      <tr class="tr_stock" style="border-top: 1px solid #f0f2f5;">
                        <td>
                          <div class="champ_input">
                            <select required name="selectedProduct" class="input_focus_type input_focus_type_select" [(ngModel)]="selectedProduct">
                              <option [ngValue]="null">Sélectionner un produit</option>
                              <option *ngFor="let produit of tasks" [ngValue]="produit">
                                {{ produit.nom }}
                              </option>
                            </select>
                          </div>
                        </td>
                        <td>
                          <!-- // Quantité  -->
                          <div class="champ_input" style="margin-right: 15px;">
                            <input type="text" disabled class="input_focus_type" id="stockActuel" 
                              [value]="selectedProduct ? selectedProduct.quantite : 0" 
                              name="stockActuel" style="cursor: no-drop; text-align: center;">
                          </div>  
                        </td>
                        <td>
                          <form>
                            <div class="champ_input" style="margin-right: 15px;">
                              <input type="number" class="input_focus_type"
                                     id="quantiteRetirer"
                                     [(ngModel)]="quantiteRetirer"
                                     name="quantiteRetirer"
                                     style="text-align: center;"
                                     min="0">
                            </div>
                          </form>
                        </td>
                        <td>
                          <!-- // prix Vente  -->
                          <div class="champ_input" style="margin-right: 15px;">
                            <input type="text" disabled class="input_focus_type" id="CoutUnitaire" 
                              [value]="selectedProduct ? selectedProduct.prixVente : 0" 
                              name="CoutUnitaire" style="cursor: no-drop; text-align: center;">
                          </div>
                        </td>
                        <td>
                          <div class="champ_input">
                            <input type="text" disabled 
                                   class="input_focus_type" 
                                   id="stockApres" 
                                   [value]="stockApres" 
                                   name="stockApres" 
                                   style="text-align: center;">
                          </div>
                        </td>
                      </tr>
                    </tbody>

                    <tbody *ngIf="stocksVisible">
                        <tr *ngFor="let stock of adjustedStocks" class="tr_stock" style="border-top: 1px solid #f0f2f5;">
                            <td>
                                <div class="champ_input_list_stock" style="margin-right: 10px;">
                                    <input type="text" readonly class="input_table"  [value]="getProductName(stock)">
                                </div>
                                
                            </td>
                            <td>
                              <div class="champ_input_list_stock" style="margin-right: 15px;">
                                  <input type="text" readonly class="input_table" [value]="stock.stockActuel" style="text-align: center;">
                              </div>
                            </td>
                            <td>
                              <div class="champ_input_list_stock" style="margin-right: 15px;">
                                <input type="text" readonly class="input_table" 
                                  [value]="stock.quantiteRetirer && stock.quantiteRetirer > 0 ? stock.quantiteRetirer : stock.quantiteAjoute" 
                                  style="text-align: center;">
                              </div>
                            </td>
                            <td>
                              <div class="champ_input_list_stock" style="margin-right: 15px;">
                                <input type="text" readonly class="input_table" [value]="getProductPrixVente(stock)" style="text-align: center;">
                              </div>
                            </td>
                            <td>
                              <div class="champ_input_list_stock">
                                <input type="text" readonly class="input_table" 
                                [value]="stock.stockApres" style="text-align: center;">
                              </div>
                            </td>
                        </tr>
                    </tbody>
                  </table>

                  <div *ngIf="errorMessage" class="error-message">
                    {{ errorMessage }}
                  </div>
                </div>

                <!-- // button de ajustement  -->
                <!-- <div class="btn_ajuster_reduire">
                  <button>Reduire plus</button>
                </div> -->
              </div>
            </div>

            <!-- Boutons Annuler et Sauvegarder -->
            <div class="information_cadre" *ngIf="selectedAction === 'ajouter'">
              <div class="info_titre_input info_titre_input_btn">
                <div class="btn_annuler">
                  <button class="btn_cancel">Annuler</button>
                </div>
                <div class="btn_ajouter">
                  <button class="btn_save" (click)="AjouterDesQuan()">Ajuster</button>
                </div>
              </div>
            </div>

            <!-- Boutons Annuler et Sauvegarder -->
            <div class="information_cadre" *ngIf="selectedAction === 'reduire'">
              <div class="info_titre_input info_titre_input_btn">
                <div class="btn_annuler">
                  <button class="btn_cancel">Annuler</button>
                </div>
                <div class="btn_ajouter">
                  <button class="btn_save" (click)="RetirerDesQuan()">Ajuster</button>
                </div>
              </div>
            </div>

          </div>
        </div>
      </form>
    </div>
  </div>
</div>

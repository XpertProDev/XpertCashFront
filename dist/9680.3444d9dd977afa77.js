"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[9680],{99680:(Nt,P,u)=>{u.r(P),u.d(P,{FactureComponent:()=>kt});var M=u(10467),f=u(60177),t=u(54438),R=u(88834),I=u(3),w=u(25084),m=u(9454),j=u(30636),k=u(99213),$=u(99631),h=u(36440),p=u(9159),x=u(89417),D=u(96115),y=u(89107),N=(u(34941),u(85837)),B=u(27468),E=u(22525),T=u(88026),F=u(21626),q=u(25558),C=u(99437),b=u(18810),G=u(96354),S=u(7673);let A=(()=>{class n{constructor(e,o){this.http=e,this.usersService=o,this.apiUrl=E.c.apiBaseUrl,this.boutiques=[]}getFactures(){return this.usersService.getValidAccessToken().pipe((0,q.n)(e=>{const o=new F.Lr({Authorization:`Bearer ${e}`});return this.http.get(`${this.apiUrl}/factures`,{headers:o})}),(0,C.W)(e=>(console.error("Erreur lors de la r\xe9cup\xe9ration des factures:",e),(0,b.$)(()=>e))))}getFacturesByBoutique(e){return this.usersService.getValidAccessToken().pipe((0,q.n)(o=>{const a=new F.Lr({Authorization:`Bearer ${o}`});return this.http.get(`${this.apiUrl}/factures/${e}`,{headers:a}).pipe((0,G.T)(c=>c||[]),(0,C.W)(c=>404===c.status?(0,S.of)([]):(0,b.$)(()=>c)))}),(0,C.W)(o=>(console.error("Erreur lors de la r\xe9cup\xe9ration des factures par boutique:",o),(0,b.$)(()=>o))))}getBoutiqueNameById(e){return this.boutiques.find(a=>a.id===e)?.nomBoutique||"Boutique inconnue"}setBoutiques(e){this.boutiques=e}static{this.\u0275fac=function(o){return new(o||n)(t.KVO(F.Qq),t.KVO(T.g))}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var X=u(75351);const z=()=>[5,10,25,100];function Y(n,s){if(1&n&&(t.j41(0,"span",24),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.SpI(" ",e.totalAllFactures," ")}}function U(n,s){if(1&n&&(t.j41(0,"span",24),t.EFF(1),t.k0s()),2&n){const e=t.XpG().$implicit,o=t.XpG(2);t.R7$(),t.SpI(" ",o.factureCounts[e.id]," ")}}function V(n,s){1&n&&t.nrm(0,"i",28)}function J(n,s){1&n&&t.nrm(0,"div",29)}function H(n,s){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"p",25),t.bIt("click",function(){const a=t.eBV(e).$implicit,c=t.XpG(2);return t.Njj(a.actif?c.selectBoutique(a):c.showSuspendedBoutiqueDialog())}),t.EFF(2),t.DNE(3,U,2,1,"span",22)(4,V,1,0,"i",26),t.k0s(),t.DNE(5,J,1,0,"div",27),t.bVm()}if(2&n){const e=s.$implicit,o=s.index,a=t.XpG(2);t.R7$(),t.AVh("name_boutique_active",e.id===(null==a.selectedBoutique?null:a.selectedBoutique.id)&&e.actif)("suspended-boutique",!e.actif),t.R7$(),t.SpI(" ",e.nomBoutique," "),t.R7$(),t.Y8G("ngIf",a.factureCounts[e.id]>0),t.R7$(),t.Y8G("ngIf",!e.actif),t.R7$(),t.Y8G("ngIf",o!==a.boutiques.length-1)}}function L(n,s){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"div",20),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.selectBoutique(null))}),t.j41(2,"p",21),t.EFF(3," Toutes les boutiques "),t.DNE(4,Y,2,1,"span",22),t.k0s()(),t.DNE(5,H,6,8,"ng-container",23),t.bVm()}if(2&n){const e=t.XpG();t.R7$(),t.AVh("name_boutique_active",null===e.selectedBoutique),t.R7$(3),t.Y8G("ngIf",e.totalAllFactures>0),t.R7$(),t.Y8G("ngForOf",e.boutiques)}}function W(n,s){if(1&n&&(t.j41(0,"div",30),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",e.noFacturesMessage," ")}}function Q(n,s){if(1&n&&(t.j41(0,"div",30),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(' Aucune facture trouv\xe9e pour le num\xe9ro "',e.searchTerm,'" ')}}function Z(n,s){if(1&n&&(t.j41(0,"div",78),t.EFF(1," Date : "),t.j41(2,"span",79),t.EFF(3),t.nI1(4,"date"),t.k0s()()),2&n){const e=t.XpG().$implicit;t.R7$(3),t.JRh(t.i5U(4,1,e.dateFacture,"dd/MM/yyyy"))}}function K(n,s){1&n&&t.nrm(0,"div",29)}function tt(n,s){1&n&&t.nrm(0,"div",29)}function et(n,s){if(1&n&&(t.j41(0,"div",80),t.EFF(1," N\xba Fournisseur : "),t.nrm(2,"span",81),t.k0s()),2&n){const e=t.XpG().$implicit,o=t.XpG(2);t.R7$(2),t.Y8G("innerHTML",o.highlightMatch(e.codeFournisseur||"****"),t.npT)}}function nt(n,s){1&n&&t.nrm(0,"div",29)}function ot(n,s){if(1&n&&(t.j41(0,"div",78),t.EFF(1," Cr\xe9\xe9 par : "),t.j41(2,"span",79),t.EFF(3),t.k0s()()),2&n){const e=t.XpG().$implicit;t.R7$(3),t.JRh(e.nomUtilisateur)}}function it(n,s){1&n&&t.nrm(0,"div",29)}function at(n,s){if(1&n&&(t.j41(0,"div",78),t.EFF(1," Type de mouvement : "),t.j41(2,"span",82),t.EFF(3),t.k0s()()),2&n){const e=t.XpG().$implicit,o=t.XpG(2);t.R7$(2),t.xc7("color",o.getColor(e.type)),t.R7$(),t.SpI(" ",e.type," ")}}function rt(n,s){1&n&&t.nrm(0,"i",83)}function st(n,s){1&n&&t.nrm(0,"i",84)}function ct(n,s){if(1&n){const e=t.RV6();t.j41(0,"div",85)(1,"div",86),t.bIt("click",function(){t.eBV(e);const a=t.XpG().$implicit,c=t.XpG(2);return t.Njj(c.downloadPDFWithJsPDF(a,c.boutiqueName))}),t.EFF(2,"T\xe9l\xe9charger en PDF"),t.k0s(),t.j41(3,"div",87),t.EFF(4,"Imprimer"),t.k0s()()}}function ut(n,s){if(1&n&&(t.j41(0,"div")(1,"p",88),t.EFF(2),t.k0s()()),2&n){const e=t.XpG(3);t.R7$(2),t.JRh(e.selectedBoutique.nomBoutique)}}function lt(n,s){if(1&n&&(t.j41(0,"p",88),t.EFF(1),t.k0s()),2&n){const e=t.XpG().$implicit,o=t.XpG(2);t.R7$(),t.SpI(" ",o.getBoutiqueNamesForFacture(e)||"Non sp\xe9cifi\xe9"," ")}}function pt(n,s){if(1&n&&(t.j41(0,"div",89)(1,"textarea",90),t.EFF(2),t.k0s()()),2&n){const e=t.XpG().$implicit;t.R7$(2),t.JRh(e.description||"sans description")}}function dt(n,s){1&n&&(t.j41(0,"th",91),t.EFF(1,"Code"),t.k0s())}function _t(n,s){if(1&n&&(t.j41(0,"td",92),t.EFF(1),t.k0s()),2&n){const e=s.$implicit;t.R7$(),t.JRh(e.codeGenerique)}}function mt(n,s){1&n&&(t.j41(0,"td",93),t.EFF(1," Total"),t.k0s())}function gt(n,s){1&n&&(t.j41(0,"th",91),t.EFF(1,"D\xe9signation"),t.k0s())}function ft(n,s){if(1&n&&(t.j41(0,"td",92),t.EFF(1),t.k0s()),2&n){const e=s.$implicit;t.R7$(),t.JRh(e.nomProduit)}}function ht(n,s){1&n&&(t.j41(0,"td",93),t.EFF(1,"...."),t.k0s())}function xt(n,s){1&n&&(t.j41(0,"th",91),t.EFF(1,"Prix unitaire"),t.k0s())}function Ft(n,s){if(1&n&&(t.j41(0,"td",92),t.EFF(1),t.nI1(2,"customNumber"),t.k0s()),2&n){const e=s.$implicit;t.R7$(),t.JRh(t.bMT(2,1,e.prixUnitair))}}function Ct(n,s){1&n&&(t.j41(0,"td",93),t.EFF(1,"...."),t.k0s())}function bt(n,s){1&n&&(t.j41(0,"th",91),t.EFF(1,"Quantit\xe9"),t.k0s())}function vt(n,s){if(1&n&&(t.j41(0,"td",92),t.EFF(1),t.nI1(2,"customNumber"),t.k0s()),2&n){const e=s.$implicit;t.R7$(),t.JRh(t.bMT(2,1,e.quantite))}}function Pt(n,s){1&n&&(t.j41(0,"td",93),t.EFF(1,"...."),t.k0s())}function Mt(n,s){1&n&&(t.j41(0,"th",91),t.EFF(1,"Total"),t.k0s())}function Et(n,s){if(1&n&&(t.j41(0,"td",94),t.EFF(1),t.nI1(2,"customNumber"),t.k0s()),2&n){const e=s.$implicit;t.R7$(),t.JRh(t.bMT(2,1,e.total))}}function Tt(n,s){if(1&n&&(t.j41(0,"td",95),t.EFF(1),t.nI1(2,"customNumber"),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.JRh(t.bMT(2,1,e.totalSum))}}function qt(n,s){1&n&&t.nrm(0,"tr",96)}function Ot(n,s){1&n&&t.nrm(0,"tr",97)}function Rt(n,s){1&n&&t.nrm(0,"tr",98)}function It(n,s){if(1&n){const e=t.RV6();t.j41(0,"mat-expansion-panel",33,0),t.bIt("opened",function(){const a=t.eBV(e).index,c=t.XpG(2);return t.Njj(c.setStep(a))}),t.j41(2,"mat-expansion-panel-header")(3,"mat-panel-title",34),t.DNE(4,Z,5,4,"div",35)(5,K,1,0,"div",27),t.j41(6,"div",36),t.EFF(7," Facture : "),t.nrm(8,"span",37),t.k0s(),t.DNE(9,tt,1,0,"div",27)(10,et,3,1,"div",38)(11,nt,1,0,"div",27)(12,ot,4,1,"div",35)(13,it,1,0,"div",27)(14,at,4,3,"div",35),t.k0s(),t.j41(15,"div",39)(16,"div",40)(17,"div",41),t.bIt("click",function(a){t.eBV(e);const c=t.XpG(2);return t.Njj(c.toggleDescription(a))}),t.DNE(18,rt,1,0,"i",42)(19,st,1,0,"ng-template",null,1,t.C5r),t.k0s(),t.j41(21,"div",43)(22,"i",44),t.bIt("click",function(a){t.eBV(e);const c=t.XpG(2);return t.Njj(c.toggleExportDropdown(a))}),t.k0s()(),t.DNE(23,ct,5,0,"div",45),t.j41(24,"div",46),t.nrm(25,"i",47),t.k0s()()()(),t.j41(26,"div",48),t.nrm(27,"div",49),t.j41(28,"div",50)(29,"h4"),t.EFF(30,"Informations de la boutique"),t.k0s()(),t.nrm(31,"div",49),t.j41(32,"div",51)(33,"div",52)(34,"div",53)(35,"div",54)(36,"div",55)(37,"p",56),t.EFF(38,"Boutique :"),t.k0s(),t.DNE(39,ut,3,1,"div",57)(40,lt,2,1,"ng-template",null,2,t.C5r),t.k0s(),t.j41(42,"div",55)(43,"p",56),t.EFF(44,"Date de creation :"),t.k0s(),t.j41(45,"p",58),t.EFF(46),t.nI1(47,"date"),t.k0s()(),t.j41(48,"div",55)(49,"p",56),t.EFF(50,"Cr\xe9\xe9 par :"),t.k0s(),t.j41(51,"p",58),t.EFF(52),t.k0s()(),t.j41(53,"div",55)(54,"p",56),t.EFF(55,"T\xe9l\xe9phone :"),t.k0s(),t.j41(56,"p",58),t.EFF(57),t.k0s()(),t.j41(58,"div",55)(59,"p",56),t.EFF(60,"Email :"),t.k0s(),t.j41(61,"p",58),t.EFF(62),t.k0s()(),t.j41(63,"div",55)(64,"p",56),t.EFF(65,"Type de mouvement :"),t.k0s(),t.j41(66,"p",59),t.EFF(67),t.k0s()()(),t.DNE(68,pt,3,1,"div",60),t.k0s(),t.nrm(69,"div",49),t.j41(70,"div",61)(71,"h4"),t.EFF(72,"Informations sur les produits"),t.k0s()(),t.nrm(73,"div",49),t.k0s(),t.j41(74,"div",62)(75,"div",63)(76,"table",64),t.qex(77,65),t.DNE(78,dt,2,0,"th",66)(79,_t,2,1,"td",67)(80,mt,2,0,"td",68),t.bVm(),t.qex(81,69),t.DNE(82,gt,2,0,"th",66)(83,ft,2,1,"td",67)(84,ht,2,0,"td",68),t.bVm(),t.qex(85,70),t.DNE(86,xt,2,0,"th",66)(87,Ft,3,3,"td",67)(88,Ct,2,0,"td",68),t.bVm(),t.qex(89,71),t.DNE(90,bt,2,0,"th",66)(91,vt,3,3,"td",67)(92,Pt,2,0,"td",68),t.bVm(),t.qex(93,72),t.DNE(94,Mt,2,0,"th",66)(95,Et,3,3,"td",73)(96,Tt,3,3,"td",74),t.bVm(),t.DNE(97,qt,1,0,"tr",75)(98,Ot,1,0,"tr",76)(99,Rt,1,0,"tr",77),t.k0s()()()()()()}if(2&n){const e=s.$implicit,o=s.index,a=t.sdS(1),c=t.sdS(20),i=t.sdS(41),l=t.XpG(2);t.Y8G("expanded",l.step()===o),t.R7$(4),t.Y8G("ngIf",!a.expanded),t.R7$(),t.Y8G("ngIf",!a.expanded),t.R7$(3),t.Y8G("innerHTML",l.highlightMatch(e.numeroFacture||""),t.npT),t.R7$(),t.Y8G("ngIf","AJOUTER"===e.type),t.R7$(),t.Y8G("ngIf","AJOUTER"===e.type),t.R7$(),t.Y8G("ngIf",!a.expanded),t.R7$(),t.Y8G("ngIf",!a.expanded),t.R7$(),t.Y8G("ngIf",!a.expanded),t.R7$(),t.Y8G("ngIf",!a.expanded),t.R7$(4),t.Y8G("ngIf",!l.showDescription)("ngIfElse",c),t.R7$(5),t.Y8G("ngIf",l.showExportDropdown),t.R7$(16),t.Y8G("ngIf",l.selectedBoutique)("ngIfElse",i),t.R7$(7),t.JRh(t.i5U(47,27,e.dateFacture,"dd/MM/yyyy \xe0 HH:mm")),t.R7$(6),t.JRh(e.nomUtilisateur),t.R7$(5),t.JRh(l.boutiquePhone),t.R7$(5),t.JRh(l.boutiqueEmail),t.R7$(4),t.xc7("color",l.getColor(e.type)),t.R7$(),t.SpI(" ",e.type," "),t.R7$(),t.Y8G("ngIf",l.showDescription),t.R7$(8),t.Y8G("dataSource",e.dataSource),t.R7$(21),t.Y8G("matHeaderRowDef",l.displayedColumns),t.R7$(),t.Y8G("matRowDefColumns",l.displayedColumns),t.R7$(),t.Y8G("matFooterRowDef",l.displayedColumns)}}function wt(n,s){if(1&n&&(t.j41(0,"mat-accordion",31),t.DNE(1,It,100,30,"mat-expansion-panel",32),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.paginatedFactures)}}function jt(n,s){if(1&n){const e=t.RV6();t.j41(0,"mat-paginator",99),t.bIt("page",function(a){t.eBV(e);const c=t.XpG();return t.Njj(c.onPageChange(a))}),t.k0s()}if(2&n){const e=t.XpG();t.Y8G("length",e.filteredFactures.length)("pageSize",e.pageSize)("pageIndex",e.currentPage)("pageSizeOptions",t.lJ4(4,z))}}let kt=(()=>{class n{constructor(e,o,a,c){this.userService=e,this.factureService=o,this.changeDetectorRef=a,this.dialog=c,this.boutiqueName="",this.nomComplet="",this.nomEntreprise="",this.email="",this.stockHistory=[],this.showNoFactureMessage=!1,this.noFacturesMessage="Aucune facture disponible.",this.factures=[],this.searchTerm="",this.filteredFactures=[],this.showExportDropdown=!1,this.showDescription=!0,this.adjustedStocks=[],this.stock=null,this.factureDataSource=new p.I6,this.selectedBoutique=null,this.boutiques=[],this.factureCounts={},this.totalAllFactures=0,this.apiUrl=E.c.imgUrl,this.displayedColumns=["codeGenerique","nomProduit","prixUnitair","quantite","total"],this.totalFactures=0,this.pageSize=10,this.currentPage=0,this.paginatedFactures=[],this.step=(0,t.vPA)(-1),this.boutiquePhone="",this.boutiqueEmail="",this.dataSource=new p.I6}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize,this.updatePaginatedFactures()}updatePaginatedFactures(){const e=this.currentPage*this.pageSize;this.paginatedFactures=this.filteredFactures.slice(e,e+this.pageSize),this.changeDetectorRef.detectChanges()}ngAfterViewInit(){this.paginators.changes.subscribe(()=>{this.factures.forEach((e,o)=>{const a=this.paginators.toArray()[o];e.dataSource&&a&&(e.dataSource.paginator=a)})})}setStep(e){this.step.set(e)}toggleExportDropdown(e){e.stopPropagation(),this.showExportDropdown=!this.showExportDropdown}onClickOutside(e){e.target.closest(".export-container")||(this.showExportDropdown=!1)}toggleDescription(e){e.stopPropagation(),this.showDescription=!this.showDescription}ngOnInit(){this.getBoutiqueName(),this.getUserInfo()}getBoutiqueName(){this.userService.getUserInfo().subscribe(e=>{if(console.log(e),e&&e.boutiques&&e.boutiques.length>0){const o=e.boutiques[0];this.boutiqueName=o.nomBoutique||"Nom de la boutique non trouv\xe9",this.boutiquePhone=o.telephone||"T\xe9l\xe9phone non trouv\xe9",this.boutiqueEmail=o.email||"Email non trouv\xe9"}else console.error("Aucune boutique trouv\xe9e pour cet utilisateur"),this.boutiqueName="Aucune boutique",this.boutiquePhone="N/A",this.boutiqueEmail="N/A"},e=>{console.error("Erreur lors de la r\xe9cup\xe9ration des informations utilisateur",e)})}applyFilter(){if(this.searchTerm){const e=this.searchTerm.toLowerCase();this.filteredFactures=this.factures.filter(o=>o.numeroFacture.toLowerCase().includes(e))}else this.filteredFactures=[...this.factures];this.currentPage=0,this.updatePaginatedFactures(),this.paginator&&this.paginator.firstPage()}getFormattedProduits(e){return e.produits.map(o=>({...o,quantiteAjoute:"AJOUT"===e.type?o.quantite:0,quantiteRetirer:"RETRAIT"===e.type?o.quantite:0}))}highlightMatch(e){if(!this.searchTerm)return e;const o=new RegExp(`(${this.searchTerm})`,"gi");return e.replace(o,"<mark>$1</mark>")}getColor(e){return"AJOUTER"===e?"#008000":"R\xe9duction"===e?"#ff0000":"#000"}getBoutiqueNamesForFacture(e){return this.selectedBoutique?this.selectedBoutique.nomBoutique:e.boutiqueIds?.length>0?e.boutiqueIds.map(o=>this.boutiques.find(a=>a.id===o)?.nomBoutique||"Boutique inconnue").join(", "):"Non sp\xe9cifi\xe9"}updatePagination(){this.totalFactures=this.filteredFactures.length;const e=this.currentPage*this.pageSize;this.paginatedFactures=this.filteredFactures.slice(e,e+this.pageSize)}loadImageAsBase64(e){var o=this;return(0,M.A)(function*(){try{const a=yield fetch(e);if(!a.ok)throw new Error("Erreur de chargement de l'image: "+a.statusText);const c=yield a.blob(),i=c.type;if("image/png"!==i&&"image/jpeg"!==i&&"image/webp"!==i&&"image/jpg"!==i&&"image/avif"!==i)throw new Error("Le fichier n'est ni PNG, ni JPEG, ni WEBP");return yield o.blobToBase64(c)}catch(a){throw console.error("Erreur lors du chargement de l'image:",a),a}})()}blobToBase64(e){return new Promise((o,a)=>{const c=new FileReader;c.onloadend=()=>o(c.result),c.onerror=i=>a("Erreur de lecture du fichier : "+i),c.readAsDataURL(e)})}downloadPDFWithJsPDF(e,o){var a=this;return(0,M.A)(function*(){e.boutiqueNames?.join(", ");const i=new y.default;i.setFontSize(9);const l=a.userInfo?.logoEntreprise;if(l){const d=`${a.apiUrl}${l}`,g=20,yt=15;try{const v=yield a.loadImageAsBase64(d);i.addImage(v,"jpg",170,10,g,yt)}catch(v){console.error("Erreur lors de l'ajout du logo au PDF:",v)}}else console.warn("Logo de l\u2019entreprise non disponible.");const _=d=>null==d?"":d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");let r=15;i.setFont("helvetica","bold"),i.text("Facture No :",10,r),i.setTextColor(6,114,228),i.text(e?.numeroFacture||"FAC-XXXXXX",30,r),r+=8,i.setTextColor(0,0,0),i.text("Informations de la boutique",10,r),r+=5,i.line(10,r,200,r),r+=10,i.setFont("helvetica","bold"),i.text("Boutique :",10,r),i.setFont("helvetica","normal"),i.setTextColor(6,114,228),i.text(o||"N/A",30,r),r+=8,i.setFont("helvetica","bold"),i.setTextColor(0,0,0),i.text("T\xe9l\xe9phone :",10,r),i.setFont("helvetica","normal"),i.text(a.boutiquePhone||"N/A",30,r),r+=8,i.setFont("helvetica","bold"),i.text("Email :",10,r),i.setFont("helvetica","normal"),i.text(a.boutiqueEmail||"N/A",22,r),r+=8,i.setFont("helvetica","bold"),i.setTextColor(0,0,0),i.text("Date de cr\xe9ation :",10,r),i.setFont("helvetica","normal"),i.text((d=>{const g=new Date(d);return new Intl.DateTimeFormat("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(g)})(e?.dateFacture||""),40,r),r+=8,i.setFont("helvetica","bold"),i.text("Cr\xe9\xe9 par:",10,r),i.setFont("helvetica","normal"),i.text(e?.nomUtilisateur||"N/A",27,r),r+=8,i.setFont("helvetica","bold"),i.text("Type de mouvement :",10,r),i.setFont("helvetica","normal");let O=e?.type||"N/A";i.setTextColor(..."AJOUTER"===O?[0,150,0]:[255,0,0]),i.text(O,45,r),i.setTextColor(0,0,0),r+=12,i.setFont("helvetica","bold"),i.text("Informations sur les produits",10,r),r+=5,i.line(10,r,200,r),r+=10,i.setTextColor(153,153,153),i.text("Produits",10,r),r+=10,i.setFillColor(6,114,228),i.setTextColor(255,255,255),i.rect(10,r,190,10,"F"),i.text("Code",15,r+7),i.text("D\xe9signation",50,r+7),i.text("Prix unitaire",100,r+7),i.text("Quantit\xe9",140,r+7),i.text("Total",170,r+7),r+=15,i.setTextColor(0,0,0),(e?.produits||[]).forEach((d,g)=>{i.text(d.codeGenerique||`P-${g+1}`,15,r),i.text(d.nomProduit,50,r),i.text(_(Number(d.prixUnitair.toFixed(3))),100,r),i.text(d.quantite.toString(),140,r),i.setTextColor(255,0,0),i.text(_(Number((d.total||0).toFixed(3))),170,r),i.setTextColor(0,0,0),r+=10}),r+=10,i.line(10,r,200,r),r+=15,i.setFont("helvetica","bold"),i.text("Signature",20,r),i.text("Approuv\xe9 par",90,r),i.text("Re\xe7u par",160,r),i.save(`Facture_${e?.numeroFacture||"XXXXXX"}.pdf`)})()}getUserInfo(){this.userService.getUserInfo().subscribe({next:e=>{this.userInfo=e,this.boutiques=e.boutiques,this.entrepriseId=e.entrepriseId,this.factureService.setBoutiques(this.boutiques),this.boutiques.length>0?(this.selectedBoutique=null,this.showNoFactureMessage=!1,this.loadAllFactures()):(this.noFacturesMessage="Aucune boutique trouv\xe9e.",this.showNoFactureMessage=!0),this.showNoFactureMessage=!1},error:e=>{console.error("Erreur lors de la r\xe9cup\xe9ration des informations utilisateur :",e),this.showNoFactureMessage=!0}})}selectBoutique(e){!e||e.actif?(this.selectedBoutique=e,null===e?this.loadAllFactures():this.loadFactures(e.id),this.currentPage=0):this.showSuspendedBoutiqueDialog()}loadFactures(e){this.showNoFactureMessage=!1,this.factureService.getFacturesByBoutique(e).subscribe({next:o=>{const a=o.map(c=>({...c,boutiqueIds:[e]}));this.factureCounts[e]=o.length,this.processFactures(a)},error:o=>{console.error("Erreur:",o),this.processFactures([]),this.showNoFactureMessage=!0}})}loadAllFactures(){this.showNoFactureMessage=!1;const e=this.boutiques.map(o=>this.factureService.getFacturesByBoutique(o.id));(0,B.p)(e).subscribe({next:o=>{const a=o.flatMap((i,l)=>{const _=this.boutiques[l].id;return i.map(r=>({...r,boutiqueIds:[_]}))}),c={};o.forEach((i,l)=>{c[this.boutiques[l].id]=i.length}),this.factureCounts=c,this.totalAllFactures=o.reduce((i,l)=>i+l.length,0),this.processFactures(a)},error:o=>{console.error("Erreur:",o),this.showNoFactureMessage=!0}})}processFactures(e){if(!e||!Array.isArray(e))return this.showNoFactureMessage=!0,this.factures=[],void(this.filteredFactures=[]);this.factures=e.reverse().map(o=>({...o,boutiqueIds:o.boutiqueIds||[],boutiqueNames:this.getBoutiqueNames(o.boutiqueIds),dataSource:new p.I6(this.getFormattedProduits(o)),totalSum:this.getFormattedProduits(o).reduce((a,c)=>a+(c.total||0),0)})),this.filteredFactures=[...this.factures],this.showNoFactureMessage=0===this.factures.length,this.updatePaginatedFactures()}getBoutiqueNames(e=[]){return e.map(o=>this.boutiques.find(a=>a.id===o)?.nomBoutique||"Boutique inconnue").filter(o=>!!o)}showSuspendedBoutiqueDialog(){this.dialog.open(N.F,{width:"400px",disableClose:!0,data:{onClose:()=>this.selectedBoutique=null}})}static{this.\u0275fac=function(o){return new(o||n)(t.rXU(T.g),t.rXU(A),t.rXU(t.gRc),t.rXU(X.bZ))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-facture"]],viewQuery:function(o,a){if(1&o&&(t.GBs(h.iy,5),t.GBs(h.iy,5)),2&o){let c;t.mGM(c=t.lsd())&&(a.paginator=c.first),t.mGM(c=t.lsd())&&(a.paginators=c)}},hostBindings:function(o,a){1&o&&t.bIt("click",function(i){return a.onClickOutside(i)},!1,t.EBC)},features:[t.Jv_([(0,I.aw)()])],decls:19,vars:6,consts:[["panel",""],["openIcon",""],["allBoutiques",""],[1,"global_container_facture"],[1,"container_facture"],[1,"tasks-header"],[1,"title"],[1,"actions"],[1,"inputSearch"],[1,"ri-search-2-line"],["type","text","placeholder","Recherche....",3,"ngModelChange","input","ngModel"],[1,"container_list_boutique"],[1,"content_list_boutique"],[1,"name_boutique"],[4,"ngIf"],["class","no-facture-message",4,"ngIf"],[1,"factures"],["class","example-headers-align",4,"ngIf"],[1,"pagination"],[3,"length","pageSize","pageIndex","pageSizeOptions","page",4,"ngIf"],[1,"all_boutique",3,"click"],[1,"all_boutique",2,"display","flex","align-items","center"],["class","facture-count",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"facture-count"],[2,"display","flex","align-items","center",3,"click"],["class","ri-error-warning-line warning-icon",4,"ngIf"],["class","barre",4,"ngIf"],[1,"ri-error-warning-line","warning-icon"],[1,"barre"],[1,"no-facture-message"],[1,"example-headers-align"],["class","cadre_panel","hideToggle","",3,"expanded","opened",4,"ngFor","ngForOf"],["hideToggle","",1,"cadre_panel",3,"opened","expanded"],[1,"title_facture"],["class","personnage",4,"ngIf"],[1,"numFacture"],[1,"title_facture_code",3,"innerHTML"],["class","Facture",4,"ngIf"],[1,"icon_export"],[1,"export-container",2,"display","flex","align-items","center"],[1,"iconDrop",2,"margin-right","20px",3,"click"],["class","ri-chat-check-line","title","Afficher la description",4,"ngIf","ngIfElse"],[1,"iconDrop"],[1,"ri-printer-cloud-line",3,"click"],["class","export-dropdown",4,"ngIf"],[1,"iconDrop",2,"margin-left","20px"],[1,"ri-arrow-down-s-fill"],[1,"content_facture"],[1,"bare"],[1,"title_produit"],[1,"container_imprimate"],[1,"content_imprimate"],[1,"double_info_content"],[1,"info_content"],[1,"info"],[1,"info_title"],[4,"ngIf","ngIfElse"],[1,"info_value"],[1,"info_value",2,"font-weight","600","text-transform","uppercase"],["class","description_detail",4,"ngIf"],[1,"title_produit",2,"margin-top","17px"],[1,"containerTable"],[1,"mat-elevation-z8"],["mat-table","",3,"dataSource"],["matColumnDef","codeGenerique"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-footer-cell","",4,"matFooterCellDef"],["matColumnDef","nomProduit"],["matColumnDef","prixUnitair"],["matColumnDef","quantite"],["matColumnDef","total"],["mat-cell","","style","color: #ff0000;",4,"matCellDef"],["mat-footer-cell","","style","color: #000000; font-weight: bold;",4,"matFooterCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],[1,"personnage"],[1,"title_facture_info"],[1,"Facture"],[1,"title_facture_codeFournisseur",3,"innerHTML"],[2,"font-weight","600","text-transform","uppercase"],["title","Afficher la description",1,"ri-chat-check-line"],["title","Fermer la description",1,"ri-chat-off-line"],[1,"export-dropdown"],[1,"export-option",3,"click"],[1,"export-option"],[1,"info_value",2,"color","#0672E4"],[1,"description_detail"],["readonly",""],["mat-header-cell",""],["mat-cell",""],["mat-footer-cell",""],["mat-cell","",2,"color","#ff0000"],["mat-footer-cell","",2,"color","#000000","font-weight","bold"],["mat-header-row",""],["mat-row",""],["mat-footer-row",""],[3,"page","length","pageSize","pageIndex","pageSizeOptions"]],template:function(o,a){1&o&&(t.j41(0,"div",3)(1,"div",4)(2,"div",5)(3,"h1",6),t.EFF(4,"Factures"),t.k0s(),t.j41(5,"div",7)(6,"div",8),t.nrm(7,"i",9),t.j41(8,"input",10),t.mxI("ngModelChange",function(i){return t.DH7(a.searchTerm,i)||(a.searchTerm=i),i}),t.bIt("input",function(){return a.applyFilter()}),t.k0s()()()(),t.j41(9,"div",11)(10,"div",12)(11,"div",13),t.DNE(12,L,6,4,"ng-container",14),t.k0s()()(),t.DNE(13,W,2,1,"div",15)(14,Q,2,1,"div",15),t.j41(15,"div",16),t.DNE(16,wt,2,1,"mat-accordion",17),t.k0s(),t.j41(17,"div",18),t.DNE(18,jt,1,5,"mat-paginator",19),t.k0s()()()),2&o&&(t.R7$(8),t.R50("ngModel",a.searchTerm),t.R7$(4),t.Y8G("ngIf",((null==a.boutiques?null:a.boutiques.length)||0)>0),t.R7$(),t.Y8G("ngIf",a.showNoFactureMessage),t.R7$(),t.Y8G("ngIf",!a.showNoFactureMessage&&0===a.filteredFactures.length&&a.searchTerm),t.R7$(2),t.Y8G("ngIf",!a.showNoFactureMessage),t.R7$(2),t.Y8G("ngIf",a.filteredFactures.length>5))},dependencies:[m.MY,m.BS,m.GK,m.Z2,m.WN,k.m_,j.RG,$.fS,R.Hl,w.X6,p.tP,p.Zl,p.tL,p.ji,p.cC,p.YV,p.iL,p.Zq,p.xW,p.KS,p.$R,p.Qo,p.YZ,p.NB,p.iF,h.Ou,h.iy,f.MD,f.Sq,f.bT,f.vh,x.YN,x.me,x.BC,x.vS,D.v],styles:['@charset "UTF-8";.container_facture[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:10px}.tasks-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}.inputSearch[_ngcontent-%COMP%]{position:relative;width:250px;height:40px;display:flex;align-items:center}.inputSearch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:100%;padding-left:10px;border-radius:5px}.inputSearch[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;right:0;margin-right:15px;font-size:17px}.cadre_panel[_ngcontent-%COMP%]{border-radius:5px!important;margin-bottom:10px}mat-expansion-panel[_ngcontent-%COMP%]{box-shadow:#0000000d 0 0 0 1px!important}.title_facture[_ngcontent-%COMP%]{font-size:13px;gap:1px}.mat-expansion-panel-header[_ngcontent-%COMP%]{height:60px}.personnage[_ngcontent-%COMP%]{color:#00000074;font-size:12px}.numFacture[_ngcontent-%COMP%], .Facture[_ngcontent-%COMP%]{color:#000;font-size:13px}.title_facture_info[_ngcontent-%COMP%]{color:#000;padding-left:6px;letter-spacing:1px;font-weight:500;font-size:11px}.title[_ngcontent-%COMP%]{margin-bottom:20px;font-size:18px;gap:5px}.title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-style:25px;letter-spacing:1px}.title_facture_code[_ngcontent-%COMP%], .title_facture_codeFournisseur[_ngcontent-%COMP%]{color:#0672e4;padding-left:5px;letter-spacing:1px;font-weight:500;font-size:11px}.icon_arrow[_ngcontent-%COMP%]{float:right}.icon_arrow[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:22px}.export-container[_ngcontent-%COMP%]{display:inline-block}.export-dropdown[_ngcontent-%COMP%]{position:absolute;background-color:#f9f9f9;min-width:180px;box-shadow:0 8px 16px #00000063;z-index:999999999;top:100%;right:0;border-radius:5px}.export-dropdown[_ngcontent-%COMP%]   .export-option[_ngcontent-%COMP%]{padding:12px 16px;cursor:pointer}.export-dropdown[_ngcontent-%COMP%]   .export-option[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}.iconDrop[_ngcontent-%COMP%]{display:flex;align-items:center}.iconDrop[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px;cursor:pointer}.mat-expansion-panel-header-description[_ngcontent-%COMP%]{flex-grow:0}.title_produit[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px}.codeProduit[_ngcontent-%COMP%]   .codeId[_ngcontent-%COMP%]{margin-bottom:10px;font-size:20px}.bare[_ngcontent-%COMP%]{width:100%;height:1px;background-color:#999;margin:15px 0}.info[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:6px}.info[_ngcontent-%COMP%]   .info_value[_ngcontent-%COMP%]{padding-left:10px;margin:0}.info_title[_ngcontent-%COMP%]{font-weight:600;margin:0}.double_info_content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.description_detail[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;height:135px;min-width:300px;padding:10px 20px 12px 8px;box-sizing:border-box;border:2px solid #ccc;border-radius:4px;background-color:#f8f8f8;font-size:13px;resize:none}.container_signature[_ngcontent-%COMP%]{margin:55px 0}.content_signature[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-evenly}.signature[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .approuve[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .recu[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px;font-weight:600}.containerTable[_ngcontent-%COMP%]{margin-top:20px}.table_title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#999}table[_ngcontent-%COMP%]{width:100%}.codeGenerique[_ngcontent-%COMP%]{color:#ff0000a8;font-size:12px}.quantiteAjoute[_ngcontent-%COMP%]{color:#0672e4}.quantiteRetirer[_ngcontent-%COMP%]{color:red}.icon_more[_ngcontent-%COMP%]{margin:14px 0 0 8px}.icon_more[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px;background-color:#0672e4;padding:7px;border-radius:50%;color:#fff;cursor:pointer}.mat-elevation-z8[_ngcontent-%COMP%]{margin:20px 0}.mat-elevation-z8[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}.mat-elevation-z8[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#0672e4;color:#fff;font-weight:700}.mat-elevation-z8[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px;border-bottom:1px solid #ddd}.no-facture-message[_ngcontent-%COMP%]{text-align:center;padding:40px;font-size:13px;color:#666;background-color:#f8f9fa;border-radius:8px;margin:20px;box-shadow:0 2px 4px #0000001a}.pagination[_ngcontent-%COMP%]{justify-content:right;margin-top:20px}.name_boutique[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;cursor:pointer;margin:30px 0 10px}.name_boutique[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding:5px 15px}.name_boutique_active[_ngcontent-%COMP%]{background-color:#e9d421;border-radius:5px;color:#000}.barre[_ngcontent-%COMP%]{height:25px;width:1px;background-color:#0000003f;margin:0 10px}.container_list_boutique[_ngcontent-%COMP%]{overflow:auto;scrollbar-color:#888 #f1f1f1}.container_list_boutique[_ngcontent-%COMP%]::-webkit-scrollbar{width:2px;height:3px}.container_list_boutique[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}.container_list_boutique[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#00f;border-radius:4px}.container_list_boutique[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:red}.name_boutique[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer;padding:8px 16px;margin:4px 0;transition:all .3s ease;font-weight:500;border-radius:4px}.name_boutique[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:hover{background-color:#0000000d;transform:translateY(-1px)}.name_boutique[_ngcontent-%COMP%]   p.name_boutique_active[_ngcontent-%COMP%]{background-color:#e9d421;color:#000!important}.warning-icon[_ngcontent-%COMP%]{margin-left:8px;color:red;font-size:14px}.facture-count[_ngcontent-%COMP%]{background-color:#ddd;color:#000;border-radius:50%;font-size:10px;min-width:18px;height:18px;display:flex;justify-content:center;align-items:center;padding:2px;margin-left:10px}.draggable-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;align-items:center}'],changeDetection:0})}}return n})()}}]);
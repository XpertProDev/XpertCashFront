"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[7806],{6822:(re,Pt,N)=>{N.d(Pt,{K:()=>E});var E=function(et){return et.BROUILLON="BROUILLON",et.APPROBATION="APPROBATION",et.APPROUVE="APPROUVE",et.ENVOYE="ENVOYE",et.VALIDE="VALIDE",et.ANNULE="ANNULE",et}(E||{})},3868:(re,Pt,N)=>{N.d(Pt,{X:()=>et});var E=N(4438);let et=(()=>{class Y{constructor(){this.unite=["z\xe9ro","un","deux","trois","quatre","cinq","six","sept","huit","neuf"],this.dizaine=["","","vingt","trente","quarante","cinquante","soixante"],this.dizaineSpecial=["dix","onze","douze","treize","quatorze","quinze","seize"]}transform(X){if(isNaN(X))return"";const rt=Math.floor(X),it=this.numberToWords(rt)+" Francs CFA";return it.charAt(0).toUpperCase()+it.slice(1)}numberToWords(X){if(X<10)return this.unite[X];if(X<17)return this.dizaineSpecial[X-10];if(X<20)return"dix-"+this.unite[X-10];if(X<70){const rt=Math.floor(X/10),it=X%10;return this.dizaine[rt]+(it?"-"+this.unite[it]:"")}if(X<80)return"soixante-"+this.numberToWords(X-60);if(X<100)return"quatre-vingt"+(X%20?"-"+this.numberToWords(X%20):"");if(X<1e3){const rt=Math.floor(X/100),it=X%100;return(rt>1?this.unite[rt]+"-cent":"cent")+(it?"-"+this.numberToWords(it):"")}if(X<1e6){const rt=Math.floor(X/1e3),it=X%1e3;return(rt>1?this.numberToWords(rt)+" mille":"mille")+(it?" "+this.numberToWords(it):"")}if(X<1e9){const rt=Math.floor(X/1e6),it=X%1e6;return(rt>1?this.numberToWords(rt)+" millions":"un million")+(it?" "+this.numberToWords(it):"")}return"nombre trop grand"}static{this.\u0275fac=function(rt){return new(rt||Y)}}static{this.\u0275pipe=E.EJ8({name:"enLettres",type:Y,pure:!0})}}return Y})()},2120:(re,Pt,N)=>{N.d(Pt,{r:()=>J});var E=N(1626),et=N(4412),Y=N(9437),M=N(8810),X=N(8141),rt=N(1985),it=N(5558),_e=N(2525),K=N(4438);let J=(()=>{class V{constructor(F){this.http=F,this.apiUrl=_e.c.apiBaseUrl,this.entrepriseSubject=new et.t([]),this.entreprise$=this.entrepriseSubject.asObservable()}getListEntreprises(){const F=localStorage.getItem("authToken")||"",Q=new E.Lr({Authorization:`Bearer ${F}`,"Content-Type":"application/json"});return this.http.get(`${this.apiUrl}/entreprises`,{headers:Q}).pipe((0,Y.W)($=>{let B="Erreur inconnue";return $.error instanceof ErrorEvent?B=`Erreur: ${$.error.message}`:404===$.status&&(B="Aucune entreprise trouv\xe9e"),(0,M.$)(()=>new Error(B))}))}addEntreprise(F){const Q=localStorage.getItem("authToken")||"",$=new E.Lr({Authorization:`Bearer ${Q}`,"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}/entreprises`,F,{headers:$}).pipe((0,Y.W)(B=>{let Z="Erreur inconnue";return B.error instanceof ErrorEvent?Z=`Erreur: ${B.error.message}`:400===B.status&&(Z=B.error||"Donn\xe9es invalides"),(0,M.$)(()=>new Error(Z))}),(0,X.M)(B=>{this.entrepriseSubject.next([...this.entrepriseSubject.value,B])}))}getListEntreprise(F){if(!F)return console.error("Token vide ou non d\xe9fini ! V\xe9rifiez que l'utilisateur est bien connect\xe9."),new rt.c;const Q=(new E.Lr).set("Authorization",`Bearer ${F}`);return console.log("En-t\xeates envoy\xe9r : ",Q),this.http.get(`${this.apiUrl}/entreprises`,{headers:Q}).pipe((0,X.M)($=>{this.entrepriseSubject.next($)}))}getEntrepriseById(F){const Q=localStorage.getItem("authToken")||"",$=new E.Lr({Authorization:`Bearer ${Q}`,"Content-Type":"application/json"});return this.http.get(`${this.apiUrl}/entreprises/${F}`,{headers:$}).pipe((0,Y.W)(B=>{let Z="Erreur inconnue";return B.error instanceof ErrorEvent?Z=`Erreur: ${B.error.message}`:404===B.status&&(Z="Entreprise non trouv\xe9e"),(0,M.$)(()=>new Error(Z))}))}updateEntreprise(F,Q){const $=localStorage.getItem("authToken")||"",B=new E.Lr({Authorization:`Bearer ${$}`});return this.http.patch(`${this.apiUrl}/updateEntreprise/${F}`,Q,{headers:B,responseType:"text"}).pipe((0,Y.W)(Z=>{let T="Erreur inconnue";return Z.error instanceof ErrorEvent?T=`Erreur: ${Z.error.message}`:400===Z.status&&(T=Z.error||"Donn\xe9es invalides"),(0,M.$)(()=>new Error(T))}))}getEntrepriseInfo(){const F=localStorage.getItem("authToken");if(!F)return console.error("Aucun token trouv\xe9"),(0,M.$)(()=>new Error("Aucun token trouv\xe9"));const Q=this.decodeJwt(F);if(this.isTokenExpired(Q))return this.getNewTokenFromApi().pipe((0,it.n)(B=>{localStorage.setItem("authToken",B.token);const Z=new E.Lr({Authorization:`Bearer ${B.token}`});return this.http.get(`${this.apiUrl}/myEntreprise`,{headers:Z}).pipe((0,X.M)(T=>{localStorage.setItem("entreprise",JSON.stringify(T))}))}));{const B=new E.Lr({Authorization:`Bearer ${F}`});return this.http.get(`${this.apiUrl}/myEntreprise`,{headers:B}).pipe((0,X.M)(Z=>{localStorage.setItem("entreprise",JSON.stringify(Z))}))}}decodeJwt(F){return JSON.parse(atob(F.split(".")[1]))}isTokenExpired(F){return new Date(1e3*F.exp)<new Date}getNewTokenFromApi(){const F=localStorage.getItem("refreshToken");return this.http.post(`${this.apiUrl}/refresh-token`,{refreshToken:F})}static{this.\u0275fac=function(Q){return new(Q||V)(K.KVO(E.Qq))}}static{this.\u0275prov=K.jDH({token:V,factory:V.\u0275fac,providedIn:"root"})}}return V})()},1068:(re,Pt,N)=>{N.d(Pt,{Q:()=>Y});var E=N(4412),et=N(4438);let Y=(()=>{class M{constructor(){this.previewSubject=new E.t(null)}setPreview(rt){this.previewSubject.next(rt)}getPreview(){return this.previewSubject.asObservable()}static{this.\u0275fac=function(it){return new(it||M)}}static{this.\u0275prov=et.jDH({token:M,factory:M.\u0275fac,providedIn:"root"})}}return M})()},2409:(re,Pt,N)=>{N.d(Pt,{c:()=>_e});var E=N(1626),et=N(8810),Y=N(8141),M=N(9437),X=N(6822),rt=N(2525),it=N(4438);let _e=(()=>{class K{constructor(V){this.http=V,this.apiUrl=rt.c.apiBaseUrl}creerFactureProforma(V,G,F,Q){const $=localStorage.getItem("authToken");if(!$)return(0,et.$)(()=>new Error("Token manquant"));const B=new E.Lr({Authorization:`Bearer ${$}`});let Z=new E.Nl;return Q&&(void 0!==G&&(Z=Z.set("remisePourcentage",G.toString())),void 0!==F&&(Z=Z.set("appliquerTVA",F.toString()))),this.http.post(`${this.apiUrl}/ajouter`,V,{headers:B,params:Z}).pipe((0,Y.M)(T=>console.log("Facture cr\xe9\xe9e avec succ\xe8s:",T)),(0,M.W)(T=>(console.error("Erreur d\xe9taill\xe9e:",T),console.log("Corps de la r\xe9ponse:",T.error),(0,et.$)(()=>T))))}getAlFactproformaOfEntreprise(V){const G=localStorage.getItem("authToken");if(!G)return console.error("Aucun token trouv\xe9"),(0,et.$)("Aucun token trouv\xe9");const F=new E.Lr({Authorization:`Bearer ${G}`});return this.http.get(`${this.apiUrl}/mes-factures`,{headers:F})}getFactureProformaById(V){const G=localStorage.getItem("authToken"),F=new E.Lr({Authorization:`Bearer ${G}`});return this.http.get(`${this.apiUrl}/factureProforma/${V}`,{headers:F})}updateFactureProforma(V,G,F,Q,$){const B=localStorage.getItem("authToken");if(!B)return(0,et.$)(()=>new Error("Token manquant"));const Z=new E.Lr({Authorization:`Bearer ${B}`,"Content-Type":"application/json"});let T=new E.Nl;return void 0!==G&&(T=T.set("remisePourcentage",G.toString())),void 0!==F&&(T=T.set("appliquerTVA",F.toString())),$&&$.length>0&&$.forEach(z=>{T=T.append("idsApprobateurs",z.toString())}),Q.statut===X.K.ANNULE&&(T=T.set("isAnnulation","true")),this.http.put(`${this.apiUrl}/updatefacture/${V}`,Q,{headers:Z,params:T}).pipe((0,Y.M)(z=>console.log("Facture mise \xe0 jour:",z)),(0,M.W)(z=>(console.error("Erreur mise \xe0 jour:",z),(0,et.$)(()=>z))))}envoyerFactureEmail(V,G){const F=new FormData;F.append("to",G.to),F.append("cc",G.cc),F.append("subject",G.subject),F.append("body",G.body),G.attachments&&G.attachments.forEach((B,Z)=>{F.append("attachments",B,B.name)});const Q=localStorage.getItem("authToken"),$=new E.Lr({Authorization:`Bearer ${Q}`});return this.http.post(`${this.apiUrl}/factures/${V}/envoyer-email`,F,{headers:$,responseType:"text"})}getHistoriqueFacture(V){const G=localStorage.getItem("authToken"),F=new E.Lr({Authorization:`Bearer ${G}`});return this.http.get(`${this.apiUrl}/factpro/${V}/historique`,{headers:F})}getNotesFactureProforma(V){const G=localStorage.getItem("authToken"),F=new E.Lr({Authorization:`Bearer ${G}`});return this.http.get(`${this.apiUrl}/factures/${V}/notes`,{headers:F})}getNoteById(V,G){const F=localStorage.getItem("authToken"),Q=new E.Lr({Authorization:`Bearer ${F}`,Accept:"application/json"});return this.http.get(`${this.apiUrl}/auth/${V}/notes/${G}`,{headers:Q})}updateNote(V,G,F){const Q=localStorage.getItem("authToken"),$=new E.Lr({Authorization:`Bearer ${Q}`,"Content-Type":"application/json"});return this.http.put(`${this.apiUrl}/${V}/notes/${G}`,{nouveauContenu:F},{headers:$}).pipe((0,Y.M)(T=>console.log("Note modifi\xe9e avec succ\xe8s:",T)),(0,M.W)(T=>(console.error("Erreur lors de la modification de la note:",T),(0,et.$)(()=>T))))}deletNoteFactureProforma(V,G){const F=localStorage.getItem("authToken"),Q=new E.Lr({Authorization:`Bearer ${F}`,Accept:"application/json"});return this.http.delete(`${this.apiUrl}/${V}/notes/${G}/supprimer`,{headers:Q})}getFacturesByClient(V,G){const F=localStorage.getItem("authToken"),Q=new E.Lr({Authorization:`Bearer ${F}`});let $=new E.Nl;return V&&($=$.set("clientId",V.toString())),G&&($=$.set("entrepriseClientId",G.toString())),this.http.get(`${this.apiUrl}/factures/client`,{headers:Q,params:$}).pipe((0,M.W)(B=>(console.error("Erreur dans getFacturesByClient:",B),(0,et.$)(()=>B))))}static{this.\u0275fac=function(G){return new(G||K)(it.KVO(E.Qq))}}static{this.\u0275prov=it.jDH({token:K,factory:K.\u0275fac,providedIn:"root"})}}return K})()},6375:(re,Pt,N)=>{N.d(Pt,{D:()=>rt});var E=N(1626),et=N(9437),Y=N(8810),M=N(2525),X=N(4438);let rt=(()=>{class it{constructor(K){this.http=K,this.apiUrl=M.c.apiBaseUrl}ajouterProduit(K,J,V,G,F,Q){const $=`${this.apiUrl}/create?addToStock=${Q}`,B=new FormData;B.append("boutiqueIds",JSON.stringify(K)),B.append("quantites",JSON.stringify(J)),B.append("produit",JSON.stringify(G)),B.append("seuilAlert",JSON.stringify(V)),F&&B.append("image",F,F.name);const Z=localStorage.getItem("authToken")||"",T=new E.Lr({Authorization:`Bearer ${Z}`});return this.http.post($,B,{headers:T})}modifierProduit(K,J){const V=localStorage.getItem("authToken")||"",G=new E.Lr({Authorization:`Bearer ${V}`}),F=new FormData,{id:Q,...$}=K;return F.append("produit",JSON.stringify($)),F.append("addToStock",K.enStock?"true":"false"),J&&F.append("image",J,J.name),this.http.patch(`${this.apiUrl}/updateProduit/${K.id}`,F,{headers:G})}getProduitById(K){const J=localStorage.getItem("authToken")||"",V=new E.Lr({Authorization:`Bearer ${J}`});return this.http.get(`${this.apiUrl}/produits/${K}`,{headers:V})}getProduitsEntreprise(K){const J=localStorage.getItem("authToken"),V=new E.Lr({Authorization:`Bearer ${J}`});return this.http.get(`${this.apiUrl}/produits/${K}/stock`,{headers:V}).pipe((0,et.W)(G=>(0,Y.$)(400===G.status&&"Cette boutique est d\xe9sactiv\xe9e, ses produits ne sont pas accessibles !"===G.error?.error?()=>new Error("BOUTIQUE_DESACTIVEE"):()=>G)))}getProduitBoutique(K){const J=localStorage.getItem("authToken");if(!J)return console.error("Aucun token trouv\xe9"),(0,Y.$)("Aucun token trouv\xe9");const V=new E.Lr({Authorization:`Bearer ${J}`});return this.http.get(`${this.apiUrl}/produits/${K}/totaux-stock`,{headers:V})}getProduitsByEntrepriseId(K){return this.http.get(`${this.apiUrl}/produits/entreprise/${K}`)}getProduitsParEntreprise(K){return this.http.get(`${this.apiUrl}/produits/entreprise/${K}`)}getFournisseurs(){const K=localStorage.getItem("authToken")||"",J=new E.Lr({Authorization:`Bearer ${K}`});return this.http.get(`${this.apiUrl}/get-fournisseurs`,{headers:J})}static{this.\u0275fac=function(J){return new(J||it)(X.KVO(E.Qq))}}static{this.\u0275prov=X.jDH({token:it,factory:it.\u0275fac,providedIn:"root"})}}return it})()},7806:(re,Pt,N)=>{N.r(Pt),N.d(Pt,{DetailFactureProformaComponent:()=>da});var E=N(467),et=N(177),Y=N(9417),M=N(6822),X=N(6115),rt=N(9107);function K(c){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var i=t.done;return Promise.resolve(t.value).then(function(n){return{value:n,done:i}})}return(K=function(i){this.s=i,this.n=i.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(i){var n=this.s.return;return void 0===n?Promise.resolve({value:i,done:!0}):e(n.apply(this.s,arguments))},throw:function(i){var n=this.s.return;return void 0===n?Promise.reject(i):e(n.apply(this.s,arguments))}},new K(c)}N(4941);const J=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type),V=[.001,0,0,.001,0,0],G=1.35,B={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},T={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101},z={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},De={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ut={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Le={ERRORS:0,WARNINGS:1,INFOS:5},Ne={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94};let Be=Le.WARNINGS;function Xn(){return Be}function $e(c){Be>=Le.INFOS&&console.log(`Info: ${c}`)}function U(c){Be>=Le.WARNINGS&&console.log(`Warning: ${c}`)}function nt(c){throw new Error(c)}function pt(c,e){c||nt(e)}function Li(c,e=null,t=null){if(!c)return null;if(t&&"string"==typeof c&&(t.addDefaultProtocol&&c.startsWith("www.")&&c.match(/\./g)?.length>=2&&(c=`http://${c}`),t.tryConvertEncoding))try{c=function Zn(c){return decodeURIComponent(escape(c))}(c)}catch{}const i=e?URL.parse(c,e):URL.parse(c);return function Wn(c){switch(c?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(i)?i:null}function Ni(c,e,t=!1){const i=URL.parse(c);return i?(i.hash=e,i.href):t&&Li(c,"http://example.com")?c.split("#",1)[0]+""+(e?`#${e}`:""):""}function W(c,e,t,i=!1){return Object.defineProperty(c,e,{value:t,enumerable:!i,configurable:!0,writable:!1}),t}const Zt=function(){function e(t,i){this.message=t,this.name=i}return e.prototype=new Error,e.constructor=e,e}();class ji extends Zt{constructor(e,t){super(e,"PasswordException"),this.code=t}}class ii extends Zt{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class ni extends Zt{constructor(e){super(e,"InvalidPDFException")}}class Ge extends Zt{constructor(e,t,i){super(e,"ResponseException"),this.status=t,this.missing=i}}class Yn extends Zt{constructor(e){super(e,"FormatError")}}class Xt extends Zt{constructor(e){super(e,"AbortException")}}function Bi(c){("object"!=typeof c||void 0===c?.length)&&nt("Invalid argument for bytesToString");const e=c.length,t=8192;if(e<t)return String.fromCharCode.apply(null,c);const i=[];for(let n=0;n<e;n+=t){const s=Math.min(n+t,e),o=c.subarray(n,s);i.push(String.fromCharCode.apply(null,o))}return i.join("")}function ae(c){"string"!=typeof c&&nt("Invalid argument for stringToBytes");const e=c.length,t=new Uint8Array(e);for(let i=0;i<e;++i)t[i]=255&c.charCodeAt(i);return t}class At{static get isLittleEndian(){return W(this,"isLittleEndian",function Kn(){const c=new Uint8Array(4);return c[0]=1,1===new Uint32Array(c.buffer,0,1)[0]}())}static get isEvalSupported(){return W(this,"isEvalSupported",function Jn(){try{return new Function(""),!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return W(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return W(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){if(typeof navigator<"u"&&"string"==typeof navigator?.platform&&"string"==typeof navigator?.userAgent){const{platform:e,userAgent:t}=navigator;return W(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}return W(this,"platform",{isAndroid:!1,isLinux:!1,isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return W(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Ue=Array.from(Array(256).keys(),c=>c.toString(16).padStart(2,"0"));class D{static makeHexColor(e,t,i){return`#${Ue[e]}${Ue[t]}${Ue[i]}`}static scaleMinMax(e,t){let i;e[0]?(e[0]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[3],t[3]*=e[3]):(i=t[0],t[0]=t[1],t[1]=i,i=t[2],t[2]=t[3],t[3]=i,e[1]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t,i=0){const n=e[i],s=e[i+1];e[i]=n*t[0]+s*t[2]+t[4],e[i+1]=n*t[1]+s*t[3]+t[5]}static applyTransformToBezier(e,t,i=0){const n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],h=t[5];for(let d=0;d<6;d+=2){const u=e[i+d],p=e[i+d+1];e[i+d]=u*n+p*o+l,e[i+d+1]=u*s+p*a+h}}static applyInverseTransform(e,t){const i=e[0],n=e[1],s=t[0]*t[3]-t[1]*t[2];e[0]=(i*t[3]-n*t[2]+t[2]*t[5]-t[4]*t[3])/s,e[1]=(-i*t[1]+n*t[0]+t[4]*t[1]-t[5]*t[0])/s}static axialAlignedBoundingBox(e,t,i){const n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],h=t[5],d=e[0],u=e[1],p=e[2],f=e[3];let g=n*d+l,m=g,_=n*p+l,b=_,v=a*u+h,y=v,x=a*f+h,A=x;if(0!==s||0!==o){const w=s*d,C=s*p,P=o*u,S=o*f;g+=P,b+=P,_+=S,m+=S,v+=w,A+=w,x+=C,y+=C}i[0]=Math.min(i[0],g,_,m,b),i[1]=Math.min(i[1],v,x,y,A),i[2]=Math.max(i[2],g,_,m,b),i[3]=Math.max(i[3],v,x,y,A)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const i=e[0],n=e[1],s=e[2],o=e[3],a=i**2+n**2,h=s**2+o**2,d=(a+h)/2,u=Math.sqrt(d**2-(a*h-(i*s+n*o)**2));t[0]=Math.sqrt(d+u||1),t[1]=Math.sqrt(d-u||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const i=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),n=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(i>n)return null;const s=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return s>o?null:[i,s,n,o]}static pointBoundingBox(e,t,i){i[0]=Math.min(i[0],e),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],e),i[3]=Math.max(i[3],t)}static rectBoundingBox(e,t,i,n,s){s[0]=Math.min(s[0],e,i),s[1]=Math.min(s[1],t,n),s[2]=Math.max(s[2],e,i),s[3]=Math.max(s[3],t,n)}static#t(e,t,i,n,s,o,a,l,h,d){if(h<=0||h>=1)return;const u=1-h,p=h*h,f=p*h,g=u*(u*(u*e+3*h*t)+3*p*i)+f*n,m=u*(u*(u*s+3*h*o)+3*p*a)+f*l;d[0]=Math.min(d[0],g),d[1]=Math.min(d[1],m),d[2]=Math.max(d[2],g),d[3]=Math.max(d[3],m)}static#e(e,t,i,n,s,o,a,l,h,d,u,p){if(Math.abs(h)<1e-12)return void(Math.abs(d)>=1e-12&&this.#t(e,t,i,n,s,o,a,l,-u/d,p));const f=d**2-4*u*h;if(f<0)return;const g=Math.sqrt(f),m=2*h;this.#t(e,t,i,n,s,o,a,l,(-d+g)/m,p),this.#t(e,t,i,n,s,o,a,l,(-d-g)/m,p)}static bezierBoundingBox(e,t,i,n,s,o,a,l,h){h[0]=Math.min(h[0],e,a),h[1]=Math.min(h[1],t,l),h[2]=Math.max(h[2],e,a),h[3]=Math.max(h[3],t,l),this.#e(e,i,s,a,t,n,o,l,3*(3*(i-s)-e+a),6*(e-2*i+s),3*(i-e),h),this.#e(e,i,s,a,t,n,o,l,3*(3*(n-o)-t+l),6*(t-2*n+o),3*(n-t),h)}}let si=null,$i=null;function Gi(){if("function"==typeof crypto.randomUUID)return crypto.randomUUID();const c=new Uint8Array(32);return crypto.getRandomValues(c),Bi(c)}const ri="pdfjs_internal_id_";function Et(c,e,t){return Math.min(Math.max(c,e),t)}function Ui(c){return Uint8Array.prototype.toBase64?c.toBase64():btoa(Bi(c))}"function"!=typeof Promise.try&&(Promise.try=function(c,...e){return new Promise(t=>{t(c(...e))})}),"function"!=typeof Math.sumPrecise&&(Math.sumPrecise=function(c){return c.reduce((e,t)=>e+t,0)});const $t="http://www.w3.org/2000/svg";class le{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}function be(c){return oi.apply(this,arguments)}function oi(){return(oi=(0,E.A)(function*(c,e="text"){if(ce(c,document.baseURI)){const t=yield fetch(c);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,i)=>{const n=new XMLHttpRequest;n.open("GET",c,!0),n.responseType=e,n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){if(200===n.status||0===n.status){switch(e){case"arraybuffer":case"blob":case"json":return void t(n.response)}return void t(n.responseText)}i(new Error(n.statusText))}},n.send(null)})})).apply(this,arguments)}class ve{constructor({viewBox:e,userUnit:t,scale:i,rotation:n,offsetX:s=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=i,this.rotation=n,this.offsetX=s,this.offsetY=o,i*=t;const l=(e[2]+e[0])/2,h=(e[3]+e[1])/2;let d,u,p,f,g,m,_,b;switch((n%=360)<0&&(n+=360),n){case 180:d=-1,u=0,p=0,f=1;break;case 90:d=0,u=1,p=1,f=0;break;case 270:d=0,u=-1,p=-1,f=0;break;case 0:d=1,u=0,p=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(p=-p,f=-f),0===d?(g=Math.abs(h-e[1])*i+s,m=Math.abs(l-e[0])*i+o,_=(e[3]-e[1])*i,b=(e[2]-e[0])*i):(g=Math.abs(l-e[0])*i+s,m=Math.abs(h-e[1])*i+o,_=(e[2]-e[0])*i,b=(e[3]-e[1])*i),this.transform=[d*i,u*i,p*i,f*i,g-d*i*l-p*i*h,m-u*i*l-f*i*h],this.width=_,this.height=b}get rawDims(){const e=this.viewBox;return W(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:i=this.offsetX,offsetY:n=this.offsetY,dontFlip:s=!1}={}){return new ve({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:n,dontFlip:s})}convertToViewportPoint(e,t){const i=[e,t];return D.applyTransform(i,this.transform),i}convertToViewportRectangle(e){const t=[e[0],e[1]];D.applyTransform(t,this.transform);const i=[e[2],e[3]];return D.applyTransform(i,this.transform),[t[0],t[1],i[0],i[1]]}convertToPdfPoint(e,t){const i=[e,t];return D.applyInverseTransform(i,this.transform),i}}class ai extends Zt{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Ve(c){const e=c.length;let t=0;for(;t<e&&""===c[t].trim();)t++;return"data:"===c.substring(t,t+5).toLowerCase()}function li(c){return"string"==typeof c&&/\.pdf$/i.test(c)}class Vi{started=Object.create(null);times=[];time(e){e in this.started&&U(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||U(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:i}of this.times)t=Math.max(i.length,t);for(const{name:i,start:n,end:s}of this.times)e.push(`${i.padEnd(t)} ${s-n}ms\n`);return e.join("")}}function ce(c,e){const t=e?URL.parse(c,e):URL.parse(c);return"http:"===t?.protocol||"https:"===t?.protocol}function Rt(c){c.preventDefault()}function ft(c){c.preventDefault(),c.stopPropagation()}class Hi{static#t;static toDateObject(e){if(!e||"string"!=typeof e)return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=this.#t.exec(e);if(!t)return null;const i=parseInt(t[1],10);let n=parseInt(t[2],10);n=n>=1&&n<=12?n-1:0;let s=parseInt(t[3],10);s=s>=1&&s<=31?s:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const h=t[7]||"Z";let d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let u=parseInt(t[9],10)||0;return u=u>=0&&u<=59?u:0,"-"===h?(o+=d,a+=u):"+"===h&&(o-=d,a-=u),new Date(Date.UTC(i,n,s,o,a,l))}}function ci(c){if(c.startsWith("#")){const e=parseInt(c.slice(1),16);return[(16711680&e)>>16,(65280&e)>>8,255&e]}return c.startsWith("rgb(")?c.slice(4,-1).split(",").map(e=>parseInt(e)):c.startsWith("rgba(")?c.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(U(`Not a valid color format: "${c}"`),[0,0,0])}function at(c){const{a:e,b:t,c:i,d:n,e:s,f:o}=c.getTransform();return[e,t,i,n,s,o]}function Lt(c){const{a:e,b:t,c:i,d:n,e:s,f:o}=c.getTransform().invertSelf();return[e,t,i,n,s,o]}function te(c,e,t=!1,i=!0){if(e instanceof ve){const{pageWidth:n,pageHeight:s}=e.rawDims,{style:o}=c,a=At.isCSSRoundSupported,l=`var(--total-scale-factor) * ${n}px`,h=`var(--total-scale-factor) * ${s}px`,d=a?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,u=a?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;t&&e.rotation%180!=0?(o.width=u,o.height=d):(o.width=d,o.height=u)}i&&c.setAttribute("data-main-rotation",e.rotation)}class Gt{constructor(){const{pixelRatio:e}=Gt;this.sx=e,this.sy=e}get scaled(){return 1!==this.sx||1!==this.sy}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,i,n){let s=1/0,o=1/0,a=1/0;i>0&&(s=Math.sqrt(i/(e*t))),-1!==n&&(o=n/e,a=n/t);const l=Math.min(s,o,a);return(this.sx>l||this.sy>l)&&(this.sx=l,this.sy=l,!0)}static get pixelRatio(){return globalThis.devicePixelRatio||1}}const hi=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Ae{#t=null;#e=null;#i;#n=null;#r=null;#s=null;static#l=null;constructor(e){this.#i=e,Ae.#l||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const e=this.#t=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=this.#i._uiManager._signal;e.addEventListener("contextmenu",Rt,{signal:t}),e.addEventListener("pointerdown",Ae.#a,{signal:t});const i=this.#n=document.createElement("div");i.className="buttons",e.append(i);const n=this.#i.toolbarPosition;if(n){const{style:s}=e,o="ltr"===this.#i._uiManager.direction?1-n[0]:n[0];s.insetInlineEnd=100*o+"%",s.top=`calc(${100*n[1]}% + var(--editor-toolbar-vert-offset))`}return this.#h(),e}get div(){return this.#t}static#a(e){e.stopPropagation()}#d(e){this.#i._focusEventsAllowed=!1,ft(e)}#c(e){this.#i._focusEventsAllowed=!0,ft(e)}#u(e){const t=this.#i._uiManager._signal;e.addEventListener("focusin",this.#d.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#c.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Rt,{signal:t})}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#r?.shown()}#h(){const{editorType:e,_uiManager:t}=this.#i,i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",Ae.#l[e]),this.#u(i),i.addEventListener("click",n=>{t.delete()},{signal:t._signal}),this.#n.append(i)}get#p(){const e=document.createElement("div");return e.className="divider",e}addAltText(e){var t=this;return(0,E.A)(function*(){const i=yield e.render();t.#u(i),t.#n.prepend(i,t.#p),t.#r=e})()}addColorPicker(e){this.#e=e;const t=e.renderButton();this.#u(t),this.#n.prepend(t,this.#p)}addEditSignatureButton(e){var t=this;return(0,E.A)(function*(){const i=t.#s=yield e.renderEditButton(t.#i);t.#u(i),t.#n.prepend(i,t.#p)})()}updateEditSignatureButton(e){this.#s&&(this.#s.title=e)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class as{#t=null;#e=null;#i;constructor(e){this.#i=e}#n(){const e=this.#e=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Rt,{signal:this.#i._signal});const t=this.#t=document.createElement("div");return t.className="buttons",e.append(t),this.#s(),e}#r(e,t){let i=0,n=0;for(const s of e){const o=s.y+s.height;if(o<i)continue;const a=s.x+(t?s.width:0);o>i?(n=a,i=o):t?a>n&&(n=a):a<n&&(n=a)}return[t?1-n:n,i]}show(e,t,i){const[n,s]=this.#r(t,i),{style:o}=this.#e||=this.#n();e.append(this.#e),o.insetInlineEnd=100*n+"%",o.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#s(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const i=this.#i._signal;e.addEventListener("contextmenu",Rt,{signal:i}),e.addEventListener("click",()=>{this.#i.highlightSelection("floating_button")},{signal:i}),this.#t.append(e)}}function di(c,e,t){for(const i of t)e.addEventListener(i,c[i].bind(c))}class ls{#t=0;get id(){return"pdfjs_internal_editor_"+this.#t++}}class ui{#t=Gi();#e=0;#i=null;static get _isSVGFittingCanvas(){const i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),n=new Image;return n.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',W(this,"_isSVGFittingCanvas",n.decode().then(()=>(i.drawImage(n,0,0,1,1,0,0,1,3),0===new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0])))}#n(e,t){var i=this;return(0,E.A)(function*(){i.#i||=new Map;let n=i.#i.get(e);if(null===n)return null;if(n?.bitmap)return n.refCounter+=1,n;try{let s;if(n||={bitmap:null,id:`image_${i.#t}_${i.#e++}`,refCounter:0,isSvg:!1},"string"==typeof t?(n.url=t,s=yield be(t,"blob")):t instanceof File?s=n.file=t:t instanceof Blob&&(s=t),"image/svg+xml"===s.type){const o=ui._isSVGFittingCanvas,a=new FileReader,l=new Image,h=new Promise((d,u)=>{l.onload=()=>{n.bitmap=l,n.isSvg=!0,d()},a.onload=(0,E.A)(function*(){const p=n.svgUrl=a.result;l.src=(yield o)?`${p}#svgView(preserveAspectRatio(none))`:p}),l.onerror=a.onerror=u});a.readAsDataURL(s),yield h}else n.bitmap=yield createImageBitmap(s);n.refCounter=1}catch(s){U(s),n=null}return i.#i.set(e,n),n&&i.#i.set(n.id,n),n})()}getFromFile(e){var t=this;return(0,E.A)(function*(){const{lastModified:i,name:n,size:s,type:o}=e;return t.#n(`${i}_${n}_${s}_${o}`,e)})()}getFromUrl(e){var t=this;return(0,E.A)(function*(){return t.#n(e,e)})()}getFromBlob(e,t){var i=this;return(0,E.A)(function*(){const n=yield t;return i.#n(e,n)})()}getFromId(e){var t=this;return(0,E.A)(function*(){t.#i||=new Map;const i=t.#i.get(e);if(!i)return null;if(i.bitmap)return i.refCounter+=1,i;if(i.file)return t.getFromFile(i.file);if(i.blobPromise){const{blobPromise:n}=i;return delete i.blobPromise,t.getFromBlob(i.id,n)}return t.getFromUrl(i.url)})()}getFromCanvas(e,t){this.#i||=new Map;let i=this.#i.get(e);if(i?.bitmap)return i.refCounter+=1,i;const n=new OffscreenCanvas(t.width,t.height);return n.getContext("2d").drawImage(t,0,0),i={bitmap:n.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#i.set(e,i),this.#i.set(i.id,i),i}getSvgUrl(e){const t=this.#i.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#i||=new Map;const t=this.#i.get(e);if(!t||(t.refCounter-=1,0!==t.refCounter))return;const{bitmap:i}=t;if(!t.url&&!t.file){const n=new OffscreenCanvas(i.width,i.height);n.getContext("bitmaprenderer").transferFromImageBitmap(i),t.blobPromise=n.convertToBlob()}i.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#t}_`)}}class cs{#t=[];#e=!1;#i;#n=-1;constructor(e=128){this.#i=e}add({cmd:e,undo:t,post:i,mustExec:n,type:s=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(n&&e(),this.#e)return;const l={cmd:e,undo:t,post:i,type:s};if(-1===this.#n)return this.#t.length>0&&(this.#t.length=0),this.#n=0,void this.#t.push(l);if(o&&this.#t[this.#n].type===s)return a&&(l.undo=this.#t[this.#n].undo),void(this.#t[this.#n]=l);const h=this.#n+1;h===this.#i?this.#t.splice(0,1):(this.#n=h,h<this.#t.length&&this.#t.splice(h)),this.#t.push(l)}undo(){if(-1===this.#n)return;this.#e=!0;const{undo:e,post:t}=this.#t[this.#n];e(),t?.(),this.#e=!1,this.#n-=1}redo(){if(this.#n<this.#t.length-1){this.#n+=1,this.#e=!0;const{cmd:e,post:t}=this.#t[this.#n];e(),t?.(),this.#e=!1}}hasSomethingToUndo(){return-1!==this.#n}hasSomethingToRedo(){return this.#n<this.#t.length-1}cleanType(e){if(-1!==this.#n){for(let t=this.#n;t>=0;t--)if(this.#t[t].type!==e)return this.#t.splice(t+1,this.#n-t),void(this.#n=t);this.#t.length=0,this.#n=-1}}destroy(){this.#t=null}}class ye{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=At.platform;for(const[i,n,s={}]of e)for(const o of i){const a=o.startsWith("mac+");t&&a?(this.callbacks.set(o.slice(4),{callback:n,options:s}),this.allKeys.add(o.split("+").at(-1))):!t&&!a&&(this.callbacks.set(o,{callback:n,options:s}),this.allKeys.add(o.split("+").at(-1)))}}#t(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const i=this.callbacks.get(this.#t(t));if(!i)return;const{callback:n,options:{bubbles:s=!1,args:o=[],checker:a=null}}=i;a&&!a(e,t)||(n.bind(e,...o,t)(),s||ft(t))}}class pi{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return function os(c){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of c.keys()){e.style.color=t;const i=window.getComputedStyle(e).color;c.set(t,ci(i))}e.remove()}(e),W(this,"_colors",e)}convert(e){const t=ci(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[i,n]of this._colors)if(n.every((s,o)=>s===t[o]))return pi._colorsMapping.get(i);return t}getHexCode(e){const t=this._colors.get(e);return t?D.makeHexColor(...t):e}}let xe=(()=>{class c{#t=new AbortController;#e=null;#i=new Map;#n=new Map;#r=null;#s=null;#l=null;#a=new cs;#d=null;#c=null;#u=0;#h=new Set;#p=null;#o=null;#f=new Set;_editorUndoBar=null;#m=!1;#g=!1;#_=!1;#b=null;#v=null;#y=null;#C=null;#w=!1;#S=null;#T=new ls;#x=!1;#M=!1;#P=null;#I=null;#F=null;#O=null;#$=null;#E=T.NONE;#A=new Set;#N=null;#j=null;#V=null;#H=null;#z={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#G=[0,0];#R=null;#D=null;#U=null;#L=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=c.prototype,i=a=>a.#D.contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&a.hasSomethingToControl(),n=(a,{target:l})=>{if(l instanceof HTMLInputElement){const{type:h}=l;return"text"!==h&&"number"!==h}return!0},s=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return W(this,"_keyboardManager",new ye([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],t.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:n}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(a,{target:l})=>!(l instanceof HTMLButtonElement)&&a.#D.contains(l)&&!a.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(a,{target:l})=>!(l instanceof HTMLButtonElement)&&a.#D.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-s,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-o,0],checker:i}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[s,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[o,0],checker:i}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-s],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-o],checker:i}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,s],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,o],checker:i}]]))}constructor(t,i,n,s,o,a,l,h,d,u,p,f,g,m){const _=this._signal=this.#t.signal;this.#D=t,this.#U=i,this.#r=n,this.#j=s,this._eventBus=o,o._on("editingaction",this.onEditingAction.bind(this),{signal:_}),o._on("pagechanging",this.onPageChanging.bind(this),{signal:_}),o._on("scalechanging",this.onScaleChanging.bind(this),{signal:_}),o._on("rotationchanging",this.onRotationChanging.bind(this),{signal:_}),o._on("setpreference",this.onSetPreference.bind(this),{signal:_}),o._on("switchannotationeditorparams",b=>this.updateParams(b.type,b.value),{signal:_}),this.#nt(),this.#at(),this.#K(),this.#s=a.annotationStorage,this.#b=a.filterFactory,this.#V=l,this.#C=h||null,this.#m=d,this.#g=u,this.#_=p,this.#$=f||null,this.viewParameters={realScale:le.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=!1!==m}destroy(){this.#L?.resolve(),this.#L=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#n.values())t.destroy();this.#n.clear(),this.#i.clear(),this.#f.clear(),this.#O?.clear(),this.#e=null,this.#A.clear(),this.#a.destroy(),this.#r?.destroy(),this.#j?.destroy(),this.#S?.hide(),this.#S=null,this.#F?.destroy(),this.#F=null,this.#v&&(clearTimeout(this.#v),this.#v=null),this.#R&&(clearTimeout(this.#R),this.#R=null),this._editorUndoBar?.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#$}get useNewAltTextFlow(){return this.#g}get useNewAltTextWhenAddingImage(){return this.#_}get hcmFilter(){return W(this,"hcmFilter",this.#V?this.#b.addHCMFilter(this.#V.foreground,this.#V.background):"none")}get direction(){return W(this,"direction",getComputedStyle(this.#D).direction)}get highlightColors(){return W(this,"highlightColors",this.#C?new Map(this.#C.split(",").map(t=>t.split("=").map(i=>i.trim()))):null)}get highlightColorNames(){return W(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#c=t}setMainHighlightColorPicker(t){this.#F=t}editAltText(t,i=!1){this.#r?.editAltText(this,t,i)}getSignature(t){this.#j?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#j}switchToMode(t,i){this._eventBus.on("annotationeditormodechanged",i,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,i){this._eventBus.dispatch("setpreference",{source:this,name:t,value:i})}onSetPreference({name:t,value:i}){"enableNewAltTextWhenAddingImage"===t&&(this.#_=i)}onPageChanging({pageNumber:t}){this.#u=t-1}focusMainContainer(){this.#D.focus()}findParent(t,i){for(const n of this.#n.values()){const{x:s,y:o,width:a,height:l}=n.div.getBoundingClientRect();if(t>=s&&t<=s+a&&i>=o&&i<=o+l)return n}return null}disableUserSelect(t=!1){this.#U.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#f.add(t)}removeShouldRescale(t){this.#f.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*le.PDF_TO_CSS_UNITS;for(const i of this.#f)i.onScaleChanging();this.#c?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#W({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#q(t){const{currentLayer:i}=this;if(i.hasTextLayer(t))return i;for(const n of this.#n.values())if(n.hasTextLayer(t))return n;return null}highlightSelection(t=""){const i=document.getSelection();if(!i||i.isCollapsed)return;const{anchorNode:n,anchorOffset:s,focusNode:o,focusOffset:a}=i,l=i.toString(),d=this.#W(i).closest(".textLayer"),u=this.getSelectionBoxes(d);if(!u)return;i.empty();const p=this.#q(d),f=this.#E===T.NONE,g=()=>{p?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:u,anchorNode:n,anchorOffset:s,focusNode:o,focusOffset:a,text:l}),f&&this.showAllEditors("highlight",!0,!0)};f?this.switchToMode(T.HIGHLIGHT,g):g()}#et(){const t=document.getSelection();if(!t||t.isCollapsed)return;const n=this.#W(t).closest(".textLayer"),s=this.getSelectionBoxes(n);s&&(this.#S||=new as(this),this.#S.show(n,s,"ltr"===this.direction))}addToAnnotationStorage(t){!t.isEmpty()&&this.#s&&!this.#s.has(t.id)&&this.#s.setValue(t.id,t)}#it(){const t=document.getSelection();if(!t||t.isCollapsed)return void(this.#N&&(this.#S?.hide(),this.#N=null,this.#k({hasSelectedText:!1})));const{anchorNode:i}=t;if(i===this.#N)return;const s=this.#W(t).closest(".textLayer");if(s){if(this.#S?.hide(),this.#N=i,this.#k({hasSelectedText:!0}),(this.#E===T.HIGHLIGHT||this.#E===T.NONE)&&(this.#E===T.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#w=this.isShiftKeyDown,!this.isShiftKeyDown)){const o=this.#E===T.HIGHLIGHT?this.#q(s):null;o?.toggleDrawing();const a=new AbortController,l=this.combinedSignal(a),h=d=>{"pointerup"===d.type&&0!==d.button||(a.abort(),o?.toggleDrawing(!0),"pointerup"===d.type&&this.#Y("main_toolbar"))};window.addEventListener("pointerup",h,{signal:l}),window.addEventListener("blur",h,{signal:l})}}else this.#N&&(this.#S?.hide(),this.#N=null,this.#k({hasSelectedText:!1}))}#Y(t=""){this.#E===T.HIGHLIGHT?this.highlightSelection(t):this.#m&&this.#et()}#nt(){document.addEventListener("selectionchange",this.#it.bind(this),{signal:this._signal})}#st(){if(this.#y)return;this.#y=new AbortController;const t=this.combinedSignal(this.#y);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#rt(){this.#y?.abort(),this.#y=null}blur(){if(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#Y("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const i of this.#A)if(i.div.contains(t)){this.#I=[i,t],i._focusEventsAllowed=!1;break}}focus(){if(!this.#I)return;const[t,i]=this.#I;this.#I=null,i.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),i.focus()}#K(){if(this.#P)return;this.#P=new AbortController;const t=this.combinedSignal(this.#P);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#ot(){this.#P?.abort(),this.#P=null}#J(){if(this.#d)return;this.#d=new AbortController;const t=this.combinedSignal(this.#d);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#Q(){this.#d?.abort(),this.#d=null}#at(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#K(),this.#J()}removeEditListeners(){this.#ot(),this.#Q()}dragOver(t){for(const{type:i}of t.dataTransfer.items)for(const n of this.#o)if(n.isHandlingMimeForPasting(i))return t.dataTransfer.dropEffect="copy",void t.preventDefault()}drop(t){for(const i of t.dataTransfer.items)for(const n of this.#o)if(n.isHandlingMimeForPasting(i.type))return n.paste(i,this.currentLayer),void t.preventDefault()}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const i=[];for(const n of this.#A){const s=n.serialize(!0);s&&i.push(s)}0!==i.length&&t.clipboardData.setData("application/pdfjs",JSON.stringify(i))}cut(t){this.copy(t),this.delete()}paste(t){var i=this;return(0,E.A)(function*(){t.preventDefault();const{clipboardData:n}=t;for(const a of n.items)for(const l of i.#o)if(l.isHandlingMimeForPasting(a.type))return void l.paste(a,i.currentLayer);let s=n.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(a){return void U(`paste: "${a.message}".`)}if(!Array.isArray(s))return;i.unselectAll();const o=i.currentLayer;try{const a=[];for(const d of s){const u=yield o.deserialize(d);if(!u)return;a.push(u)}const l=()=>{for(const d of a)i.#Z(d);i.#tt(a)};i.addCommands({cmd:l,undo:()=>{for(const d of a)d.remove()},mustExec:!0})}catch(a){U(`paste: "${a.message}".`)}})()}keydown(t){!this.isShiftKeyDown&&"Shift"===t.key&&(this.isShiftKeyDown=!0),this.#E!==T.NONE&&!this.isEditorHandlingKeyboard&&c._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&"Shift"===t.key&&(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#Y("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu")}}#k(t){Object.entries(t).some(([n,s])=>this.#z[n]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#z,t)}),this.#E===T.HIGHLIGHT&&!1===t.hasSelectedEditor&&this.#B([[z.HIGHLIGHT_FREE,!0]]))}#B(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#st(),this.#J(),this.#k({isEditing:this.#E!==T.NONE,isEmpty:this.#X(),hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:this.#a.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#rt(),this.#Q(),this.#k({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#o){this.#o=t;for(const i of this.#o)this.#B(i.defaultPropertiesToUpdate)}}getId(){return this.#T.id}get currentLayer(){return this.#n.get(this.#u)}getLayer(t){return this.#n.get(t)}get currentPageIndex(){return this.#u}addLayer(t){this.#n.set(t.pageIndex,t),this.#x?t.enable():t.disable()}removeLayer(t){this.#n.delete(t.pageIndex)}updateMode(t){var i=this;return(0,E.A)(function*(n,s=null,o=!1){if(i.#E!==n&&(!i.#L||(yield i.#L.promise,i.#L))){if(i.#L=Promise.withResolvers(),i.#c?.commitOrRemove(),i.#E=n,n===T.NONE)return i.setEditingState(!1),i.#ct(),i._editorUndoBar?.hide(),void i.#L.resolve();n===T.SIGNATURE&&(yield i.#j?.loadSignatures()),i.setEditingState(!0),yield i.#lt(),i.unselectAll();for(const a of i.#n.values())a.updateMode(n);if(!s)return o&&i.addNewEditorFromKeyboard(),void i.#L.resolve();for(const a of i.#i.values())a.annotationElementId===s?(i.setSelected(a),a.enterInEditMode()):a.unselect();i.#L.resolve()}}).apply(this,arguments)}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==this.#E&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,i){if(this.#o){switch(t){case z.CREATE:return void this.currentLayer.addNewEditor(i);case z.HIGHLIGHT_DEFAULT_COLOR:this.#F?.updateColor(i);break;case z.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#H||=new Map).set(t,i),this.showAllEditors("highlight",i)}for(const n of this.#A)n.updateParams(t,i);for(const n of this.#o)n.updateDefaultParams(t,i)}}showAllEditors(t,i,n=!1){for(const o of this.#i.values())o.editorType===t&&o.show(i);(this.#H?.get(z.HIGHLIGHT_SHOW_ALL)??!0)!==i&&this.#B([[z.HIGHLIGHT_SHOW_ALL,i]])}enableWaiting(t=!1){if(this.#M!==t){this.#M=t;for(const i of this.#n.values())t?i.disableClick():i.enableClick(),i.div.classList.toggle("waiting",t)}}#lt(){var t=this;return(0,E.A)(function*(){if(!t.#x){t.#x=!0;const i=[];for(const n of t.#n.values())i.push(n.enable());yield Promise.all(i);for(const n of t.#i.values())n.enable()}})()}#ct(){if(this.unselectAll(),this.#x){this.#x=!1;for(const t of this.#n.values())t.disable();for(const t of this.#i.values())t.disable()}}getEditors(t){const i=[];for(const n of this.#i.values())n.pageIndex===t&&i.push(n);return i}getEditor(t){return this.#i.get(t)}addEditor(t){this.#i.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#v&&clearTimeout(this.#v),this.#v=setTimeout(()=>{this.focusMainContainer(),this.#v=null},0)),this.#i.delete(t.id),t.annotationElementId&&this.#O?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#h.has(t.annotationElementId))&&this.#s?.remove(t.id)}addDeletedAnnotationElement(t){this.#h.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#h.has(t)}removeDeletedAnnotationElement(t){this.#h.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#Z(t){const i=this.#n.get(t.pageIndex);i?i.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#B(t.propertiesToUpdate))}get#ht(){let t=null;for(t of this.#A);return t}updateUI(t){this.#ht===t&&this.#B(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#B(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#A.has(t))return this.#A.delete(t),t.unselect(),void this.#k({hasSelectedEditor:this.hasSelection});this.#A.add(t),t.select(),this.#B(t.propertiesToUpdate),this.#k({hasSelectedEditor:!0})}setSelected(t){this.#c?.commitOrRemove();for(const i of this.#A)i!==t&&i.unselect();this.#A.clear(),this.#A.add(t),t.select(),this.#B(t.propertiesToUpdate),this.#k({hasSelectedEditor:!0})}isSelected(t){return this.#A.has(t)}get firstSelectedEditor(){return this.#A.values().next().value}unselect(t){t.unselect(),this.#A.delete(t),this.#k({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#A.size}get isEnterHandled(){return 1===this.#A.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#a.undo(),this.#k({hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#X()}),this._editorUndoBar?.hide()}redo(){this.#a.redo(),this.#k({hasSomethingToUndo:!0,hasSomethingToRedo:this.#a.hasSomethingToRedo(),isEmpty:this.#X()})}addCommands(t){this.#a.add(t),this.#k({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#X()})}cleanUndoStack(t){this.#a.cleanType(t)}#X(){if(0===this.#i.size)return!0;if(1===this.#i.size)for(const t of this.#i.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const i=t?[t]:[...this.#A],s=()=>{for(const o of i)this.#Z(o)};this.addCommands({cmd:()=>{this._editorUndoBar?.show(s,1===i.length?i[0].editorType:i.length);for(const o of i)o.remove()},undo:s,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#tt(t){for(const i of this.#A)i.unselect();this.#A.clear();for(const i of t)i.isEmpty()||(this.#A.add(i),i.select());this.#k({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#A)t.commit();this.#tt(this.#i.values())}unselectAll(){if((!this.#e||(this.#e.commitOrRemove(),this.#E===T.NONE))&&!this.#c?.commitOrRemove()&&this.hasSelection){for(const t of this.#A)t.unselect();this.#A.clear(),this.#k({hasSelectedEditor:!1})}}translateSelectedEditors(t,i,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;this.#G[0]+=t,this.#G[1]+=i;const[s,o]=this.#G,a=[...this.#A];this.#R&&clearTimeout(this.#R),this.#R=setTimeout(()=>{this.#R=null,this.#G[0]=this.#G[1]=0,this.addCommands({cmd:()=>{for(const h of a)this.#i.has(h.id)&&(h.translateInPage(s,o),h.translationDone())},undo:()=>{for(const h of a)this.#i.has(h.id)&&(h.translateInPage(-s,-o),h.translationDone())},mustExec:!1})},1e3);for(const h of a)h.translateInPage(t,i),h.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#p=new Map;for(const t of this.#A)this.#p.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#p)return!1;this.disableUserSelect(!1);const t=this.#p;this.#p=null;let i=!1;for(const[{x:s,y:o,pageIndex:a},l]of t)l.newX=s,l.newY=o,l.newPageIndex=a,i||=s!==l.savedX||o!==l.savedY||a!==l.savedPageIndex;if(!i)return!1;const n=(s,o,a,l)=>{if(this.#i.has(s.id)){const h=this.#n.get(l);h?s._setParentAndPosition(h,o,a):(s.pageIndex=l,s.x=o,s.y=a)}};return this.addCommands({cmd:()=>{for(const[s,{newX:o,newY:a,newPageIndex:l}]of t)n(s,o,a,l)},undo:()=>{for(const[s,{savedX:o,savedY:a,savedPageIndex:l}]of t)n(s,o,a,l)},mustExec:!0}),!0}dragSelectedEditors(t,i){if(this.#p)for(const n of this.#p.keys())n.drag(t,i)}rebuild(t){if(null===t.parent){const i=this.getLayer(t.pageIndex);i?(i.changeParent(t),i.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#A.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#E}get imageManager(){return W(this,"imageManager",new ui)}getSelectionBoxes(t){if(!t)return null;const i=document.getSelection();for(let d=0,u=i.rangeCount;d<u;d++)if(!t.contains(i.getRangeAt(d).commonAncestorContainer))return null;const{x:n,y:s,width:o,height:a}=t.getBoundingClientRect();let l;switch(t.getAttribute("data-main-rotation")){case"90":l=(d,u,p,f)=>({x:(u-s)/a,y:1-(d+p-n)/o,width:f/a,height:p/o});break;case"180":l=(d,u,p,f)=>({x:1-(d+p-n)/o,y:1-(u+f-s)/a,width:p/o,height:f/a});break;case"270":l=(d,u,p,f)=>({x:1-(u+f-s)/a,y:(d-n)/o,width:f/a,height:p/o});break;default:l=(d,u,p,f)=>({x:(d-n)/o,y:(u-s)/a,width:p/o,height:f/a})}const h=[];for(let d=0,u=i.rangeCount;d<u;d++){const p=i.getRangeAt(d);if(!p.collapsed)for(const{x:f,y:g,width:m,height:_}of p.getClientRects())0===m||0===_||h.push(l(f,g,m,_))}return 0===h.length?null:h}addChangedExistingAnnotation({annotationElementId:t,id:i}){(this.#l||=new Map).set(t,i)}removeChangedExistingAnnotation({annotationElementId:t}){this.#l?.delete(t)}renderAnnotationElement(t){const i=this.#l?.get(t.data.id);if(!i)return;const n=this.#s.getRawValue(i);n&&(this.#E===T.NONE&&!n.hasBeenModified||n.renderAnnotationElement(t))}setMissingCanvas(t,i,n){const s=this.#O?.get(t);s&&(s.setCanvas(i,n),this.#O.delete(t))}addMissingCanvas(t,i){(this.#O||=new Map).set(t,i)}}return c})(),zi=(()=>{class c{#t=null;#e=!1;#i=null;#n=null;#r=null;#s=null;#l=!1;#a=null;#d=null;#c=null;#u=null;#h=!1;static#p=null;static _l10n=null;constructor(t){this.#d=t,this.#h=t._uiManager.useNewAltTextFlow,c.#p||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){c._l10n??=t}render(){var t=this;return(0,E.A)(function*(){const i=t.#i=document.createElement("button");i.className="altText",i.tabIndex="0";const n=t.#n=document.createElement("span");i.append(n),t.#h?(i.classList.add("new"),i.setAttribute("data-l10n-id",c.#p.missing),n.setAttribute("data-l10n-id",c.#p["missing-label"])):(i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),n.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=t.#d._uiManager._signal;i.addEventListener("contextmenu",Rt,{signal:s}),i.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:s});const o=a=>{a.preventDefault(),t.#d._uiManager.editAltText(t.#d),t.#h&&t.#d._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:t.#o}})};return i.addEventListener("click",o,{capture:!0,signal:s}),i.addEventListener("keydown",a=>{a.target===i&&"Enter"===a.key&&(t.#l=!0,o(a))},{signal:s}),yield t.#f(),i})()}get#o(){return(this.#t?"added":null===this.#t&&this.guessedText&&"review")||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#l}),this.#l=!1)}isEmpty(){return this.#h?null===this.#t:!this.#t&&!this.#e}hasData(){return this.#h?null!==this.#t||!!this.#c:this.isEmpty()}get guessedText(){return this.#c}setGuessedText(t){var i=this;return(0,E.A)(function*(){null===i.#t&&(i.#c=t,i.#u=yield c._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),i.#f())})()}toggleAltTextBadge(t=!1){if(!this.#h||this.#t)return this.#a?.remove(),void(this.#a=null);if(!this.#a){const i=this.#a=document.createElement("div");i.className="noAltTextBadge",this.#d.div.append(i)}this.#a.classList.toggle("hidden",!t)}serialize(t){let i=this.#t;return!t&&this.#c===i&&(i=this.#u),{altText:i,decorative:this.#e,guessedText:this.#c,textWithDisclaimer:this.#u}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:i,guessedText:n,textWithDisclaimer:s,cancel:o=!1}){n&&(this.#c=n,this.#u=s),(this.#t!==t||this.#e!==i)&&(o||(this.#t=t,this.#e=i),this.#f())}toggle(t=!1){this.#i&&(!t&&this.#s&&(clearTimeout(this.#s),this.#s=null),this.#i.disabled=!t)}shown(){this.#d._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#o}})}destroy(){this.#i?.remove(),this.#i=null,this.#n=null,this.#r=null,this.#a?.remove(),this.#a=null}#f(){var t=this;return(0,E.A)(function*(){const i=t.#i;if(!i)return;if(t.#h){if(i.classList.toggle("done",!!t.#t),i.setAttribute("data-l10n-id",c.#p[t.#o]),t.#n?.setAttribute("data-l10n-id",c.#p[`${t.#o}-label`]),!t.#t)return void t.#r?.remove()}else{if(!t.#t&&!t.#e)return i.classList.remove("done"),void t.#r?.remove();i.classList.add("done"),i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let n=t.#r;if(!n){t.#r=n=document.createElement("span"),n.className="tooltip",n.setAttribute("role","tooltip"),n.id=`alt-text-tooltip-${t.#d.id}`;const o=100,a=t.#d._uiManager._signal;a.addEventListener("abort",()=>{clearTimeout(t.#s),t.#s=null},{once:!0}),i.addEventListener("mouseenter",()=>{t.#s=setTimeout(()=>{t.#s=null,t.#r.classList.add("show"),t.#d._reportTelemetry({action:"alt_text_tooltip"})},o)},{signal:a}),i.addEventListener("mouseleave",()=>{t.#s&&(clearTimeout(t.#s),t.#s=null),t.#r?.classList.remove("show")},{signal:a})}t.#e?n.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(n.removeAttribute("data-l10n-id"),n.textContent=t.#t),n.parentNode||i.append(n),t.#d.getElementForAltText()?.setAttribute("aria-describedby",n.id)})()}}return c})();class He{#t;#e=!1;#i=null;#n;#r;#s;#l;#a=null;#d;#c=null;#u;#h=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:i=null,onPinchStart:n=null,onPinching:s=null,onPinchEnd:o=null,signal:a}){this.#t=e,this.#i=i,this.#n=t,this.#r=n,this.#s=s,this.#l=o,this.#u=new AbortController,this.#d=AbortSignal.any([a,this.#u.signal]),e.addEventListener("touchstart",this.#p.bind(this),{passive:!1,signal:this.#d})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Gt.pixelRatio}#p(e){if(this.#n?.())return;if(1===e.touches.length){if(this.#a)return;const n=this.#a=new AbortController,s=AbortSignal.any([this.#d,n.signal]),o=this.#t,a={capture:!0,signal:s,passive:!1},l=h=>{"touch"===h.pointerType&&(this.#a?.abort(),this.#a=null)};return o.addEventListener("pointerdown",h=>{"touch"===h.pointerType&&(ft(h),l(h))},a),o.addEventListener("pointerup",l,a),void o.addEventListener("pointercancel",l,a)}if(!this.#h){this.#h=new AbortController;const n=AbortSignal.any([this.#d,this.#h.signal]),s=this.#t,o={signal:n,capture:!1,passive:!1};s.addEventListener("touchmove",this.#o.bind(this),o);const a=this.#f.bind(this);s.addEventListener("touchend",a,o),s.addEventListener("touchcancel",a,o),o.capture=!0,s.addEventListener("pointerdown",ft,o),s.addEventListener("pointermove",ft,o),s.addEventListener("pointercancel",ft,o),s.addEventListener("pointerup",ft,o),this.#r?.()}if(ft(e),2!==e.touches.length||this.#i?.())return void(this.#c=null);let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]),this.#c={touch0X:t.screenX,touch0Y:t.screenY,touch1X:i.screenX,touch1Y:i.screenY}}#o(e){if(!this.#c||2!==e.touches.length)return;ft(e);let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]);const{screenX:n,screenY:s}=t,{screenX:o,screenY:a}=i,l=this.#c,{touch0X:h,touch0Y:d,touch1X:u,touch1Y:p}=l,f=u-h,g=p-d,b=Math.hypot(o-n,a-s)||1,v=Math.hypot(f,g)||1;if(!this.#e&&Math.abs(v-b)<=He.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=n,l.touch0Y=s,l.touch1X=o,l.touch1Y=a,!this.#e)return void(this.#e=!0);const y=[(n+o)/2,(s+a)/2];this.#s?.(y,v,b)}#f(e){e.touches.length>=2||(this.#h&&(this.#h.abort(),this.#h=null,this.#l?.()),this.#c&&(ft(e),this.#c=null,this.#e=!1))}destroy(){this.#u?.abort(),this.#u=null,this.#a?.abort(),this.#a=null}}class j{#t=null;#e=null;#i=null;#n=!1;#r=null;#s="";#l=!1;#a=null;#d=null;#c=null;#u=null;#h="";#p=!1;#o=null;#f=!1;#m=!1;#g=!1;#_=null;#b=0;#v=0;#y=null;#C=null;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#w=!1;#S=j._zIndex++;static _borderLineWidth=-1;static _colorManager=new pi;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=j.prototype._resizeWithKeyboard,t=xe.TRANSLATE_SMALL,i=xe.TRANSLATE_BIG;return W(this,"_resizerKeyboardManager",new ye([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,i]}],[["Escape","mac+Escape"],j.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:i,pageHeight:n,pageX:s,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,n],this.pageTranslation=[s,o];const[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return W(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new hs({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(j._l10n??=e,j._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),-1!==j._borderLineWidth)return;const i=getComputedStyle(document.documentElement);j._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){nt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#w}set _isDraggable(e){this.#w=e,this.div?.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(2*e),this.y+=this.width*e/(2*t);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(2*e),this.y-=this.width*e/(2*t);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#S}setParent(e){null!==e?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):this.#U(),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#p?this.#p=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,i,n){const[s,o]=this.parentDimensions;[i,n]=this.screenToPageTranslation(i,n),this.x=(e+i)/s,this.y=(t+n)/o,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[i,n]=this.parentDimensions;this.setAt(e*i,t*n,this.width*i,this.height*n),this._onTranslated()}#T([e,t],i,n){[i,n]=this.screenToPageTranslation(i,n),this.x+=i/e,this.y+=n/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#T(this.parentDimensions,e,t)}translateInPage(e,t){this.#o||=[this.x,this.y,this.width,this.height],this.#T(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){this.#o||=[this.x,this.y,this.width,this.height];const{div:i,parentDimensions:[n,s]}=this;if(this.x+=e/n,this.y+=t/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:u,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this;const[l,h]=this.getBaseTranslation();o+=l,a+=h;const{style:d}=i;d.left=`${(100*o).toFixed(2)}%`,d.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),i.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#o&&(this.#o[0]!==this.x||this.#o[1]!==this.y)}get _hasBeenResized(){return!!this.#o&&(this.#o[2]!==this.width||this.#o[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:i}=j,n=i/e,s=i/t;switch(this.rotation){case 90:return[-n,s];case 180:return[n,s];case 270:return[n,-s];default:return[-n,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[i,n]}=this;let{x:s,y:o,width:a,height:l}=this;if(a*=i,l*=n,s*=i,o*=n,this._mustFixPosition)switch(e){case 0:s=Et(s,0,i-a),o=Et(o,0,n-l);break;case 90:s=Et(s,0,i-l),o=Et(o,a,n);break;case 180:s=Et(s,a,i),o=Et(o,l,n);break;case 270:s=Et(s,l,i),o=Et(o,0,n-a)}this.x=s/=i,this.y=o/=n;const[h,d]=this.getBaseTranslation();s+=h,o+=d,t.left=`${(100*s).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}static#x(e,t,i){switch(i){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return j.#x(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return j.#x(e,t,360-this.parentRotation)}#M(e){switch(e){case 90:{const[t,i]=this.pageDimensions;return[0,-t/i,i/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,i]=this.pageDimensions;return[0,t/i,-i/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,i]}=this;return[t*e,i*e]}setDims(e,t){const[i,n]=this.parentDimensions,{style:s}=this.div;s.width=`${(100*e/i).toFixed(2)}%`,this.#l||(s.height=`${(100*t/n).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:i}=e,n=i.endsWith("%"),s=!this.#l&&t.endsWith("%");if(n&&s)return;const[o,a]=this.parentDimensions;n||(e.width=`${(100*parseFloat(i)/o).toFixed(2)}%`),!this.#l&&!s&&(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#P(){if(this.#a)return;this.#a=document.createElement("div"),this.#a.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const i of e){const n=document.createElement("div");this.#a.append(n),n.classList.add("resizer",i),n.setAttribute("data-resizer-name",i),n.addEventListener("pointerdown",this.#I.bind(this,i),{signal:t}),n.addEventListener("contextmenu",Rt,{signal:t}),n.tabIndex=-1}this.div.prepend(this.#a)}#I(e,t){t.preventDefault();const{isMac:i}=At.platform;if(0!==t.button||t.ctrlKey&&i)return;this.#i?.toggle(!1);const n=this._isDraggable;this._isDraggable=!1,this.#d=[t.screenX,t.screenY];const s=new AbortController,o=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#$.bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",ft,{passive:!1,signal:o}),window.addEventListener("contextmenu",Rt,{signal:o}),this.#c={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const h=()=>{s.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=n,this.parent.div.style.cursor=a,this.div.style.cursor=l,this.#O()};window.addEventListener("pointerup",h,{signal:o}),window.addEventListener("blur",h,{signal:o})}#F(e,t,i,n){this.width=i,this.height=n,this.x=e,this.y=t;const[s,o]=this.parentDimensions;this.setDims(s*i,o*n),this.fixAndSetPosition(),this._onResized()}_onResized(){}#O(){if(!this.#c)return;const{savedX:e,savedY:t,savedWidth:i,savedHeight:n}=this.#c;this.#c=null;const s=this.x,o=this.y,a=this.width,l=this.height;s===e&&o===t&&a===i&&l===n||this.addCommands({cmd:this.#F.bind(this,s,o,a,l),undo:this.#F.bind(this,e,t,i,n),mustExec:!0})}static _round(e){return Math.round(1e4*e)/1e4}#$(e,t){const[i,n]=this.parentDimensions,s=this.x,o=this.y,a=this.width,l=this.height,h=j.MIN_SIZE/i,d=j.MIN_SIZE/n,u=this.#M(this.rotation),p=(R,L)=>[u[0]*R+u[2]*L,u[1]*R+u[3]*L],f=this.#M(360-this.rotation);let m,_,b=!1,v=!1;switch(e){case"topLeft":b=!0,m=(R,L)=>[0,0],_=(R,L)=>[R,L];break;case"topMiddle":m=(R,L)=>[R/2,0],_=(R,L)=>[R/2,L];break;case"topRight":b=!0,m=(R,L)=>[R,0],_=(R,L)=>[0,L];break;case"middleRight":v=!0,m=(R,L)=>[R,L/2],_=(R,L)=>[0,L/2];break;case"bottomRight":b=!0,m=(R,L)=>[R,L],_=(R,L)=>[0,0];break;case"bottomMiddle":m=(R,L)=>[R/2,L],_=(R,L)=>[R/2,0];break;case"bottomLeft":b=!0,m=(R,L)=>[0,L],_=(R,L)=>[R,0];break;case"middleLeft":v=!0,m=(R,L)=>[0,L/2],_=(R,L)=>[R,L/2]}const y=m(a,l),x=_(a,l);let A=p(...x);const w=j._round(s+A[0]),C=j._round(o+A[1]);let O,k,P=1,S=1;if(t.fromKeyboard)({deltaX:O,deltaY:k}=t);else{const{screenX:R,screenY:L}=t,[lt,Ut]=this.#d;[O,k]=this.screenToPageTranslation(R-lt,L-Ut),this.#d[0]=R,this.#d[1]=L}if([O,k]=[f[0]*(R=O/i)+f[2]*(L=k/n),f[1]*R+f[3]*L],b){const R=Math.hypot(a,l);P=S=Math.max(Math.min(Math.hypot(x[0]-y[0]-O,x[1]-y[1]-k)/R,1/a,1/l),h/a,d/l)}else v?P=Et(Math.abs(x[0]-y[0]-O),h,1)/a:S=Et(Math.abs(x[1]-y[1]-k),d,1)/l;var R,L;const tt=j._round(a*P),st=j._round(l*S);A=p(..._(tt,st));const q=w-A[0],bt=C-A[1];this.#o||=[this.x,this.y,this.width,this.height],this.width=tt,this.height=st,this.x=q,this.y=bt,this.setDims(i*tt,n*st),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}addEditToolbar(){var e=this;return(0,E.A)(function*(){return e._editToolbar||e.#m||(e._editToolbar=new Ae(e),e.div.append(e._editToolbar.render()),e.#i&&(yield e._editToolbar.addAltText(e.#i))),e._editToolbar})()}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#i?.destroy())}addContainer(e){const t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}addAltTextButton(){var e=this;return(0,E.A)(function*(){e.#i||(zi.initialize(j._l10n),e.#i=new zi(e),e.#t&&(e.#i.data=e.#t,e.#t=null),yield e.addEditToolbar())})()}get altTextData(){return this.#i?.data}set altTextData(e){this.#i&&(this.#i.data=e)}get guessedAltText(){return this.#i?.guessedText}setGuessedAltText(e){var t=this;return(0,E.A)(function*(){yield t.#i?.setGuessedText(e)})()}serializeAltText(e){return this.#i?.serialize(e)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}render(){const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=this.#n?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),this.#H();const[t,i]=this.parentDimensions;this.parentRotation%180!=0&&(e.style.maxWidth=`${(100*i/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/i).toFixed(2)}%`);const[n,s]=this.getInitialTranslation();return this.translate(n,s),di(this,e,["keydown","pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#C||=new He({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#E.bind(this),onPinching:this.#A.bind(this),onPinchEnd:this.#N.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),e}#E(){this.#c={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#i?.toggle(!1),this.parent.togglePointerEvents(!1)}#A(e,t,i){let s=i/t*.7+1-.7;if(1===s)return;const o=this.#M(this.rotation),a=(w,C)=>[o[0]*w+o[2]*C,o[1]*w+o[3]*C],[l,h]=this.parentDimensions,d=this.x,u=this.y,p=this.width,f=this.height,g=j.MIN_SIZE/l,m=j.MIN_SIZE/h;s=Math.max(Math.min(s,1/p,1/f),g/p,m/f);const _=j._round(p*s),b=j._round(f*s);if(_===p&&b===f)return;this.#o||=[d,u,p,f];const v=a(p/2,f/2),y=j._round(d+v[0]),x=j._round(u+v[1]),A=a(_/2,b/2);this.x=y-A[0],this.y=x-A[1],this.width=_,this.height=b,this.setDims(l*_,h*b),this.fixAndSetPosition(),this._onResizing()}#N(){this.#i?.toggle(!0),this.parent.togglePointerEvents(!0),this.#O()}pointerdown(e){const{isMac:t}=At.platform;0!==e.button||e.ctrlKey&&t?e.preventDefault():(this.#p=!0,this._isDraggable?this.#V(e):this.#j(e))}get isSelected(){return this._uiManager.isSelected(this)}#j(e){const{isMac:t}=At.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#V(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let i=!1;const n=new AbortController,s=this._uiManager.combinedSignal(n),o={capture:!0,passive:!1,signal:s},a=h=>{n.abort(),this.#r=null,this.#p=!1,this._uiManager.endDragSession()||this.#j(h),i&&this._onStopDragging()};t&&(this.#b=e.clientX,this.#v=e.clientY,this.#r=e.pointerId,this.#s=e.pointerType,window.addEventListener("pointermove",h=>{i||(i=!0,this._onStartDragging());const{clientX:d,clientY:u,pointerId:p}=h;if(p!==this.#r)return void ft(h);const[f,g]=this.screenToPageTranslation(d-this.#b,u-this.#v);this.#b=d,this.#v=u,this._uiManager.dragSelectedEditors(f,g)},o),window.addEventListener("touchmove",ft,o),window.addEventListener("pointerdown",h=>{h.pointerType===this.#s&&(this.#C||h.isPrimary)&&a(h),ft(h)},o));const l=h=>{this.#r&&this.#r!==h.pointerId?ft(h):a(h)};window.addEventListener("pointerup",l,{signal:s}),window.addEventListener("blur",l,{signal:s})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#_&&clearTimeout(this.#_),this.#_=setTimeout(()=>{this.#_=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,i){e.changeParent(this),this.x=t,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,i=this.rotation){const n=this.parentScale,[s,o]=this.pageDimensions,[a,l]=this.pageTranslation,h=e/n,d=t/n,u=this.x*s,p=this.y*o,f=this.width*s,g=this.height*o;switch(i){case 0:return[u+h+a,o-p-d-g+l,u+h+f+a,o-p-d+l];case 90:return[u+d+a,o-p+h+l,u+d+g+a,o-p+h+f+l];case 180:return[u-h-f+a,o-p+d+l,u-h+a,o-p+d+g+l];case 270:return[u-d-g+a,o-p-h-f+l,u-d+a,o-p-h+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[i,n,s,o]=e,a=s-i,l=o-n;switch(this.rotation){case 0:return[i,t-o,a,l];case 90:return[i,t-n,l,a];case 180:return[s,t-n,a,l];case 270:return[s,t-o,l,a];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){this.#m=!0}disableEditMode(){this.#m=!1}isInEditMode(){return this.#m}shouldGetKeyboardEvents(){return this.#g}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:i,right:n}=this.getClientDimensions(),{innerHeight:s,innerWidth:o}=window;return t<o&&n>0&&e<s&&i>0}#H(){if(this.#u||!this.div)return;this.#u=new AbortController;const e=this._uiManager.combinedSignal(this.#u);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#H()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){nt("An editor must be serializable")}static deserialize(e,t,i){var n=this;return(0,E.A)(function*(){const s=new n.prototype.constructor({parent:t,id:t.getNextId(),uiManager:i});s.rotation=e.rotation,s.#t=e.accessibilityData,s._isCopy=e.isCopy||!1;const[o,a]=s.pageDimensions,[l,h,d,u]=s.getRectInCurrentCoords(e.rect,a);return s.x=l/o,s.y=h/a,s.width=d/o,s.height=u/a,s})()}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}remove(){if(this.#u?.abort(),this.#u=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#_&&(clearTimeout(this.#_),this.#_=null),this.#U(),this.removeEditToolbar(),this.#y){for(const e of this.#y.values())clearTimeout(e);this.#y=null}this.parent=null,this.#C?.destroy(),this.#C=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#P(),this.#a.classList.remove("hidden"))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||"Enter"!==e.key)return;this._uiManager.setSelected(this),this.#c={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#a.children;if(!this.#e){this.#e=Array.from(t);const o=this.#z.bind(this),a=this.#G.bind(this),l=this._uiManager._signal;for(const h of this.#e){const d=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",o,{signal:l}),h.addEventListener("blur",a,{signal:l}),h.addEventListener("focus",this.#R.bind(this,d),{signal:l}),h.setAttribute("data-l10n-id",j._l10nResizer[d])}}const i=this.#e[0];let n=0;for(const o of t){if(o===i)break;n++}const s=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(s!==n){if(s<n)for(let a=0;a<n-s;a++)this.#a.append(this.#a.firstChild);else if(s>n)for(let a=0;a<s-n;a++)this.#a.firstChild.before(this.#a.lastChild);let o=0;for(const a of t){const h=this.#e[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",j._l10nResizer[h])}}this.#D(0),this.#g=!0,this.#a.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#z(e){j._resizerKeyboardManager.exec(this,e)}#G(e){this.#g&&e.relatedTarget?.parentNode!==this.#a&&this.#U()}#R(e){this.#h=this.#g?e:""}#D(e){if(this.#e)for(const t of this.#e)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#g&&this.#$(this.#h,{deltaX:e,deltaY:t,fromKeyboard:!0})}#U(){this.#g=!1,this.#D(-1),this.#O()}_stopResizingWithKeyboard(){this.#U(),this.div.focus()}select(){this.makeResizable(),this.div?.classList.add("selectedEditor"),this._editToolbar?(this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)):this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()})}unselect(){this.#a?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#f}set isEditing(e){this.#f=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){this.#l=!0;const i=e/t,{style:n}=this.div;n.aspectRatio=i,n.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#y||=new Map;const{action:i}=e;let n=this.#y.get(i);return n&&clearTimeout(n),n=setTimeout(()=>{this._reportTelemetry(e),this.#y.delete(i),0===this.#y.size&&(this.#y=null)},j._telemetryTimeout),void this.#y.set(i,n)}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#n=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#n=!0}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(t){if("CANVAS"===t.nodeName){const i=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),i.before(t)}}else t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);return t}resetAnnotationElement(e){const{firstChild:t}=e.container;"DIV"===t?.nodeName&&t.classList.contains("annotationContent")&&t.remove()}}class hs extends j{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Xi=3285377520,It=4294901760,Nt=65535;class Wi{constructor(e){this.h1=e?4294967295&e:Xi,this.h2=e?4294967295&e:Xi}update(e){let t,i;if("string"==typeof e){t=new Uint8Array(2*e.length),i=0;for(let m=0,_=e.length;m<_;m++){const b=e.charCodeAt(m);b<=255?t[i++]=b:(t[i++]=b>>>8,t[i++]=255&b)}}else{if(!ArrayBuffer.isView(e))throw new Error("Invalid data format, must be a string or TypedArray.");t=e.slice(),i=t.byteLength}const n=i>>2,s=i-4*n,o=new Uint32Array(t.buffer,0,n);let a=0,l=0,h=this.h1,d=this.h2;const u=3432918353,p=461845907,f=u&Nt,g=p&Nt;for(let m=0;m<n;m++)1&m?(a=o[m],a=a*u&It|a*f&Nt,a=a<<15|a>>>17,a=a*p&It|a*g&Nt,h^=a,h=h<<13|h>>>19,h=5*h+3864292196):(l=o[m],l=l*u&It|l*f&Nt,l=l<<15|l>>>17,l=l*p&It|l*g&Nt,d^=l,d=d<<13|d>>>19,d=5*d+3864292196);switch(a=0,s){case 3:a^=t[4*n+2]<<16;case 2:a^=t[4*n+1]<<8;case 1:a^=t[4*n],a=a*u&It|a*f&Nt,a=a<<15|a>>>17,a=a*p&It|a*g&Nt,1&n?h^=a:d^=a}this.h1=h,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=3981806797*e&It|36045*e&Nt,t=4283543511*t&It|(2950163797*(t<<16|e>>>16)&It)>>>16,e^=t>>>1,e=444984403*e&It|60499*e&Nt,t=3301882366*t&It|(3120437893*(t<<16|e>>>16)&It)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const fi=Object.freeze({map:null,hash:"",transfer:void 0});class gi{#t=!1;#e=null;#i=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const i=this.#i.get(e);return void 0===i?t:Object.assign(t,i)}getRawValue(e){return this.#i.get(e)}remove(e){if(this.#i.delete(e),0===this.#i.size&&this.resetModified(),"function"==typeof this.onAnnotationEditor){for(const t of this.#i.values())if(t instanceof j)return;this.onAnnotationEditor(null)}}setValue(e,t){const i=this.#i.get(e);let n=!1;if(void 0!==i)for(const[s,o]of Object.entries(t))i[s]!==o&&(n=!0,i[s]=o);else n=!0,this.#i.set(e,t);n&&this.#n(),t instanceof j&&"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(t.constructor._type)}has(e){return this.#i.has(e)}get size(){return this.#i.size}#n(){this.#t||(this.#t=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,"function"==typeof this.onResetModified&&this.onResetModified())}get print(){return new Yi(this)}get serializable(){if(0===this.#i.size)return fi;const e=new Map,t=new Wi,i=[],n=Object.create(null);let s=!1;for(const[o,a]of this.#i){const l=a instanceof j?a.serialize(!1,n):a;l&&(e.set(o,l),t.update(`${o}:${JSON.stringify(l)}`),s||=!!l.bitmap)}if(s)for(const o of e.values())o.bitmap&&i.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:i}:fi}get editorStats(){let e=null;const t=new Map;for(const i of this.#i.values()){if(!(i instanceof j))continue;const n=i.telemetryFinalData;if(!n)continue;const{type:s}=n;t.has(s)||t.set(s,Object.getPrototypeOf(i).constructor),e||=Object.create(null);const o=e[s]||=new Map;for(const[a,l]of Object.entries(n)){if("type"===a)continue;let h=o.get(a);h||(h=new Map,o.set(a,h));const d=h.get(l)??0;h.set(l,d+1)}}for(const[i,n]of t)e[i]=n.computeTelemetryFinalData(e[i]);return e}resetModifiedIds(){this.#e=null}get modifiedIds(){if(this.#e)return this.#e;const e=[];for(const t of this.#i.values())!(t instanceof j)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return this.#e={ids:new Set(e),hash:e.join(",")}}[Symbol.iterator](){return this.#i.entries()}}class Yi extends gi{#t;constructor(e){super();const{map:t,hash:i,transfer:n}=e.serializable,s=structuredClone(t,n?{transfer:n}:null);this.#t={map:s,hash:i,transfer:n}}get print(){nt("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return W(this,"modifiedIds",{ids:new Set,hash:""})}}class ds{#t=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}loadSystemFont(e){var t=this;return(0,E.A)(function*({systemFontInfo:i,disableFontFace:n,_inspectFont:s}){if(i&&!t.#t.has(i.loadedName)){if(pt(!n,"loadSystemFont shouldn't be called when `disableFontFace` is set."),t.isFontLoadingAPISupported){const{loadedName:o,src:a,style:l}=i,h=new FontFace(o,a,l);t.addNativeFontFace(h);try{yield h.load(),t.#t.add(o),s?.(i)}catch{U(`Cannot load system font: ${i.baseFontName}, installing it could help to improve PDF rendering.`),t.removeNativeFontFace(h)}return}nt("Not implemented: loadSystemFont without the Font Loading API.")}}).apply(this,arguments)}bind(e){var t=this;return(0,E.A)(function*(){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo)return void(yield t.loadSystemFont(e));if(t.isFontLoadingAPISupported){const n=e.createNativeFontFace();if(n){t.addNativeFontFace(n);try{yield n.loaded}catch(s){throw U(`Failed to load font '${n.family}': '${s}'.`),e.disableFontFace=!0,s}}return}const i=e.createFontFaceRule();if(i){if(t.insertRule(i),t.isSyncFontLoadingSupported)return;yield new Promise(n=>{const s=t._queueLoadingCallback(n);t._prepareFontLoadEvent(e,s)})}})()}get isFontLoadingAPISupported(){return W(this,"isFontLoadingAPISupported",!!this._document?.fonts)}get isSyncFontLoadingSupported(){return W(this,"isSyncFontLoadingSupported",J||At.platform.isFirefox)}_queueLoadingCallback(e){const{loadingRequests:i}=this,n={done:!1,complete:function t(){for(pt(!n.done,"completeRequest() cannot be called twice."),n.done=!0;i.length>0&&i[0].done;){const s=i.shift();setTimeout(s.callback,0)}},callback:e};return i.push(n),n}get _loadTestFont(){return W(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(e,t){function i(x,A){return x.charCodeAt(A)<<24|x.charCodeAt(A+1)<<16|x.charCodeAt(A+2)<<8|255&x.charCodeAt(A+3)}function n(x,A,w,C){return x.substring(0,A)+C+x.substring(A+w)}let s,o;const a=this._document.createElement("canvas");a.width=1,a.height=1;const l=a.getContext("2d");let h=0;const u=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=n(p,976,u.length,u);const m=1482184792;let _=i(p,16);for(s=0,o=u.length-3;s<o;s+=4)_=_-m+i(u,s)|0;s<u.length&&(_=_-m+i(u+"XXX",s)|0),p=n(p,16,4,function qn(c){return String.fromCharCode(c>>24&255,c>>16&255,c>>8&255,255&c)}(_));const b=`url(data:font/opentype;base64,${btoa(p)});`;this.insertRule(`@font-face {font-family:"${u}";src:${b}}`);const y=this._document.createElement("div");y.style.visibility="hidden",y.style.width=y.style.height="10px",y.style.position="absolute",y.style.top=y.style.left="0px";for(const x of[e.loadedName,u]){const A=this._document.createElement("span");A.textContent="Hi",A.style.fontFamily=x,y.append(A)}this._document.body.append(y),function d(x,A){if(++h>30)return U("Load test font never loaded."),void A();l.font="30px "+x,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0?A():setTimeout(d.bind(null,x,A))}(u,()=>{y.remove(),t.complete()})}}class us{constructor(e,t=null){this.compiledGlyphs=Object.create(null);for(const i in e)this[i]=e[i];this._inspectFont=t}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(this.cssFontInfo){const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}else e=new FontFace(this.loadedName,this.data,{});return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${Ui(this.data)});`;let t;if(this.cssFontInfo){let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}else t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(void 0!==this.compiledGlyphs[t])return this.compiledGlyphs[t];const i=this.loadedName+"_path_"+t;let n;try{n=e.get(i)}catch(o){U(`getPathGenerator - ignoring character: "${o}".`)}const s=new Path2D(n||"");return this.fontExtraProperties||e.delete(i),this.compiledGlyphs[t]=s}}function qi(){}function St(c){if(c instanceof Xt||c instanceof ni||c instanceof ji||c instanceof Ge||c instanceof ii)return c;switch(c instanceof Error||"object"==typeof c&&null!==c||nt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),c.name){case"AbortException":return new Xt(c.message);case"InvalidPDFException":return new ni(c.message);case"PasswordException":return new ji(c.message,c.code);case"ResponseException":return new Ge(c.message,c.status,c.missing);case"UnknownErrorException":return new ii(c.message,c.details)}return new ii(c.message,c.toString())}class Ce{#t=new AbortController;constructor(e,t,i){this.sourceName=e,this.targetName=t,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream)return void this.#n(e);if(e.callback){const i=e.callbackId,n=this.callbackCapabilities[i];if(!n)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],1===e.callback)n.resolve(e.data);else{if(2!==e.callback)throw new Error("Unexpected callback case");n.reject(St(e.reason))}return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const i=this.sourceName,n=e.sourceName,s=this.comObj;Promise.try(t,e.data).then(function(o){s.postMessage({sourceName:i,targetName:n,callback:1,callbackId:e.callbackId,data:o})},function(o){s.postMessage({sourceName:i,targetName:n,callback:2,callbackId:e.callbackId,reason:St(o)})})}else e.streamId?this.#i(e):t(e.data)}on(e,t){const i=this.actionHandler;if(i[e])throw new Error(`There is already an actionName called "${e}"`);i[e]=t}send(e,t,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},i)}sendWithPromise(e,t,i){const n=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[n]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:n,data:t},i)}catch(o){s.reject(o)}return s.promise}sendWithStream(e,t,i,n){const s=this.streamId++,o=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:h=>{const d=Promise.withResolvers();return this.streamControllers[s]={controller:h,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:o,targetName:a,action:e,streamId:s,data:t,desiredSize:h.desiredSize},n),d.promise},pull:h=>{const d=Promise.withResolvers();return this.streamControllers[s].pullCall=d,l.postMessage({sourceName:o,targetName:a,stream:6,streamId:s,desiredSize:h.desiredSize}),d.promise},cancel:h=>{pt(h instanceof Error,"cancel must have a valid reason");const d=Promise.withResolvers();return this.streamControllers[s].cancelCall=d,this.streamControllers[s].isClosed=!0,l.postMessage({sourceName:o,targetName:a,stream:1,streamId:s,reason:St(h)}),d.promise}},i)}#i(e){const t=e.streamId,i=this.sourceName,n=e.sourceName,s=this.comObj,o=this,a=this.actionHandler[e.action],l={enqueue(h,d=1,u){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=d,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:i,targetName:n,stream:4,streamId:t,chunk:h},u)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:i,targetName:n,stream:3,streamId:t}),delete o.streamSinks[t])},error(h){pt(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,s.postMessage({sourceName:i,targetName:n,stream:5,streamId:t,reason:St(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){s.postMessage({sourceName:i,targetName:n,stream:8,streamId:t,success:!0})},function(h){s.postMessage({sourceName:i,targetName:n,stream:8,streamId:t,reason:St(h)})})}#n(e){const t=e.streamId,i=this.sourceName,n=e.sourceName,s=this.comObj,o=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case 8:e.success?o.startCall.resolve():o.startCall.reject(St(e.reason));break;case 7:e.success?o.pullCall.resolve():o.pullCall.reject(St(e.reason));break;case 6:if(!a){s.postMessage({sourceName:i,targetName:n,stream:7,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||qi).then(function(){s.postMessage({sourceName:i,targetName:n,stream:7,streamId:t,success:!0})},function(h){s.postMessage({sourceName:i,targetName:n,stream:7,streamId:t,reason:St(h)})});break;case 4:if(pt(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case 3:if(pt(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),this.#r(o,t);break;case 5:pt(o,"error should have stream controller"),o.controller.error(St(e.reason)),this.#r(o,t);break;case 2:e.success?o.cancelCall.resolve():o.cancelCall.reject(St(e.reason)),this.#r(o,t);break;case 1:if(!a)break;const l=St(e.reason);Promise.try(a.onCancel||qi,l).then(function(){s.postMessage({sourceName:i,targetName:n,stream:2,streamId:t,success:!0})},function(h){s.postMessage({sourceName:i,targetName:n,stream:2,streamId:t,reason:St(h)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}#r(e,t){var i=this;return(0,E.A)(function*(){yield Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete i.streamControllers[t]})()}destroy(){this.#t?.abort(),this.#t=null}}class Ki{#t=!1;constructor({enableHWA:e=!1}){this.#t=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(e,t);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!this.#t})}}reset(e,t,i){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||i<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=i}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){nt("Abstract method `_createCanvas` called.")}}class ps extends Ki{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const i=this._document.createElement("canvas");return i.width=e,i.height=t,i}}class Ji{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}fetch(e){var t=this;return(0,E.A)(function*({name:i}){if(!t.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!i)throw new Error("CMap name must be specified.");const n=t.baseUrl+i+(t.isCompressed?".bcmap":"");return t._fetch(n).then(s=>({cMapData:s,isCompressed:t.isCompressed})).catch(s=>{throw new Error(`Unable to load ${t.isCompressed?"binary ":""}CMap at: ${n}`)})}).apply(this,arguments)}_fetch(e){return(0,E.A)(function*(){nt("Abstract method `_fetch` called.")})()}}class Qi extends Ji{_fetch(e){var t=this;return(0,E.A)(function*(){const i=yield be(e,t.isCompressed?"arraybuffer":"text");return i instanceof ArrayBuffer?new Uint8Array(i):ae(i)})()}}class Zi{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,i,n,s){return"none"}destroy(e=!1){}}class fs extends Zi{#t;#e;#i;#n;#r;#s;#l=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#n=e,this.#r=t}get#a(){return this.#e||=new Map}get#d(){return this.#s||=new Map}get#c(){if(!this.#i){const e=this.#r.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const i=this.#r.createElementNS($t,"svg");i.setAttribute("width",0),i.setAttribute("height",0),this.#i=this.#r.createElementNS($t,"defs"),e.append(i),i.append(this.#i),this.#r.body.append(e)}return this.#i}#u(e){if(1===e.length){const l=e[0],h=new Array(256);for(let u=0;u<256;u++)h[u]=l[u]/255;const d=h.join(",");return[d,d,d]}const[t,i,n]=e,s=new Array(256),o=new Array(256),a=new Array(256);for(let l=0;l<256;l++)s[l]=t[l]/255,o[l]=i[l]/255,a[l]=n[l]/255;return[s.join(","),o.join(","),a.join(",")]}#h(e){if(void 0===this.#t){this.#t="";const t=this.#r.URL;t!==this.#r.baseURI&&(Ve(t)?U('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=Ni(t,""))}return`url(${this.#t}#${e})`}addFilter(e){if(!e)return"none";let t=this.#a.get(e);if(t)return t;const[i,n,s]=this.#u(e),o=1===e.length?i:`${i}${n}${s}`;if(t=this.#a.get(o),t)return this.#a.set(e,t),t;const a=`g_${this.#n}_transfer_map_${this.#l++}`,l=this.#h(a);this.#a.set(e,l),this.#a.set(o,l);const h=this.#f(a);return this.#g(i,n,s,h),l}addHCMFilter(e,t){const i=`${e}-${t}`,n="base";let s=this.#d.get(n);if(s?.key===i||(s?(s.filter?.remove(),s.key=i,s.url="none",s.filter=null):(s={key:i,url:"none",filter:null},this.#d.set(n,s)),!e||!t))return s.url;const o=this.#b(e);e=D.makeHexColor(...o);const a=this.#b(t);if(t=D.makeHexColor(...a),this.#c.style.color="","#000000"===e&&"#ffffff"===t||e===t)return s.url;const l=new Array(256);for(let f=0;f<=255;f++){const g=f/255;l[f]=g<=.03928?g/12.92:((g+.055)/1.055)**2.4}const h=l.join(","),d=`g_${this.#n}_hcm_filter`,u=s.filter=this.#f(d);this.#g(h,h,h,u),this.#o(u);const p=(f,g)=>{const m=o[f]/255,_=a[f]/255,b=new Array(g+1);for(let v=0;v<=g;v++)b[v]=m+v/g*(_-m);return b.join(",")};return this.#g(p(0,5),p(1,5),p(2,5),u),s.url=this.#h(d),s.url}addAlphaFilter(e){let t=this.#a.get(e);if(t)return t;const[i]=this.#u([e]),n=`alpha_${i}`;if(t=this.#a.get(n),t)return this.#a.set(e,t),t;const s=`g_${this.#n}_alpha_map_${this.#l++}`,o=this.#h(s);this.#a.set(e,o),this.#a.set(n,o);const a=this.#f(s);return this.#_(i,a),o}addLuminosityFilter(e){let i,n,t=this.#a.get(e||"luminosity");if(t)return t;if(e?([i]=this.#u([e]),n=`luminosity_${i}`):n="luminosity",t=this.#a.get(n),t)return this.#a.set(e,t),t;const s=`g_${this.#n}_luminosity_map_${this.#l++}`,o=this.#h(s);this.#a.set(e,o),this.#a.set(n,o);const a=this.#f(s);return this.#p(a),e&&this.#_(i,a),o}addHighlightHCMFilter(e,t,i,n,s){const o=`${t}-${i}-${n}-${s}`;let a=this.#d.get(e);if(a?.key===o||(a?(a.filter?.remove(),a.key=o,a.url="none",a.filter=null):(a={key:o,url:"none",filter:null},this.#d.set(e,a)),!t||!i))return a.url;const[l,h]=[t,i].map(this.#b.bind(this));let d=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),u=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[p,f]=[n,s].map(this.#b.bind(this));u<d&&([d,u,p,f]=[u,d,f,p]),this.#c.style.color="";const g=(b,v,y)=>{const x=new Array(256),A=(u-d)/y,w=b/255,C=(v-b)/(255*y);let P=0;for(let S=0;S<=y;S++){const O=Math.round(d+S*A),k=w+S*C;for(let tt=P;tt<=O;tt++)x[tt]=k;P=O+1}for(let S=P;S<256;S++)x[S]=x[P-1];return x.join(",")},m=`g_${this.#n}_hcm_${e}_filter`,_=a.filter=this.#f(m);return this.#o(_),this.#g(g(p[0],f[0],5),g(p[1],f[1],5),g(p[2],f[2],5),_),a.url=this.#h(m),a.url}destroy(e=!1){e&&this.#s?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#e?.clear(),this.#e=null,this.#s?.clear(),this.#s=null,this.#l=0)}#p(e){const t=this.#r.createElementNS($t,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#o(e){const t=this.#r.createElementNS($t,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#f(e){const t=this.#r.createElementNS($t,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#c.append(t),t}#m(e,t,i){const n=this.#r.createElementNS($t,t);n.setAttribute("type","discrete"),n.setAttribute("tableValues",i),e.append(n)}#g(e,t,i,n){const s=this.#r.createElementNS($t,"feComponentTransfer");n.append(s),this.#m(s,"feFuncR",e),this.#m(s,"feFuncG",t),this.#m(s,"feFuncB",i)}#_(e,t){const i=this.#r.createElementNS($t,"feComponentTransfer");t.append(i),this.#m(i,"feFuncA",e)}#b(e){return this.#c.style.color=e,ci(getComputedStyle(this.#c).getPropertyValue("color"))}}class tn{constructor({baseUrl:e=null}){this.baseUrl=e}fetch(e){var t=this;return(0,E.A)(function*({filename:i}){if(!t.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!i)throw new Error("Font filename must be specified.");const n=`${t.baseUrl}${i}`;return t._fetch(n).catch(s=>{throw new Error(`Unable to load font data at: ${n}`)})}).apply(this,arguments)}_fetch(e){return(0,E.A)(function*(){nt("Abstract method `_fetch` called.")})()}}class en extends tn{_fetch(e){return(0,E.A)(function*(){const t=yield be(e,"arraybuffer");return new Uint8Array(t)})()}}class nn{constructor({baseUrl:e=null}){this.baseUrl=e}fetch(e){var t=this;return(0,E.A)(function*({filename:i}){if(!t.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!i)throw new Error("Wasm filename must be specified.");const n=`${t.baseUrl}${i}`;return t._fetch(n).catch(s=>{throw new Error(`Unable to load wasm data at: ${n}`)})}).apply(this,arguments)}_fetch(e){return(0,E.A)(function*(){nt("Abstract method `_fetch` called.")})()}}class sn extends nn{_fetch(e){return(0,E.A)(function*(){const t=yield be(e,"arraybuffer");return new Uint8Array(t)})()}}function mi(c){return _i.apply(this,arguments)}function _i(){return(_i=(0,E.A)(function*(c){const t=yield process.getBuiltinModule("fs").promises.readFile(c);return new Uint8Array(t)})).apply(this,arguments)}J&&U("Please use the `legacy` build in Node.js environments.");class gs extends Zi{}class ms extends Ki{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire("file:///Users/mac/Desktop/Tiak3da/XpertCashFront/node_modules/pdfjs-dist/build/pdf.mjs")("@napi-rs/canvas").createCanvas(e,t)}}class _s extends Ji{_fetch(e){return(0,E.A)(function*(){return mi(e)})()}}class bs extends tn{_fetch(e){return(0,E.A)(function*(){return mi(e)})()}}class vs extends nn{_fetch(e){return(0,E.A)(function*(){return mi(e)})()}}function bi(c,e){if(!e)return;const t=e[2]-e[0],i=e[3]-e[1],n=new Path2D;n.rect(e[0],e[1],t,i),c.clip(n)}class vi{isModifyingCurrentTransform(){return!1}getPattern(){nt("Abstract method `getPattern` called.")}}class As extends vi{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;"axial"===this._type?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)t.addColorStop(i[0],i[1]);return t}getPattern(e,t,i,n){let s;if("Stroke"===n||"Fill"===n){const o=t.current.getClippedPathBoundingBox(n,at(e))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,l=Math.ceil(o[3]-o[1])||1,h=t.cachedCanvases.getCanvas("pattern",a,l),d=h.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-o[0],-o[1]),i=D.transform(i,[1,0,0,1,o[0],o[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),bi(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),s=e.createPattern(h.canvas,"no-repeat");const u=new DOMMatrix(i);s.setTransform(u)}else bi(e,this._bbox),s=this._createGradient(e);return s}}function Ai(c,e,t,i,n,s,o,a){const l=e.coords,h=e.colors,d=c.data,u=4*c.width;let p;l[t+1]>l[i+1]&&(p=t,t=i,i=p,p=s,s=o,o=p),l[i+1]>l[n+1]&&(p=i,i=n,n=p,p=o,o=a,a=p),l[t+1]>l[i+1]&&(p=t,t=i,i=p,p=s,s=o,o=p);const f=(l[t]+e.offsetX)*e.scaleX,g=(l[t+1]+e.offsetY)*e.scaleY,m=(l[i]+e.offsetX)*e.scaleX,_=(l[i+1]+e.offsetY)*e.scaleY,b=(l[n]+e.offsetX)*e.scaleX,v=(l[n+1]+e.offsetY)*e.scaleY;if(g>=v)return;const y=h[s],x=h[s+1],A=h[s+2],w=h[o],C=h[o+1],P=h[o+2],S=h[a],O=h[a+1],k=h[a+2],tt=Math.round(g),st=Math.round(v);let q,bt,R,L,lt,Ut,Bt,Vt;for(let mt=tt;mt<=st;mt++){if(mt<_){const ct=mt<g?0:(g-mt)/(g-_);q=f-(f-m)*ct,bt=y-(y-w)*ct,R=x-(x-C)*ct,L=A-(A-P)*ct}else{let ct;ct=mt>v?1:_===v?0:(_-mt)/(_-v),q=m-(m-b)*ct,bt=w-(w-S)*ct,R=C-(C-O)*ct,L=P-(P-k)*ct}let ot;ot=mt<g?0:mt>v?1:(g-mt)/(g-v),lt=f-(f-b)*ot,Ut=y-(y-S)*ot,Bt=x-(x-O)*ot,Vt=A-(A-k)*ot;const Dt=Math.round(Math.min(q,lt)),Ot=Math.round(Math.max(q,lt));let kt=u*mt+4*Dt;for(let ct=Dt;ct<=Ot;ct++)ot=(q-ct)/(q-lt),ot<0?ot=0:ot>1&&(ot=1),d[kt++]=bt-(bt-Ut)*ot|0,d[kt++]=R-(R-Bt)*ot|0,d[kt++]=L-(L-Vt)*ot|0,d[kt++]=255}}function ys(c,e,t){const i=e.coords,n=e.colors;let s,o;switch(e.type){case"lattice":const a=e.verticesPerRow,l=Math.floor(i.length/a)-1,h=a-1;for(s=0;s<l;s++){let d=s*a;for(let u=0;u<h;u++,d++)Ai(c,t,i[d],i[d+1],i[d+a],n[d],n[d+1],n[d+a]),Ai(c,t,i[d+a+1],i[d+1],i[d+a],n[d+a+1],n[d+1],n[d+a])}break;case"triangles":for(s=0,o=i.length;s<o;s+=3)Ai(c,t,i[s],i[s+1],i[s+2],n[s],n[s+1],n[s+2]);break;default:throw new Error("illegal figure")}}class xs extends vi{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,i){const a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-a,d=Math.ceil(this._bounds[3])-l,u=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),f=h/u,g=d/p,m={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/f,scaleY:1/g},v=i.getCanvas("mesh",u+4,p+4),y=v.context,x=y.createImageData(u,p);if(t){const w=x.data;for(let C=0,P=w.length;C<P;C+=4)w[C]=t[0],w[C+1]=t[1],w[C+2]=t[2],w[C+3]=255}for(const w of this._figures)ys(x,w,m);return y.putImageData(x,2,2),{canvas:v.canvas,offsetX:a-2*f,offsetY:l-2*g,scaleX:f,scaleY:g}}isModifyingCurrentTransform(){return!0}getPattern(e,t,i,n){bi(e,this._bbox);const s=new Float32Array(2);if("Shading"===n)D.singularValueDecompose2dScale(at(e),s);else if(this.matrix){D.singularValueDecompose2dScale(this.matrix,s);const[a,l]=s;D.singularValueDecompose2dScale(t.baseTransform,s),s[0]*=a,s[1]*=l}else D.singularValueDecompose2dScale(t.baseTransform,s);const o=this._createMeshCanvas(s,"Shading"===n?null:this._background,t.cachedCanvases);return"Shading"!==n&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class Cs extends vi{getPattern(){return"hotpink"}}let ws=(()=>{class c{static MAX_PATTERN_SIZE=3e3;constructor(t,i,n,s){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=i,this.canvasGraphicsFactory=n,this.baseTransform=s}createPatternCanvas(t){const{bbox:i,operatorList:n,paintType:s,tilingType:o,color:a,canvasGraphicsFactory:l}=this;let{xstep:h,ystep:d}=this;h=Math.abs(h),d=Math.abs(d),$e("TilingType: "+o);const u=i[0],p=i[1],f=i[2],g=i[3],m=f-u,_=g-p,b=new Float32Array(2);D.singularValueDecompose2dScale(this.matrix,b);const[v,y]=b;D.singularValueDecompose2dScale(this.baseTransform,b);const x=v*b[0],A=y*b[1];let w=m,C=_,P=!1,S=!1;const O=Math.ceil(h*x),k=Math.ceil(d*A);O>=Math.ceil(m*x)?w=h:P=!0,k>=Math.ceil(_*A)?C=d:S=!0;const q=this.getSizeAndScale(w,this.ctx.canvas.width,x),bt=this.getSizeAndScale(C,this.ctx.canvas.height,A),R=t.cachedCanvases.getCanvas("pattern",q.size,bt.size),L=R.context,lt=l.createCanvasGraphics(L);if(lt.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(lt,s,a),L.translate(-q.scale*u,-bt.scale*p),lt.transform(q.scale,0,0,bt.scale,0,0),L.save(),this.clipBbox(lt,u,p,f,g),lt.baseTransform=at(lt.ctx),lt.executeOperatorList(n),lt.endDrawing(),L.restore(),P||S){const Ut=R.canvas;P&&(w=h),S&&(C=d);const Bt=this.getSizeAndScale(w,this.ctx.canvas.width,x),Vt=this.getSizeAndScale(C,this.ctx.canvas.height,A),mt=Bt.size,ot=Vt.size,Dt=t.cachedCanvases.getCanvas("pattern-workaround",mt,ot),Ot=Dt.context,kt=P?Math.floor(m/h):0,ct=S?Math.floor(_/d):0;for(let Yt=0;Yt<=kt;Yt++)for(let qt=0;qt<=ct;qt++)Ot.drawImage(Ut,mt*Yt,ot*qt,mt,ot,0,0,mt,ot);return{canvas:Dt.canvas,scaleX:Bt.scale,scaleY:Vt.scale,offsetX:u,offsetY:p}}return{canvas:R.canvas,scaleX:q.scale,scaleY:bt.scale,offsetX:u,offsetY:p}}getSizeAndScale(t,i,n){const s=Math.max(c.MAX_PATTERN_SIZE,i);let o=Math.ceil(t*n);return o>=s?o=s:n=o/t,{scale:n,size:o}}clipBbox(t,i,n,s,o){t.ctx.rect(i,n,s-i,o-n),D.axialAlignedBoundingBox([i,n,s,o],at(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,i,n){const s=t.ctx,o=t.current;switch(i){case 1:const a=this.ctx;s.fillStyle=a.fillStyle,s.strokeStyle=a.strokeStyle,o.fillColor=a.fillStyle,o.strokeColor=a.strokeStyle;break;case 2:const l=D.makeHexColor(n[0],n[1],n[2]);s.fillStyle=l,s.strokeStyle=l,o.fillColor=l,o.strokeColor=l;break;default:throw new Yn(`Unsupported paint type: ${i}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,i,n,s){let o=n;"Shading"!==s&&(o=D.transform(o,i.baseTransform),this.matrix&&(o=D.transform(o,this.matrix)));const a=this.createPatternCanvas(i);let l=new DOMMatrix(o);l=l.translate(a.offsetX,a.offsetY),l=l.scale(1/a.scaleX,1/a.scaleY);const h=t.createPattern(a.canvas,"repeat");return h.setTransform(l),h}}return c})();function on({src:c,srcPos:e=0,dest:t,width:i,height:n,nonBlackColor:s=4294967295,inverseDecode:o=!1}){const a=At.isLittleEndian?4278190080:255,[l,h]=o?[s,a]:[a,s],d=i>>3,u=7&i,p=c.length;t=new Uint32Array(t.buffer);let f=0;for(let g=0;g<n;g++){for(const _=e+d;e<_;e++){const b=e<p?c[e]:255;t[f++]=128&b?h:l,t[f++]=64&b?h:l,t[f++]=32&b?h:l,t[f++]=16&b?h:l,t[f++]=8&b?h:l,t[f++]=4&b?h:l,t[f++]=2&b?h:l,t[f++]=1&b?h:l}if(0===u)continue;const m=e<p?c[e++]:255;for(let _=0;_<u;_++)t[f++]=m&1<<7-_?h:l}return{srcPos:e,destPos:f}}const yi=new DOMMatrix,Tt=new Float32Array(2),he=new Float32Array([1/0,1/0,-1/0,-1/0]);class Ts{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,i){let n;return void 0!==this.cache[e]?(n=this.cache[e],this.canvasFactory.reset(n,t,i)):(n=this.canvasFactory.create(t,i),this.cache[e]=n),n}delete(e){delete this.cache[e]}clear(){for(const e in this.cache)this.canvasFactory.destroy(this.cache[e]),delete this.cache[e]}}function Xe(c,e,t,i,n,s,o,a,l,h){const[d,u,p,f,g,m]=at(c);if(0===u&&0===p){const y=Math.round(o*d+g),A=Math.round(a*f+m),C=Math.abs(Math.round((o+l)*d+g)-y)||1,S=Math.abs(Math.round((a+h)*f+m)-A)||1;return c.setTransform(Math.sign(d),0,0,Math.sign(f),y,A),c.drawImage(e,t,i,n,s,0,0,C,S),c.setTransform(d,u,p,f,g,m),[C,S]}if(0===d&&0===f){const y=Math.round(a*p+g),A=Math.round(o*u+m),C=Math.abs(Math.round((a+h)*p+g)-y)||1,S=Math.abs(Math.round((o+l)*u+m)-A)||1;return c.setTransform(0,Math.sign(u),Math.sign(p),0,y,A),c.drawImage(e,t,i,n,s,0,0,S,C),c.setTransform(d,u,p,f,g,m),[S,C]}return c.drawImage(e,t,i,n,s,o,a,l,h),[Math.hypot(d,u)*l,Math.hypot(p,f)*h]}class hn{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=V;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=0;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(e,t){this.clipBox=new Float32Array([0,0,e,t]),this.minMax=he.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e="Fill",t=null){const i=this.minMax.slice();if("Stroke"===e){t||nt("Stroke bounding box must include transform."),D.singularValueDecompose2dScale(t,Tt);const n=Tt[0]*this.lineWidth/2,s=Tt[1]*this.lineWidth/2;i[0]-=n,i[1]-=s,i[2]+=n,i[3]+=s}return i}updateClipFromPath(){const e=D.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(he,0)}getClippedPathBoundingBox(e="Fill",t=null){return D.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function dn(c,e){if(e instanceof ImageData)return void c.putImageData(e,0,0);const t=e.height,i=e.width,n=t%16,s=(t-n)/16,o=0===n?s:s+1,a=c.createImageData(i,16);let h,l=0;const d=e.data,u=a.data;let p,f,g,m;if(e.kind===De.GRAYSCALE_1BPP){const _=d.byteLength,b=new Uint32Array(u.buffer,0,u.byteLength>>2),v=b.length,y=i+7>>3,x=4294967295,A=At.isLittleEndian?4278190080:255;for(p=0;p<o;p++){for(g=p<s?16:n,h=0,f=0;f<g;f++){const w=_-l;let C=0;const P=w>y?i:8*w-7,S=-8&P;let O=0,k=0;for(;C<S;C+=8)k=d[l++],b[h++]=128&k?x:A,b[h++]=64&k?x:A,b[h++]=32&k?x:A,b[h++]=16&k?x:A,b[h++]=8&k?x:A,b[h++]=4&k?x:A,b[h++]=2&k?x:A,b[h++]=1&k?x:A;for(;C<P;C++)0===O&&(k=d[l++],O=128),b[h++]=k&O?x:A,O>>=1}for(;h<v;)b[h++]=0;c.putImageData(a,0,16*p)}}else if(e.kind===De.RGBA_32BPP){for(f=0,m=16*i*4,p=0;p<s;p++)u.set(d.subarray(l,l+m)),l+=m,c.putImageData(a,0,f),f+=16;p<o&&(m=i*n*4,u.set(d.subarray(l,l+m)),c.putImageData(a,0,f))}else{if(e.kind!==De.RGB_24BPP)throw new Error(`bad image kind: ${e.kind}`);for(g=16,m=i*g,p=0;p<o;p++){for(p>=s&&(g=n,m=i*g),h=0,f=m;f--;)u[h++]=d[l++],u[h++]=d[l++],u[h++]=d[l++],u[h++]=255;c.putImageData(a,0,16*p)}}}function un(c,e){if(e.bitmap)return void c.drawImage(e.bitmap,0,0);const t=e.height,i=e.width,n=t%16,s=(t-n)/16,o=0===n?s:s+1,a=c.createImageData(i,16);let l=0;const h=e.data,d=a.data;for(let u=0;u<o;u++){const p=u<s?16:n;({srcPos:l}=on({src:h,srcPos:l,dest:d,width:i,height:p,nonBlackColor:0})),c.putImageData(a,0,16*u)}}function Ee(c,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of t)void 0!==c[i]&&(e[i]=c[i]);void 0!==c.setLineDash&&(e.setLineDash(c.getLineDash()),e.lineDashOffset=c.lineDashOffset)}function We(c){c.strokeStyle=c.fillStyle="#000000",c.fillRule="nonzero",c.globalAlpha=1,c.lineWidth=1,c.lineCap="butt",c.lineJoin="miter",c.miterLimit=10,c.globalCompositeOperation="source-over",c.font="10px sans-serif",void 0!==c.setLineDash&&(c.setLineDash([]),c.lineDashOffset=0);const{filter:e}=c;"none"!==e&&""!==e&&(c.filter="none")}function pn(c,e){if(e)return!0;D.singularValueDecompose2dScale(c,Tt);const t=Math.fround(Gt.pixelRatio*le.PDF_TO_CSS_UNITS);return Tt[0]<=t&&Tt[1]<=t}const ks=["butt","round","square"],Is=["miter","round","bevel"],Fs={},fn={};class de{constructor(e,t,i,n,s,{optionalContentConfig:o,markedContentStack:a=null},l,h){this.ctx=e,this.current=new hn(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=i,this.canvasFactory=n,this.filterFactory=s,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new Ts(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return"string"==typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:i=!1,background:n=null}){const s=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=n||"#ffffff",this.ctx.fillRect(0,0,s,o),this.ctx.fillStyle=a,i){const l=this.cachedCanvases.getCanvas("transparent",s,o);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...at(this.compositeCtx))}this.ctx.save(),We(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=at(this.ctx)}executeOperatorList(e,t,i,n){const s=e.argsArray,o=e.fnArray;let a=t||0;const l=s.length;if(l===a)return a;const h=l-a>10&&"function"==typeof i,d=h?Date.now()+15:0;let u=0;const p=this.commonObjs,f=this.objs;let g;for(;;){if(void 0!==n&&a===n.nextBreakPoint)return n.breakIt(a,i),a;if(g=o[a],g!==Ne.dependency)this[g].apply(this,s[a]);else for(const m of s[a]){const _=m.startsWith("g_")?p:f;if(!_.has(m))return _.get(m,i),a}if(a++,a===l)return a;if(h&&++u>10){if(Date.now()>d)return i(),a;u=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==e){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const i=e.width??e.displayWidth,n=e.height??e.displayHeight;let d,u,s=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),a=i,l=n,h="prescale1";for(;s>2&&a>1||o>2&&l>1;){let p=a,f=l;s>2&&a>1&&(p=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),s/=a/p),o>2&&l>1&&(f=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,o/=l/f),d=this.cachedCanvases.getCanvas(h,p,f),u=d.context,u.clearRect(0,0,p,f),u.drawImage(e,0,0,a,l,0,0,p,f),e=d.canvas,a=p,l=f,h="prescale1"===h?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:i,height:n}=e,s=this.current.fillColor,o=this.current.patternFill,a=at(t);let l,h,d,u;if((e.bitmap||e.data)&&e.count>1){const S=e.bitmap||e.data.buffer;h=JSON.stringify(o?a:[a.slice(0,4),s]),l=this._cachedBitmapsMap.get(S),l||(l=new Map,this._cachedBitmapsMap.set(S,l));const O=l.get(h);if(O&&!o)return{canvas:O,offsetX:Math.round(Math.min(a[0],a[2])+a[4]),offsetY:Math.round(Math.min(a[1],a[3])+a[5])};d=O}d||(u=this.cachedCanvases.getCanvas("maskCanvas",i,n),un(u.context,e));let p=D.transform(a,[1/i,0,0,-1/n,0,0]);p=D.transform(p,[1,0,0,1,0,-n]);const f=he.slice();D.axialAlignedBoundingBox([0,0,i,n],p,f);const[g,m,_,b]=f,v=Math.round(_-g)||1,y=Math.round(b-m)||1,x=this.cachedCanvases.getCanvas("fillCanvas",v,y),A=x.context,w=g,C=m;A.translate(-w,-C),A.transform(...p),d||(d=this._scaleImage(u.canvas,Lt(A)),d=d.img,l&&o&&l.set(h,d)),A.imageSmoothingEnabled=pn(at(A),e.interpolate),Xe(A,d,0,0,d.width,d.height,0,0,i,n),A.globalCompositeOperation="source-in";const P=D.transform(Lt(A),[1,0,0,1,-w,-C]);return A.fillStyle=o?s.getPattern(t,this,P,"Fill"):s,A.fillRect(0,0,i,n),l&&!o&&(this.cachedCanvases.delete("fillCanvas"),l.set(h,x.canvas)),{canvas:x.canvas,offsetX:Math.round(w),offsetY:Math.round(C)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=ks[e]}setLineJoin(e){this.ctx.lineJoin=Is[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const i=this.ctx;void 0!==i.setLineDash&&(i.setLineDash(e),i.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,i]of e)switch(t){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const n=this.cachedCanvases.getCanvas("smaskGroupAt"+this.groupLevel,this.ctx.canvas.width,this.ctx.canvas.height);this.suspendedCtx=this.ctx;const s=this.ctx=n.context;s.setTransform(this.suspendedCtx.getTransform()),Ee(this.suspendedCtx,s),function Ms(c,e){if(c._removeMirroring)throw new Error("Context is already forwarding operations.");c.__originalSave=c.save,c.__originalRestore=c.restore,c.__originalRotate=c.rotate,c.__originalScale=c.scale,c.__originalTranslate=c.translate,c.__originalTransform=c.transform,c.__originalSetTransform=c.setTransform,c.__originalResetTransform=c.resetTransform,c.__originalClip=c.clip,c.__originalMoveTo=c.moveTo,c.__originalLineTo=c.lineTo,c.__originalBezierCurveTo=c.bezierCurveTo,c.__originalRect=c.rect,c.__originalClosePath=c.closePath,c.__originalBeginPath=c.beginPath,c._removeMirroring=()=>{c.save=c.__originalSave,c.restore=c.__originalRestore,c.rotate=c.__originalRotate,c.scale=c.__originalScale,c.translate=c.__originalTranslate,c.transform=c.__originalTransform,c.setTransform=c.__originalSetTransform,c.resetTransform=c.__originalResetTransform,c.clip=c.__originalClip,c.moveTo=c.__originalMoveTo,c.lineTo=c.__originalLineTo,c.bezierCurveTo=c.__originalBezierCurveTo,c.rect=c.__originalRect,c.closePath=c.__originalClosePath,c.beginPath=c.__originalBeginPath,delete c._removeMirroring},c.save=function(){e.save(),this.__originalSave()},c.restore=function(){e.restore(),this.__originalRestore()},c.translate=function(t,i){e.translate(t,i),this.__originalTranslate(t,i)},c.scale=function(t,i){e.scale(t,i),this.__originalScale(t,i)},c.transform=function(t,i,n,s,o,a){e.transform(t,i,n,s,o,a),this.__originalTransform(t,i,n,s,o,a)},c.setTransform=function(t,i,n,s,o,a){e.setTransform(t,i,n,s,o,a),this.__originalSetTransform(t,i,n,s,o,a)},c.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},c.rotate=function(t){e.rotate(t),this.__originalRotate(t)},c.clip=function(t){e.clip(t),this.__originalClip(t)},c.moveTo=function(t,i){e.moveTo(t,i),this.__originalMoveTo(t,i)},c.lineTo=function(t,i){e.lineTo(t,i),this.__originalLineTo(t,i)},c.bezierCurveTo=function(t,i,n,s,o,a){e.bezierCurveTo(t,i,n,s,o,a),this.__originalBezierCurveTo(t,i,n,s,o,a)},c.rect=function(t,i,n,s){e.rect(t,i,n,s),this.__originalRect(t,i,n,s)},c.closePath=function(){e.closePath(),this.__originalClosePath()},c.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}(s,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Ee(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){this.current.activeSMask&&(e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height],this.composeSMask(this.suspendedCtx,this.current.activeSMask,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore())}composeSMask(e,t,i,n){const s=n[0],o=n[1],a=n[2]-s,l=n[3]-o;0===a||0===l||(this.genericComposeSMask(t.context,i,a,l,t.subtype,t.backdrop,t.transferMap,s,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(i.canvas,0,0),e.restore())}genericComposeSMask(e,t,i,n,s,o,a,l,h,d,u){let p=e.canvas,f=l-d,g=h-u;if(o){const _=D.makeHexColor(...o);if(f<0||g<0||f+i>p.width||g+n>p.height){const b=this.cachedCanvases.getCanvas("maskExtension",i,n),v=b.context;v.drawImage(p,-f,-g),v.globalCompositeOperation="destination-atop",v.fillStyle=_,v.fillRect(0,0,i,n),v.globalCompositeOperation="source-over",p=b.canvas,f=g=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(f,g,i,n),e.clip(b),e.globalCompositeOperation="destination-atop",e.fillStyle=_,e.fillRect(f,g,i,n),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),"Alpha"===s&&a?t.filter=this.filterFactory.addAlphaFilter(a):"Luminosity"===s&&(t.filter=this.filterFactory.addLuminosityFilter(a));const m=new Path2D;m.rect(l,h,i,n),t.clip(m),t.globalCompositeOperation="destination-in",t.drawImage(p,f,g,i,n,l,h,i,n),t.restore()}save(){this.inSMaskMode&&Ee(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){0!==this.stateStack.length?(this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Ee(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null):this.inSMaskMode&&this.endSMaskMode()}transform(e,t,i,n,s,o){this.ctx.transform(e,t,i,n,s,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,i){let[n]=t;if(!i)return n||=t[0]=new Path2D,void this[e](n);if(!(n instanceof Path2D)){const s=t[0]=new Path2D;for(let o=0,a=n.length;o<a;)switch(n[o++]){case 0:s.moveTo(n[o++],n[o++]);break;case 1:s.lineTo(n[o++],n[o++]);break;case 2:s.bezierCurveTo(n[o++],n[o++],n[o++],n[o++],n[o++],n[o++]);break;case 3:s.closePath();break;default:U(`Unrecognized drawing path operator: ${n[o-1]}`)}n=s}D.axialAlignedBoundingBox(i,at(this.ctx),this.current.minMax),this[e](n)}closePath(){this.ctx.closePath()}stroke(e,t=!0){const i=this.ctx,n=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if("object"==typeof n&&n?.getPattern){const s=n.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=n.getPattern(i,this,Lt(i),"Stroke"),s){const o=new Path2D;o.addPath(e,i.getTransform().invertSelf().multiplySelf(s)),e=o}this.rescaleAndStroke(e,!1),i.restore()}else this.rescaleAndStroke(e,!0);t&&this.consumePath(e,this.current.getClippedPathBoundingBox("Stroke",at(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(e){this.stroke(e)}fill(e,t=!0){const i=this.ctx,n=this.current.fillColor;let o=!1;if(this.current.patternFill){const l=n.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.fillStyle=n.getPattern(i,this,Lt(i),"Fill"),l){const h=new Path2D;h.addPath(e,i.getTransform().invertSelf().multiplySelf(l)),e=h}o=!0}const a=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==a&&(this.pendingEOFill?(i.fill(e,"evenodd"),this.pendingEOFill=!1):i.fill(e)),o&&i.restore(),t&&this.consumePath(e,a)}eoFill(e){this.pendingEOFill=!0,this.fill(e)}fillStroke(e){this.fill(e,!1),this.stroke(e,!1),this.consumePath(e)}eoFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}closeFillStroke(e){this.fillStroke(e)}closeEOFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}endPath(e){this.consumePath(e)}rawFillPath(e){this.ctx.fill(e)}clip(){this.pendingClip=Fs}eoClip(){this.pendingClip=fn}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(void 0===e)return;const i=new Path2D,n=t.getTransform().invertSelf();for(const{transform:s,x:o,y:a,fontSize:l,path:h}of e)i.addPath(h,new DOMMatrix(s).preMultiplySelf(n).translate(o,a).scale(l,-l));t.clip(i),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){const i=this.commonObjs.get(e),n=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(n.fontMatrix=i.fontMatrix||V,(0===n.fontMatrix[0]||0===n.fontMatrix[3])&&U("Invalid font matrix for font "+e),t<0?(t=-t,n.fontDirection=-1):n.fontDirection=1,this.current.font=i,this.current.fontSize=t,i.isType3Font)return;const s=i.loadedName||"sans-serif",o=i.systemFontInfo?.css||`"${s}", ${i.fallbackName}`;let a="normal";i.black?a="900":i.bold&&(a="bold");const l=i.italic?"italic":"normal";let h=t;t<16?h=16:t>100&&(h=100),this.current.fontSizeScale=t/h,this.ctx.font=`${l} ${a} ${h}px ${o}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e){const{current:t}=this;t.textMatrix=e,t.textMatrixScale=Math.hypot(e[0],e[1]),t.x=t.lineX=0,t.y=t.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#i(e,t,i){const n=new Path2D;return n.addPath(e,new DOMMatrix(i).invertSelf().multiplySelf(t)),n}paintChar(e,t,i,n,s){const o=this.ctx,a=this.current,l=a.font,h=a.textRenderingMode,d=a.fontSize/a.fontSizeScale,u=3&h,p=!!(4&h),f=a.patternFill&&!l.missingFile,g=a.patternStroke&&!l.missingFile;let m;if((l.disableFontFace||p||f||g)&&(m=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||f||g){let _;if(o.save(),o.translate(t,i),o.scale(d,-d),(0===u||2===u)&&(n?(_=o.getTransform(),o.setTransform(...n),o.fill(this.#i(m,_,n))):o.fill(m)),1===u||2===u)if(s){_||=o.getTransform(),o.setTransform(...s);const{a:b,b:v,c:y,d:x}=_,A=D.inverseTransform(s),w=D.transform([b,v,y,x,0,0],A);D.singularValueDecompose2dScale(w,Tt),o.lineWidth*=Math.max(Tt[0],Tt[1])/d,o.stroke(this.#i(m,_,s))}else o.lineWidth/=d,o.stroke(m);o.restore()}else(0===u||2===u)&&o.fillText(e,t,i),(1===u||2===u)&&o.strokeText(e,t,i);p&&(this.pendingTextPaths||=[]).push({transform:at(o),x:t,y:i,fontSize:d,path:m})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let i=!1;for(let n=3;n<t.length;n+=4)if(t[n]>0&&t[n]<255){i=!0;break}return W(this,"isFontSubpixelAAEnabled",i)}showText(e){const t=this.current,i=t.font;if(i.isType3Font)return this.showType3Text(e);const n=t.fontSize;if(0===n)return;const s=this.ctx,o=t.fontSizeScale,a=t.charSpacing,l=t.wordSpacing,h=t.fontDirection,d=t.textHScale*h,u=e.length,p=i.vertical,f=p?1:-1,g=i.defaultVMetrics,m=n*t.fontMatrix[0],_=0===t.textRenderingMode&&!i.disableFontFace&&!t.patternFill;let b,v;if(s.save(),t.textMatrix&&s.transform(...t.textMatrix),s.translate(t.x,t.y+t.textRise),s.scale(d,h>0?-1:1),t.patternFill){s.save();const C=t.fillColor.getPattern(s,this,Lt(s),"Fill");b=at(s),s.restore(),s.fillStyle=C}if(t.patternStroke){s.save();const C=t.strokeColor.getPattern(s,this,Lt(s),"Stroke");v=at(s),s.restore(),s.strokeStyle=C}let y=t.lineWidth;const x=t.textMatrixScale;if(0===x||0===y){const C=3&t.textRenderingMode;(1===C||2===C)&&(y=this.getSinglePixelWidth())}else y/=x;if(1!==o&&(s.scale(o,o),y/=o),s.lineWidth=y,i.isInvalidPDFjsFont){const C=[];let P=0;for(const S of e)C.push(S.unicode),P+=S.width;return s.fillText(C.join(""),0,0),t.x+=P*m*d,s.restore(),void this.compose()}let w,A=0;for(w=0;w<u;++w){const C=e[w];if("number"==typeof C){A+=f*C*n/1e3;continue}let P=!1;const S=(C.isSpace?l:0)+a,O=C.fontChar,k=C.accent;let tt,st,q=C.width;if(p){const R=C.vmetric||g,L=-(C.vmetric?R[1]:.5*q)*m;q=R?-R[0]:q,tt=L/o,st=(A+R[2]*m)/o}else tt=A/o,st=0;if(i.remeasure&&q>0){const R=1e3*s.measureText(O).width/n*o;if(q<R&&this.isFontSubpixelAAEnabled){const L=q/R;P=!0,s.save(),s.scale(L,1),tt/=L}else q!==R&&(tt+=(q-R)/2e3*n/o)}this.contentVisible&&(C.isInFont||i.missingFile)&&(_&&!k?s.fillText(O,tt,st):(this.paintChar(O,tt,st,b,v),k&&this.paintChar(k.fontChar,tt+n*k.offset.x/o,st-n*k.offset.y/o,b,v))),A+=p?q*m-S*h:q*m+S*h,P&&s.restore()}p?t.y-=A:t.x+=A*d,s.restore(),this.compose()}showType3Text(e){const t=this.ctx,i=this.current,n=i.font,s=i.fontSize,o=i.fontDirection,a=n.vertical?1:-1,l=i.charSpacing,h=i.wordSpacing,d=i.textHScale*o,u=i.fontMatrix||V,p=e.length;let g,m,_,b;if(3!==i.textRenderingMode&&0!==s){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),i.textMatrix&&t.transform(...i.textMatrix),t.translate(i.x,i.y+i.textRise),t.scale(d,o),g=0;g<p;++g){if(m=e[g],"number"==typeof m){b=a*m*s/1e3,this.ctx.translate(b,0),i.x+=b*d;continue}const v=(m.isSpace?h:0)+l,y=n.charProcOperatorList[m.operatorListId];y?this.contentVisible&&(this.save(),t.scale(s,s),t.transform(...u),this.executeOperatorList(y),this.restore()):U(`Type3 character "${m.operatorListId}" is not available.`);const x=[m.width,0];D.applyTransform(x,u),_=x[0]*s+v,t.translate(_,0),i.x+=_*d}t.restore()}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,i,n,s,o){const a=new Path2D;a.rect(i,n,s-i,o-n),this.ctx.clip(a),this.endPath()}getColorN_Pattern(e){let t;if("TilingPattern"===e[0]){const i=this.baseTransform||at(this.ctx);t=new ws(e,this.ctx,{createCanvasGraphics:s=>new de(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})},i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,i){this.ctx.strokeStyle=this.current.strokeColor=D.makeHexColor(e,t,i),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,i){this.ctx.fillStyle=this.current.fillColor=D.makeHexColor(e,t,i),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=function Es(c){switch(c[0]){case"RadialAxial":return new As(c);case"Mesh":return new xs(c);case"Dummy":return new Cs}throw new Error(`Unknown IR type: ${c[0]}`)}(this.getObject(e)),this.cachedPatterns.set(e,i)),t&&(i.matrix=t),i}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const i=this._getPattern(e);t.fillStyle=i.getPattern(t,this,Lt(t),"Shading");const n=Lt(t);if(n){const{width:s,height:o}=t.canvas,a=he.slice();D.axialAlignedBoundingBox([0,0,s,o],n,a);const[l,h,d,u]=a;this.ctx.fillRect(l,h,d-l,u-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){nt("Should not call beginInlineImage")}beginImageData(){nt("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=at(this.ctx),t)){D.axialAlignedBoundingBox(t,this.baseTransform,this.current.minMax);const[i,n,s,o]=t,a=new Path2D;a.rect(i,n,s-i,o-n),this.ctx.clip(a),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||$e("TODO: Support non-isolated groups."),e.knockout&&U("Knockout groups not supported.");const i=at(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let n=he.slice();D.axialAlignedBoundingBox(e.bbox,at(t),n),n=D.intersect(n,[0,0,t.canvas.width,t.canvas.height])||[0,0,0,0];const o=Math.floor(n[0]),a=Math.floor(n[1]),l=Math.max(Math.ceil(n[2])-o,1),h=Math.max(Math.ceil(n[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,h]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(d,l,h),p=u.context;p.translate(-o,-a),p.transform(...i);let f=new Path2D;const[g,m,_,b]=e.bbox;if(f.rect(g,m,_-g,b-m),e.matrix){const v=new Path2D;v.addPath(f,new DOMMatrix(e.matrix)),f=v}p.clip(f),e.smask?this.smaskStack.push({canvas:u.canvas,context:p,offsetX:o,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,a),t.save()),Ee(t,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const n=at(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...n);const s=he.slice();D.axialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],n,s),this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(s)}}beginAnnotation(e,t,i,n,s){if(this.#t(),We(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const o=t[2]-t[0],a=t[3]-t[1];if(s&&this.annotationCanvasMap){(i=i.slice())[4]-=t[0],i[5]-=t[1],(t=t.slice())[0]=t[1]=0,t[2]=o,t[3]=a,D.singularValueDecompose2dScale(at(this.ctx),Tt);const{viewportScale:l}=this,h=Math.ceil(o*this.outputScaleX*l),d=Math.ceil(a*this.outputScaleY*l);this.annotationCanvas=this.canvasFactory.create(h,d);const{canvas:u,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,u),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(Tt[0],0,0,-Tt[1],0,a*Tt[1]),We(this.ctx)}else{We(this.ctx),this.endPath();const l=new Path2D;l.rect(t[0],t[1],o,a),this.ctx.clip(l)}}this.current=new hn(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...n)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;(e=this.getObject(e.data,e)).count=t;const i=this.ctx,n=this._createMaskCanvas(e),s=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(s,n.offsetX,n.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,i=0,n=0,s,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);const a=this.ctx;a.save();const l=at(a);a.transform(t,i,n,s,0,0);const h=this._createMaskCanvas(e);a.setTransform(1,0,0,1,h.offsetX-l[4],h.offsetY-l[5]);for(let d=0,u=o.length;d<u;d+=2){const p=D.transform(l,[t,i,n,s,o[d],o[d+1]]);a.drawImage(h.canvas,p[4],p[5])}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,i=this.current.fillColor,n=this.current.patternFill;for(const s of e){const{data:o,width:a,height:l,transform:h}=s,d=this.cachedCanvases.getCanvas("maskCanvas",a,l),u=d.context;u.save(),un(u,this.getObject(o,s)),u.globalCompositeOperation="source-in",u.fillStyle=n?i.getPattern(u,this,Lt(t),"Fill"):i,u.fillRect(0,0,a,l),u.restore(),t.save(),t.transform(...h),t.scale(1,-1),Xe(t,d.canvas,0,0,a,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);t?this.paintInlineImageXObject(t):U("Dependent image isn't ready yet")}paintImageXObjectRepeat(e,t,i,n){if(!this.contentVisible)return;const s=this.getObject(e);if(!s)return void U("Dependent image isn't ready yet");const o=s.width,a=s.height,l=[];for(let h=0,d=n.length;h<d;h+=2)l.push({transform:[t,0,0,i,n[h],n[h+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(s,l)}applyTransferMapsToCanvas(e){return"none"!==this.current.transferMaps&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if("none"===this.current.transferMaps)return e.bitmap;const{bitmap:t,width:i,height:n}=e,s=this.cachedCanvases.getCanvas("inlineImage",i,n),o=s.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",s.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,i=e.height,n=this.ctx;this.save();const{filter:s}=n;let o;if("none"!==s&&""!==s&&(n.filter="none"),n.scale(1/t,-1/i),e.bitmap)o=this.applyTransferMapsToBitmap(e);else if("function"==typeof HTMLElement&&e instanceof HTMLElement||!e.data)o=e;else{const h=this.cachedCanvases.getCanvas("inlineImage",t,i).context;dn(h,e),o=this.applyTransferMapsToCanvas(h)}const a=this._scaleImage(o,Lt(n));n.imageSmoothingEnabled=pn(at(n),e.interpolate),Xe(n,a.img,0,0,a.paintWidth,a.paintHeight,0,-i,t,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const i=this.ctx;let n;if(e.bitmap)n=e.bitmap;else{const l=this.cachedCanvases.getCanvas("inlineImage",e.width,e.height).context;dn(l,e),n=this.applyTransferMapsToCanvas(l)}for(const s of t)i.save(),i.transform(...s.transform),i.scale(1,-1),Xe(i,n,s.x,s.y,s.w,s.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){this.markedContentStack.push("OC"===e?{visible:this.optionalContentConfig.isVisible(t)}:{visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e,t){const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);const n=this.ctx;this.pendingClip&&(i||(this.pendingClip===fn?n.clip(e,"evenodd"):n.clip(e)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=at(this.ctx);if(0===e[1]&&0===e[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),i=Math.hypot(e[0],e[2]),n=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(i,n)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){const{lineWidth:e}=this.current,{a:t,b:i,c:n,d:s}=this.ctx.getTransform();let o,a;if(0===i&&0===n){const l=Math.abs(t),h=Math.abs(s);if(l===h)if(0===e)o=a=1/l;else{const d=l*e;o=a=d<1?1/d:1}else if(0===e)o=1/l,a=1/h;else{const d=l*e,u=h*e;o=d<1?1/d:1,a=u<1?1/u:1}}else{const l=Math.abs(t*s-i*n),h=Math.hypot(t,i),d=Math.hypot(n,s);if(0===e)o=d/l,a=h/l;else{const u=e*l;o=d>u?d/u:1,a=h>u?h/u:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:i,current:{lineWidth:n}}=this,[s,o]=this.getScaleForStroking();if(s===o)return i.lineWidth=(n||1)*s,void i.stroke(e);const a=i.getLineDash();t&&i.save(),i.scale(s,o),yi.a=1/s,yi.d=1/o;const l=new Path2D;if(l.addPath(e,yi),a.length>0){const h=Math.max(s,o);i.setLineDash(a.map(d=>d/h)),i.lineDashOffset/=h}i.lineWidth=n||1,i.stroke(l),t&&i.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const c in Ne)void 0!==de.prototype[c]&&(de.prototype[Ne[c]]=de.prototype[c]);class we{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&null!==e)throw new Error("Invalid `workerPort` type.");this.#t=e}static get workerSrc(){return this.#e}static set workerSrc(e){if("string"!=typeof e)throw new Error("Invalid `workerSrc` type.");this.#e=e}}class Os{#t;#e;constructor({parsedData:e,rawData:t}){this.#t=e,this.#e=t}getRaw(){return this.#e}get(e){return this.#t.get(e)??null}[Symbol.iterator](){return this.#t.entries()}}const ue=Symbol("INTERNAL");class Rs{#t=!1;#e=!1;#i=!1;#n=!0;constructor(e,{name:t,intent:i,usage:n,rbGroups:s}){this.#t=!!(2&e),this.#e=!!(4&e),this.name=t,this.intent=i,this.usage=n,this.rbGroups=s}get visible(){if(this.#i)return this.#n;if(!this.#n)return!1;const{print:e,view:t}=this.usage;return this.#t?"OFF"!==t?.viewState:!this.#e||"OFF"!==e?.printState}_setVisible(e,t,i=!1){e!==ue&&nt("Internal method `_setVisible` called."),this.#i=i,this.#n=t}}class Ds{#t=null;#e=new Map;#i=null;#n=null;constructor(e,t=2){if(this.renderingIntent=t,this.name=null,this.creator=null,null!==e){this.name=e.name,this.creator=e.creator,this.#n=e.order;for(const i of e.groups)this.#e.set(i.id,new Rs(t,i));if("OFF"===e.baseState)for(const i of this.#e.values())i._setVisible(ue,!1);for(const i of e.on)this.#e.get(i)._setVisible(ue,!0);for(const i of e.off)this.#e.get(i)._setVisible(ue,!1);this.#i=this.getHash()}}#r(e){const t=e.length;if(t<2)return!0;const i=e[0];for(let n=1;n<t;n++){const s=e[n];let o;if(Array.isArray(s))o=this.#r(s);else{if(!this.#e.has(s))return U(`Optional content group not found: ${s}`),!0;o=this.#e.get(s).visible}switch(i){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return"And"===i}isVisible(e){if(0===this.#e.size)return!0;if(!e)return $e("Optional content group not defined."),!0;if("OCG"===e.type)return this.#e.has(e.id)?this.#e.get(e.id).visible:(U(`Optional content group not found: ${e.id}`),!0);if("OCMD"===e.type){if(e.expression)return this.#r(e.expression);if(!e.policy||"AnyOn"===e.policy){for(const t of e.ids){if(!this.#e.has(t))return U(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!0}return!1}if("AllOn"===e.policy){for(const t of e.ids){if(!this.#e.has(t))return U(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!1}return!0}if("AnyOff"===e.policy){for(const t of e.ids){if(!this.#e.has(t))return U(`Optional content group not found: ${t}`),!0;if(!this.#e.get(t).visible)return!0}return!1}if("AllOff"===e.policy){for(const t of e.ids){if(!this.#e.has(t))return U(`Optional content group not found: ${t}`),!0;if(this.#e.get(t).visible)return!1}return!0}return U(`Unknown optional content policy ${e.policy}.`),!0}return U(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,i=!0){const n=this.#e.get(e);if(n){if(i&&t&&n.rbGroups.length)for(const s of n.rbGroups)for(const o of s)o!==e&&this.#e.get(o)?._setVisible(ue,!1,!0);n._setVisible(ue,!!t,!0),this.#t=null}else U(`Optional content group not found: ${e}`)}setOCGState({state:e,preserveRB:t}){let i;for(const n of e){switch(n){case"ON":case"OFF":case"Toggle":i=n;continue}const s=this.#e.get(n);if(s)switch(i){case"ON":this.setVisibility(n,!0,t);break;case"OFF":this.setVisibility(n,!1,t);break;case"Toggle":this.setVisibility(n,!s.visible,t)}}this.#t=null}get hasInitialVisibility(){return null===this.#i||this.getHash()===this.#i}getOrder(){return this.#e.size?this.#n?this.#n.slice():[...this.#e.keys()]:null}getGroup(e){return this.#e.get(e)||null}getHash(){if(null!==this.#t)return this.#t;const e=new Wi;for(const[t,i]of this.#e)e.update(`${t}:${i.visible}`);return this.#t=e.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class Ls{constructor(e,{disableRange:t=!1,disableStream:i=!1}){pt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:n,initialData:s,progressiveDone:o,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,s?.length>0){const l=s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!i,this._isRangeSupported=!t,this._contentLength=n,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,h)=>{this._onReceiveData({begin:l,chunk:h})}),e.addProgressListener((l,h)=>{this._onProgress({loaded:l,total:h})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const i=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;void 0===e?this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i):pt(this._rangeReaders.some(function(s){return s._begin===e&&(s._enqueue(i),!0)}),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){void 0===e.total?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){pt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new Ns(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new js(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}}class Ns{constructor(e,t,i=!1,n=null){this._stream=e,this._done=i||!1,this._filename=li(n)?n:null,this._queuedChunks=t||[],this._loaded=0;for(const s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}read(){var e=this;return(0,E.A)(function*(){if(e._queuedChunks.length>0)return{value:e._queuedChunks.shift(),done:!1};if(e._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return e._requests.push(t),t.promise})()}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class js{constructor(e,t,i){this._stream=e,this._begin=t,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(0===this._requests.length)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}read(){var e=this;return(0,E.A)(function*(){if(e._queuedChunk){const i=e._queuedChunk;return e._queuedChunk=null,{value:i,done:!1}}if(e._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return e._requests.push(t),t.promise})()}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function gn(c,e){const t=new Headers;if(!c||!e||"object"!=typeof e)return t;for(const i in e){const n=e[i];void 0!==n&&t.append(i,n)}return t}function Ye(c){return URL.parse(c)?.origin??null}function mn({responseHeaders:c,isHttp:e,rangeChunkSize:t,disableRange:i}){const n={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(c.get("Content-Length"),10);return!Number.isInteger(s)||(n.suggestedLength=s,s<=2*t)||i||!e||"bytes"!==c.get("Accept-Ranges")||"identity"!==(c.get("Content-Encoding")||"identity")||(n.allowRangeRequests=!0),n}function _n(c){const e=c.get("Content-Disposition");if(e){let t=function Bs(c){let e=!0,t=i("filename\\*","i").exec(c);if(t){t=t[1];let d=a(t);return d=unescape(d),d=l(d),d=h(d),s(d)}if(t=function o(d){const u=[];let p;const f=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(p=f.exec(d));){let[,m,_,b]=p;if(m=parseInt(m,10),m in u){if(0===m)break}else u[m]=[_,b]}const g=[];for(let m=0;m<u.length&&m in u;++m){let[_,b]=u[m];b=a(b),_&&(b=unescape(b),0===m&&(b=l(b))),g.push(b)}return g.join("")}(c),t)return s(h(t));if(t=i("filename","i").exec(c),t){t=t[1];let d=a(t);return d=h(d),s(d)}function i(d,u){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function n(d,u){if(d){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const p=new TextDecoder(d,{fatal:!0}),f=ae(u);u=p.decode(f),e=!1}catch{}}return u}function s(d){return e&&/[\x80-\xff]/.test(d)&&(d=n("utf-8",d),e&&(d=n("iso-8859-1",d))),d}function a(d){if(d.startsWith('"')){const u=d.slice(1).split('\\"');for(let p=0;p<u.length;++p){const f=u[p].indexOf('"');-1!==f&&(u[p]=u[p].slice(0,f),u.length=p+1),u[p]=u[p].replaceAll(/\\(.)/g,"$1")}d=u.join('"')}return d}function l(d){const u=d.indexOf("'");return-1===u?d:n(d.slice(0,u),d.slice(u+1).replace(/^[^']*'/,""))}function h(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,p,f,g){if("q"===f||"Q"===f)return n(p,g=(g=g.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,function(m,_){return String.fromCharCode(parseInt(_,16))}));try{g=atob(g)}catch{}return n(p,g)})}return""}(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(li(t))return t}return null}function Pe(c,e){return new Ge(`Unexpected server response (${c}) while retrieving PDF "${e}".`,c,404===c||0===c&&e.startsWith("file:"))}function bn(c){return 200===c||206===c}function vn(c,e,t){return{method:"GET",headers:c,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function An(c){return c instanceof Uint8Array?c.buffer:c instanceof ArrayBuffer?c:(U(`getArrayBuffer - unexpected data format: ${c}`),new Uint8Array(c).buffer)}class yn{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=gn(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return pt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new $s(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new Gs(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class $s{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const i=new Headers(e.headers),n=t.url;fetch(n,vn(i,this._withCredentials,this._abortController)).then(s=>{if(e._responseOrigin=Ye(s.url),!bn(s.status))throw Pe(s.status,n);this._reader=s.body.getReader(),this._headersCapability.resolve();const o=s.headers,{allowRangeRequests:a,suggestedLength:l}=mn({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=_n(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Xt("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){var e=this;return(0,E.A)(function*(){yield e._headersCapability.promise;const{value:t,done:i}=yield e._reader.read();return i?{value:t,done:i}:(e._loaded+=t.byteLength,e.onProgress?.({loaded:e._loaded,total:e._contentLength}),{value:An(t),done:!1})})()}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class Gs{constructor(e,t,i){this._stream=e,this._reader=null,this._loaded=0;const n=e.source;this._withCredentials=n.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!n.disableStream,this._abortController=new AbortController;const s=new Headers(e.headers);s.append("Range",`bytes=${t}-${i-1}`);const o=n.url;fetch(o,vn(s,this._withCredentials,this._abortController)).then(a=>{const l=Ye(a.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!bn(a.status))throw Pe(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}read(){var e=this;return(0,E.A)(function*(){yield e._readCapability.promise;const{value:t,done:i}=yield e._reader.read();return i?{value:t,done:i}:(e._loaded+=t.byteLength,e.onProgress?.({loaded:e._loaded}),{value:An(t),done:!1})})()}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class Vs{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:i}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=gn(this.isHttp,t),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,i=this.currXhrId++,n=this.pendingRequests[i]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[s,o]of this.headers)t.setRequestHeader(s,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),n.expectedStatus=206):n.expectedStatus=200,t.responseType="arraybuffer",pt(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,i),t.onprogress=this.onProgress.bind(this,i),n.onHeadersReceived=e.onHeadersReceived,n.onDone=e.onDone,n.onError=e.onError,n.onProgress=e.onProgress,t.send(null),i}onProgress(e,t){const i=this.pendingRequests[e];i&&i.onProgress?.(t)}onStateChange(e,t){const i=this.pendingRequests[e];if(!i)return;const n=i.xhr;if(n.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),4!==n.readyState||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],0===n.status&&this.isHttp)return void i.onError(n.status);const s=n.status||200;if((200!==s||206!==i.expectedStatus)&&s!==i.expectedStatus)return void i.onError(n.status);const a=function Us(c){const e=c.response;return"string"!=typeof e?e:ae(e).buffer}(n);if(206===s){const l=n.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);h?i.onDone({begin:parseInt(h[1],10),chunk:a}):(U('Missing or invalid "Content-Range" header.'),i.onError(0))}else a?i.onDone({begin:0,chunk:a}):i.onError(n.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class Hs{constructor(e){this._source=e,this._manager=new Vs(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return pt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new zs(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const i=new Xs(this._manager,e,t);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class zs{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=Ye(t.responseURL);const i=t.getAllResponseHeaders(),n=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[l,...h]=a.split(": ");return[l,h.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:o}=mn({responseHeaders:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=_n(n),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Pe(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}read(){var e=this;return(0,E.A)(function*(){if(yield e._headersCapability.promise,e._storedError)throw e._storedError;if(e._cachedChunks.length>0)return{value:e._cachedChunks.shift(),done:!1};if(e._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return e._requests.push(t),t.promise})()}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Xs{constructor(e,t,i){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const e=Ye(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=Pe(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}read(){var e=this;return(0,E.A)(function*(){if(e._storedError)throw e._storedError;if(null!==e._queuedChunk){const i=e._queuedChunk;return e._queuedChunk=null,{value:i,done:!1}}if(e._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return e._requests.push(t),t.promise})()}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Ws=/^[a-z][a-z0-9\-+.]+:/i;class qs{constructor(e){this.source=e,this.url=function Ys(c){if(Ws.test(c))return new URL(c);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(c))}(e.url),pt("file:"===this.url.protocol,"PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return pt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Ks(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new Js(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class Ks{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(n=>{this._contentLength=n.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},n=>{"ENOENT"===n.code&&(n=Pe(0,this._url.href)),this._storedError=n,this._headersCapability.reject(n)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){var e=this;return(0,E.A)(function*(){if(yield e._readCapability.promise,e._done)return{value:void 0,done:!0};if(e._storedError)throw e._storedError;const t=e._readableStream.read();return null===t?(e._readCapability=Promise.withResolvers(),e.read()):(e._loaded+=t.length,e.onProgress?.({loaded:e._loaded,total:e._contentLength}),{value:new Uint8Array(t).buffer,done:!1})})()}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Xt("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Js{constructor(e,t,i){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!e.source.disableStream;const s=process.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:t,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}read(){var e=this;return(0,E.A)(function*(){if(yield e._readCapability.promise,e._done)return{value:void 0,done:!0};if(e._storedError)throw e._storedError;const t=e._readableStream.read();return null===t?(e._readCapability=Promise.withResolvers(),e.read()):(e._loaded+=t.length,e.onProgress?.({loaded:e._loaded}),{value:new Uint8Array(t).buffer,done:!1})})()}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}class wt{#t=Promise.withResolvers();#e=null;#i=!1;#n=!!globalThis.FontInspector?.enabled;#r=null;#s=null;#l=0;#a=0;#d=null;#c=null;#u=0;#h=0;#p=Object.create(null);#o=[];#f=null;#m=[];#g=new WeakMap;#_=null;static#b=new Map;static#v=new Map;static#y=new WeakMap;static#C=null;static#w=new Set;constructor({textContentSource:e,container:t,viewport:i}){if(e instanceof ReadableStream)this.#f=e;else{if("object"!=typeof e)throw new Error('No "textContentSource" parameter specified.');this.#f=new ReadableStream({start(l){l.enqueue(e),l.close()}})}this.#e=this.#c=t,this.#h=i.scale*Gt.pixelRatio,this.#u=i.rotation,this.#s={div:null,properties:null,ctx:null};const{pageWidth:n,pageHeight:s,pageX:o,pageY:a}=i.rawDims;this.#_=[1,0,0,-1,-o,a+s],this.#a=n,this.#l=s,wt.#I(),te(t,i),this.#t.promise.finally(()=>{wt.#w.delete(this),this.#s=null,this.#p=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=At.platform;return W(this,"fontFamilyMap",new Map([["sans-serif",(e&&t?"Calibri, ":"")+"sans-serif"],["monospace",(e&&t?"Lucida Console, ":"")+"monospace"]]))}render(){const e=()=>{this.#d.read().then(({value:t,done:i})=>{i?this.#t.resolve():(this.#r??=t.lang,Object.assign(this.#p,t.styles),this.#S(t.items),e())},this.#t.reject)};return this.#d=this.#f.getReader(),wt.#w.add(this),e(),this.#t.promise}update({viewport:e,onBefore:t=null}){const i=e.scale*Gt.pixelRatio,n=e.rotation;if(n!==this.#u&&(t?.(),this.#u=n,te(this.#c,{rotation:n})),i!==this.#h){t?.(),this.#h=i;const s={div:null,properties:null,ctx:wt.#M(this.#r)};for(const o of this.#m)s.properties=this.#g.get(o),s.div=o,this.#x(s)}}cancel(){const e=new Xt("TextLayer task cancelled.");this.#d?.cancel(e).catch(()=>{}),this.#d=null,this.#t.reject(e)}get textDivs(){return this.#m}get textContentItemsStr(){return this.#o}#S(e){if(this.#i)return;this.#s.ctx??=wt.#M(this.#r);const t=this.#m,i=this.#o;for(const n of e){if(t.length>1e5)return U("Ignoring additional textDivs for performance reasons."),void(this.#i=!0);if(void 0!==n.str)i.push(n.str),this.#T(n);else if("beginMarkedContentProps"===n.type||"beginMarkedContent"===n.type){const s=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),null!==n.id&&this.#e.setAttribute("id",`${n.id}`),s.append(this.#e)}else"endMarkedContent"===n.type&&(this.#e=this.#e.parentNode)}}#T(e){const t=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:""!==e.str,hasEOL:e.hasEOL,fontSize:0};this.#m.push(t);const n=D.transform(this.#_,e.transform);let s=Math.atan2(n[1],n[0]);const o=this.#p[e.fontName];o.vertical&&(s+=Math.PI/2);let a=this.#n&&o.fontSubstitution||o.fontFamily;a=wt.fontFamilyMap.get(a)||a;const l=Math.hypot(n[2],n[3]),h=l*wt.#F(a,o,this.#r);let d,u;0===s?(d=n[4],u=n[5]-h):(d=n[4]+h*Math.sin(s),u=n[5]-h*Math.cos(s));const p="calc(var(--total-scale-factor) *",f=t.style;this.#e===this.#c?(f.left=`${(100*d/this.#a).toFixed(2)}%`,f.top=`${(100*u/this.#l).toFixed(2)}%`):(f.left=`${p}${d.toFixed(2)}px)`,f.top=`${p}${u.toFixed(2)}px)`),f.fontSize=`${p}${(wt.#C*l).toFixed(2)}px)`,f.fontFamily=a,i.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#n&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),0!==s&&(i.angle=s*(180/Math.PI));let g=!1;if(e.str.length>1)g=!0;else if(" "!==e.str&&e.transform[0]!==e.transform[3]){const m=Math.abs(e.transform[0]),_=Math.abs(e.transform[3]);m!==_&&Math.max(m,_)/Math.min(m,_)>1.5&&(g=!0)}if(g&&(i.canvasWidth=o.vertical?e.height:e.width),this.#g.set(t,i),this.#s.div=t,this.#s.properties=i,this.#x(this.#s),i.hasText&&this.#e.append(t),i.hasEOL){const m=document.createElement("br");m.setAttribute("role","presentation"),this.#e.append(m)}}#x(e){const{div:t,properties:i,ctx:n}=e,{style:s}=t;let o="";if(wt.#C>1&&(o=`scale(${1/wt.#C})`),0!==i.canvasWidth&&i.hasText){const{fontFamily:a}=s,{canvasWidth:l,fontSize:h}=i;wt.#P(n,h*this.#h,a);const{width:d}=n.measureText(t.textContent);d>0&&(o=`scaleX(${l*this.#h/d}) ${o}`)}0!==i.angle&&(o=`rotate(${i.angle}deg) ${o}`),o.length>0&&(s.transform=o)}static cleanup(){if(!(this.#w.size>0)){this.#b.clear();for(const{canvas:e}of this.#v.values())e.remove();this.#v.clear()}}static#M(e=null){let t=this.#v.get(e||="");if(!t){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=e,document.body.append(i),t=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#v.set(e,t),this.#y.set(t,{size:0,family:""})}return t}static#P(e,t,i){const n=this.#y.get(e);t===n.size&&i===n.family||(e.font=`${t}px ${i}`,n.size=t,n.family=i)}static#I(){if(null!==this.#C)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#C=e.getBoundingClientRect().height,e.remove()}static#F(e,t,i){const n=this.#b.get(e);if(n)return n;const s=this.#M(i);s.canvas.width=s.canvas.height=30,this.#P(s,30,e);const o=s.measureText(""),a=o.fontBoundingBoxAscent,l=Math.abs(o.fontBoundingBoxDescent);s.canvas.width=s.canvas.height=0;let h=.8;return a?h=a/(a+l):(At.platform.isFirefox&&U("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?h=t.ascent:t.descent&&(h=1+t.descent)),this.#b.set(e,h),h}}class Se{static textContent(e){const t=[],i={items:t,styles:Object.create(null)};return function n(s){if(!s)return;let o=null;const a=s.name;if("#text"===a)o=s.value;else{if(!Se.shouldBuildText(a))return;s?.attributes?.textContent?o=s.attributes.textContent:s.value&&(o=s.value)}if(null!==o&&t.push({str:o}),s.children)for(const l of s.children)n(l)}(e),i}static shouldBuildText(e){return!("textarea"===e||"input"===e||"option"===e||"select"===e)}}function Cn(c={}){"string"==typeof c||c instanceof URL?c={url:c}:(c instanceof ArrayBuffer||ArrayBuffer.isView(c))&&(c={data:c});const e=new wi,{docId:t}=e,i=c.url?function er(c){if(c instanceof URL)return c.href;if("string"==typeof c){if(J)return c;const e=URL.parse(c,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(c.url):null,n=c.data?function ir(c){if(J&&typeof Buffer<"u"&&c instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(c instanceof Uint8Array&&c.byteLength===c.buffer.byteLength)return c;if("string"==typeof c)return ae(c);if(c instanceof ArrayBuffer||ArrayBuffer.isView(c)||"object"==typeof c&&!isNaN(c?.length))return new Uint8Array(c);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(c.data):null,s=c.httpHeaders||null,o=!0===c.withCredentials,a=c.password??null,l=c.range instanceof En?c.range:null,h=Number.isInteger(c.rangeChunkSize)&&c.rangeChunkSize>0?c.rangeChunkSize:65536;let d=c.worker instanceof vt?c.worker:null;const u=c.verbosity,p="string"!=typeof c.docBaseUrl||Ve(c.docBaseUrl)?null:c.docBaseUrl,f=qe(c.cMapUrl),g=!1!==c.cMapPacked,m=c.CMapReaderFactory||(J?_s:Qi),_=qe(c.iccUrl),b=qe(c.standardFontDataUrl),v=c.StandardFontDataFactory||(J?bs:en),y=qe(c.wasmUrl),x=c.WasmFactory||(J?vs:sn),A=!0!==c.stopAtErrors,w=Number.isInteger(c.maxImageSize)&&c.maxImageSize>-1?c.maxImageSize:-1,C=!1!==c.isEvalSupported,P="boolean"==typeof c.isOffscreenCanvasSupported?c.isOffscreenCanvasSupported:!J,S="boolean"==typeof c.isImageDecoderSupported?c.isImageDecoderSupported:!J&&(At.platform.isFirefox||!globalThis.chrome),O=Number.isInteger(c.canvasMaxAreaInBytes)?c.canvasMaxAreaInBytes:-1,k="boolean"==typeof c.disableFontFace?c.disableFontFace:J,tt=!0===c.fontExtraProperties,st=!0===c.enableXfa,q=c.ownerDocument||globalThis.document,bt=!0===c.disableRange,R=!0===c.disableStream,L=!0===c.disableAutoFetch,lt=!0===c.pdfBug,Ut=c.CanvasFactory||(J?ms:ps),Bt=c.FilterFactory||(J?gs:fs),Vt=!0===c.enableHWA,mt=!1!==c.useWasm,ot=l?l.length:c.length??NaN,Dt="boolean"==typeof c.useSystemFonts?c.useSystemFonts:!J&&!k,Ot="boolean"==typeof c.useWorkerFetch?c.useWorkerFetch:!!(m===Qi&&v===en&&x===sn&&f&&b&&y&&ce(f,document.baseURI)&&ce(b,document.baseURI)&&ce(y,document.baseURI));!function zn(c){Number.isInteger(c)&&(Be=c)}(u);const ct={canvasFactory:new Ut({ownerDocument:q,enableHWA:Vt}),filterFactory:new Bt({docId:t,ownerDocument:q}),cMapReaderFactory:Ot?null:new m({baseUrl:f,isCompressed:g}),standardFontDataFactory:Ot?null:new v({baseUrl:b}),wasmFactory:Ot?null:new x({baseUrl:y})};if(!d){const se={verbosity:u,port:we.workerPort};d=se.port?vt.fromPort(se):new vt(se),e._worker=d}const Yt={docId:t,apiVersion:"5.2.133",data:n,password:a,disableAutoFetch:L,rangeChunkSize:h,length:ot,docBaseUrl:p,enableXfa:st,evaluatorOptions:{maxImageSize:w,disableFontFace:k,ignoreErrors:A,isEvalSupported:C,isOffscreenCanvasSupported:P,isImageDecoderSupported:S,canvasMaxAreaInBytes:O,fontExtraProperties:tt,useSystemFonts:Dt,useWasm:mt,useWorkerFetch:Ot,cMapUrl:f,iccUrl:_,standardFontDataUrl:b,wasmUrl:y}},qt={ownerDocument:q,pdfBug:lt,styleElement:null,loadingParams:{disableAutoFetch:L,enableXfa:st}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const se=d.messageHandler.sendWithPromise("GetDocRequest",Yt,n?[n.buffer]:null);let Oe;if(l)Oe=new Ls(l,{disableRange:bt,disableStream:R});else if(!n){if(!i)throw new Error("getDocument - no `url` parameter provided.");let Ht;if(J)if(ce(i)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");Ht=yn}else Ht=qs;else Ht=ce(i)?yn:Hs;Oe=new Ht({url:i,length:ot,httpHeaders:s,withCredentials:o,rangeChunkSize:h,disableRange:bt,disableStream:R})}return se.then(Ht=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const ti=new Ce(t,Ht,d.port),Di=new lr(ti,e,Oe,qt,ct);e._transport=Di,ti.send("Ready",null)})}).catch(e._capability.reject),e}function qe(c){if("string"!=typeof c)return null;if(c.endsWith("/"))return c;throw new Error(`Invalid factory url: "${c}" must include trailing slash.`)}const Ei=c=>"object"==typeof c&&Number.isInteger(c?.num)&&c.num>=0&&Number.isInteger(c?.gen)&&c.gen>=0,sr=function es(c,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[i,n,...s]=t;if(!c(i)&&!Number.isInteger(i)||!e(n))return!1;const o=s.length;let a=!0;switch(n.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return 0===o;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(4!==o)return!1;a=!1;break;default:return!1}for(const l of s)if(!("number"==typeof l||a&&null===l))return!1;return!0}.bind(null,Ei,c=>"object"==typeof c&&"string"==typeof c?.name);class wi{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId="d"+wi.#t++;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}destroy(){var e=this;return(0,E.A)(function*(){e.destroyed=!0;try{e._worker?.port&&(e._worker._pendingDestroy=!0),yield e._transport?.destroy()}catch(t){throw e._worker?.port&&delete e._worker._pendingDestroy,t}e._transport=null,e._worker?.destroy(),e._worker=null})()}getData(){var e=this;return(0,E.A)(function*(){return e._transport.getData()})()}}class En{constructor(e,t,i=!1,n=null){this.length=e,this.initialData=t,this.progressiveDone=i,this.contentDispositionFilename=n,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const i of this._rangeListeners)i(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const i of this._progressListeners)i(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){nt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class rr{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return W(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class or{#t=!1;constructor(e,t,i,n=!1){this._pageIndex=e,this._pageInfo=t,this._transport=i,this._stats=n?new Vi:null,this._pdfBug=n,this.commonObjs=i.commonObjs,this.objs=new wn,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:i=0,offsetY:n=0,dontFlip:s=!1}={}){return new ve({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:n,dontFlip:s})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return W(this,"isPureXfa",!!this._transport._htmlForXfa)}getXfa(){var e=this;return(0,E.A)(function*(){return e._transport._htmlForXfa?.children[e._pageIndex]||null})()}render({canvasContext:e,viewport:t,intent:i="display",annotationMode:n=B.ENABLE,transform:s=null,background:o=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:h=null,printAnnotationStorage:d=null,isEditing:u=!1}){this._stats?.time("Overall");const p=this._transport.getRenderingIntent(i,n,d,u),{renderingIntent:f,cacheKey:g}=p;this.#t=!1,a||=this._transport.getOptionalContentConfig(f);let m=this._intentStates.get(g);m||(m=Object.create(null),this._intentStates.set(g,m)),m.streamReaderCancelTimeout&&(clearTimeout(m.streamReaderCancelTimeout),m.streamReaderCancelTimeout=null);const _=!!(4&f);m.displayReadyCapability||(m.displayReadyCapability=Promise.withResolvers(),m.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(p));const b=x=>{m.renderTasks.delete(v),_&&(this.#t=!0),this.#e(),x?(v.capability.reject(x),this._abortOperatorList({intentState:m,reason:x instanceof Error?x:new Error(x)})):v.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},v=new pe({callback:b,params:{canvasContext:e,viewport:t,transform:s,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:m.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!_,pdfBug:this._pdfBug,pageColors:h});(m.renderTasks||=new Set).add(v);const y=v.task;return Promise.all([m.displayReadyCapability.promise,a]).then(([x,A])=>{if(this.destroyed)b();else{if(this._stats?.time("Rendering"),!(A.renderingIntent&f))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");v.initializeGraphics({transparency:x,optionalContentConfig:A}),v.operatorListChanged()}}).catch(b),y}getOperatorList({intent:e="display",annotationMode:t=B.ENABLE,printAnnotationStorage:i=null,isEditing:n=!1}={}){const o=this._transport.getRenderingIntent(e,t,i,n,!0);let l,a=this._intentStates.get(o.cacheKey);return a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a)),a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=function s(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))},a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===e,disableNormalization:!0===t},{highWaterMark:100,size:n=>n.items.length})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>Se.textContent(i));const t=this.streamTextContent(e);return new Promise(function(i,n){const o=t.getReader(),a={items:[],styles:Object.create(null),lang:null};!function s(){o.read().then(function({value:l,done:h}){h?i(a):(a.lang??=l.lang,Object.assign(a.styles,l.styles),a.items.push(...l.items),s())},n)}()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const i of t.renderTasks)e.push(i.completed),i.cancel();return this.objs.clear(),this.#t=!1,Promise.all(e)}cleanup(e=!1){this.#t=!0;const t=this.#e();return e&&t&&(this._stats&&=new Vi),t}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(e,t){const i=this._intentStates.get(t);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let i=0,n=e.length;i<n;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const i of t.renderTasks)i.operatorListChanged();e.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:i,modifiedIds:n}){const{map:s,transfer:o}=i,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:s,modifiedIds:n},o).getReader(),h=this._intentStates.get(t);h.streamReader=l;const d=()=>{l.read().then(({value:u,done:p})=>{p?h.streamReader=null:this._transport.destroyed||(this._renderPageChunk(u,h),d())},u=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const p of h.renderTasks)p.operatorListChanged();this.#e()}if(h.displayReadyCapability)h.displayReadyCapability.reject(u);else{if(!h.opListReadCapability)throw u;h.opListReadCapability.reject(u)}}})};d()}_abortOperatorList({intentState:e,reason:t,force:i=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!i){if(e.renderTasks.size>0)return;if(t instanceof ai){let n=100;return t.extraDelay>0&&t.extraDelay<1e3&&(n+=t.extraDelay),void(e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},n))}}if(e.streamReader.cancel(new Xt(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[n,s]of this._intentStates)if(s===e){this._intentStates.delete(n);break}this.cleanup()}}}get stats(){return this._stats}}class ar{#t=new Map;#e=Promise.resolve();postMessage(e,t){const i={data:structuredClone(e,t?{transfer:t}:null)};this.#e.then(()=>{for(const[n]of this.#t)n.call(this,i)})}addEventListener(e,t,i=null){let n=null;if(i?.signal instanceof AbortSignal){const{signal:s}=i;if(s.aborted)return void U("LoopbackPort - cannot use an `aborted` signal.");const o=()=>this.removeEventListener(e,t);n=()=>s.removeEventListener("abort",o),s.addEventListener("abort",o)}this.#t.set(t,n)}removeEventListener(e,t){this.#t.get(t)?.(),this.#t.delete(t)}terminate(){for(const[,e]of this.#t)e?.();this.#t.clear()}}class vt{static#t=0;static#e=!1;static#i;static{J&&(this.#e=!0,we.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(e,t)=>{const i=URL.parse(e);if(!i?.origin||"null"===i.origin)return!1;const n=new URL(t,i);return i.origin===n.origin},this._createCDNWrapper=e=>URL.createObjectURL(new Blob([`await import("${e}");`],{type:"text/javascript"}))}constructor({name:e=null,port:t=null,verbosity:i=Xn()}={}){if(this.name=e,this.destroyed=!1,this.verbosity=i,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if(vt.#i?.has(t))throw new Error("Cannot use more than one PDFWorker per port.");return(vt.#i||=new WeakMap).set(t,this),void this._initializeFromPort(t)}this._initialize()}get promise(){return this._readyCapability.promise}#n(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new Ce("main","worker",e),this._messageHandler.on("ready",function(){}),this.#n()}_initialize(){if(vt.#e||vt.#r)return void this._setupFakeWorker();let{workerSrc:e}=vt;try{vt._isSameOrigin(window.location,e)||(e=vt._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),i=new Ce("main","worker",t),n=()=>{s.abort(),i.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},s=new AbortController;t.addEventListener("error",()=>{this._webWorker||n()},{signal:s.signal}),i.on("test",a=>{s.abort(),!this.destroyed&&a?(this._messageHandler=i,this._port=t,this._webWorker=t,this.#n()):n()}),i.on("ready",a=>{if(s.abort(),this.destroyed)n();else try{o()}catch{this._setupFakeWorker()}});const o=()=>{const a=new Uint8Array;i.send("test",a,[a.buffer])};return void o()}catch{$e("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){vt.#e||(U("Setting up fake worker."),vt.#e=!0),vt._setupFakeWorkerGlobal.then(e=>{if(this.destroyed)return void this._readyCapability.reject(new Error("Worker was destroyed"));const t=new ar;this._port=t;const i="fake"+vt.#t++,n=new Ce(i+"_worker",i,t);e.setup(n,t),this._messageHandler=new Ce(i,i+"_worker",t),this.#n()}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this._webWorker?.terminate(),this._webWorker=null,vt.#i?.delete(this._port),this._port=null,this._messageHandler?.destroy(),this._messageHandler=null}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const t=this.#i?.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new vt(e)}static get workerSrc(){if(we.workerSrc)return we.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#r(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){var e=this;return W(this,"_setupFakeWorkerGlobal",function(){var i=(0,E.A)(function*(){return e.#r?e.#r:(yield import(e.workerSrc)).WorkerMessageHandler});return function(){return i.apply(this,arguments)}}()())}}class lr{#t=new Map;#e=new Map;#i=new Map;#n=new Map;#r=null;constructor(e,t,i,n,s){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new wn,this.fontLoader=new ds({ownerDocument:n.ownerDocument,styleElement:n.styleElement}),this.loadingParams=n.loadingParams,this._params=n,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.wasmFactory=s.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#s(e,t=null){const i=this.#t.get(e);if(i)return i;const n=this.messageHandler.sendWithPromise(e,t);return this.#t.set(e,n),n}get annotationStorage(){return W(this,"annotationStorage",new gi)}getRenderingIntent(e,t=B.ENABLE,i=null,n=!1,s=!1){let o=2,a=fi;switch(e){case"any":o=1;break;case"display":break;case"print":o=4;break;default:U(`getRenderingIntent - invalid intent: ${e}`)}const l=4&o&&i instanceof Yi?i:this.annotationStorage;switch(t){case B.DISABLE:o+=64;break;case B.ENABLE:break;case B.ENABLE_FORMS:o+=16;break;case B.ENABLE_STORAGE:o+=32,a=l.serializable;break;default:U(`getRenderingIntent - invalid annotationMode: ${t}`)}n&&(o+=128),s&&(o+=256);const{ids:h,hash:d}=l.modifiedIds;return{renderingIntent:o,cacheKey:[o,a.hash,d].join("_"),annotationStorageSerializable:a,modifiedIds:h}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of this.#e.values())e.push(i._destroy());this.#e.clear(),this.#i.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),wt.cleanup(),this._networkStream?.cancelAllRequests(new Xt("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){var e=this;const{messageHandler:t,loadingTask:i}=this;t.on("GetReader",(n,s)=>{pt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=o=>{this._lastProgress={loaded:o.loaded,total:o.total}},s.onPull=()=>{this._fullReader.read().then(function({value:o,done:a}){a?s.close():(pt(o instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(o),1,[o]))}).catch(o=>{s.error(o)})},s.onCancel=o=>{this._fullReader.cancel(o),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("ReaderHeadersReady",function(){var n=(0,E.A)(function*(s){yield e._fullReader.headersReady;const{isStreamingSupported:o,isRangeSupported:a,contentLength:l}=e._fullReader;return(!o||!a)&&(e._lastProgress&&i.onProgress?.(e._lastProgress),e._fullReader.onProgress=h=>{i.onProgress?.({loaded:h.loaded,total:h.total})}),{isStreamingSupported:o,isRangeSupported:a,contentLength:l}});return function(s){return n.apply(this,arguments)}}()),t.on("GetRangeReader",(n,s)=>{pt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const o=this._networkStream.getRangeReader(n.begin,n.end);o?(s.onPull=()=>{o.read().then(function({value:a,done:l}){l?s.close():(pt(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(a),1,[a]))}).catch(a=>{s.error(a)})},s.onCancel=a=>{o.cancel(a),s.ready.catch(l=>{if(!this.destroyed)throw l})}):s.close()}),t.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,i._capability.resolve(new rr(n,this))}),t.on("DocException",n=>{i._capability.reject(St(n))}),t.on("PasswordRequest",n=>{this.#r=Promise.withResolvers();try{if(!i.onPassword)throw St(n);i.onPassword(o=>{o instanceof Error?this.#r.reject(o):this.#r.resolve({password:o})},n.code)}catch(s){this.#r.reject(s)}return this.#r.promise}),t.on("DataLoaded",n=>{i.onProgress?.({loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),t.on("StartRenderPage",n=>{this.destroyed||this.#e.get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),t.on("commonobj",([n,s,o])=>{if(this.destroyed||this.commonObjs.has(n))return null;switch(s){case"Font":if("error"in o){const d=o.error;U(`Error during font loading: ${d}`),this.commonObjs.resolve(n,d);break}const a=this._params.pdfBug&&globalThis.FontInspector?.enabled?(d,u)=>globalThis.FontInspector.fontAdded(d,u):null,l=new us(o,a);this.fontLoader.bind(l).catch(()=>t.sendWithPromise("FontFallback",{id:n})).finally(()=>{!l.fontExtraProperties&&l.data&&(l.data=null),this.commonObjs.resolve(n,l)});break;case"CopyLocalImage":const{imageRef:h}=o;pt(h,"The imageRef must be defined.");for(const d of this.#e.values())for(const[,u]of d.objs)if(u?.ref===h)return u.dataLen?(this.commonObjs.resolve(n,structuredClone(u)),u.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,o);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),t.on("obj",([n,s,o,a])=>{if(this.destroyed)return;const l=this.#e.get(s);if(!l.objs.has(n)){if(0===l._intentStates.size)return void a?.bitmap?.close();switch(o){case"Image":case"Pattern":l.objs.resolve(n,a);break;default:throw new Error(`Got unknown object type ${o}`)}}}),t.on("DocProgress",n=>{this.destroyed||i.onProgress?.({loaded:n.loaded,total:n.total})}),t.on("FetchBinaryData",function(){var n=(0,E.A)(function*(s){if(e.destroyed)throw new Error("Worker was destroyed.");const o=e[s.type];if(!o)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return o.fetch(s)});return function(s){return n.apply(this,arguments)}}())}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&U("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,i=this.#i.get(t);if(i)return i;const n=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(s=>{if(this.destroyed)throw new Error("Transport destroyed");s.refStr&&this.#n.set(s.refStr,e);const o=new or(t,s,this,this._params.pdfBug);return this.#e.set(t,o),o});return this.#i.set(t,n),n}getPageIndex(e){return Ei(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#s("GetFieldObjects")}hasJSActions(){return this.#s("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return"string"!=typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#s("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#s("GetOptionalContentConfig").then(t=>new Ds(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#t.get(e);if(t)return t;const i=this.messageHandler.sendWithPromise(e,null).then(n=>({info:n[0],metadata:n[1]?new Os(n[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(e,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}startCleanup(){var e=this;return(0,E.A)(function*(t=!1){if(!e.destroyed){yield e.messageHandler.sendWithPromise("Cleanup",null);for(const i of e.#e.values())if(!i.cleanup())throw new Error(`startCleanup: Page ${i.pageNumber} is currently rendering.`);e.commonObjs.clear(),t||e.fontLoader.clear(),e.#t.clear(),e.filterFactory.destroy(!0),wt.cleanup()}}).apply(this,arguments)}cachedPageNumber(e){return Ei(e)?this.#n.get(0===e.gen?`${e.num}R`:`${e.num}R${e.gen}`)??null:null}}const Me=Symbol("INITIAL_DATA");class wn{#t=Object.create(null);#e(e){return this.#t[e]||={...Promise.withResolvers(),data:Me}}get(e,t=null){if(t){const n=this.#e(e);return n.promise.then(()=>t(n.data)),null}const i=this.#t[e];if(!i||i.data===Me)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return i.data}has(e){const t=this.#t[e];return!!t&&t.data!==Me}delete(e){const t=this.#t[e];return!(!t||t.data===Me||(delete this.#t[e],0))}resolve(e,t=null){const i=this.#e(e);i.data=t,i.resolve()}clear(){for(const e in this.#t){const{data:t}=this.#t[e];t?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const e in this.#t){const{data:t}=this.#t[e];t!==Me&&(yield[e,t])}}}class cr{#t=null;onContinue=null;onError=null;constructor(e){this.#t=e}get promise(){return this.#t.capability.promise}cancel(e=0){this.#t.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#t.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#t;return e.form||e.canvas&&t?.size>0}}class pe{#t=null;static#e=new WeakSet;constructor({callback:e,params:t,objs:i,commonObjs:n,annotationCanvasMap:s,operatorList:o,pageIndex:a,canvasFactory:l,filterFactory:h,useRequestAnimationFrame:d=!1,pdfBug:u=!1,pageColors:p=null}){this.callback=e,this.params=t,this.objs=i,this.commonObjs=n,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=h,this._pdfBug=u,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===d&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new cr(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(pe.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");pe.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:i,viewport:n,transform:s,background:o}=this.params;this.gfx=new de(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:s,viewport:n,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),pe.#e.delete(this._canvas),e||=new ai(`Rendering cancelled, page ${this._pageIndex+1}`,t),this.callback(e),this.task.onError?.(e)}operatorListChanged(){this.graphicsReady?(this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()):this.graphicsReadyCallback||=this._continueBound}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}_next(){var e=this;return(0,E.A)(function*(){e.cancelled||(e.operatorListIdx=e.gfx.executeOperatorList(e.operatorList,e.operatorListIdx,e._continueBound,e.stepper),e.operatorListIdx===e.operatorList.argsArray.length&&(e.running=!1,e.operatorList.lastChunk&&(e.gfx.endDrawing(),pe.#e.delete(e._canvas),e.callback())))})()}}function Pn(c){return Math.floor(255*Math.max(0,Math.min(1,c))).toString(16).padStart(2,"0")}function Te(c){return Math.max(0,Math.min(255,255*c))}class Sn{static CMYK_G([e,t,i,n]){return["G",1-Math.min(1,.3*e+.59*i+.11*t+n)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return[e=Te(e),e,e]}static G_HTML([e]){const t=Pn(e);return`#${t}${t}${t}`}static RGB_G([e,t,i]){return["G",.3*e+.59*t+.11*i]}static RGB_rgb(e){return e.map(Te)}static RGB_HTML(e){return`#${e.map(Pn).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,i,n]){return["RGB",1-Math.min(1,e+n),1-Math.min(1,i+n),1-Math.min(1,t+n)]}static CMYK_rgb([e,t,i,n]){return[Te(1-Math.min(1,e+n)),Te(1-Math.min(1,i+n)),Te(1-Math.min(1,t+n))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,i]){const n=1-e,s=1-t,o=1-i;return["CMYK",n,s,o,Math.min(n,s,o)]}}class ur{create(e,t,i=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const n=this._createSVG("svg:svg");return n.setAttribute("version","1.1"),i||(n.setAttribute("width",`${e}px`),n.setAttribute("height",`${t}px`)),n.setAttribute("preserveAspectRatio","none"),n.setAttribute("viewBox",`0 0 ${e} ${t}`),n}createElement(e){if("string"!=typeof e)throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){nt("Abstract method `_createSVG` called.")}}class Ke extends ur{_createSVG(e){return document.createElementNS($t,e)}}class Mn{static setupStorage(e,t,i,n,s){const o=n.getValue(t,{value:null});switch(i.name){case"textarea":if(null!==o.value&&(e.textContent=o.value),"print"===s)break;e.addEventListener("input",a=>{n.setValue(t,{value:a.target.value})});break;case"input":if("radio"===i.attributes.type||"checkbox"===i.attributes.type){if(o.value===i.attributes.xfaOn?e.setAttribute("checked",!0):o.value===i.attributes.xfaOff&&e.removeAttribute("checked"),"print"===s)break;e.addEventListener("change",a=>{n.setValue(t,{value:a.target.getAttribute(a.target.checked?"xfaOn":"xfaOff")})})}else{if(null!==o.value&&e.setAttribute("value",o.value),"print"===s)break;e.addEventListener("input",a=>{n.setValue(t,{value:a.target.value})})}break;case"select":if(null!==o.value){e.setAttribute("value",o.value);for(const a of i.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{const l=a.target.options;n.setValue(t,{value:-1===l.selectedIndex?"":l[l.selectedIndex].value})})}}static setAttributes({html:e,element:t,storage:i=null,intent:n,linkService:s}){const{attributes:o}=t,a=e instanceof HTMLAnchorElement;"radio"===o.type&&(o.name=`${o.name}-${n}`);for(const[l,h]of Object.entries(o))if(null!=h)switch(l){case"class":h.length&&e.setAttribute(l,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!a||"href"!==l&&"newWindow"!==l)&&e.setAttribute(l,h)}a&&s.addLinkAttributes(e,o.href,o.newWindow),i&&o.dataId&&this.setupStorage(e,o.dataId,t,i)}static render(e){const t=e.annotationStorage,i=e.linkService,n=e.xfaHtml,s=e.intent||"display",o=document.createElement(n.name);n.attributes&&this.setAttributes({html:o,element:n,intent:s,linkService:i});const a="richText"!==s,l=e.div;if(l.append(o),e.viewport){const u=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=u}a&&l.setAttribute("class","xfaLayer xfaFont");const h=[];if(0===n.children.length){if(n.value){const u=document.createTextNode(n.value);o.append(u),a&&Se.shouldBuildText(n.name)&&h.push(u)}return{textDivs:h}}const d=[[n,-1,o]];for(;d.length>0;){const[u,p,f]=d.at(-1);if(p+1===u.children.length){d.pop();continue}const g=u.children[++d.at(-1)[1]];if(null===g)continue;const{name:m}=g;if("#text"===m){const b=document.createTextNode(g.value);h.push(b),f.append(b);continue}const _=g?.attributes?.xmlns?document.createElementNS(g.attributes.xmlns,m):document.createElement(m);if(f.append(_),g.attributes&&this.setAttributes({html:_,element:g,storage:t,intent:s,linkService:i}),g.children?.length>0)d.push([g,-1,_]);else if(g.value){const b=document.createTextNode(g.value);a&&Se.shouldBuildText(m)&&h.push(b),_.append(b)}}for(const u of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))u.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const ke=1e3,ee=new WeakSet;class Tn{static create(e){switch(e.data.annotationType){case ut.LINK:return new kn(e);case ut.TEXT:return new fr(e);case ut.WIDGET:switch(e.data.fieldType){case"Tx":return new gr(e);case"Btn":return e.data.radioButton?new In(e):e.data.checkBox?new _r(e):new br(e);case"Ch":return new vr(e);case"Sig":return new mr(e)}return new ie(e);case ut.POPUP:return new Pi(e);case ut.FREETEXT:return new Fn(e);case ut.LINE:return new yr(e);case ut.SQUARE:return new xr(e);case ut.CIRCLE:return new Cr(e);case ut.POLYLINE:return new On(e);case ut.CARET:return new wr(e);case ut.INK:return new Si(e);case ut.POLYGON:return new Er(e);case ut.HIGHLIGHT:return new Rn(e);case ut.UNDERLINE:return new Pr(e);case ut.SQUIGGLY:return new Sr(e);case ut.STRIKEOUT:return new Mr(e);case ut.STAMP:return new Dn(e);case ut.FILEATTACHMENT:return new Tr(e);default:return new ht(e)}}}class ht{#t=null;#e=!1;#i=null;constructor(e,{isRenderable:t=!1,ignoreBorder:i=!1,createQuadrilaterals:n=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(i)),n&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:i}){return!!(e?.str||t?.str||i?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return ht._hasPopupData(this.data)}updateEdited(e){if(!this.container)return;this.#t||={rect:this.data.rect.slice(0)};const{rect:t}=e;t&&this.#n(t),this.#i?.popup.updateEdited(e)}resetEdited(){this.#t&&(this.#n(this.#t.rect),this.#i?.popup.resetEdited(),this.#t=null)}#n(e){const{container:{style:t},data:{rect:i,rotation:n},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:o,pageX:a,pageY:l}}}}=this;i?.splice(0,4,...e),t.left=100*(e[0]-a)/s+"%",t.top=100*(o-e[3]+l)/o+"%",0===n?(t.width=100*(e[2]-e[0])/s+"%",t.height=100*(e[3]-e[1])/o+"%"):this.setRotation(n)}_createContainer(e){const{data:t,parent:{page:i,viewport:n}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",t.id),this instanceof ie||(s.tabIndex=ke);const{style:o}=s;if(o.zIndex=this.parent.zIndex++,t.alternativeText&&(s.title=t.alternativeText),t.noRotate&&s.classList.add("norotate"),!t.rect||this instanceof Pi){const{rotation:m}=t;return!t.hasOwnCanvas&&0!==m&&this.setRotation(m,s),s}const{width:a,height:l}=this;if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const m=t.borderStyle.horizontalCornerRadius,_=t.borderStyle.verticalCornerRadius;switch(m>0||_>0?o.borderRadius=`calc(${m}px * var(--total-scale-factor)) / calc(${_}px * var(--total-scale-factor))`:this instanceof In&&(o.borderRadius=`calc(${a}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`),t.borderStyle.style){case 1:o.borderStyle="solid";break;case 2:o.borderStyle="dashed";break;case 3:U("Unimplemented border style: beveled");break;case 4:U("Unimplemented border style: inset");break;case 5:o.borderBottomStyle="solid"}const b=t.borderColor||null;b?(this.#e=!0,o.borderColor=D.makeHexColor(0|b[0],0|b[1],0|b[2])):o.borderWidth=0}const h=D.normalizeRect([t.rect[0],i.view[3]-t.rect[1]+i.view[1],t.rect[2],i.view[3]-t.rect[3]+i.view[1]]),{pageWidth:d,pageHeight:u,pageX:p,pageY:f}=n.rawDims;o.left=100*(h[0]-p)/d+"%",o.top=100*(h[1]-f)/u+"%";const{rotation:g}=t;return t.hasOwnCanvas||0===g?(o.width=100*a/d+"%",o.height=100*l/u+"%"):this.setRotation(g,s),s}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:n}=this.parent.viewport.rawDims;let{width:s,height:o}=this;e%180!=0&&([s,o]=[o,s]),t.style.width=100*s/i+"%",t.style.height=100*o/n+"%",t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,i,n)=>{const s=n.detail[t],o=s[0],a=s.slice(1);n.target.style[i]=Sn[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[i]:Sn[`${o}_rgb`](a)})};return W(this,"_commonActions",{display:t=>{const{display:i}=t.detail,n=i%2==1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:1===i||2===i})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:i}=t.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const i=t.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(e,t){const i=this._commonActions;for(const n of Object.keys(t.detail))(e[n]||i[n])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const i=this._commonActions;for(const[n,s]of Object.entries(t)){const o=i[n];o&&(o({detail:{[n]:s},target:e}),delete t[n])}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,i,n,s]=this.data.rect.map(m=>Math.fround(m));if(8===e.length){const[m,_,b,v]=e.subarray(2,6);if(n===m&&s===_&&t===b&&i===v)return}const{style:o}=this.container;let a;if(this.#e){const{borderColor:m,borderWidth:_}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${m}" stroke-width="${_}">`],this.container.classList.add("hasBorder")}const l=n-t,h=s-i,{svgFactory:d}=this,u=d.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0);const p=d.createElement("defs");u.append(p);const f=d.createElement("clipPath"),g=`clippath_${this.data.id}`;f.setAttribute("id",g),f.setAttribute("clipPathUnits","objectBoundingBox"),p.append(f);for(let m=2,_=e.length;m<_;m+=8){const b=e[m],v=e[m+1],y=e[m+2],x=e[m+3],A=d.createElement("rect"),w=(y-t)/l,C=(s-v)/h,P=(b-y)/l,S=(v-x)/h;A.setAttribute("x",w),A.setAttribute("y",C),A.setAttribute("width",P),A.setAttribute("height",S),f.append(A),a?.push(`<rect vector-effect="non-scaling-stroke" x="${w}" y="${C}" width="${P}" height="${S}"/>`)}this.#e&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(u),this.container.style.clipPath=`url(#${g})`}_createPopup(){const{data:e}=this,t=this.#i=new Pi({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]});this.parent.div.append(t.render())}render(){nt("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const i=[];if(this._fieldObjects){const n=this._fieldObjects[e];if(n)for(const{page:s,id:o,exportValues:a}of n){if(-1===s||o===t)continue;const l="string"==typeof a?a:null,h=document.querySelector(`[data-element-id="${o}"]`);!h||ee.has(h)?i.push({id:o,exportValue:l,domElement:h}):U(`_getElementsByName - element not allowed: ${o}`)}return i}for(const n of document.getElementsByName(e)){const{exportValue:s}=n,o=n.getAttribute("data-element-id");o!==t&&ee.has(n)&&i.push({id:o,exportValue:s,domElement:n})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class kn extends ht{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,i=document.createElement("a");i.setAttribute("data-element-id",e.id);let n=!1;return e.url?(t.addLinkAttributes(i,e.url,e.newWindow),n=!0):e.action?(this._bindNamedAction(i,e.action),n=!0):e.attachment?(this.#e(i,e.attachment,e.attachmentDest),n=!0):e.setOCGState?(this.#i(i,e.setOCGState),n=!0):e.dest?(this._bindLink(i,e.dest),n=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),n=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(i,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(i),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||""===t)&&this.#t()}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),this.#t()}#e(e,t,i=null){e.href=this.linkService.getAnchorUrl(""),t.description&&(e.title=t.description),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,i),!1),this.#t()}#i(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),this.#t()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(t.actions)){const s=i.get(n);s&&(e[s]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:n}}),!1))}e.onclick||(e.onclick=()=>!1),this.#t()}_bindResetFormAction(e,t){const i=e.onclick;if(i||(e.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects)return U('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(i||(e.onclick=()=>!1));e.onclick=()=>{i?.();const{fields:n,refs:s,include:o}=t,a=[];if(0!==n.length||0!==s.length){const d=new Set(s);for(const u of n){const p=this._fieldObjects[u]||[];for(const{id:f}of p)d.add(f)}for(const u of Object.values(this._fieldObjects))for(const p of u)d.has(p.id)===o&&a.push(p)}else for(const d of Object.values(this._fieldObjects))a.push(...d);const l=this.annotationStorage,h=[];for(const d of a){const{id:u}=d;switch(h.push(u),d.type){case"text":case"combobox":case"listbox":l.setValue(u,{value:d.defaultValue||""});break;case"checkbox":case"radiobutton":l.setValue(u,{value:d.defaultValue===d.exportValues});break;default:continue}const p=document.querySelector(`[data-element-id="${u}"]`);p&&(ee.has(p)?p.dispatchEvent(new Event("resetform")):U(`_bindResetFormAction - element not allowed: ${u}`))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}}),!1}}}class fr extends ht{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class ie extends ht{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&("CANVAS"===e.previousSibling?.nodeName&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return At.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,i,n,s){i.includes("mouse")?e.addEventListener(i,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:s(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(i,o=>{if("blur"===i){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if("focus"===i){if(t.focused)return;t.focused=!0}s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:s(o)}})})}_setEventListeners(e,t,i,n){for(const[s,o]of i)("Action"===o||this.data.actions?.[o])&&(("Focus"===o||"Blur"===o)&&(t||={focused:!1}),this._setEventListener(e,t,s,o,n),"Focus"!==o||this.data.actions?.Blur?"Blur"===o&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null):this._setEventListener(e,t,"blur","Blur",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=null===t?"transparent":D.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const{fontColor:i}=this.data.defaultAppearanceData,n=this.data.defaultAppearanceData.fontSize||9,s=e.style;let o;const l=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-2),d=Math.round(h/(G*n))||1;o=Math.min(n,l(h/d/G))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-2);o=Math.min(n,l(h/G))}s.fontSize=`calc(${o}px * var(--total-scale-factor))`,s.color=D.makeHexColor(i[0],i[1],i[2]),null!==this.data.textAlignment&&(s.textAlign=["left","center","right"][this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class gr extends ie{constructor(e){super(e,{isRenderable:e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue})}setPropertyOnSiblings(e,t,i,n){const s=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=i),s.setValue(o.id,{[n]:i})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const n=e.getValue(t,{value:this.data.fieldValue});let s=n.value||"";const o=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;o&&s.length>o&&(s=s.slice(0,o));let a=n.formattedValue||this.data.textContent?.join("\n")||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const l={userValue:s,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=a??s,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type=this.data.password?"password":"text",i.setAttribute("value",a??s),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),ee.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=ke,this._setRequired(i,this.data.required),o&&(i.maxLength=o),i.addEventListener("input",d=>{e.setValue(t,{value:d.target.value}),this.setPropertyOnSiblings(i,"value",d.target.value,"value"),l.formattedValue=null}),i.addEventListener("resetform",d=>{i.value=l.userValue=this.data.defaultFieldValue??"",l.formattedValue=null});let h=d=>{const{formattedValue:u}=l;null!=u&&(d.target.value=u),d.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",u=>{if(l.focused)return;const{target:p}=u;l.userValue&&(p.value=l.userValue),l.lastCommittedValue=p.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),i.addEventListener("updatefromsandbox",u=>{this.showElementAndHideCanvas(u.target),this._dispatchEventFromSandbox({value(f){l.userValue=f.detail.value??"",e.setValue(t,{value:l.userValue.toString()}),f.target.value=l.userValue},formattedValue(f){const{formattedValue:g}=f.detail;l.formattedValue=g,null!=g&&f.target!==document.activeElement&&(f.target.value=g),e.setValue(t,{formattedValue:g})},selRange(f){f.target.setSelectionRange(...f.detail.selRange)},charLimit:f=>{const{charLimit:g}=f.detail,{target:m}=f;if(0===g)return void m.removeAttribute("maxLength");m.setAttribute("maxLength",g);let _=l.userValue;!_||_.length<=g||(_=_.slice(0,g),m.value=l.userValue=_,e.setValue(t,{value:_}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:_,willCommit:!0,commitKey:1,selStart:m.selectionStart,selEnd:m.selectionEnd}}))}},u)}),i.addEventListener("keydown",u=>{l.commitKey=1;let p=-1;if("Escape"===u.key?p=0:"Enter"!==u.key||this.data.multiLine?"Tab"===u.key&&(l.commitKey=3):p=2,-1===p)return;const{value:f}=u.target;l.lastCommittedValue!==f&&(l.lastCommittedValue=f,l.userValue=f,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:f,willCommit:!0,commitKey:p,selStart:u.target.selectionStart,selEnd:u.target.selectionEnd}}))});const d=h;h=null,i.addEventListener("blur",u=>{if(!l.focused||!u.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);const{value:p}=u.target;l.userValue=p,l.lastCommittedValue!==p&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:p,willCommit:!0,commitKey:l.commitKey,selStart:u.target.selectionStart,selEnd:u.target.selectionEnd}}),d(u)}),this.data.actions?.Keystroke&&i.addEventListener("beforeinput",u=>{l.lastCommittedValue=null;const{data:p,target:f}=u,{value:g,selectionStart:m,selectionEnd:_}=f;let b=m,v=_;switch(u.inputType){case"deleteWordBackward":{const y=g.substring(0,m).match(/\w*[^\w]*$/);y&&(b-=y[0].length);break}case"deleteWordForward":{const y=g.substring(m).match(/^[^\w]*\w*/);y&&(v+=y[0].length);break}case"deleteContentBackward":m===_&&(b-=1);break;case"deleteContentForward":m===_&&(v+=1)}u.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:g,change:p||"",willCommit:!1,selStart:b,selEnd:v}})}),this._setEventListeners(i,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],u=>u.target.value)}if(h&&i.addEventListener("blur",h),this.data.comb){const u=(this.data.rect[2]-this.data.rect[0])/o;i.classList.add("comb"),i.style.letterSpacing=`calc(${u}px * var(--total-scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class mr extends ie{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class _r extends ie{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,i=t.id;let n=e.getValue(i,{value:t.exportValue===t.fieldValue}).value;"string"==typeof n&&(n="Off"!==n,e.setValue(i,{value:n})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return ee.add(s),s.setAttribute("data-element-id",i),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=t.fieldName,n&&s.setAttribute("checked",!0),s.setAttribute("exportValue",t.exportValue),s.tabIndex=ke,s.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const h of this._getElementsByName(a,i)){const d=l&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=d),e.setValue(h.id,{value:d})}e.setValue(i,{value:l})}),s.addEventListener("resetform",o=>{o.target.checked=(t.defaultFieldValue||"Off")===t.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",o=>{this._dispatchEventFromSandbox({value(l){l.target.checked="Off"!==l.detail.value,e.setValue(i,{value:l.target.checked})}},o)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class In extends ie{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,i=t.id;let n=e.getValue(i,{value:t.fieldValue===t.buttonValue}).value;if("string"==typeof n&&(n=n!==t.buttonValue,e.setValue(i,{value:n})),n)for(const o of this._getElementsByName(t.fieldName,i))e.setValue(o.id,{value:!1});const s=document.createElement("input");if(ee.add(s),s.setAttribute("data-element-id",i),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=t.fieldName,n&&s.setAttribute("checked",!0),s.tabIndex=ke,s.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const h of this._getElementsByName(a,i))e.setValue(h.id,{value:!1});e.setValue(i,{value:l})}),s.addEventListener("resetform",o=>{const a=t.defaultFieldValue;o.target.checked=null!=a&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;s.addEventListener("updatefromsandbox",a=>{this._dispatchEventFromSandbox({value:h=>{const d=o===h.detail.value;for(const u of this._getElementsByName(h.target.name)){const p=d&&u.id===i;u.domElement&&(u.domElement.checked=p),e.setValue(u.id,{value:p})}}},a)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class br extends kn{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),e}}class vr extends ie{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,i=e.getValue(t,{value:this.data.fieldValue}),n=document.createElement("select");ee.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,this._setRequired(n,this.data.required),n.name=this.data.fieldName,n.tabIndex=ke;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(n.size=this.data.options.length,this.data.multiSelect&&(n.multiple=!0)),n.addEventListener("resetform",d=>{const u=this.data.defaultFieldValue;for(const p of n.options)p.selected=p.value===u});for(const d of this.data.options){const u=document.createElement("option");u.textContent=d.displayValue,u.value=d.exportValue,i.value.includes(d.exportValue)&&(u.setAttribute("selected",!0),s=!1),n.append(u)}let o=null;if(s){const d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),n.prepend(d),o=()=>{d.remove(),n.removeEventListener("input",o),o=null},n.addEventListener("input",o)}const a=d=>{const u=d?"value":"textContent",{options:p,multiple:f}=n;return f?Array.prototype.filter.call(p,g=>g.selected).map(g=>g[u]):-1===p.selectedIndex?null:p[p.selectedIndex][u]};let l=a(!1);const h=d=>Array.prototype.map.call(d.target.options,p=>({displayValue:p.textContent,exportValue:p.value}));return this.enableScripting&&this.hasJSActions?(n.addEventListener("updatefromsandbox",d=>{this._dispatchEventFromSandbox({value(p){o?.();const f=p.detail.value,g=new Set(Array.isArray(f)?f:[f]);for(const m of n.options)m.selected=g.has(m.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(p){n.multiple=!0},remove(p){const f=n.options,g=p.detail.remove;f[g].selected=!1,n.remove(g),f.length>0&&-1===Array.prototype.findIndex.call(f,_=>_.selected)&&(f[0].selected=!0),e.setValue(t,{value:a(!0),items:h(p)}),l=a(!1)},clear(p){for(;0!==n.length;)n.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(p){const{index:f,displayValue:g,exportValue:m}=p.detail.insert,_=n.children[f],b=document.createElement("option");b.textContent=g,b.value=m,_?_.before(b):n.append(b),e.setValue(t,{value:a(!0),items:h(p)}),l=a(!1)},items(p){const{items:f}=p.detail;for(;0!==n.length;)n.remove(0);for(const g of f){const{displayValue:m,exportValue:_}=g,b=document.createElement("option");b.textContent=m,b.value=_,n.append(b)}n.options.length>0&&(n.options[0].selected=!0),e.setValue(t,{value:a(!0),items:h(p)}),l=a(!1)},indices(p){const f=new Set(p.detail.indices);for(const g of p.target.options)g.selected=f.has(g.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(p){p.target.disabled=!p.detail.editable}},d)}),n.addEventListener("input",d=>{const u=a(!0),p=a(!1);e.setValue(t,{value:u}),d.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:p,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(n,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):n.addEventListener("input",function(d){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Pi extends ht{constructor(e){const{data:t,elements:i}=e;super(e,{isRenderable:ht._hasPopupData(t)}),this.elements=i,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new Ar({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",t.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(i=>`${ri}${i}`).join(",")),this.container}}class Ar{#t=this.#S.bind(this);#e=this.#P.bind(this);#i=this.#M.bind(this);#n=this.#x.bind(this);#r=null;#s=null;#l=null;#a=null;#d=null;#c=null;#u=null;#h=!1;#p=null;#o=null;#f=null;#m=null;#g=null;#_=null;#b=!1;constructor({container:e,color:t,elements:i,titleObj:n,modificationDate:s,contentsObj:o,richText:a,parent:l,rect:h,parentRect:d,open:u}){this.#s=e,this.#g=n,this.#l=o,this.#m=a,this.#c=l,this.#r=t,this.#f=h,this.#u=d,this.#d=i,this.#a=Hi.toDateObject(s),this.trigger=i.flatMap(p=>p.getElementsToTriggerPopup());for(const p of this.trigger)p.addEventListener("click",this.#n),p.addEventListener("mouseenter",this.#i),p.addEventListener("mouseleave",this.#e),p.classList.add("popupTriggerArea");for(const p of i)p.container?.addEventListener("keydown",this.#t);this.#s.hidden=!0,u&&this.#x()}render(){if(this.#p)return;const e=this.#p=document.createElement("div");if(e.className="popup",this.#r){const s=e.style.outlineColor=D.makeHexColor(...this.#r);e.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`}const t=document.createElement("span");t.className="header";const i=document.createElement("h1");if(t.append(i),({dir:i.dir,str:i.textContent}=this.#g),e.append(t),this.#a){const s=document.createElement("span");s.classList.add("popupDate"),s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#a.valueOf()})),t.append(s)}const n=this.#v;if(n)Mn.render({xfaHtml:n,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const s=this._formatContents(this.#l);e.append(s)}this.#s.append(e)}get#v(){const e=this.#m,t=this.#l;return e?.str&&(!t?.str||t.str===e.str)&&this.#m.html||null}get#y(){return this.#v?.attributes?.style?.fontSize||0}get#C(){return this.#v?.attributes?.style?.color||null}#w(e){const t=[],i={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},n={style:{color:this.#C,fontSize:this.#y?`calc(${this.#y}px * var(--total-scale-factor))`:""}};for(const s of e.split("\n"))t.push({name:"span",value:s,attributes:n});return i}_formatContents({str:e,dir:t}){const i=document.createElement("p");i.classList.add("popupContent"),i.dir=t;const n=e.split(/(?:\r\n?|\n)/);for(let s=0,o=n.length;s<o;++s)i.append(document.createTextNode(n[s])),s<o-1&&i.append(document.createElement("br"));return i}#S(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||("Enter"===e.key||"Escape"===e.key&&this.#h)&&this.#x()}updateEdited({rect:e,popupContent:t}){this.#_||={contentsObj:this.#l,richText:this.#m},e&&(this.#o=null),t&&(this.#m=this.#w(t),this.#l=null),this.#p?.remove(),this.#p=null}resetEdited(){this.#_&&(({contentsObj:this.#l,richText:this.#m}=this.#_),this.#_=null,this.#p?.remove(),this.#p=null,this.#o=null)}#T(){if(null!==this.#o)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:i,pageX:n,pageY:s}}}=this.#c;let o=!!this.#u,a=o?this.#u:this.#f;for(const g of this.#d)if(!a||null!==D.intersect(g.data.rect,a)){a=g.data.rect,o=!0;break}const l=D.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]);this.#o=[100*(l[0]+(o?a[2]-a[0]+5:0)-n)/t,100*(l[1]-s)/i];const{style:f}=this.#s;f.left=`${this.#o[0]}%`,f.top=`${this.#o[1]}%`}#x(){this.#h=!this.#h,this.#h?(this.#M(),this.#s.addEventListener("click",this.#n),this.#s.addEventListener("keydown",this.#t)):(this.#P(),this.#s.removeEventListener("click",this.#n),this.#s.removeEventListener("keydown",this.#t))}#M(){this.#p||this.render(),this.isVisible?this.#h&&this.#s.classList.add("focused"):(this.#T(),this.#s.hidden=!1,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)+1e3)}#P(){this.#s.classList.remove("focused"),!this.#h&&this.isVisible&&(this.#s.hidden=!0,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)-1e3)}forceHide(){this.#b=this.isVisible,this.#b&&(this.#s.hidden=!0)}maybeShow(){this.#b&&(this.#p||this.#M(),this.#b=!1,this.#s.hidden=!1)}get isVisible(){return!1===this.#s.hidden}}class Fn extends ht{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=T.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const i=document.createElement("span");i.textContent=t,e.append(i)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class yr extends ht{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:e,width:t,height:i}=this,n=this.svgFactory.create(t,i,!0),s=this.#t=this.svgFactory.createElement("svg:line");return s.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),s.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),s.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),s.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),s.setAttribute("stroke-width",e.borderStyle.width||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),n.append(s),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class xr extends ht{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:e,width:t,height:i}=this,n=this.svgFactory.create(t,i,!0),s=e.borderStyle.width,o=this.#t=this.svgFactory.createElement("svg:rect");return o.setAttribute("x",s/2),o.setAttribute("y",s/2),o.setAttribute("width",t-s),o.setAttribute("height",i-s),o.setAttribute("stroke-width",s||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Cr extends ht{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:e,width:t,height:i}=this,n=this.svgFactory.create(t,i,!0),s=e.borderStyle.width,o=this.#t=this.svgFactory.createElement("svg:ellipse");return o.setAttribute("cx",t/2),o.setAttribute("cy",i/2),o.setAttribute("rx",t/2-s/2),o.setAttribute("ry",i/2-s/2),o.setAttribute("stroke-width",s||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class On extends ht{#t=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:i,popupRef:n},width:s,height:o}=this;if(!t)return this.container;const a=this.svgFactory.create(s,o,!0);let l=[];for(let d=0,u=t.length;d<u;d+=2)l.push(`${t[d]-e[0]},${e[3]-t[d+1]}`);l=l.join(" ");const h=this.#t=this.svgFactory.createElement(this.svgElementName);return h.setAttribute("points",l),h.setAttribute("stroke-width",i.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),a.append(h),this.container.append(a),!n&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Er extends On{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class wr extends ht{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Si extends ht{#t=null;#e=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType="InkHighlight"===this.data.it?T.HIGHLIGHT:T.INK}#i(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:t,inkLists:i,borderStyle:n,popupRef:s}}=this,{transform:o,width:a,height:l}=this.#i(t,e),h=this.svgFactory.create(a,l,!0),d=this.#t=this.svgFactory.createElement("svg:g");h.append(d),d.setAttribute("stroke-width",n.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",o);for(let u=0,p=i.length;u<p;u++){const f=this.svgFactory.createElement(this.svgElementName);this.#e.push(f),f.setAttribute("points",i[u].join(",")),d.append(f)}return!s&&this.hasPopupData&&this._createPopup(),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:t,points:i,rect:n}=e,s=this.#t;if(t>=0&&s.setAttribute("stroke-width",t||1),i)for(let o=0,a=this.#e.length;o<a;o++)this.#e[o].setAttribute("points",i[o].join(","));if(n){const{transform:o,width:a,height:l}=this.#i(this.data.rotation,n);s.parentElement.setAttribute("viewBox",`0 0 ${a} ${l}`),s.setAttribute("transform",o)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Rn extends ht{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=T.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class Pr extends ht{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Sr extends ht{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Mr extends ht{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Dn extends ht{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=T.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Tr extends ht{#t=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let i;t.hasAppearance||0===t.fillAlpha?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(100*t.fillAlpha)}%);`)),i.addEventListener("dblclick",this.#e.bind(this)),this.#t=i;const{isMac:n}=At.platform;return e.addEventListener("keydown",s=>{"Enter"===s.key&&(n?s.metaKey:s.ctrlKey)&&this.#e()}),!t.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),e.append(i),e}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Mi{#t=null;#e=null;#i=new Map;#n=null;constructor({div:e,accessibilityManager:t,annotationCanvasMap:i,annotationEditorUIManager:n,page:s,viewport:o,structTreeLayer:a}){this.div=e,this.#t=t,this.#e=i,this.#n=a||null,this.page=s,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=n}hasEditableAnnotations(){return this.#i.size>0}#r(e,t){var i=this;return(0,E.A)(function*(){const n=e.firstChild||e,s=n.id=`${ri}${t}`,o=yield i.#n?.getAriaAttributes(s);if(o)for(const[a,l]of o)n.setAttribute(a,l);i.div.append(e),i.#t?.moveElementInDOM(i.div,e,n,!1)})()}render(e){var t=this;return(0,E.A)(function*(){const{annotations:i}=e,n=t.div;te(n,t.viewport);const s=new Map,o={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new Ke,annotationStorage:e.annotationStorage||new gi,enableScripting:!0===e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:t,elements:null};for(const a of i){if(a.noHTML)continue;const l=a.annotationType===ut.POPUP;if(l){const u=s.get(a.id);if(!u)continue;o.elements=u}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;o.data=a;const h=Tn.create(o);if(!h.isRenderable)continue;if(!l&&a.popupRef){const u=s.get(a.popupRef);u?u.push(h):s.set(a.popupRef,[h])}const d=h.render();a.hidden&&(d.style.visibility="hidden"),yield t.#r(d,a.id),h._isEditable&&(t.#i.set(h.data.id,h),t._annotationEditorUIManager?.renderAnnotationElement(h))}t.#s()})()}addLinkAnnotations(e,t){var i=this;return(0,E.A)(function*(){const n={data:null,layer:i.div,linkService:t,svgFactory:new Ke,parent:i};for(const s of e){s.borderStyle||=Mi._defaultBorderStyle,n.data=s;const o=Tn.create(n);if(!o.isRenderable)continue;const a=o.render();yield i.#r(a,s.id)}})()}update({viewport:e}){const t=this.div;this.viewport=e,te(t,{rotation:e.rotation}),this.#s(),t.hidden=!1}#s(){if(!this.#e)return;const e=this.div;for(const[t,i]of this.#e){const n=e.querySelector(`[data-annotation-id="${t}"]`);if(!n)continue;i.className="annotationContent";const{firstChild:s}=n;s?"CANVAS"===s.nodeName?s.replaceWith(i):s.classList.contains("annotationContent")?s.after(i):s.before(i):n.append(i);const o=this.#i.get(t);o&&(o._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(t,n.id,i),o._hasNoCanvas=!1):o.canvas=i)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(e){return this.#i.get(e)}static get _defaultBorderStyle(){return W(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:1,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const Je=/\r\n?|\n/g;class _t extends j{#t;#e="";#i=`${this.id}-editor`;#n=null;#r;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=_t.prototype,t=s=>s.isEmpty(),i=xe.TRANSLATE_SMALL,n=xe.TRANSLATE_BIG;return W(this,"_keyboardManager",new ye([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[n,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,n],checker:t}]]))}static _type="freetext";static _editorType=T.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.#t=e.color||_t._defaultColor||j._defaultLineColor,this.#r=e.fontSize||_t._defaultFontSize}static initialize(e,t){j.initialize(e,t);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case z.FREETEXT_SIZE:_t._defaultFontSize=t;break;case z.FREETEXT_COLOR:_t._defaultColor=t}}updateParams(e,t){switch(e){case z.FREETEXT_SIZE:this.#s(t);break;case z.FREETEXT_COLOR:this.#l(t)}}static get defaultPropertiesToUpdate(){return[[z.FREETEXT_SIZE,_t._defaultFontSize],[z.FREETEXT_COLOR,_t._defaultColor||j._defaultLineColor]]}get propertiesToUpdate(){return[[z.FREETEXT_SIZE,this.#r],[z.FREETEXT_COLOR,this.#t]]}#s(e){const t=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--total-scale-factor))`,this.translate(0,-(n-this.#r)*this.parentScale),this.#r=n,this.#d()},i=this.#r;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:z.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#l(e){const t=n=>{this.#t=this.editorDiv.style.color=n},i=this.#t;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:z.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-_t._internalPadding*e,-(_t._internalPadding+this.#r)*e]}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(T.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#n=new AbortController;const e=this._uiManager.combinedSignal(this.#n);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#i),this._isDraggable=!0,this.#n?.abort(),this.#n=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#a(){const e=[];this.editorDiv.normalize();let t=null;for(const i of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&"BR"===i.nodeName||(e.push(_t.#c(i)),t=i);return e.join("\n")}#d(){const[e,t]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:n,div:s}=this,o=s.style.display,a=s.classList.contains("hidden");s.classList.remove("hidden"),s.style.display="hidden",n.div.append(this.div),i=s.getBoundingClientRect(),s.remove(),s.style.display=o,s.classList.toggle("hidden",a)}this.rotation%180==this.parentRotation%180?(this.width=i.width/e,this.height=i.height/t):(this.width=i.height/e,this.height=i.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#e,t=this.#e=this.#a().trimEnd();if(e===t)return;const i=n=>{this.#e=n,n?(this.#u(),this._uiManager.rebuild(this),this.#d()):this.remove()};this.addCommands({cmd:()=>{i(t)},undo:()=>{i(e)},mustExec:!1}),this.#d()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&"Enter"===e.key&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){_t._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,t;(this._isCopy||this.annotationElementId)&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#i),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#r}px * var(--total-scale-factor))`,i.color=this.#t,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),di(this,this.div,["dblclick","keydown"]),this._isCopy||this.annotationElementId){const[n,s]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[a,l]=this.getInitialTranslation();[a,l]=this.pageTranslationToScreen(a,l);const[h,d]=this.pageDimensions,[u,p]=this.pageTranslation;let f,g;switch(this.rotation){case 0:f=e+(o[0]-u)/h,g=t+this.height-(o[1]-p)/d;break;case 90:f=e+(o[0]-u)/h,g=t-(o[1]-p)/d,[a,l]=[l,-a];break;case 180:f=e-this.width+(o[0]-u)/h,g=t-(o[1]-p)/d,[a,l]=[-a,-l];break;case 270:f=e+(o[0]-u-this.height*d)/h,g=t+(o[1]-p-this.width*h)/d,[a,l]=[-l,a]}this.setAt(f*n,g*s,a,l)}else this._moveAfterPaste(e,t);this.#u(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Je,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:i}=t;if(1===i.length&&"text/plain"===i[0])return;e.preventDefault();const n=_t.#p(t.getData("text")||"").replaceAll(Je,"\n");if(!n)return;const s=window.getSelection();if(!s.rangeCount)return;this.editorDiv.normalize(),s.deleteFromDocument();const o=s.getRangeAt(0);if(!n.includes("\n"))return o.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),void s.collapseToStart();const{startContainer:a,startOffset:l}=o,h=[],d=[];if(a.nodeType===Node.TEXT_NODE){const f=a.parentElement;if(d.push(a.nodeValue.slice(l).replaceAll(Je,"")),f!==this.editorDiv){let g=h;for(const m of this.editorDiv.childNodes)m!==f?g.push(_t.#c(m)):g=d}h.push(a.nodeValue.slice(0,l).replaceAll(Je,""))}else if(a===this.editorDiv){let f=h,g=0;for(const m of this.editorDiv.childNodes)g++===l&&(f=d),f.push(_t.#c(m))}this.#e=`${h.join("\n")}${n}${d.join("\n")}`,this.#u();const u=new Range;let p=Math.sumPrecise(h.map(f=>f.length));for(const{firstChild:f}of this.editorDiv.childNodes)if(f.nodeType===Node.TEXT_NODE){const g=f.nodeValue.length;if(p<=g){u.setStart(f,p),u.setEnd(f,p);break}p-=g}s.removeAllRanges(),s.addRange(u)}#u(){if(this.editorDiv.replaceChildren(),this.#e)for(const e of this.#e.split("\n")){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#h(){return this.#e.replaceAll("\xa0"," ")}static#p(e){return e.replaceAll(" ","\xa0")}get contentDiv(){return this.editorDiv}static deserialize(e,t,i){var n=()=>super.deserialize,s=this;return(0,E.A)(function*(){let o=null;if(e instanceof Fn){const{data:{defaultAppearanceData:{fontSize:l,fontColor:h},rect:d,rotation:u,id:p,popupRef:f},textContent:g,textPosition:m,parent:{page:{pageNumber:_}}}=e;if(!g||0===g.length)return null;o=e={annotationType:T.FREETEXT,color:Array.from(h),fontSize:l,value:g.join("\n"),position:m,pageIndex:_-1,rect:d.slice(0),rotation:u,id:p,deleted:!1,popupRef:f}}const a=yield n().call(s,e,t,i);return a.#r=e.fontSize,a.#t=D.makeHexColor(...e.color),a.#e=_t.#p(e.value),a.annotationElementId=e.id||null,a._initialData=o,a})()}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=_t._internalPadding*this.parentScale,i=this.getRect(t,t),n=j._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#t),s={annotationType:T.FREETEXT,color:n,fontSize:this.#r,value:this.#h(),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(s.isCopy=!0,s):this.annotationElementId&&!this.#o(s)?null:(s.id=this.annotationElementId,s)}#o(e){const{value:t,fontSize:i,color:n,pageIndex:s}=this._initialData;return this._hasBeenMoved||e.value!==t||e.fontSize!==i||e.color.some((o,a)=>o!==n[a])||e.pageIndex!==s}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(this.deleted)return t;const{style:i}=t;i.fontSize=`calc(${this.#r}px * var(--total-scale-factor))`,i.color=this.#t,t.replaceChildren();for(const s of this.#e.split("\n")){const o=document.createElement("div");o.append(s?document.createTextNode(s):document.createElement("br")),t.append(o)}const n=_t._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(n,n),popupContent:this.#e}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}let I=(()=>class c{static PRECISION=1e-4;toSVGPath(){nt("Abstract method `toSVGPath` must be implemented.")}get box(){nt("Abstract getter `box` must be implemented.")}serialize(t,i){nt("Abstract method `serialize` must be implemented.")}static _rescale(t,i,n,s,o,a){a||=new Float32Array(t.length);for(let l=0,h=t.length;l<h;l+=2)a[l]=i+t[l]*s,a[l+1]=n+t[l+1]*o;return a}static _rescaleAndSwap(t,i,n,s,o,a){a||=new Float32Array(t.length);for(let l=0,h=t.length;l<h;l+=2)a[l]=i+t[l+1]*s,a[l+1]=n+t[l]*o;return a}static _translate(t,i,n,s){s||=new Float32Array(t.length);for(let o=0,a=t.length;o<a;o+=2)s[o]=i+t[o],s[o+1]=n+t[o+1];return s}static svgRound(t){return Math.round(1e4*t)}static _normalizePoint(t,i,n,s,o){switch(o){case 90:return[1-i/n,t/s];case 180:return[1-t/n,1-i/s];case 270:return[i/n,1-t/s];default:return[t/n,i/s]}}static _normalizePagePoint(t,i,n){switch(n){case 90:return[1-i,t];case 180:return[1-t,1-i];case 270:return[i,1-t];default:return[t,i]}}static createBezierPoints(t,i,n,s,o,a){return[(t+5*n)/6,(i+5*s)/6,(5*n+o)/6,(5*s+a)/6,(n+o)/2,(s+a)/2]}})();class ne{#t;#e=[];#i;#n;#r=[];#s=new Float32Array(18);#l;#a;#d;#c;#u;#h;#p=[];static#o=8;static#f=2;static#m=ne.#o+ne.#f;constructor({x:e,y:t},i,n,s,o,a=0){this.#t=i,this.#h=s*n,this.#n=o,this.#s.set([NaN,NaN,NaN,NaN,e,t],6),this.#i=a,this.#c=ne.#o*n,this.#d=ne.#m*n,this.#u=n,this.#p.push(e,t)}isEmpty(){return isNaN(this.#s[8])}#g(){const e=this.#s.subarray(4,6),t=this.#s.subarray(16,18),[i,n,s,o]=this.#t;return[(this.#l+(e[0]-t[0])/2-i)/s,(this.#a+(e[1]-t[1])/2-n)/o,(this.#l+(t[0]-e[0])/2-i)/s,(this.#a+(t[1]-e[1])/2-n)/o]}add({x:e,y:t}){this.#l=e,this.#a=t;const[i,n,s,o]=this.#t;let[a,l,h,d]=this.#s.subarray(8,12);const u=e-h,p=t-d,f=Math.hypot(u,p);if(f<this.#d)return!1;const g=f-this.#c,m=g/f,_=m*u,b=m*p;let v=a,y=l;a=h,l=d,h+=_,d+=b,this.#p?.push(e,t);const w=-b/g*this.#h,C=_/g*this.#h;return this.#s.set(this.#s.subarray(2,8),0),this.#s.set([h+w,d+C],4),this.#s.set(this.#s.subarray(14,18),12),this.#s.set([h-w,d-C],16),isNaN(this.#s[6])?(0===this.#r.length&&(this.#s.set([a+w,l+C],2),this.#r.push(NaN,NaN,NaN,NaN,(a+w-i)/s,(l+C-n)/o),this.#s.set([a-w,l-C],14),this.#e.push(NaN,NaN,NaN,NaN,(a-w-i)/s,(l-C-n)/o)),this.#s.set([v,y,a,l,h,d],6),!this.isEmpty()):(this.#s.set([v,y,a,l,h,d],6),Math.abs(Math.atan2(y-l,v-a)-Math.atan2(b,_))<Math.PI/2?([a,l,h,d]=this.#s.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((a+h)/2-i)/s,((l+d)/2-n)/o),[a,l,v,y]=this.#s.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((v+a)/2-i)/s,((y+l)/2-n)/o),!0):([v,y,a,l,h,d]=this.#s.subarray(0,6),this.#r.push(((v+5*a)/6-i)/s,((y+5*l)/6-n)/o,((5*a+h)/6-i)/s,((5*l+d)/6-n)/o,((a+h)/2-i)/s,((l+d)/2-n)/o),[h,d,a,l,v,y]=this.#s.subarray(12,18),this.#e.push(((v+5*a)/6-i)/s,((y+5*l)/6-n)/o,((5*a+h)/6-i)/s,((5*l+d)/6-n)/o,((a+h)/2-i)/s,((l+d)/2-n)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=this.#r,t=this.#e;if(isNaN(this.#s[6])&&!this.isEmpty())return this.#_();const i=[];i.push(`M${e[4]} ${e[5]}`);for(let n=6;n<e.length;n+=6)isNaN(e[n])?i.push(`L${e[n+4]} ${e[n+5]}`):i.push(`C${e[n]} ${e[n+1]} ${e[n+2]} ${e[n+3]} ${e[n+4]} ${e[n+5]}`);this.#v(i);for(let n=t.length-6;n>=6;n-=6)isNaN(t[n])?i.push(`L${t[n+4]} ${t[n+5]}`):i.push(`C${t[n]} ${t[n+1]} ${t[n+2]} ${t[n+3]} ${t[n+4]} ${t[n+5]}`);return this.#b(i),i.join(" ")}#_(){const[e,t,i,n]=this.#t,[s,o,a,l]=this.#g();return`M${(this.#s[2]-e)/i} ${(this.#s[3]-t)/n} L${(this.#s[4]-e)/i} ${(this.#s[5]-t)/n} L${s} ${o} L${a} ${l} L${(this.#s[16]-e)/i} ${(this.#s[17]-t)/n} L${(this.#s[14]-e)/i} ${(this.#s[15]-t)/n} Z`}#b(e){const t=this.#e;e.push(`L${t[4]} ${t[5]} Z`)}#v(e){const[t,i,n,s]=this.#t,o=this.#s.subarray(4,6),a=this.#s.subarray(16,18),[l,h,d,u]=this.#g();e.push(`L${(o[0]-t)/n} ${(o[1]-i)/s} L${l} ${h} L${d} ${u} L${(a[0]-t)/n} ${(a[1]-i)/s}`)}newFreeDrawOutline(e,t,i,n,s,o){return new Ln(e,t,i,n,s,o)}getOutlines(){const e=this.#r,t=this.#e,i=this.#s,[n,s,o,a]=this.#t,l=new Float32Array((this.#p?.length??0)+2);for(let u=0,p=l.length-2;u<p;u+=2)l[u]=(this.#p[u]-n)/o,l[u+1]=(this.#p[u+1]-s)/a;if(l[l.length-2]=(this.#l-n)/o,l[l.length-1]=(this.#a-s)/a,isNaN(i[6])&&!this.isEmpty())return this.#y(l);const h=new Float32Array(this.#r.length+24+this.#e.length);let d=e.length;for(let u=0;u<d;u+=2)isNaN(e[u])?h[u]=h[u+1]=NaN:(h[u]=e[u],h[u+1]=e[u+1]);d=this.#w(h,d);for(let u=t.length-6;u>=6;u-=6)for(let p=0;p<6;p+=2)isNaN(t[u+p])?(h[d]=h[d+1]=NaN,d+=2):(h[d]=t[u+p],h[d+1]=t[u+p+1],d+=2);return this.#C(h,d),this.newFreeDrawOutline(h,l,this.#t,this.#u,this.#i,this.#n)}#y(e){const t=this.#s,[i,n,s,o]=this.#t,[a,l,h,d]=this.#g(),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(t[2]-i)/s,(t[3]-n)/o,NaN,NaN,NaN,NaN,(t[4]-i)/s,(t[5]-n)/o,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,(t[16]-i)/s,(t[17]-n)/o,NaN,NaN,NaN,NaN,(t[14]-i)/s,(t[15]-n)/o],0),this.newFreeDrawOutline(u,e,this.#t,this.#u,this.#i,this.#n)}#C(e,t){const i=this.#e;return e.set([NaN,NaN,NaN,NaN,i[4],i[5]],t),t+6}#w(e,t){const i=this.#s.subarray(4,6),n=this.#s.subarray(16,18),[s,o,a,l]=this.#t,[h,d,u,p]=this.#g();return e.set([NaN,NaN,NaN,NaN,(i[0]-s)/a,(i[1]-o)/l,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,u,p,NaN,NaN,NaN,NaN,(n[0]-s)/a,(n[1]-o)/l],t),t+24}}class Ln extends I{#t;#e=new Float32Array(4);#i;#n;#r;#s;#l;constructor(e,t,i,n,s,o){super(),this.#l=e,this.#r=t,this.#t=i,this.#s=n,this.#i=s,this.#n=o,this.lastPoint=[NaN,NaN],this.#a(o);const[a,l,h,d]=this.#e;for(let u=0,p=e.length;u<p;u+=2)e[u]=(e[u]-a)/h,e[u+1]=(e[u+1]-l)/d;for(let u=0,p=t.length;u<p;u+=2)t[u]=(t[u]-a)/h,t[u+1]=(t[u+1]-l)/d}toSVGPath(){const e=[`M${this.#l[4]} ${this.#l[5]}`];for(let t=6,i=this.#l.length;t<i;t+=6)isNaN(this.#l[t])?e.push(`L${this.#l[t+4]} ${this.#l[t+5]}`):e.push(`C${this.#l[t]} ${this.#l[t+1]} ${this.#l[t+2]} ${this.#l[t+3]} ${this.#l[t+4]} ${this.#l[t+5]}`);return e.push("Z"),e.join(" ")}serialize([e,t,i,n],s){const o=i-e,a=n-t;let l,h;switch(s){case 0:l=I._rescale(this.#l,e,n,o,-a),h=I._rescale(this.#r,e,n,o,-a);break;case 90:l=I._rescaleAndSwap(this.#l,e,t,o,a),h=I._rescaleAndSwap(this.#r,e,t,o,a);break;case 180:l=I._rescale(this.#l,i,t,-o,a),h=I._rescale(this.#r,i,t,-o,a);break;case 270:l=I._rescaleAndSwap(this.#l,i,n,-o,-a),h=I._rescaleAndSwap(this.#r,i,n,-o,-a)}return{outline:Array.from(l),points:[Array.from(h)]}}#a(e){const t=this.#l;let i=t[4],n=t[5];const s=[i,n,i,n];let o=i,a=n;const l=e?Math.max:Math.min;for(let d=6,u=t.length;d<u;d+=6){const p=t[d+4],f=t[d+5];if(isNaN(t[d]))D.pointBoundingBox(p,f,s),a<f?(o=p,a=f):a===f&&(o=l(o,p));else{const g=[1/0,1/0,-1/0,-1/0];D.bezierBoundingBox(i,n,...t.slice(d,d+6),g),D.rectBoundingBox(...g,s),a<g[3]?(o=g[2],a=g[3]):a===g[3]&&(o=l(o,g[2]))}i=p,n=f}const h=this.#e;h[0]=s[0]-this.#i,h[1]=s[1]-this.#i,h[2]=s[2]-s[0]+2*this.#i,h[3]=s[3]-s[1]+2*this.#i,this.lastPoint=[o,a]}get box(){return this.#e}newOutliner(e,t,i,n,s,o=0){return new ne(e,t,i,n,s,o)}getNewOutline(e,t){const[i,n,s,o]=this.#e,[a,l,h,d]=this.#t,u=s*h,p=o*d,f=i*h+a,g=n*d+l,m=this.newOutliner({x:this.#r[0]*u+f,y:this.#r[1]*p+g},this.#t,this.#s,e,this.#n,t??this.#i);for(let _=2;_<this.#r.length;_+=2)m.add({x:this.#r[_]*u+f,y:this.#r[_+1]*p+g});return m.getOutlines()}}class Ti{#t;#e;#i=[];#n=[];constructor(e,t=0,i=0,n=!0){const s=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x:g,y:m,width:_,height:b}of e){const v=Math.floor((g-t)/a)*a,y=Math.ceil((g+_+t)/a)*a,x=Math.floor((m-t)/a)*a,A=Math.ceil((m+b+t)/a)*a;this.#i.push([v,x,A,!0],[y,x,A,!1]),D.rectBoundingBox(v,x,y,A,s)}const l=s[2]-s[0]+2*i,h=s[3]-s[1]+2*i,d=s[0]-i,u=s[1]-i,p=this.#i.at(n?-1:-2),f=[p[0],p[2]];for(const g of this.#i){const[m,_,b]=g;g[0]=(m-d)/l,g[1]=(_-u)/h,g[2]=(b-u)/h}this.#t=new Float32Array([d,u,l,h]),this.#e=f}getOutlines(){this.#i.sort((t,i)=>t[0]-i[0]||t[1]-i[1]||t[2]-i[2]);const e=[];for(const t of this.#i)t[3]?(e.push(...this.#d(t)),this.#l(t)):(this.#a(t),e.push(...this.#d(t)));return this.#r(e)}#r(e){const t=[],i=new Set;for(const o of e){const[a,l,h]=o;t.push([a,l,o],[a,h,o])}t.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=t.length;o<a;o+=2){const l=t[o][2],h=t[o+1][2];l.push(h),h.push(l),i.add(l),i.add(h)}const n=[];let s;for(;i.size>0;){const o=i.values().next().value;let[a,l,h,d,u]=o;i.delete(o);let p=a,f=l;for(s=[a,h],n.push(s);;){let g;if(i.has(d))g=d;else{if(!i.has(u))break;g=u}i.delete(g),[a,l,h,d,u]=g,p!==a&&(s.push(p,f,a,f===l?l:h),p=a),f=f===l?h:l}s.push(p,f)}return new kr(n,this.#t,this.#e)}#s(e){const t=this.#n;let i=0,n=t.length-1;for(;i<=n;){const s=i+n>>1,o=t[s][0];if(o===e)return s;o<e?i=s+1:n=s-1}return n+1}#l([,e,t]){const i=this.#s(e);this.#n.splice(i,0,[e,t])}#a([,e,t]){const i=this.#s(e);for(let n=i;n<this.#n.length;n++){const[s,o]=this.#n[n];if(s!==e)break;if(s===e&&o===t)return void this.#n.splice(n,1)}for(let n=i-1;n>=0;n--){const[s,o]=this.#n[n];if(s!==e)break;if(s===e&&o===t)return void this.#n.splice(n,1)}}#d(e){const[t,i,n]=e,s=[[t,i,n]],o=this.#s(n);for(let a=0;a<o;a++){const[l,h]=this.#n[a];for(let d=0,u=s.length;d<u;d++){const[,p,f]=s[d];if(!(h<=p||f<=l)){if(p>=l){if(f>h)s[d][1]=h;else{if(1===u)return[];s.splice(d,1),d--,u--}continue}s[d][2]=l,f>h&&s.push([t,h,f])}}}return s}}class kr extends I{#t;#e;constructor(e,t,i){super(),this.#e=e,this.#t=t,this.lastPoint=i}toSVGPath(){const e=[];for(const t of this.#e){let[i,n]=t;e.push(`M${i} ${n}`);for(let s=2;s<t.length;s+=2){const o=t[s],a=t[s+1];o===i?(e.push(`V${a}`),n=a):a===n&&(e.push(`H${o}`),i=o)}e.push("Z")}return e.join(" ")}serialize([e,t,i,n],s){const o=[],a=i-e,l=n-t;for(const h of this.#e){const d=new Array(h.length);for(let u=0;u<h.length;u+=2)d[u]=e+h[u]*a,d[u+1]=n-h[u+1]*l;o.push(d)}return o}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class ki extends ne{newFreeDrawOutline(e,t,i,n,s,o){return new Ir(e,t,i,n,s,o)}}class Ir extends Ln{newOutliner(e,t,i,n,s,o=0){return new ki(e,t,i,n,s,o)}}class Ft{#t=null;#e=null;#i;#n=null;#r=!1;#s=!1;#l=null;#a;#d=null;#c=null;#u;static#h=null;static get _keyboardManager(){return W(this,"_keyboardManager",new ye([[["Escape","mac+Escape"],Ft.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Ft.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Ft.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Ft.prototype._moveToPrevious],[["Home","mac+Home"],Ft.prototype._moveToBeginning],[["End","mac+End"],Ft.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#s=!1,this.#u=z.HIGHLIGHT_COLOR,this.#l=e):(this.#s=!0,this.#u=z.HIGHLIGHT_DEFAULT_COLOR),this.#c=e?._uiManager||t,this.#a=this.#c._eventBus,this.#i=e?.color||this.#c?.highlightColors.values().next().value||"#FFFF98",Ft.#h||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const e=this.#t=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=this.#c._signal;e.addEventListener("click",this.#m.bind(this),{signal:t}),e.addEventListener("keydown",this.#f.bind(this),{signal:t});const i=this.#e=document.createElement("span");return i.className="swatch",i.setAttribute("aria-hidden",!0),i.style.backgroundColor=this.#i,e.append(i),e}renderMainDropdown(){const e=this.#n=this.#p();return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}#p(){const e=document.createElement("div"),t=this.#c._signal;e.addEventListener("contextmenu",Rt,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[i,n]of this.#c.highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",n),s.title=i,s.setAttribute("data-l10n-id",Ft.#h[i]);const o=document.createElement("span");s.append(o),o.className="swatch",o.style.backgroundColor=n,s.setAttribute("aria-selected",n===this.#i),s.addEventListener("click",this.#o.bind(this,n),{signal:t}),e.append(s)}return e.addEventListener("keydown",this.#f.bind(this),{signal:t}),e}#o(e,t){t.stopPropagation(),this.#a.dispatch("switchannotationeditorparams",{source:this,type:this.#u,value:e})}_colorSelectFromKeyboard(e){if(e.target===this.#t)return void this.#m(e);const t=e.target.getAttribute("data-color");t&&this.#o(t,e)}_moveToNext(e){this.#_?e.target!==this.#t?e.target.nextSibling?.focus():this.#n.firstChild?.focus():this.#m(e)}_moveToPrevious(e){e.target!==this.#n?.firstChild&&e.target!==this.#t?(this.#_||this.#m(e),e.target.previousSibling?.focus()):this.#_&&this._hideDropdownFromKeyboard()}_moveToBeginning(e){this.#_?this.#n.firstChild?.focus():this.#m(e)}_moveToEnd(e){this.#_?this.#n.lastChild?.focus():this.#m(e)}#f(e){Ft._keyboardManager.exec(this,e)}#m(e){if(this.#_)return void this.hideDropdown();if(this.#r=0===e.detail,this.#d||(this.#d=new AbortController,window.addEventListener("pointerdown",this.#g.bind(this),{signal:this.#c.combinedSignal(this.#d)})),this.#n)return void this.#n.classList.remove("hidden");const t=this.#n=this.#p();this.#t.append(t)}#g(e){this.#n?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#n?.classList.add("hidden"),this.#d?.abort(),this.#d=null}get#_(){return this.#n&&!this.#n.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#s){if(!this.#_)return void this.#l?.unselect();this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(e){if(this.#e&&(this.#e.style.backgroundColor=e),!this.#n)return;const t=this.#c.highlightColors.values();for(const i of this.#n.children)i.setAttribute("aria-selected",t.next().value===e)}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#n?.remove(),this.#n=null}}class dt extends j{#t=null;#e=0;#i;#n=null;#r=null;#s=null;#l=null;#a=0;#d=null;#c=null;#u=null;#h=!1;#p=null;#o;#f=null;#m="";#g;#_="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=T.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=dt.prototype;return W(this,"_keyboardManager",new ye([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||dt._defaultColor,this.#g=e.thickness||dt._defaultThickness,this.#o=e.opacity||dt._defaultOpacity,this.#i=e.boxes||null,this.#_=e.methodOfCreation||"",this.#m=e.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(this.#h=!0,this.#v(e),this.#T()):this.#i&&(this.#t=e.anchorNode,this.#e=e.anchorOffset,this.#l=e.focusNode,this.#a=e.focusOffset,this.#b(),this.#T(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#h?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#g,methodOfCreation:this.#_}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#b(){const e=new Ti(this.#i,.001);this.#c=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#c.box;const t=new Ti(this.#i,.0025,.001,"ltr"===this._uiManager.direction);this.#s=t.getOutlines();const{lastPoint:i}=this.#s;this.#p=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#v({highlightOutlines:e,highlightId:t,clipPathId:i}){if(this.#c=e,this.#s=e.getNewOutline(this.#g/2+1.5,.0025),t>=0)this.#u=t,this.#n=i,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#f=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},!0);else if(this.parent){const d=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#u,{bbox:dt.#x(this.#c.box,(d-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#f,{bbox:dt.#x(this.#s.box,d),path:{d:this.#s.toSVGPath()}})}const[s,o,a,l]=e.box;switch(this.rotation){case 0:this.x=s,this.y=o,this.width=a,this.height=l;break;case 90:{const[d,u]=this.parentDimensions;this.x=o,this.y=1-s,this.width=a*u/d,this.height=l*d/u;break}case 180:this.x=1-s,this.y=1-o,this.width=a,this.height=l;break;case 270:{const[d,u]=this.parentDimensions;this.x=1-o,this.y=s,this.width=a*u/d,this.height=l*d/u;break}}const{lastPoint:h}=this.#s;this.#p=[(h[0]-s)/a,(h[1]-o)/l]}static initialize(e,t){j.initialize(e,t),dt._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case z.HIGHLIGHT_DEFAULT_COLOR:dt._defaultColor=t;break;case z.HIGHLIGHT_THICKNESS:dt._defaultThickness=t}}translateInPage(e,t){}get toolbarPosition(){return this.#p}updateParams(e,t){switch(e){case z.HIGHLIGHT_COLOR:this.#y(t);break;case z.HIGHLIGHT_THICKNESS:this.#C(t)}}static get defaultPropertiesToUpdate(){return[[z.HIGHLIGHT_DEFAULT_COLOR,dt._defaultColor],[z.HIGHLIGHT_THICKNESS,dt._defaultThickness]]}get propertiesToUpdate(){return[[z.HIGHLIGHT_COLOR,this.color||dt._defaultColor],[z.HIGHLIGHT_THICKNESS,this.#g||dt._defaultThickness],[z.HIGHLIGHT_FREE,this.#h]]}#y(e){const t=(s,o)=>{this.color=s,this.#o=o,this.parent?.drawLayer.updateProperties(this.#u,{root:{fill:s,"fill-opacity":o}}),this.#r?.updateColor(s)},i=this.color,n=this.#o;this.addCommands({cmd:t.bind(this,e,dt._defaultOpacity),undo:t.bind(this,i,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:z.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)}#C(e){const t=this.#g,i=n=>{this.#g=n,this.#w(n)};this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:z.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}addEditToolbar(){var e=()=>super.addEditToolbar,t=this;return(0,E.A)(function*(){const i=yield e().call(t);return i?(t._uiManager.highlightColors&&(t.#r=new Ft({editor:t}),i.addColorPicker(t.#r)),i):null})()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#I())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#I())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#S(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#T(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#S():e&&(this.#T(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#w(e){if(!this.#h)return;this.#v({highlightOutlines:this.#c.getNewOutline(e/2)}),this.fixAndSetPosition();const[t,i]=this.parentDimensions;this.setDims(this.width*t,this.height*i)}#S(){null===this.#u||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#f),this.#f=null)}#T(e=this.parent){null===this.#u&&(({id:this.#u,clipPathId:this.#n}=e.drawLayer.draw({bbox:this.#c.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#o},rootClass:{highlight:!0,free:this.#h},path:{d:this.#c.toSVGPath()}},!1,!0)),this.#f=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#h},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},this.#h),this.#d&&(this.#d.style.clipPath=this.#n))}static#x([e,t,i,n],s){switch(s){case 90:return[1-t-n,e,n,i];case 180:return[1-e-i,1-t-n,i,n];case 270:return[t,1-e-i,n,i]}return[e,t,i,n]}rotate(e){const{drawLayer:t}=this.parent;let i;i=this.#h?dt.#x(this.#c.box,e=(e-this.rotation+360)%360):dt.#x([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#u,{bbox:i,root:{"data-main-rotation":e}}),t.updateProperties(this.#f,{bbox:dt.#x(this.#s.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();this.#m&&(e.setAttribute("aria-label",this.#m),e.setAttribute("role","mark")),this.#h?e.classList.add("free"):this.div.addEventListener("keydown",this.#M.bind(this),{signal:this._uiManager._signal});const t=this.#d=document.createElement("div");e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#n;const[i,n]=this.parentDimensions;return this.setDims(this.width*i,this.height*n),di(this,this.#d,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!1}})}#M(e){dt._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#P(!0);break;case 1:case 3:this.#P(!1)}}#P(e){if(!this.#t)return;const t=window.getSelection();e?t.setPosition(this.#t,this.#e):t.setPosition(this.#l,this.#a)}select(){super.select(),this.#f&&this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#f&&(this.parent?.drawLayer.updateProperties(this.#f,{rootClass:{selected:!1}}),this.#h||this.#P(!1))}get _mustFixPosition(){return!this.#h}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#u,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#f,{rootClass:{hidden:!e}}))}#I(){return this.#h?this.rotation:0}#F(){if(this.#h)return null;const[e,t]=this.pageDimensions,[i,n]=this.pageTranslation,s=this.#i,o=new Float32Array(8*s.length);let a=0;for(const{x:l,y:h,width:d,height:u}of s){const p=l*e+i,f=(1-h)*t+n;o[a]=o[a+4]=p,o[a+1]=o[a+3]=f,o[a+2]=o[a+6]=p+d*e,o[a+5]=o[a+7]=f-u*t,a+=8}return o}#O(e){return this.#c.serialize(e,this.#I())}static startHighlighting(e,t,{target:i,x:n,y:s}){const{x:o,y:a,width:l,height:h}=i.getBoundingClientRect(),d=new AbortController,u=e.combinedSignal(d),p=f=>{d.abort(),this.#E(e,f)};window.addEventListener("blur",p,{signal:u}),window.addEventListener("pointerup",p,{signal:u}),window.addEventListener("pointerdown",ft,{capture:!0,passive:!1,signal:u}),window.addEventListener("contextmenu",Rt,{signal:u}),i.addEventListener("pointermove",this.#$.bind(this,e),{signal:u}),this._freeHighlight=new ki({x:n,y:s},[o,a,l,h],e.scale,this._defaultThickness/2,t,.001),({id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0))}static#$(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#E(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(e,t,i){var n=()=>super.deserialize,s=this;return(0,E.A)(function*(){let o=null;if(e instanceof Rn){const{data:{quadPoints:_,rect:b,rotation:v,id:y,color:x,opacity:A,popupRef:w},parent:{page:{pageNumber:C}}}=e;o=e={annotationType:T.HIGHLIGHT,color:Array.from(x),opacity:A,quadPoints:_,boxes:null,pageIndex:C-1,rect:b.slice(0),rotation:v,id:y,deleted:!1,popupRef:w}}else if(e instanceof Si){const{data:{inkLists:_,rect:b,rotation:v,id:y,color:x,borderStyle:{rawWidth:A},popupRef:w},parent:{page:{pageNumber:C}}}=e;o=e={annotationType:T.HIGHLIGHT,color:Array.from(x),thickness:A,inkLists:_,boxes:null,pageIndex:C-1,rect:b.slice(0),rotation:v,id:y,deleted:!1,popupRef:w}}const{color:a,quadPoints:l,inkLists:h,opacity:d}=e,u=yield n().call(s,e,t,i);u.color=D.makeHexColor(...a),u.#o=d||1,h&&(u.#g=e.thickness),u.annotationElementId=e.id||null,u._initialData=o;const[p,f]=u.pageDimensions,[g,m]=u.pageTranslation;if(l){const _=u.#i=[];for(let b=0;b<l.length;b+=8)_.push({x:(l[b]-g)/p,y:1-(l[b+1]-m)/f,width:(l[b+2]-l[b])/p,height:(l[b+1]-l[b+5])/f});u.#b(),u.#T(),u.rotate(u.rotation)}else if(h){u.#h=!0;const _=h[0],b={x:_[0]-g,y:f-(_[1]-m)},v=new ki(b,[0,0,p,f],1,u.#g/2,!0,.001);for(let A=0,w=_.length;A<w;A+=2)b.x=_[A]-g,b.y=f-(_[A+1]-m),v.add(b);const{id:y,clipPathId:x}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:u.color,"fill-opacity":u._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:v.toSVGPath()}},!0,!0);u.#v({highlightOutlines:v.getOutlines(),highlightId:y,clipPathId:x}),u.#T(),u.rotate(u.parentRotation)}return u})()}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=this.getRect(0,0),i=j._colorManager.convert(this.color),n={annotationType:T.HIGHLIGHT,color:i,opacity:this.#o,thickness:this.#g,quadPoints:this.#F(),outlines:this.#O(t),pageIndex:this.pageIndex,rect:t,rotation:this.#I(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#A(n)?null:(n.id=this.annotationElementId,n)}#A(e){const{color:t}=this._initialData;return e.color.some((i,n)=>i!==t[n])}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class Nn{#t=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,i]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,i)}updateSVGProperty(e,t){this.#t[e]=t}toSVGProperties(){const e=this.#t;return this.#t=Object.create(null),{root:e}}reset(){this.#t=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){nt("Not implemented")}}let jn=(()=>{class c extends j{#t=null;#e;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#i=null;static#n=null;static#r=null;static#s=NaN;static#l=null;static#a=null;static#d=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(this.#c(t),this.#p())}#c({drawOutlines:t,drawId:i,drawingOptions:n}){this.#t=t,this._drawingOptions||=n,i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,t.defaultProperties)):this._drawId=this.#u(t,this.parent),this.#m(t.box)}#u(t,i){const{id:n}=i.drawLayer.draw(c._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return n}static _mergeSVGProperties(t,i){const n=new Set(Object.keys(t));for(const[s,o]of Object.entries(i))n.has(s)?Object.assign(t[s],o):t[s]=o;return t}static getDefaultDrawingOptions(t){nt("Not implemented")}static get typesMap(){nt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,i){const n=this.typesMap.get(t);n&&this._defaultDrawingOptions.updateProperty(n,i),this._currentParent&&(c.#i.updateProperty(n,i),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,i){const n=this.constructor.typesMap.get(t);n&&this._updateProperty(t,n,i)}static get defaultPropertiesToUpdate(){const t=[],i=this._defaultDrawingOptions;for(const[n,s]of this.typesMap)t.push([n,i[s]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:i}=this;for(const[n,s]of this.constructor.typesMap)t.push([n,i[s]]);return t}_updateProperty(t,i,n){const s=this._drawingOptions,o=s[i],a=l=>{s.updateProperty(i,l);const h=this.#t.updateProperty(i,l);h&&this.#m(h),this.parent?.drawLayer.updateProperties(this._drawId,s.toSVGProperties())};this.addCommands({cmd:a.bind(this,n),undo:a.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,c._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#f()),{bbox:this.#g()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,c._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#f()),{bbox:this.#g()}))}_onTranslating(t,i){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#g()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,c._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#f(),this.parentDimensions),{bbox:this.#g()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#h(),super.remove()}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.#p(),this.#m(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let i=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#h()):t&&(this._uiManager.addShouldRescale(this),this.#p(t),i=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),i&&this.select()}#h(){null===this._drawId||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#p(t=this.parent){if(null===this._drawId||this.parent!==t){if(null!==this._drawId)return void this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);this._drawingOptions.updateAll(),this._drawId=this.#u(this.#t,t)}}#o([t,i,n,s]){const{parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[i,1-t,n*(a/o),s*(o/a)];case 180:return[1-t,1-i,n,s];case 270:return[1-i,t,n*(a/o),s*(o/a)];default:return[t,i,n,s]}}#f(){const{x:t,y:i,width:n,height:s,parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[1-i,t,n*(o/a),s*(a/o)];case 180:return[1-t,1-i,n,s];case 270:return[i,1-t,n*(o/a),s*(a/o)];default:return[t,i,n,s]}}#m(t){if([this.x,this.y,this.width,this.height]=this.#o(t),this.div){this.fixAndSetPosition();const[i,n]=this.parentDimensions;this.setDims(this.width*i,this.height*n)}this._onResized()}#g(){const{x:t,y:i,width:n,height:s,rotation:o,parentRotation:a,parentDimensions:[l,h]}=this;switch((4*o+a)/90){case 1:return[1-i-s,t,s,n];case 2:return[1-t-n,1-i-s,n,s];case 3:return[i,1-t-n,s,n];case 4:return[t,i-n*(l/h),s*(h/l),n*(l/h)];case 5:return[1-i,t,n*(l/h),s*(h/l)];case 6:return[1-t-s*(h/l),1-i,s*(h/l),n*(l/h)];case 7:return[i-n*(l/h),1-t-s*(h/l),n*(l/h),s*(h/l)];case 8:return[t-n,i-s,n,s];case 9:return[1-i,t-n,s,n];case 10:return[1-t,1-i,n,s];case 11:return[i-s,1-t,s,n];case 12:return[t-s*(h/l),i,s*(h/l),n*(l/h)];case 13:return[1-i-n*(l/h),t-s*(h/l),n*(l/h),s*(h/l)];case 14:return[1-t,1-i-n*(l/h),s*(h/l),n*(l/h)];case 15:return[i,1-t,n*(l/h),s*(h/l)];default:return[t,i,n,s]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,c._mergeSVGProperties({bbox:this.#g()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#m(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,i;this._isCopy&&(t=this.x,i=this.y);const n=super.render();n.classList.add("draw");const s=document.createElement("div");n.append(s),s.setAttribute("aria-hidden","true"),s.className="internal";const[o,a]=this.parentDimensions;return this.setDims(this.width*o,this.height*a),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,i),n}static createDrawerInstance(t,i,n,s,o){nt("Not implemented")}static startDrawing(t,i,n,s){const{target:o,offsetX:a,offsetY:l,pointerId:h,pointerType:d}=s;if(c.#l&&c.#l!==d)return;const{viewport:{rotation:u}}=t,{width:p,height:f}=o.getBoundingClientRect(),g=c.#n=new AbortController,m=t.combinedSignal(g);c.#s||=h,c.#l??=d,window.addEventListener("pointerup",_=>{c.#s===_.pointerId?this._endDraw(_):c.#a?.delete(_.pointerId)},{signal:m}),window.addEventListener("pointercancel",_=>{c.#s===_.pointerId?this._currentParent.endDrawingSession():c.#a?.delete(_.pointerId)},{signal:m}),window.addEventListener("pointerdown",_=>{c.#l===_.pointerType&&((c.#a||=new Set).add(_.pointerId),c.#i.isCancellable()&&(c.#i.removeLastElement(),c.#i.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:m}),window.addEventListener("contextmenu",Rt,{signal:m}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:m}),o.addEventListener("touchmove",_=>{_.timeStamp===c.#d&&ft(_)},{signal:m}),t.toggleDrawing(),i._editorUndoBar?.hide(),c.#i?t.drawLayer.updateProperties(this._currentDrawId,c.#i.startNew(a,l,p,f,u)):(i.updateUIForDefaultProperties(this),c.#i=this.createDrawerInstance(a,l,p,f,u),c.#r=this.getDefaultDrawingOptions(),this._currentParent=t,({id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(c.#r.toSVGProperties(),c.#i.defaultSVGProperties),!0,!1)))}static _drawMove(t){if(c.#d=-1,!c.#i)return;const{offsetX:i,offsetY:n,pointerId:s}=t;if(c.#s===s){if(c.#a?.size>=1)return void this._endDraw(t);this._currentParent.drawLayer.updateProperties(this._currentDrawId,c.#i.add(i,n)),c.#d=t.timeStamp,ft(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,c.#i=null,c.#r=null,c.#l=null,c.#d=NaN),c.#n&&(c.#n.abort(),c.#n=null,c.#s=NaN,c.#a=null)}static _endDraw(t){const i=this._currentParent;if(i){if(i.toggleDrawing(!0),this._cleanup(!1),t?.target===i.div&&i.drawLayer.updateProperties(this._currentDrawId,c.#i.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const n=c.#i,s=this._currentDrawId,o=n.getLastElement();return void i.addCommands({cmd:()=>{i.drawLayer.updateProperties(s,n.setLastElement(o))},undo:()=>{i.drawLayer.updateProperties(s,n.removeLastElement())},mustExec:!1,type:z.DRAW_STEP})}this.endDrawing(!1)}}static endDrawing(t){const i=this._currentParent;if(!i)return null;if(i.toggleDrawing(!0),i.cleanUndoStack(z.DRAW_STEP),!c.#i.isEmpty()){const{pageDimensions:[n,s],scale:o}=i,a=i.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:c.#i.getOutlines(n*o,s*o,o,this._INNER_MARGIN),drawingOptions:c.#r,mustBeCommitted:!t});return this._cleanup(!0),a}return i.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,i,n,s,o,a){nt("Not implemented")}static deserialize(t,i,n){var s=()=>super.deserialize,o=this;return(0,E.A)(function*(){const{rawDims:{pageWidth:a,pageHeight:l,pageX:h,pageY:d}}=i.viewport,u=o.deserializeDraw(h,d,a,l,o._INNER_MARGIN,t),p=yield s().call(o,t,i,n);return p.createDrawingOptions(t),p.#c({drawOutlines:u}),p.#p(),p.onScaleChanging(),p.rotate(),p})()}serializeDraw(t){const[i,n]=this.pageTranslation,[s,o]=this.pageDimensions;return this.#t.serialize([i,n,s,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}return c})();class Fr{#t=new Float64Array(6);#e;#i;#n;#r;#s;#l="";#a=0;#d=new Ie;#c;#u;constructor(e,t,i,n,s,o){this.#c=i,this.#u=n,this.#n=s,this.#r=o,[e,t]=this.#h(e,t);const a=this.#e=[NaN,NaN,NaN,NaN,e,t];this.#s=[e,t],this.#i=[{line:a,points:this.#s}],this.#t.set(a,0)}updateProperty(e,t){"stroke-width"===e&&(this.#r=t)}#h(e,t){return I._normalizePoint(e,t,this.#c,this.#u,this.#n)}isEmpty(){return!this.#i||0===this.#i.length}isCancellable(){return this.#s.length<=10}add(e,t){[e,t]=this.#h(e,t);const[i,n,s,o]=this.#t.subarray(2,6);return Math.hypot(this.#c*(e-s),this.#u*(t-o))<=2?null:(this.#s.push(e,t),isNaN(i)?(this.#t.set([s,o,e,t],2),this.#e.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([i,n,s,o,e,t],0),this.#e.push(...I.createBezierPoints(i,n,s,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){return this.add(e,t)||(2===this.#s.length?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,i,n,s){this.#c=i,this.#u=n,this.#n=s,[e,t]=this.#h(e,t);const o=this.#e=[NaN,NaN,NaN,NaN,e,t];this.#s=[e,t];const a=this.#i.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#i.push({line:o,points:this.#s}),this.#t.set(o,0),this.#a=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(e){return this.#i?(this.#i.push(e),this.#e=e.line,this.#s=e.points,this.#a=0,{path:{d:this.toSVGPath()}}):this.#d.setLastElement(e)}removeLastElement(){if(!this.#i)return this.#d.removeLastElement();this.#i.pop(),this.#l="";for(let e=0,t=this.#i.length;e<t;e++){const{line:i,points:n}=this.#i[e];this.#e=i,this.#s=n,this.#a=0,this.toSVGPath()}return{path:{d:this.#l}}}toSVGPath(){const e=I.svgRound(this.#e[4]),t=I.svgRound(this.#e[5]);if(2===this.#s.length)return this.#l=`${this.#l} M ${e} ${t} Z`,this.#l;if(this.#s.length<=6){const n=this.#l.lastIndexOf("M");this.#l=`${this.#l.slice(0,n)} M ${e} ${t}`,this.#a=6}if(4===this.#s.length){const n=I.svgRound(this.#e[10]),s=I.svgRound(this.#e[11]);return this.#l=`${this.#l} L ${n} ${s}`,this.#a=12,this.#l}const i=[];0===this.#a&&(i.push(`M ${e} ${t}`),this.#a=6);for(let n=this.#a,s=this.#e.length;n<s;n+=6){const[o,a,l,h,d,u]=this.#e.slice(n,n+6).map(I.svgRound);i.push(`C${o} ${a} ${l} ${h} ${d} ${u}`)}return this.#l+=i.join(" "),this.#a=this.#e.length,this.#l}getOutlines(e,t,i,n){const s=this.#i.at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),this.#d.build(this.#i,e,t,i,this.#n,this.#r,n),this.#t=null,this.#e=null,this.#i=null,this.#l=null,this.#d}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Ie extends I{#t;#e=0;#i;#n;#r;#s;#l;#a;#d;build(e,t,i,n,s,o,a){this.#r=t,this.#s=i,this.#l=n,this.#a=s,this.#d=o,this.#i=a??0,this.#n=e,this.#h()}get thickness(){return this.#d}setLastElement(e){return this.#n.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#n.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:t}of this.#n)if(e.push(`M${I.svgRound(t[4])} ${I.svgRound(t[5])}`),6!==t.length)if(12===t.length&&isNaN(t[6]))e.push(`L${I.svgRound(t[10])} ${I.svgRound(t[11])}`);else for(let i=6,n=t.length;i<n;i+=6){const[s,o,a,l,h,d]=t.subarray(i,i+6).map(I.svgRound);e.push(`C${s} ${o} ${a} ${l} ${h} ${d}`)}else e.push("Z");return e.join("")}serialize([e,t,i,n],s){const o=[],a=[],[l,h,d,u]=this.#u();let p,f,g,m,_,b,v,y,x;switch(this.#a){case 0:x=I._rescale,p=e,f=t+n,g=i,m=-n,_=e+l*i,b=t+(1-h-u)*n,v=e+(l+d)*i,y=t+(1-h)*n;break;case 90:x=I._rescaleAndSwap,p=e,f=t,g=i,m=n,_=e+h*i,b=t+l*n,v=e+(h+u)*i,y=t+(l+d)*n;break;case 180:x=I._rescale,p=e+i,f=t,g=-i,m=n,_=e+(1-l-d)*i,b=t+h*n,v=e+(1-l)*i,y=t+(h+u)*n;break;case 270:x=I._rescaleAndSwap,p=e+i,f=t+n,g=-i,m=-n,_=e+(1-h-u)*i,b=t+(1-l-d)*n,v=e+(1-h)*i,y=t+(1-l)*n}for(const{line:A,points:w}of this.#n)o.push(x(A,p,f,g,m,s?new Array(A.length):null)),a.push(x(w,p,f,g,m,s?new Array(w.length):null));return{lines:o,points:a,rect:[_,b,v,y]}}static deserialize(e,t,i,n,s,{paths:{lines:o,points:a},rotation:l,thickness:h}){const d=[];let u,p,f,g,m;switch(l){case 0:m=I._rescale,u=-e/i,p=t/n+1,f=1/i,g=-1/n;break;case 90:m=I._rescaleAndSwap,u=-t/n,p=-e/i,f=1/n,g=1/i;break;case 180:m=I._rescale,u=e/i+1,p=-t/n,f=-1/i,g=1/n;break;case 270:m=I._rescaleAndSwap,u=t/n+1,p=e/i+1,f=-1/n,g=-1/i}if(!o){o=[];for(const b of a){const v=b.length;if(2===v){o.push(new Float32Array([NaN,NaN,NaN,NaN,b[0],b[1]]));continue}if(4===v){o.push(new Float32Array([NaN,NaN,NaN,NaN,b[0],b[1],NaN,NaN,NaN,NaN,b[2],b[3]]));continue}const y=new Float32Array(3*(v-2));o.push(y);let[x,A,w,C]=b.subarray(0,4);y.set([NaN,NaN,NaN,NaN,x,A],0);for(let P=4;P<v;P+=2){const S=b[P],O=b[P+1];y.set(I.createBezierPoints(x,A,w,C,S,O),3*(P-2)),[x,A,w,C]=[w,C,S,O]}}}for(let b=0,v=o.length;b<v;b++)d.push({line:m(o[b].map(y=>y??NaN),u,p,f,g),points:m(a[b].map(y=>y??NaN),u,p,f,g)});const _=new this.prototype.constructor;return _.build(d,i,n,1,l,h,s),_}#c(e=this.#d){const t=this.#i+e/2*this.#l;return this.#a%180==0?[t/this.#r,t/this.#s]:[t/this.#s,t/this.#r]}#u(){const[e,t,i,n]=this.#t,[s,o]=this.#c(0);return[e+s,t+o,i-2*s,n-2*o]}#h(){const e=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:n}of this.#n){if(n.length<=12){for(let a=4,l=n.length;a<l;a+=6)D.pointBoundingBox(n[a],n[a+1],e);continue}let s=n[4],o=n[5];for(let a=6,l=n.length;a<l;a+=6){const[h,d,u,p,f,g]=n.subarray(a,a+6);D.bezierBoundingBox(s,o,h,d,u,p,f,g,e),s=f,o=g}}const[t,i]=this.#c();e[0]=Et(e[0]-t,0,1),e[1]=Et(e[1]-i,0,1),e[2]=Et(e[2]+t,0,1),e[3]=Et(e[3]+i,0,1),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#t}updateProperty(e,t){return"stroke-width"===e?this.#p(t):null}#p(e){const[t,i]=this.#c();this.#d=e;const[n,s]=this.#c(),[o,a]=[n-t,s-i],l=this.#t;return l[0]-=o,l[1]-=a,l[2]+=2*o,l[3]+=2*a,l}updateParentDimensions([e,t],i){const[n,s]=this.#c();this.#r=e,this.#s=t,this.#l=i;const[o,a]=this.#c(),l=o-n,h=a-s,d=this.#t;return d[0]-=l,d[1]-=h,d[2]+=2*l,d[3]+=2*h,d}updateRotation(e){return this.#e=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(I.svgRound).join(" ")}get defaultProperties(){const[e,t]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${I.svgRound(e)} ${I.svgRound(t)}`}}}get rotationTransform(){const[,,e,t]=this.#t;let i=0,n=0,s=0,o=0,a=0,l=0;switch(this.#e){case 90:n=t/e,s=-e/t,a=e;break;case 180:i=-1,o=-1,a=e,l=t;break;case 270:n=-t/e,s=e/t,l=t;break;default:return""}return`matrix(${i} ${n} ${s} ${o} ${I.svgRound(a)} ${I.svgRound(l)})`}getPathResizingSVGProperties([e,t,i,n]){const[s,o]=this.#c(),[a,l,h,d]=this.#t;if(Math.abs(h-s)<=I.PRECISION||Math.abs(d-o)<=I.PRECISION){const m=e+i/2-(a+h/2),_=t+n/2-(l+d/2);return{path:{"transform-origin":`${I.svgRound(e)} ${I.svgRound(t)}`,transform:`${this.rotationTransform} translate(${m} ${_})`}}}const u=(i-2*s)/(h-2*s),p=(n-2*o)/(d-2*o),f=h/i,g=d/n;return{path:{"transform-origin":`${I.svgRound(a)} ${I.svgRound(l)}`,transform:`${this.rotationTransform} scale(${f} ${g}) translate(${I.svgRound(s)} ${I.svgRound(o)}) scale(${u} ${p}) translate(${I.svgRound(-s)} ${I.svgRound(-o)})`}}}getPathResizedSVGProperties([e,t,i,n]){const[s,o]=this.#c(),a=this.#t,[l,h,d,u]=a;if(a[0]=e,a[1]=t,a[2]=i,a[3]=n,Math.abs(d-s)<=I.PRECISION||Math.abs(u-o)<=I.PRECISION){const _=e+i/2-(l+d/2),b=t+n/2-(h+u/2);for(const{line:v,points:y}of this.#n)I._translate(v,_,b,v),I._translate(y,_,b,y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${I.svgRound(e)} ${I.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(i-2*s)/(d-2*s),f=(n-2*o)/(u-2*o),g=-p*(l+s)+e+s,m=-f*(h+o)+t+o;if(1!==p||1!==f||0!==g||0!==m)for(const{line:_,points:b}of this.#n)I._rescale(_,g,m,p,f,_),I._rescale(b,g,m,p,f,b);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${I.svgRound(e)} ${I.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],i){const[n,s]=i,o=this.#t,a=e-o[0],l=t-o[1];if(this.#r===n&&this.#s===s)for(const{line:h,points:d}of this.#n)I._translate(h,a,l,h),I._translate(d,a,l,d);else{const h=this.#r/n,d=this.#s/s;this.#r=n,this.#s=s;for(const{line:u,points:p}of this.#n)I._rescale(u,a,l,h,d,u),I._rescale(p,a,l,h,d,p);o[2]*=h,o[3]*=d}return o[0]=e,o[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${I.svgRound(e)} ${I.svgRound(t)}`}}}get defaultSVGProperties(){const e=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${I.svgRound(e[0])} ${I.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class Qe extends Nn{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:j._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){"stroke-width"===e&&(t??=this["stroke-width"],t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new Qe(this._viewParameters);return e.updateAll(this),e}}class Ii extends jn{static _type="ink";static _editorType=T.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,t){j.initialize(e,t),this._defaultDrawingOptions=new Qe(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return W(this,"typesMap",new Map([[z.INK_THICKNESS,"stroke-width"],[z.INK_COLOR,"stroke"],[z.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,i,n,s){return new Fr(e,t,i,n,s,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,i,n,s,o){return Ie.deserialize(e,t,i,n,s,o)}static deserialize(e,t,i){var n=()=>super.deserialize,s=this;return(0,E.A)(function*(){let o=null;if(e instanceof Si){const{data:{inkLists:l,rect:h,rotation:d,id:u,color:p,opacity:f,borderStyle:{rawWidth:g},popupRef:m},parent:{page:{pageNumber:_}}}=e;o=e={annotationType:T.INK,color:Array.from(p),thickness:g,opacity:f,paths:{points:l},boxes:null,pageIndex:_-1,rect:h.slice(0),rotation:d,id:u,deleted:!1,popupRef:m}}const a=yield n().call(s,e,t,i);return a.annotationElementId=e.id||null,a._initialData=o,a})()}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:t,parent:i}=this;t.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:i}){this._drawingOptions=Ii.getDefaultDrawingOptions({stroke:D.makeHexColor(...e),"stroke-width":t,"stroke-opacity":i})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:t,points:i,rect:n}=this.serializeDraw(e),{_drawingOptions:{stroke:s,"stroke-opacity":o,"stroke-width":a}}=this,l={annotationType:T.INK,color:j._colorManager.convert(s),opacity:o,thickness:a,paths:{lines:t,points:i},pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(l.isCopy=!0,l):this.annotationElementId&&!this.#t(l)?null:(l.id=this.annotationElementId,l)}#t(e){const{color:t,thickness:i,opacity:n,pageIndex:s}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((o,a)=>o!==t[a])||e.thickness!==i||e.opacity!==n||e.pageIndex!==s}renderAnnotationElement(e){const{points:t,rect:i}=this.serializeDraw(!1);return e.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:t}),null}}class Fi extends Ie{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}class fe{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(e,t,i,n){return n-=t,0==(i-=e)?n>0?0:4:1===i?n+6:2-n}static#i=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#n(e,t,i,n,s,o,a){const l=this.#e(i,n,s,o);for(let h=0;h<8;h++){const d=(-h+l-a+16)%8;if(0!==e[(i+this.#i[2*d])*t+(n+this.#i[2*d+1])])return d}return-1}static#r(e,t,i,n,s,o,a){const l=this.#e(i,n,s,o);for(let h=0;h<8;h++){const d=(h+l+a+16)%8;if(0!==e[(i+this.#i[2*d])*t+(n+this.#i[2*d+1])])return d}return-1}static#s(e,t,i,n){const s=e.length,o=new Int32Array(s);for(let d=0;d<s;d++)o[d]=e[d]<=n?1:0;for(let d=1;d<i-1;d++)o[d*t]=o[d*t+t-1]=0;for(let d=0;d<t;d++)o[d]=o[t*i-1-d]=0;let l,a=1;const h=[];for(let d=1;d<i-1;d++){l=1;for(let u=1;u<t-1;u++){const p=d*t+u,f=o[p];if(0===f)continue;let g=d,m=u;if(1===f&&0===o[p-1])a+=1,m-=1;else{if(!(f>=1&&0===o[p+1])){1!==f&&(l=Math.abs(f));continue}a+=1,m+=1,f>1&&(l=f)}const _=[u,d],b=m===u+1,v={isHole:b,points:_,id:a,parent:0};let y;h.push(v);for(const k of h)if(k.id===l){y=k;break}v.parent=y?y.isHole?b?y.parent:l:b?l:y.parent:b?l:0;const x=this.#n(o,t,d,u,g,m,0);if(-1===x){o[p]=-a,1!==o[p]&&(l=Math.abs(o[p]));continue}let A=this.#i[2*x],w=this.#i[2*x+1];const C=d+A,P=u+w;g=C,m=P;let S=d,O=u;for(;;){const k=this.#r(o,t,S,O,g,m,1);A=this.#i[2*k],w=this.#i[2*k+1];const tt=S+A,st=O+w;_.push(st,tt);const q=S*t+O;if(0===o[q+1]?o[q]=-a:1===o[q]&&(o[q]=a),tt===d&&st===u&&S===C&&O===P){1!==o[p]&&(l=Math.abs(o[p]));break}g=S,m=O,S=tt,O=st}}}return h}static#l(e,t,i,n){if(i-t<=4){for(let C=t;C<i-2;C+=2)n.push(e[C],e[C+1]);return}const s=e[t],o=e[t+1],a=e[i-4]-s,l=e[i-3]-o,h=Math.hypot(a,l),d=a/h,u=l/h,p=d*o-u*s,g=1/h,m=Math.atan(l/a),_=Math.cos(m),b=Math.sin(m),v=g*(Math.abs(_)+Math.abs(b)),y=g*(1-v+v**2),x=Math.max(Math.atan(Math.abs(b+_)*y),Math.atan(Math.abs(b-_)*y));let A=0,w=t;for(let C=t+2;C<i-2;C+=2){const P=Math.abs(p-d*e[C+1]+u*e[C]);P>A&&(w=C,A=P)}A>(h*x)**2?(this.#l(e,t,w+2,n),this.#l(e,w,i,n)):n.push(s,o)}static#a(e){const t=[],i=e.length;return this.#l(e,0,i,t),t.push(e[i-2],e[i-1]),t.length<=4?null:t}static#d(e,t,i,n,s,o){const a=new Float32Array(o**2),l=-2*n**2,h=o>>1;for(let m=0;m<o;m++){const _=(m-h)**2;for(let b=0;b<o;b++)a[m*o+b]=Math.exp((_+(b-h)**2)/l)}const d=new Float32Array(256),u=-2*s**2;for(let m=0;m<256;m++)d[m]=Math.exp(m**2/u);const f=new Uint8Array(e.length),g=new Uint32Array(256);for(let m=0;m<i;m++)for(let _=0;_<t;_++){const b=m*t+_,v=e[b];let y=0,x=0;for(let w=0;w<o;w++){const C=m+w-h;if(!(C<0||C>=i))for(let P=0;P<o;P++){const S=_+P-h;if(S<0||S>=t)continue;const O=e[C*t+S],k=a[w*o+P]*d[Math.abs(O-v)];y+=O*k,x+=k}}g[f[b]=Math.round(y/x)]++}return[f,g]}static#c(e){const t=new Uint32Array(256);for(const i of e)t[i]++;return t}static#u(e){const t=e.length,i=new Uint8ClampedArray(t>>2);let n=-1/0,s=1/0;for(let a=0,l=i.length;a<l;a++){if(0===e[3+(a<<2)]){n=i[a]=255;continue}const d=i[a]=e[a<<2];d>n&&(n=d),d<s&&(s=d)}const o=255/(n-s);for(let a=0;a<t;a++)i[a]=(i[a]-s)*o;return i}static#h(e){let t,i=-1/0,n=-1/0;const s=e.findIndex(l=>0!==l);let o=s,a=s;for(t=s;t<256;t++){const l=e[t];l>i&&(t-o>n&&(n=t-o,a=t-1),i=l,o=t)}for(t=a-1;t>=0&&!(e[t]>e[t+1]);t--);return t}static#p(e){const t=e,{width:i,height:n}=e,{maxDim:s}=this.#t;let o=i,a=n;if(i>s||n>s){let p=i,f=n,g=Math.log2(Math.max(i,n)/s);const m=Math.floor(g);g=g===m?m-1:m;for(let b=0;b<g;b++){o=p,a=f,o>s&&(o=Math.ceil(o/2)),a>s&&(a=Math.ceil(a/2));const v=new OffscreenCanvas(o,a);v.getContext("2d").drawImage(e,0,0,p,f,0,0,o,a),p=o,f=a,e!==t&&e.close(),e=v.transferToImageBitmap()}const _=Math.min(s/o,s/a);o=Math.round(o*_),a=Math.round(a*_)}const h=new OffscreenCanvas(o,a).getContext("2d",{willReadFrequently:!0});h.filter="grayscale(1)",h.drawImage(e,0,0,e.width,e.height,0,0,o,a);const d=h.getImageData(0,0,o,a).data;return[this.#u(d),o,a]}static extractContoursFromText(e,{fontFamily:t,fontStyle:i,fontWeight:n},s,o,a,l){let h=new OffscreenCanvas(1,1),d=h.getContext("2d",{alpha:!1});const p=d.font=`${i} ${n} 200px ${t}`,{actualBoundingBoxLeft:f,actualBoundingBoxRight:g,actualBoundingBoxAscent:m,actualBoundingBoxDescent:_,fontBoundingBoxAscent:b,fontBoundingBoxDescent:v,width:y}=d.measureText(e),A=Math.ceil(1.5*Math.max(Math.abs(f)+Math.abs(g)||0,y)),w=Math.ceil(1.5*Math.max(Math.abs(m)+Math.abs(_)||200,Math.abs(b)+Math.abs(v)||200));h=new OffscreenCanvas(A,w),d=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),d.font=p,d.filter="grayscale(1)",d.fillStyle="white",d.fillRect(0,0,A,w),d.fillStyle="black",d.fillText(e,.5*A/2,1.5*w/2);const C=this.#u(d.getImageData(0,0,A,w).data),P=this.#c(C),S=this.#h(P),O=this.#s(C,A,w,S);return this.processDrawnLines({lines:{curves:O,width:A,height:w},pageWidth:s,pageHeight:o,rotation:a,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(e,t,i,n,s){const[o,a,l]=this.#p(e),[h,d]=this.#d(o,a,l,Math.hypot(a,l)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),u=this.#h(d),p=this.#s(h,a,l,u);return this.processDrawnLines({lines:{curves:p,width:a,height:l},pageWidth:t,pageHeight:i,rotation:n,innerMargin:s,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:i,rotation:n,innerMargin:s,mustSmooth:o,areContours:a}){n%180!=0&&([t,i]=[i,t]);const{curves:l,width:h,height:d}=e,u=e.thickness??0,p=[],f=Math.min(t/h,i/d),g=f/t,m=f/i,_=[];for(const{points:v}of l){const y=o?this.#a(v):v;if(!y)continue;_.push(y);const x=y.length,A=new Float32Array(x),w=new Float32Array(3*(2===x?2:x-2));if(p.push({line:w,points:A}),2===x){A[0]=y[0]*g,A[1]=y[1]*m,w.set([NaN,NaN,NaN,NaN,A[0],A[1]],0);continue}let[C,P,S,O]=y;C*=g,P*=m,S*=g,O*=m,A.set([C,P,S,O],0),w.set([NaN,NaN,NaN,NaN,C,P],0);for(let k=4;k<x;k+=2){const tt=A[k]=y[k]*g,st=A[k+1]=y[k+1]*m;w.set(I.createBezierPoints(C,P,S,O,tt,st),3*(k-2)),[C,P,S,O]=[S,O,tt,st]}}if(0===p.length)return null;const b=a?new Fi:new Ie;return b.build(p,t,i,1,n,a?0:u,s),{outline:b,newCurves:_,areContours:a,thickness:u,width:h,height:d}}static compressSignature(e){return(0,E.A)(function*({outlines:t,areContours:i,thickness:n,width:s,height:o}){let d,a=1/0,l=-1/0,h=0;for(const x of t){h+=x.length;for(let A=2,w=x.length;A<w;A++){const C=x[A]-x[A-2];a=Math.min(a,C),l=Math.max(l,C)}}d=a>=-128&&l<=127?Int8Array:a>=-32768&&l<=32767?Int16Array:Int32Array;const u=t.length,p=8+3*u,f=new Uint32Array(p);let g=0;f[g++]=p*Uint32Array.BYTES_PER_ELEMENT+(h-2*u)*d.BYTES_PER_ELEMENT,f[g++]=0,f[g++]=s,f[g++]=o,f[g++]=i?0:1,f[g++]=Math.max(0,Math.floor(n??0)),f[g++]=u,f[g++]=d.BYTES_PER_ELEMENT;for(const x of t)f[g++]=x.length-2,f[g++]=x[0],f[g++]=x[1];const m=new CompressionStream("deflate-raw"),_=m.writable.getWriter();yield _.ready,_.write(f);const b=d.prototype.constructor;for(const x of t){const A=new b(x.length-2);for(let w=2,C=x.length;w<C;w++)A[w-2]=x[w]-x[w-2];_.write(A)}_.close();const v=yield new Response(m.readable).arrayBuffer();return Ui(new Uint8Array(v))}).apply(this,arguments)}static decompressSignature(e){return(0,E.A)(function*(){try{const a=function is(c){return Uint8Array.fromBase64?Uint8Array.fromBase64(c):ae(atob(c))}(e),{readable:l,writable:h}=new DecompressionStream("deflate-raw"),d=h.getWriter();yield d.ready,d.write(a).then((0,E.A)(function*(){yield d.ready,yield d.close()})).catch(()=>{});let u=null,p=0;var n,t=!1,i=!1;try{for(var o,s=function _e(c){var e,t,i,n=2;for(typeof Symbol<"u"&&(t=Symbol.asyncIterator,i=Symbol.iterator);n--;){if(t&&null!=(e=c[t]))return e.call(c);if(i&&null!=(e=c[i]))return new K(e.call(c));t="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}(l);t=!(o=yield s.next()).done;t=!1){const P=o.value;u||=new Uint8Array(new Uint32Array(P.buffer,0,4)[0]),u.set(P,p),p+=P.length}}catch(P){i=!0,n=P}finally{try{t&&null!=s.return&&(yield s.return())}finally{if(i)throw n}}const f=new Uint32Array(u.buffer,0,u.length>>2),g=f[1];if(0!==g)throw new Error(`Invalid version: ${g}`);const m=f[2],_=f[3],b=0===f[4],v=f[5],y=f[6],A=[],w=(8+3*y)*Uint32Array.BYTES_PER_ELEMENT;let C;switch(f[7]){case Int8Array.BYTES_PER_ELEMENT:C=new Int8Array(u.buffer,w);break;case Int16Array.BYTES_PER_ELEMENT:C=new Int16Array(u.buffer,w);break;case Int32Array.BYTES_PER_ELEMENT:C=new Int32Array(u.buffer,w)}p=0;for(let P=0;P<y;P++){const S=f[3*P+8],O=new Float32Array(S+2);A.push(O);for(let k=0;k<2;k++)O[k]=f[3*P+8+k+1];for(let k=0;k<S;k++)O[k+2]=O[k]+C[p++]}return{areContours:b,thickness:v,outlines:A,width:m,height:_}}catch(a){return U(`decompressSignature: ${a}`),null}})()}}class Oi extends Nn{constructor(){super(),super.updateProperties({fill:j._defaultLineColor,"stroke-width":0})}clone(){const e=new Oi;return e.updateAll(this),e}}class Ri extends Qe{constructor(e){super(e),super.updateProperties({stroke:j._defaultLineColor,"stroke-width":1})}clone(){const e=new Ri(this._viewParameters);return e.updateAll(this),e}}class jt extends jn{#t=!1;#e=null;#i=null;#n=null;static _type="signature";static _editorType=T.SIGNATURE;static _defaultDrawingOptions=null;constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#i=e.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,t){j.initialize(e,t),this._defaultDrawingOptions=new Oi,this._defaultDrawnSignatureOptions=new Ri(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!1}static get typesMap(){return W(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(e){const t=e.get("hasDescription");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){null!==this._drawId&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,t;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,e=this.x,t=this.y),super.render(),null===this._drawId)if(this.#i){const{lines:n,mustSmooth:s,areContours:o,description:a,uuid:l,heightInPage:h}=this.#i,{rawDims:{pageWidth:d,pageHeight:u},rotation:p}=this.parent.viewport,f=fe.processDrawnLines({lines:n,pageWidth:d,pageHeight:u,rotation:p,innerMargin:jt._INNER_MARGIN,mustSmooth:s,areContours:o});this.addSignature(f,h,a,l)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);return i&&(this._isCopy=!0,this._moveAfterPaste(e,t)),this.div}setUuid(e){this.#n=e,this.addEditToolbar()}getUuid(){return this.#n}get description(){return this.#e}set description(e){this.#e=e,super.addEditToolbar().then(t=>{t?.updateEditSignatureButton(e)})}getSignaturePreview(){const{newCurves:e,areContours:t,thickness:i,width:n,height:s}=this.#i,o=Math.max(n,s);return{areContours:t,outline:fe.processDrawnLines({lines:{curves:e.map(l=>({points:l})),thickness:i,width:n,height:s},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:t}).outline}}addEditToolbar(){var e=()=>super.addEditToolbar,t=this;return(0,E.A)(function*(){const i=yield e().call(t);return i?(t._uiManager.signatureManager&&null!==t.#e&&(yield i.addEditSignatureButton(t._uiManager.signatureManager,t.#n,t.#e),i.show()),i):null})()}addSignature(e,t,i,n){const{x:s,y:o}=this,{outline:a}=this.#i=e;let l;this.#t=a instanceof Fi,this.#e=i,this.div.setAttribute("data-l10n-args",JSON.stringify({description:i})),this.#t?l=jt.getDefaultDrawingOptions():(l=jt._defaultDrawnSignatureOptions.clone(),l.updateProperties({"stroke-width":a.thickness})),this._addOutlines({drawOutlines:a,drawingOptions:l});const[h,d]=this.parentDimensions,[,u]=this.pageDimensions;let p=t/u;p=p>=1?.5:p,this.width*=p/this.height,this.width>=1&&(p*=.9/this.width,this.width=.9),this.height=p,this.setDims(h*this.width,d*this.height),this.x=s,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(n),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!n,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:t,pageHeight:i},rotation:n}=this.parent.viewport;return fe.process(e,t,i,n,jt._INNER_MARGIN)}getFromText(e,t){const{rawDims:{pageWidth:i,pageHeight:n},rotation:s}=this.parent.viewport;return fe.extractContoursFromText(e,t,i,n,s,jt._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:t,pageHeight:i},rotation:n}=this.parent.viewport;return fe.processDrawnLines({lines:e,pageWidth:t,pageHeight:i,rotation:n,innerMargin:jt._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:t}){e?this._drawingOptions=jt.getDefaultDrawingOptions():(this._drawingOptions=jt._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":t}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:t,points:i,rect:n}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":s}}=this,o={annotationType:T.SIGNATURE,isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:s,pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(o.paths={lines:t,points:i},o.uuid=this.#n,o.isCopy=!0):o.lines=t,this.#e&&(o.accessibilityData={type:"Figure",alt:this.#e}),o}static deserializeDraw(e,t,i,n,s,o){return o.areContours?Fi.deserialize(e,t,i,n,s,o):Ie.deserialize(e,t,i,n,s,o)}static deserialize(e,t,i){var n=()=>super.deserialize,s=this;return(0,E.A)(function*(){const o=yield n().call(s,e,t,i);return o.#t=e.areContours,o.#e=e.accessibilityData?.alt||"",o.#n=e.uuid,o})()}}class Or extends j{#t=null;#e=null;#i=null;#n=null;#r=null;#s="";#l=null;#a=!1;#d=null;#c=!1;#u=!1;static _type="stamp";static _editorType=T.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#n=e.bitmapUrl,this.#r=e.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,t){j.initialize(e,t)}static isHandlingMimeForPasting(e){return hi.includes(e)}static paste(e,t){t.pasteEditor(T.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){const t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#h(e,t=!1){e?(this.#t=e.bitmap,t||(this.#e=e.id,this.#c=e.isSvg),e.file&&(this.#s=e.file.name),this.#f()):this.remove()}#p(){if(this.#i=null,this._uiManager.enableWaiting(!1),this.#l){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t)return this._editToolbar.hide(),void this._uiManager.editAltText(this,!0);if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}mlGuessAltText(){var e=this;return(0,E.A)(function*(t=null,i=!0){if(e.hasAltTextData())return null;const{mlManager:n}=e._uiManager;if(!n)throw new Error("No ML.");if(!(yield n.isEnabledFor("altText")))throw new Error("ML isn't enabled for alt text.");const{data:s,width:o,height:a}=t||e.copyCanvas(null,null,!0).imageData,l=yield n.guess({name:"altText",request:{data:s,width:o,height:a,channels:s.length/(o*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const h=l.output;return yield e.setGuessedAltText(h),i&&!e.hasAltTextData()&&(e.altTextData={alt:h,decorative:!1}),h}).apply(this,arguments)}#o(){var e=this;if(this.#e)return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(this.#e).then(n=>this.#h(n,!0)).finally(()=>this.#p());if(this.#n){const n=this.#n;return this.#n=null,this._uiManager.enableWaiting(!0),void(this.#i=this._uiManager.imageManager.getFromUrl(n).then(s=>this.#h(s)).finally(()=>this.#p()))}if(this.#r){const n=this.#r;return this.#r=null,this._uiManager.enableWaiting(!0),void(this.#i=this._uiManager.imageManager.getFromFile(n).then(s=>this.#h(s)).finally(()=>this.#p()))}const t=document.createElement("input");t.type="file",t.accept=hi.join(",");const i=this._uiManager._signal;this.#i=new Promise(n=>{t.addEventListener("change",(0,E.A)(function*(){if(t.files&&0!==t.files.length){e._uiManager.enableWaiting(!0);const s=yield e._uiManager.imageManager.getFromFile(t.files[0]);e._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:e._uiManager.useNewAltTextFlow}}),e.#h(s)}else e.remove();n()}),{signal:i}),t.addEventListener("cancel",()=>{this.remove(),n()},{signal:i})}).finally(()=>this.#p()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#l?.remove(),this.#l=null,this.#d&&(clearTimeout(this.#d),this.#d=null)),super.remove()}rebuild(){this.parent?(super.rebuild(),null!==this.div&&(this.#e&&null===this.#l&&this.#o(),this.isAttachedToDOM||this.parent.add(this))):this.#e&&this.#o()}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#i||this.#t||this.#n||this.#r||this.#e||this.#a)}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;return this._isCopy&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),this.#a||(this.#t?this.#f():this.#o()),this._isCopy&&this._moveAfterPaste(e,t),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,t){const{id:i,bitmap:n}=this._uiManager.imageManager.getFromCanvas(e,t);t.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(this.#e=i,n&&(this.#t=n),this.#a=!1,this.#f())}_onResized(){this.onScaleChanging()}onScaleChanging(){this.parent&&(null!==this.#d&&clearTimeout(this.#d),this.#d=setTimeout(()=>{this.#d=null,this.#g()},200))}#f(){const{div:e}=this;let{width:t,height:i}=this.#t;const[n,s]=this.pageDimensions,o=.75;if(this.width)t=this.width*n,i=this.height*s;else if(t>o*n||i>o*s){const d=Math.min(o*n/t,o*s/i);t*=d,i*=d}const[a,l]=this.parentDimensions;this.setDims(t*a/n,i*l/s),this._uiManager.enableWaiting(!1);const h=this.#l=document.createElement("canvas");h.setAttribute("role","img"),this.addContainer(h),this.width=t/n,this.height=i/s,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#g(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#s&&this.div.setAttribute("aria-description",this.#s)}copyCanvas(e,t,i=!1){e||(e=224);const{width:n,height:s}=this.#t,o=new Gt;let a=this.#t,l=n,h=s,d=null;if(t){if(n>t||s>t){const w=Math.min(t/n,t/s);l=Math.floor(n*w),h=Math.floor(s*w)}d=document.createElement("canvas");const p=d.width=Math.ceil(l*o.sx),f=d.height=Math.ceil(h*o.sy);this.#c||(a=this.#m(p,f));const g=d.getContext("2d");g.filter=this._uiManager.hcmFilter;let m="white",_="#cfcfd8";"none"!==this._uiManager.hcmFilter?_="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(m="#8f8f9d",_="#42414d");const b=15,v=b*o.sx,y=b*o.sy,x=new OffscreenCanvas(2*v,2*y),A=x.getContext("2d");A.fillStyle=m,A.fillRect(0,0,2*v,2*y),A.fillStyle=_,A.fillRect(0,0,v,y),A.fillRect(v,y,v,y),g.fillStyle=g.createPattern(x,"repeat"),g.fillRect(0,0,p,f),g.drawImage(a,0,0,a.width,a.height,0,0,p,f)}let u=null;if(i){let p,f;if(o.symmetric&&a.width<e&&a.height<e)p=a.width,f=a.height;else if(a=this.#t,n>e||s>e){const _=Math.min(e/n,e/s);p=Math.floor(n*_),f=Math.floor(s*_),this.#c||(a=this.#m(p,f))}const m=new OffscreenCanvas(p,f).getContext("2d",{willReadFrequently:!0});m.drawImage(a,0,0,a.width,a.height,0,0,p,f),u={width:p,height:f,data:m.getImageData(0,0,p,f).data}}return{canvas:d,width:l,height:h,imageData:u}}#m(e,t){const{width:i,height:n}=this.#t;let s=i,o=n,a=this.#t;for(;s>2*e||o>2*t;){const l=s,h=o;s>2*e&&(s=s>=16384?Math.floor(s/2)-1:Math.ceil(s/2)),o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const d=new OffscreenCanvas(s,o);d.getContext("2d").drawImage(a,0,0,l,h,0,0,s,o),a=d.transferToImageBitmap()}return a}#g(){const[e,t]=this.parentDimensions,{width:i,height:n}=this,s=new Gt,o=Math.ceil(i*e*s.sx),a=Math.ceil(n*t*s.sy),l=this.#l;if(!l||l.width===o&&l.height===a)return;l.width=o,l.height=a;const h=this.#c?this.#t:this.#m(o,a),d=l.getContext("2d");d.filter=this._uiManager.hcmFilter,d.drawImage(h,0,0,h.width,h.height,0,0,o,a)}#_(e){if(e){if(this.#c){const n=this._uiManager.imageManager.getSvgUrl(this.#e);if(n)return n}const t=document.createElement("canvas");return({width:t.width,height:t.height}=this.#t),t.getContext("2d").drawImage(this.#t,0,0),t.toDataURL()}if(this.#c){const[t,i]=this.pageDimensions,n=Math.round(this.width*t*le.PDF_TO_CSS_UNITS),s=Math.round(this.height*i*le.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(n,s);return o.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,n,s),o.transferToImageBitmap()}return structuredClone(this.#t)}static deserialize(e,t,i){var n=()=>super.deserialize,s=this;return(0,E.A)(function*(){let o=null,a=!1;if(e instanceof Dn){const{data:{rect:b,rotation:v,id:y,structParent:x,popupRef:A},container:w,parent:{page:{pageNumber:C}},canvas:P}=e;let S,O;P?(delete e.canvas,({id:S,bitmap:O}=i.imageManager.getFromCanvas(w.id,P)),P.remove()):(a=!0,e._hasNoCanvas=!0);const k=(yield t._structTree.getAriaAttributes(`${ri}${y}`))?.get("aria-label")||"";o=e={annotationType:T.STAMP,bitmapId:S,bitmap:O,pageIndex:C-1,rect:b.slice(0),rotation:v,id:y,deleted:!1,accessibilityData:{decorative:!1,altText:k},isSvg:!1,structParent:x,popupRef:A}}const l=yield n().call(s,e,t,i),{rect:h,bitmap:d,bitmapUrl:u,bitmapId:p,isSvg:f,accessibilityData:g}=e;a?(i.addMissingCanvas(e.id,l),l.#a=!0):p&&i.imageManager.isValidId(p)?(l.#e=p,d&&(l.#t=d)):l.#n=u,l.#c=f;const[m,_]=l.pageDimensions;return l.width=(h[2]-h[0])/m,l.height=(h[3]-h[1])/_,l.annotationElementId=e.id||null,g&&(l.altTextData=g),l._initialData=o,l.#u=!!o,l})()}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i={annotationType:T.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(e)return i.bitmapUrl=this.#_(!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:n,altText:s}=this.serializeAltText(!1);if(!n&&s&&(i.accessibilityData={type:"Figure",alt:s}),this.annotationElementId){const a=this.#b(i);if(a.isSame)return null;a.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,null===t)return i;t.stamps||=new Map;const o=this.#c?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(t.stamps.has(this.#e)){if(this.#c){const a=t.stamps.get(this.#e);o>a.area&&(a.area=o,a.serialized.bitmap.close(),a.serialized.bitmap=this.#_(!1))}}else t.stamps.set(this.#e,{area:o,serialized:i}),i.bitmap=this.#_(!1);return i}#b(e){const{pageIndex:t,accessibilityData:{altText:i}}=this._initialData,n=e.pageIndex===t,s=(e.accessibilityData?.alt||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&n&&s,isSameAltText:s}}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}}let Rr=(()=>{class c{#t;#e=!1;#i=null;#n=null;#r=null;#s=new Map;#l=!1;#a=!1;#d=!1;#c=null;#u=null;#h=null;#p=null;#o;static _initialized=!1;static#f=new Map([_t,Ii,Or,dt,jt].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:i,div:n,structTreeLayer:s,accessibilityManager:o,annotationLayer:a,drawLayer:l,textLayer:h,viewport:d,l10n:u}){const p=[...c.#f.values()];if(!c._initialized){c._initialized=!0;for(const f of p)f.initialize(u,t)}t.registerEditorTypes(p),this.#o=t,this.pageIndex=i,this.div=n,this.#t=o,this.#i=a,this.viewport=d,this.#h=h,this.drawLayer=l,this._structTree=s,this.#o.addLayer(this)}get isEmpty(){return 0===this.#s.size}get isInvisible(){return this.isEmpty&&this.#o.getMode()===T.NONE}updateToolbar(t){this.#o.updateToolbar(t)}updateMode(t=this.#o.getMode()){switch(this.#v(),t){case T.NONE:return this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case T.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case T.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:i}=this.div;for(const n of c.#f.values())i.toggle(`${n._type}Editing`,t===n._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#h?.div}setEditingState(t){this.#o.setEditingState(t)}addCommands(t){this.#o.addCommands(t)}cleanUndoStack(t){this.#o.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#i?.div.classList.toggle("disabled",!t)}enable(){var t=this;return(0,E.A)(function*(){t.#d=!0,t.div.tabIndex=0,t.togglePointerEvents(!0);const i=new Set;for(const s of t.#s.values())s.enableEditing(),s.show(!0),s.annotationElementId&&(t.#o.removeChangedExistingAnnotation(s),i.add(s.annotationElementId));if(!t.#i)return void(t.#d=!1);const n=t.#i.getEditableAnnotations();for(const s of n){if(s.hide(),t.#o.isDeletedAnnotationElement(s.data.id)||i.has(s.data.id))continue;const o=yield t.deserialize(s);o&&(t.addOrRebuild(o),o.enableEditing())}t.#d=!1})()}disable(){this.#a=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);const t=new Map,i=new Map;for(const s of this.#s.values())if(s.disableEditing(),s.annotationElementId){if(null!==s.serialize()){t.set(s.annotationElementId,s);continue}i.set(s.annotationElementId,s),this.getEditableAnnotation(s.annotationElementId)?.show(),s.remove()}if(this.#i){const s=this.#i.getEditableAnnotations();for(const o of s){const{id:a}=o.data;if(this.#o.isDeletedAnnotationElement(a))continue;let l=i.get(a);l?(l.resetAnnotationElement(o),l.show(!1),o.show()):(l=t.get(a),l&&(this.#o.addChangedExistingAnnotation(l),l.renderAnnotationElement(o)&&l.show(!1)),o.show())}}this.#v(),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const s of c.#f.values())n.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#a=!1}getEditableAnnotation(t){return this.#i?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#o.getActive()!==t&&this.#o.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#h?.div&&!this.#p){this.#p=new AbortController;const t=this.#o.combinedSignal(this.#p);this.#h.div.addEventListener("pointerdown",this.#m.bind(this),{signal:t}),this.#h.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#h?.div&&this.#p&&(this.#p.abort(),this.#p=null,this.#h.div.classList.remove("highlighting"))}#m(t){this.#o.unselectAll();const{target:i}=t;if(i===this.#h.div||("img"===i.getAttribute("role")||i.classList.contains("endOfContent"))&&this.#h.div.contains(i)){const{isMac:n}=At.platform;if(0!==t.button||t.ctrlKey&&n)return;this.#o.showAllEditors("highlight",!0,!0),this.#h.div.classList.add("free"),this.toggleDrawing(),dt.startHighlighting(this,"ltr"===this.#o.direction,{target:this.#h.div,x:t.x,y:t.y}),this.#h.div.addEventListener("pointerup",()=>{this.#h.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#o._signal}),t.preventDefault()}}enableClick(){if(this.#n)return;this.#n=new AbortController;const t=this.#o.combinedSignal(this.#n);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const i=this.pointerup.bind(this);this.div.addEventListener("pointerup",i,{signal:t}),this.div.addEventListener("pointercancel",i,{signal:t})}disableClick(){this.#n?.abort(),this.#n=null}attach(t){this.#s.set(t.id,t);const{annotationElementId:i}=t;i&&this.#o.isDeletedAnnotationElement(i)&&this.#o.removeDeletedAnnotationElement(t)}detach(t){this.#s.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#a&&t.annotationElementId&&this.#o.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#o.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#o.addDeletedAnnotationElement(t.annotationElementId),j.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(t.parent!==this||!t.isAttachedToDOM){if(this.changeParent(t),this.#o.addEditor(t),this.attach(t),!t.isAttachedToDOM){const i=t.render();this.div.append(i),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#d),this.#o.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:i}=document;t.div.contains(i)&&!this.#r&&(t._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#o._signal}),i.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){this.addCommands({cmd:()=>t._uiManager.rebuild(t),undo:()=>{t.remove()},mustExec:!1})}getNextId(){return this.#o.getId()}get#g(){return c.#f.get(this.#o.getMode())}combinedSignal(t){return this.#o.combinedSignal(t)}#_(t){const i=this.#g;return i?new i.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#g?.canCreateNewEmptyEditor()}pasteEditor(t,i){var n=this;return(0,E.A)(function*(){n.#o.updateToolbar(t),yield n.#o.updateMode(t);const{offsetX:s,offsetY:o}=n.#b(),a=n.getNextId(),l=n.#_({parent:n,id:a,x:s,y:o,uiManager:n.#o,isCentered:!0,...i});l&&n.add(l)})()}deserialize(t){var i=this;return(0,E.A)(function*(){return(yield c.#f.get(t.annotationType??t.annotationEditorType)?.deserialize(t,i,i.#o))||null})()}createAndAddNewEditor(t,i,n={}){const s=this.getNextId(),o=this.#_({parent:this,id:s,x:t.offsetX,y:t.offsetY,uiManager:this.#o,isCentered:i,...n});return o&&this.add(o),o}#b(){const{x:t,y:i,width:n,height:s}=this.div.getBoundingClientRect(),o=Math.max(0,t),a=Math.max(0,i),d=(o+Math.min(window.innerWidth,t+n))/2-t,u=(a+Math.min(window.innerHeight,i+s))/2-i,[p,f]=this.viewport.rotation%180==0?[d,u]:[u,d];return{offsetX:p,offsetY:f}}addNewEditor(t={}){this.createAndAddNewEditor(this.#b(),!0,t)}setSelected(t){this.#o.setSelected(t)}toggleSelected(t){this.#o.toggleSelected(t)}unselect(t){this.#o.unselect(t)}pointerup(t){const{isMac:i}=At.platform;if(0!==t.button||t.ctrlKey&&i||t.target!==this.div||!this.#l||(this.#l=!1,this.#g?.isDrawer&&this.#g.supportMultipleDrawings))return;if(!this.#e)return void(this.#e=!0);const n=this.#o.getMode();n!==T.STAMP&&n!==T.SIGNATURE?this.createAndAddNewEditor(t,!1):this.#o.unselectAll()}pointerdown(t){if(this.#o.getMode()===T.HIGHLIGHT&&this.enableTextSelection(),this.#l)return void(this.#l=!1);const{isMac:i}=At.platform;if(0!==t.button||t.ctrlKey&&i||t.target!==this.div)return;if(this.#l=!0,this.#g?.isDrawer)return void this.startDrawingSession(t);const n=this.#o.getActive();this.#e=!n||n.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#c)return void this.#g.startDrawing(this,this.#o,!1,t);this.#o.setCurrentDrawingSession(this),this.#c=new AbortController;const i=this.#o.combinedSignal(this.#c);this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(this.#u=null,this.commitOrRemove())},{signal:i}),this.#g.startDrawing(this,this.#o,!1,t)}pause(t){if(t){const{activeElement:i}=document;this.div.contains(i)&&(this.#u=i)}else this.#u&&setTimeout(()=>{this.#u?.focus(),this.#u=null},0)}endDrawingSession(t=!1){return this.#c?(this.#o.setCurrentDrawingSession(null),this.#c.abort(),this.#c=null,this.#u=null,this.#g.endDrawing(t)):null}findNewParent(t,i,n){const s=this.#o.findParent(i,n);return null!==s&&s!==this&&(s.changeParent(t),!0)}commitOrRemove(){return!!this.#c&&(this.endDrawingSession(),!0)}onScaleChanging(){this.#c&&this.#g.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#o.getActive()?.parent===this&&(this.#o.commitOrRemove(),this.#o.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(const t of this.#s.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#s.clear(),this.#o.removeLayer(this)}#v(){for(const t of this.#s.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,te(this.div,t);for(const i of this.#o.getEditors(this.pageIndex))this.add(i),i.rebuild();this.updateMode()}update({viewport:t}){this.#o.commitOrRemove(),this.#v();const i=this.viewport.rotation,n=t.rotation;if(this.viewport=t,te(this.div,{rotation:n}),i!==n)for(const s of this.#s.values())s.rotate(n)}get pageDimensions(){const{pageWidth:t,pageHeight:i}=this.viewport.rawDims;return[t,i]}get scale(){return this.#o.viewParameters.realScale}}return c})();class xt{#t=null;#e=new Map;#i=new Map;static#n=0;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(this.#t){if(this.#t!==e){if(this.#e.size>0)for(const t of this.#e.values())t.remove(),e.append(t);this.#t=e}}else this.#t=e}static get _svgFactory(){return W(this,"_svgFactory",new Ke)}static#r(e,[t,i,n,s]){const{style:o}=e;o.top=100*i+"%",o.left=100*t+"%",o.width=100*n+"%",o.height=100*s+"%"}#s(){const e=xt._svgFactory.create(1,1,!0);return this.#t.append(e),e.setAttribute("aria-hidden",!0),e}#l(e,t){const i=xt._svgFactory.createElement("clipPath");e.append(i);const n=`clip_${t}`;i.setAttribute("id",n),i.setAttribute("clipPathUnits","objectBoundingBox");const s=xt._svgFactory.createElement("use");return i.append(s),s.setAttribute("href",`#${t}`),s.classList.add("clip"),n}#a(e,t){for(const[i,n]of Object.entries(t))null===n?e.removeAttribute(i):e.setAttribute(i,n)}draw(e,t=!1,i=!1){const n=xt.#n++,s=this.#s(),o=xt._svgFactory.createElement("defs");s.append(o);const a=xt._svgFactory.createElement("path");o.append(a);const l=`path_p${this.pageIndex}_${n}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#i.set(n,a);const h=i?this.#l(o,l):null,d=xt._svgFactory.createElement("use");return s.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(s,e),this.#e.set(n,s),{id:n,clipPathId:`url(#${h})`}}drawOutline(e,t){const i=xt.#n++,n=this.#s(),s=xt._svgFactory.createElement("defs");n.append(s);const o=xt._svgFactory.createElement("path");s.append(o);const a=`path_p${this.pageIndex}_${i}`;let l;if(o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke"),t){const u=xt._svgFactory.createElement("mask");s.append(u),l=`mask_p${this.pageIndex}_${i}`,u.setAttribute("id",l),u.setAttribute("maskUnits","objectBoundingBox");const p=xt._svgFactory.createElement("rect");u.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const f=xt._svgFactory.createElement("use");u.append(f),f.setAttribute("href",`#${a}`),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}const h=xt._svgFactory.createElement("use");n.append(h),h.setAttribute("href",`#${a}`),l&&h.setAttribute("mask",`url(#${l})`);const d=h.cloneNode();return n.append(d),h.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(n,e),this.#e.set(i,n),i}finalizeDraw(e,t){this.#i.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;const{root:i,bbox:n,rootClass:s,path:o}=t,a="number"==typeof e?this.#e.get(e):e;if(a){if(i&&this.#a(a,i),n&&xt.#r(a,n),s){const{classList:l}=a;for(const[h,d]of Object.entries(s))l.toggle(h,d)}o&&this.#a(a.firstChild.firstChild,o)}}updateParent(e,t){if(t===this)return;const i=this.#e.get(e);i&&(t.#t.append(i),this.#e.delete(e),t.#e.set(e,i))}remove(e){this.#i.delete(e),null!==this.#t&&(this.#e.get(e).remove(),this.#e.delete(e))}destroy(){this.#t=null;for(const e of this.#e.values())e.remove();this.#e.clear(),this.#i.clear()}}globalThis.pdfjsTestingUtils={HighlightOutliner:Ti},globalThis.pdfjsLib={AbortException:Xt,AnnotationEditorLayer:Rr,AnnotationEditorParamsType:z,AnnotationEditorType:T,AnnotationEditorUIManager:xe,AnnotationLayer:Mi,AnnotationMode:B,AnnotationType:ut,build:"4f7761353",ColorPicker:Ft,createValidAbsoluteUrl:Li,DOMSVGFactory:Ke,DrawLayer:xt,FeatureTest:At,fetchData:be,getDocument:Cn,getFilenameFromUrl:function ns(c){return[c]=c.split(/[#?]/,1),c.substring(c.lastIndexOf("/")+1)},getPdfFilenameFromUrl:function ss(c,e="document.pdf"){if("string"!=typeof c)return e;if(Ve(c))return U('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,n=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(c);let s=i.exec(n[1])||i.exec(n[2])||i.exec(n[3]);if(s&&(s=s[0],s.includes("%")))try{s=i.exec(decodeURIComponent(s))[0]}catch{}return s||e},getUuid:Gi,getXfaPageViewport:function rs(c,{scale:e=1,rotation:t=0}){const{width:i,height:n}=c.attributes.style,s=[0,0,parseInt(i),parseInt(n)];return new ve({viewBox:s,userUnit:1,scale:e,rotation:t})},GlobalWorkerOptions:we,ImageKind:De,InvalidPDFException:ni,isDataScheme:Ve,isPdfFile:li,isValidExplicitDest:sr,MathClamp:Et,noContextMenu:Rt,normalizeUnicode:function ts(c){return si||(si=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,$i=new Map([["\ufb05","\u017ft"]])),c.replaceAll(si,(e,t,i)=>t?t.normalize("NFKC"):$i.get(i))},OPS:Ne,OutputScale:Gt,PasswordResponses:{NEED_PASSWORD:1,INCORRECT_PASSWORD:2},PDFDataRangeTransport:En,PDFDateString:Hi,PDFWorker:vt,PermissionFlag:{PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},PixelsPerInch:le,RenderingCancelledException:ai,ResponseException:Ge,setLayerDimensions:te,shadow:W,SignatureExtractor:fe,stopEvent:ft,SupportedImageMimeTypes:hi,TextLayer:wt,TouchManager:He,updateUrlHash:Ni,Util:D,VerbosityLevel:Le,version:"5.2.133",XfaLayer:Mn};var Dr=N(9350),Lr=N(7707),jr=N(3868),Br=N(2525),r=N(4438),Bn=N(9192),$r=N(6375),Gr=N(2409),Ur=N(8026),Vr=N(2120),Hr=N(1068),zr=N(9252);const Xr=["editableContent"],Wr=["subjectInput"],Yr=["fileInput"],Wt=()=>({standalone:!0}),qr=c=>({duplicate:c}),Kr=(c,e,t,i)=>({creation:c,approbation:e,envoi:t,validation:i}),Jr=(c,e,t,i)=>({"ri-file-add-line":c,"ri-checkbox-circle-line":e,"ri-send-plane-line":t,"ri-shield-check-line":i}),Qr=c=>({transform:c});function Zr(c,e){if(1&c&&(r.j41(0,"div",23),r.EFF(1),r.k0s()),2&c){const t=r.XpG();r.R7$(),r.SpI(" ",t.errorMessage," ")}}function to(c,e){1&c&&(r.j41(0,"div",24)(1,"div",25),r.nrm(2,"div",26),r.j41(3,"p"),r.EFF(4,"Connexion en cours..."),r.k0s()()())}function eo(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",73)(1,"button",72),r.bIt("click",function(){r.eBV(t);const n=r.XpG(3);return r.Njj(n.openStatusConfirmation(n.statusOptions.BROUILLON))}),r.EFF(2," Brouillon "),r.k0s()()}if(2&c){const t=r.XpG(3);r.R7$(),r.AVh("active",t.factureProForma.statut===t.statusOptions.BROUILLON),r.Y8G("disabled",!t.canTransitionTo(t.statusOptions.BROUILLON))}}function io(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",74)(1,"button",72),r.bIt("click",function(){r.eBV(t);const n=r.XpG(3);return r.Njj(n.openStatusConfirmation(n.statusOptions.APPROBATION))}),r.EFF(2," Approbation "),r.k0s()()}if(2&c){const t=r.XpG(3);r.R7$(),r.AVh("active",t.factureProForma.statut===t.statusOptions.APPROBATION),r.Y8G("disabled",!t.canTransitionTo(t.statusOptions.APPROBATION))}}function no(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",75)(1,"button",72),r.bIt("click",function(){r.eBV(t);const n=r.XpG(3);return r.Njj(n.openStatusConfirmation(n.statusOptions.APPROUVE))}),r.EFF(2," Approuver "),r.k0s()()}if(2&c){const t=r.XpG(3);r.R7$(),r.AVh("active",t.factureProForma.statut===t.statusOptions.APPROUVE),r.Y8G("disabled",!t.canTransitionTo(t.statusOptions.APPROUVE))}}function so(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",76)(1,"button",72),r.bIt("click",function(){r.eBV(t);const n=r.XpG(3);return r.Njj(n.openStatusConfirmation(n.statusOptions.ENVOYE))}),r.EFF(2," Envoyer "),r.k0s()()}if(2&c){const t=r.XpG(3);r.R7$(),r.AVh("active",t.factureProForma.statut===t.statusOptions.ENVOYE),r.Y8G("disabled",!t.canTransitionTo(t.statusOptions.ENVOYE))}}function ro(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",66),r.DNE(1,eo,3,3,"div",67)(2,io,3,3,"div",68)(3,no,3,3,"div",69)(4,so,3,3,"div",70),r.j41(5,"div",71)(6,"button",72),r.bIt("click",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.openStatusConfirmation(n.statusOptions.VALIDE))}),r.EFF(7," Valider "),r.k0s()()()}if(2&c){const t=r.XpG(2);r.R7$(),r.Y8G("ngIf",t.factureProForma.statut!==t.statusOptions.VALIDE),r.R7$(),r.Y8G("ngIf",!t.factureProForma.dateApprobation&&t.factureProForma.statut!==t.statusOptions.VALIDE),r.R7$(),r.Y8G("ngIf",t.factureProForma.statut!==t.statusOptions.VALIDE),r.R7$(),r.Y8G("ngIf",t.factureProForma.statut!==t.statusOptions.VALIDE),r.R7$(2),r.AVh("active",t.factureProForma.statut===t.statusOptions.VALIDE),r.Y8G("disabled",!t.canTransitionTo(t.statusOptions.VALIDE))}}function oo(c,e){1&c&&(r.j41(0,"div",77),r.nrm(1,"i",78),r.EFF(2," Cette facture a \xe9t\xe9 annul\xe9e "),r.k0s())}function ao(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",79)(1,"div",80)(2,"h4"),r.EFF(3,"Confirmer le changement de statut"),r.k0s(),r.j41(4,"p"),r.EFF(5),r.k0s(),r.j41(6,"div",81)(7,"button",82),r.bIt("click",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.cancelStatusChange())}),r.EFF(8,"Annuler"),r.k0s(),r.j41(9,"button",83),r.bIt("click",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.confirmStatusChange())}),r.EFF(10,"Confirmer"),r.k0s()()()()}if(2&c){const t=r.XpG(2);r.R7$(5),r.SpI('Voulez-vous vraiment passer la facture au statut "',t.selectedStatutLabel,'" ?')}}function lo(c,e){if(1&c&&(r.j41(0,"div")(1,"h5"),r.EFF(2,"Doit"),r.k0s(),r.j41(3,"div",84)(4,"div",39),r.nrm(5,"input",85),r.j41(6,"label",86),r.EFF(7," Email "),r.k0s()(),r.j41(8,"div",39),r.nrm(9,"input",87),r.j41(10,"label",88),r.EFF(11," Droit "),r.k0s()()(),r.j41(12,"div",84)(13,"div",39),r.nrm(14,"input",89),r.j41(15,"label",90),r.EFF(16," Adresse "),r.k0s()(),r.j41(17,"div",39),r.nrm(18,"input",91),r.j41(19,"label",92),r.EFF(20," Num\xe9ro t\xe9l\xe9phone "),r.k0s()()()()),2&c){const t=r.XpG(2);r.R7$(5),r.Y8G("value",t.factureProForma.client.email),r.R7$(4),r.Y8G("value",t.factureProForma.client.nomComplet),r.R7$(5),r.Y8G("value",t.factureProForma.client.adresse),r.R7$(4),r.Y8G("value",t.factureProForma.client.telephone)}}function co(c,e){if(1&c&&(r.j41(0,"div")(1,"div",93)(2,"h5"),r.EFF(3,"Entreprise clients"),r.k0s(),r.j41(4,"div",94),r.nrm(5,"i",95),r.k0s()(),r.j41(6,"div",84)(7,"div",39),r.nrm(8,"input",96),r.j41(9,"label",97),r.EFF(10,"Nom"),r.k0s()(),r.j41(11,"div",39),r.nrm(12,"input",85),r.j41(13,"label",98),r.EFF(14,"Email"),r.k0s()()(),r.j41(15,"div",84)(16,"div",39),r.nrm(17,"input",99),r.j41(18,"label",90),r.EFF(19,"Adresse"),r.k0s()(),r.j41(20,"div",39),r.nrm(21,"input",100),r.j41(22,"label",92),r.EFF(23,"Num\xe9ro t\xe9l\xe9phone"),r.k0s()()()()),2&c){const t=r.XpG(2);r.R7$(8),r.Y8G("value",t.factureProForma.entrepriseClient.nom||"Non vide"),r.R7$(4),r.Y8G("value",t.factureProForma.entrepriseClient.email||"Nom email"),r.R7$(5),r.Y8G("value",t.factureProForma.entrepriseClient.adresse||"Nom adresse"),r.R7$(4),r.Y8G("value",t.factureProForma.entrepriseClient.telephone||"Nom t\xe9l\xe9phone")}}function ho(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",109),r.bIt("click",function(){r.eBV(t);const n=r.XpG().index,s=r.XpG(2);return r.Njj(s.supprimerLigneConfirmee(n))}),r.nrm(1,"i",110),r.k0s()}}function uo(c,e){if(1&c){const t=r.RV6();r.j41(0,"tr",101)(1,"td",102)(2,"div",50),r.nrm(3,"input",103),r.k0s()(),r.j41(4,"td")(5,"div",50)(6,"textarea",104),r.mxI("ngModelChange",function(n){const s=r.eBV(t).$implicit;return r.DH7(s.ligneDescription,n)||(s.ligneDescription=n),r.Njj(n)}),r.k0s()()(),r.j41(7,"td")(8,"div",50)(9,"input",105),r.mxI("ngModelChange",function(n){const s=r.eBV(t).$implicit;return r.DH7(s.quantite,n)||(s.quantite=n),r.Njj(n)}),r.k0s()()(),r.j41(10,"td")(11,"div",50),r.nrm(12,"input",106),r.nI1(13,"customNumber"),r.k0s()(),r.j41(14,"td")(15,"div",50),r.nrm(16,"input",107),r.nI1(17,"customNumber"),r.k0s()(),r.j41(18,"td"),r.DNE(19,ho,2,0,"div",108),r.k0s()()}if(2&c){const t=e.$implicit,i=r.XpG(2);r.R7$(3),r.Y8G("value",i.getProduitNom(t.produitId)),r.R7$(3),r.Y8G("disabled",i.isAnnule),r.R50("ngModel",t.ligneDescription),r.Y8G("ngModelOptions",r.lJ4(14,Wt)),r.R7$(3),r.Y8G("disabled",i.isAnnule),r.R50("ngModel",t.quantite),r.Y8G("ngModelOptions",r.lJ4(15,Wt)),r.R7$(3),r.Y8G("value",r.bMT(13,10,i.getPrixVente(t.produitId))),r.R7$(4),r.Y8G("value",r.bMT(17,12,i.getMontantTotal(t))),r.R7$(3),r.Y8G("ngIf",!i.isValidated)}}function po(c,e){if(1&c&&(r.j41(0,"option",113),r.EFF(1),r.k0s()),2&c){const t=e.$implicit;r.Y8G("ngValue",t.id),r.R7$(),r.SpI(" ",t.nom," ")}}function fo(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",118),r.bIt("click",function(){r.eBV(t);const n=r.XpG().index,s=r.XpG(3);return r.Njj(s.ajouterLigneFacture(n))}),r.nrm(1,"i",119),r.k0s()}}function go(c,e){if(1&c){const t=r.RV6();r.j41(0,"tr",101)(1,"div",50)(2,"td")(3,"select",112),r.mxI("ngModelChange",function(n){const s=r.eBV(t).$implicit;return r.DH7(s.produitId,n)||(s.produitId=n),r.Njj(n)}),r.bIt("ngModelChange",function(n){const s=r.eBV(t),o=s.$implicit,a=s.index,l=r.XpG(3);return r.Njj(l.onProduitChange(n,o,a))}),r.j41(4,"option",113),r.EFF(5,"S\xe9lectionner un produit"),r.k0s(),r.DNE(6,po,2,2,"option",114),r.k0s()()(),r.j41(7,"td")(8,"div",50)(9,"textarea",104),r.mxI("ngModelChange",function(n){const s=r.eBV(t).$implicit;return r.DH7(s.ligneDescription,n)||(s.ligneDescription=n),r.Njj(n)}),r.k0s()()(),r.j41(10,"td")(11,"div",50)(12,"input",115),r.mxI("ngModelChange",function(n){const s=r.eBV(t).$implicit;return r.DH7(s.quantite,n)||(s.quantite=n),r.Njj(n)}),r.bIt("ngModelChange",function(){r.eBV(t);const n=r.XpG(3);return r.Njj(n.updateCalculs())}),r.k0s()()(),r.j41(13,"td")(14,"div",50),r.nrm(15,"input",116),r.nI1(16,"customNumber"),r.k0s()(),r.j41(17,"td")(18,"div",50),r.nrm(19,"input",116),r.nI1(20,"customNumber"),r.k0s()(),r.j41(21,"td"),r.DNE(22,fo,2,0,"div",117),r.k0s()()}if(2&c){const t=e.$implicit,i=e.index,n=r.XpG(3);r.R7$(3),r.Mz_("name","produit",i,""),r.Y8G("disabled",n.isAnnule),r.R50("ngModel",t.produitId),r.Y8G("ngModelOptions",r.lJ4(21,Wt))("ngClass",r.eq3(22,qr,t.isDuplicate)),r.R7$(),r.Y8G("ngValue",null),r.R7$(2),r.Y8G("ngForOf",n.produits),r.R7$(3),r.Y8G("disabled",n.isAnnule),r.R50("ngModel",t.ligneDescription),r.Y8G("ngModelOptions",r.lJ4(24,Wt)),r.R7$(3),r.Y8G("disabled",n.isAnnule),r.R50("ngModel",t.quantite),r.Y8G("ngModelOptions",r.lJ4(25,Wt)),r.R7$(3),r.Y8G("value",r.bMT(16,17,n.getPrixVente(t.produitId))),r.R7$(4),r.Y8G("value",r.bMT(20,19,n.getMontantTotal(t))),r.R7$(3),r.Y8G("ngIf",!n.isValidated)}}function mo(c,e){if(1&c&&(r.j41(0,"tbody"),r.DNE(1,go,23,26,"tr",111),r.k0s()),2&c){const t=r.XpG(2);r.R7$(),r.Y8G("ngForOf",t.inputLignes)("ngForTrackBy",t.trackByFn)}}function _o(c,e){if(1&c&&(r.j41(0,"span"),r.EFF(1),r.k0s()),2&c){const t=r.XpG(3);r.R7$(),r.SpI("(",t.remisePourcentage,"%)")}}function bo(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",120)(1,"div",121)(2,"input",122),r.nI1(3,"number"),r.mxI("ngModelChange",function(n){r.eBV(t);const s=r.XpG(2);return r.DH7(s.remisePourcentage,n)||(s.remisePourcentage=n),r.Njj(n)}),r.k0s(),r.j41(4,"label",123),r.EFF(5," REMISE "),r.DNE(6,_o,2,1,"span",42),r.k0s()(),r.j41(7,"div",121),r.nrm(8,"input",124),r.nI1(9,"customNumber"),r.j41(10,"label",123),r.EFF(11,"Montant (CFA)"),r.k0s()()()}if(2&c){const t=r.XpG(2);r.R7$(2),r.Y8G("value",r.bMT(3,4,t.factureProForma.remise)),r.R50("ngModel",t.remisePourcentage),r.R7$(4),r.Y8G("ngIf",null!==t.remisePourcentage),r.R7$(2),r.Y8G("value",r.bMT(9,6,t.getMontantRemise()))}}function vo(c,e){if(1&c&&(r.j41(0,"div",120)(1,"div",39),r.nrm(2,"input",125),r.nI1(3,"number"),r.j41(4,"label",123),r.EFF(5,"TVA (%)"),r.k0s()(),r.j41(6,"div",121),r.nrm(7,"input",124),r.nI1(8,"number"),r.j41(9,"label",123),r.EFF(10,"Montant (CFA)"),r.k0s()()()),2&c){const t=r.XpG(2);r.R7$(2),r.Y8G("value",null!=t.tauxTva?r.i5U(3,2,100*t.tauxTva,"1.0-0")+"%":""),r.R7$(5),r.Y8G("value",null!=t.getMontantTVA()?r.i5U(8,5,t.getMontantTVA(),"1.0-3"):"")}}function Ao(c,e){if(1&c){const t=r.RV6();r.j41(0,"button",131),r.bIt("click",function(){r.eBV(t);const n=r.XpG(3);return r.Njj(n.submitUpdateForm())}),r.EFF(1,"Modifier"),r.k0s()}}function yo(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",126)(1,"div",127)(2,"button",128),r.bIt("click",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.getAnnulerDetail())}),r.EFF(3,"Annuler"),r.k0s()(),r.j41(4,"div",129),r.DNE(5,Ao,2,0,"button",130),r.k0s()()}if(2&c){const t=r.XpG(2);r.R7$(5),r.Y8G("ngIf",!t.isValidated)}}function xo(c,e){if(1&c&&(r.j41(0,"div",132),r.EFF(1),r.k0s()),2&c){const t=r.XpG(2);r.R7$(),r.SpI(" ",t.errorMessage," ")}}function Co(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",27)(1,"div",28)(2,"form",29)(3,"fieldset")(4,"div",30)(5,"h3"),r.EFF(6,"D\xe9tails de la facture pro forma"),r.k0s()(),r.j41(7,"div",31)(8,"div",32)(9,"h4"),r.EFF(10,"\xc9tat"),r.k0s(),r.j41(11,"div",33),r.DNE(12,ro,8,7,"div",34)(13,oo,3,0,"div",35)(14,ao,11,1,"div",21),r.k0s()()(),r.j41(15,"div",31)(16,"div",36)(17,"h2"),r.EFF(18,"FACTURE PRO FORMA : "),r.j41(19,"span"),r.EFF(20),r.k0s()(),r.j41(21,"p",37),r.EFF(22),r.nI1(23,"date"),r.k0s()()(),r.j41(24,"div",31)(25,"div",38)(26,"div",39)(27,"textarea",40),r.mxI("ngModelChange",function(n){r.eBV(t);const s=r.XpG();return r.DH7(s.factureProForma.description,n)||(s.factureProForma.description=n),r.Njj(n)}),r.k0s(),r.j41(28,"label",41),r.EFF(29," Objet "),r.k0s()()()(),r.j41(30,"div",31)(31,"div",38),r.DNE(32,lo,21,4,"div",42)(33,co,24,4,"div",42),r.k0s()(),r.j41(34,"div",31)(35,"div",38)(36,"div",43)(37,"h4"),r.EFF(38,"Produits"),r.k0s()(),r.j41(39,"div",44)(40,"table")(41,"thead")(42,"tr",45)(43,"th",46),r.EFF(44,"D\xe9signation"),r.k0s(),r.j41(45,"th",47),r.EFF(46,"Description"),r.k0s(),r.j41(47,"th",47),r.EFF(48,"Quantit\xe9"),r.k0s(),r.j41(49,"th",47),r.EFF(50,"Prix Unitaire"),r.k0s(),r.j41(51,"th",47),r.EFF(52,"Montant (FCFA)"),r.k0s()()(),r.j41(53,"tbody"),r.DNE(54,uo,20,16,"tr",48),r.k0s(),r.DNE(55,mo,2,2,"tbody",42),r.j41(56,"tfoot")(57,"tr",49)(58,"td")(59,"h4"),r.EFF(60,"MONTANT TOTAL HT "),r.k0s()(),r.nrm(61,"td")(62,"td")(63,"td"),r.j41(64,"td")(65,"div",50),r.nrm(66,"input",51),r.nI1(67,"customNumber"),r.k0s()(),r.nrm(68,"td"),r.k0s()()()()()(),r.j41(69,"div",31)(70,"div",38)(71,"div",52)(72,"p"),r.EFF(73,"Application de REMISE"),r.k0s(),r.j41(74,"label",53)(75,"input",54),r.mxI("ngModelChange",function(n){r.eBV(t);const s=r.XpG();return r.DH7(s.activeRemise,n)||(s.activeRemise=n),r.Njj(n)}),r.bIt("change",function(){r.eBV(t);const n=r.XpG();return r.Njj(n.onToggleRemise())}),r.k0s(),r.nrm(76,"span",55),r.k0s()(),r.DNE(77,bo,12,8,"div",56),r.k0s()(),r.j41(78,"div",31)(79,"div",38)(80,"div",57)(81,"h4"),r.EFF(82," MONTANT COMMERCIAL "),r.k0s(),r.j41(83,"div",58),r.EFF(84),r.nI1(85,"customNumber"),r.k0s()()()(),r.j41(86,"div",31)(87,"div",38)(88,"div",52)(89,"p"),r.EFF(90,"Application de TVA"),r.k0s(),r.j41(91,"label",53)(92,"input",54),r.mxI("ngModelChange",function(n){r.eBV(t);const s=r.XpG();return r.DH7(s.activeTva,n)||(s.activeTva=n),r.Njj(n)}),r.bIt("change",function(){r.eBV(t);const n=r.XpG();return r.Njj(n.onToggleTVA())}),r.k0s(),r.nrm(93,"span",55),r.k0s()(),r.DNE(94,vo,11,8,"div",56),r.k0s()(),r.j41(95,"div",31)(96,"div",38)(97,"div",57)(98,"h4"),r.EFF(99,"MONTANT TOTAL TTC "),r.k0s(),r.j41(100,"div",58),r.EFF(101),r.nI1(102,"customNumber"),r.k0s()()()()(),r.j41(103,"div",59)(104,"div",60)(105,"button",61),r.bIt("click",function(){r.eBV(t);const n=r.XpG();return r.Njj(n.apercuFactureProformaDansDetail())}),r.EFF(106,"Aper\xe7u "),r.nrm(107,"i",62),r.k0s()(),r.DNE(108,yo,6,1,"div",63),r.k0s(),r.j41(109,"div",64),r.DNE(110,xo,2,1,"div",65),r.k0s()()()()}if(2&c){const t=r.XpG();r.R7$(11),r.AVh("has-active",t.factureProForma.statut),r.R7$(),r.Y8G("ngIf",t.factureProForma.statut!==t.statusOptions.ANNULE),r.R7$(),r.Y8G("ngIf",t.factureProForma.statut===t.statusOptions.ANNULE),r.R7$(),r.Y8G("ngIf",t.showStatusConfirmation),r.R7$(6),r.SpI(" ",t.factureProForma.numeroFacture," "),r.R7$(2),r.Lme("",t.siege,", le ",r.i5U(23,28,t.factureProForma.dateCreation,"dd-MM-yyyy"),""),r.R7$(5),r.Y8G("disabled",t.isAnnule),r.R50("ngModel",t.factureProForma.description),r.Y8G("ngModelOptions",r.lJ4(37,Wt)),r.R7$(5),r.Y8G("ngIf",t.factureProForma.client),r.R7$(),r.Y8G("ngIf",t.factureProForma.entrepriseClient),r.R7$(21),r.Y8G("ngForOf",t.confirmedLignes),r.R7$(),r.Y8G("ngIf",t.factureProForma.statut!==t.statusOptions.ANNULE),r.R7$(11),r.Y8G("value",r.bMT(67,31,t.getTotalHT())),r.R7$(9),r.Y8G("disabled",t.isAnnule),r.R50("ngModel",t.activeRemise),r.Y8G("ngModelOptions",r.lJ4(38,Wt)),r.R7$(2),r.Y8G("ngIf",t.activeRemise),r.R7$(7),r.SpI(" ",r.bMT(85,33,t.getTotalCommercial())," CFA "),r.R7$(8),r.Y8G("disabled",t.isAnnule),r.R50("ngModel",t.activeTva),r.Y8G("ngModelOptions",r.lJ4(39,Wt)),r.R7$(2),r.Y8G("ngIf",t.activeTva),r.R7$(7),r.SpI(" ",r.bMT(102,35,t.getTotalTTC())," CFA "),r.R7$(7),r.Y8G("ngIf",t.factureProForma.statut!==t.statusOptions.ANNULE),r.R7$(2),r.Y8G("ngIf",t.errorMessage)}}function Eo(c,e){if(1&c){const t=r.RV6();r.j41(0,"i",143),r.bIt("click",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.toggleAddNoteInput())}),r.k0s()}}function wo(c,e){if(1&c){const t=r.RV6();r.j41(0,"i",144),r.bIt("click",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.submitNote())}),r.k0s()}}function Po(c,e){if(1&c){const t=r.RV6();r.j41(0,"i",145),r.bIt("click",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.closeNoteInput())}),r.k0s()}}function So(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",146)(1,"textarea",147),r.mxI("ngModelChange",function(n){r.eBV(t);const s=r.XpG(2);return r.DH7(s.noteModification,n)||(s.noteModification=n),r.Njj(n)}),r.k0s()()}if(2&c){const t=r.XpG(2);r.R7$(),r.R50("ngModel",t.noteModification)}}function Mo(c,e){if(1&c&&(r.j41(0,"span",148),r.EFF(1),r.k0s()),2&c){const t=r.XpG(2);r.R7$(),r.SpI(" ",t.infoMessage," ")}}function To(c,e){if(1&c){const t=r.RV6();r.qex(0),r.j41(1,"div",162)(2,"p"),r.EFF(3,"Voulez-vous vraiment supprimer cette note ?"),r.k0s(),r.j41(4,"div",163)(5,"button",160),r.bIt("click",function(){r.eBV(t);const n=r.XpG(2).index,s=r.XpG(2);return r.Njj(s.confirmDelete(n))}),r.EFF(6,"Oui"),r.k0s(),r.j41(7,"button",160),r.bIt("click",function(){r.eBV(t);const n=r.XpG(4);return r.Njj(n.cancelDelete())}),r.EFF(8,"Non"),r.k0s()()(),r.bVm()}}function ko(c,e){if(1&c){const t=r.RV6();r.j41(0,"button",160),r.bIt("click",function(){r.eBV(t);const n=r.XpG(2).index,s=r.XpG(2);return r.Njj(s.askDelete(n))}),r.EFF(1,"\u{1f5d1}\ufe0f Supprimer"),r.k0s()}}function Io(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",159)(1,"button",160),r.bIt("click",function(){r.eBV(t);const n=r.XpG().index,s=r.XpG(2);return r.Njj(s.editNote(n))}),r.EFF(2,"\u270f\ufe0f Modifier"),r.k0s(),r.DNE(3,To,9,0,"ng-container",161)(4,ko,2,0,"ng-template",null,0,r.C5r),r.k0s()}if(2&c){const t=r.sdS(5),i=r.XpG().index,n=r.XpG(2);r.R7$(3),r.Y8G("ngIf",n.confirmDeleteIndex===i)("ngIfElse",t)}}function Fo(c,e){if(1&c&&(r.j41(0,"span",164),r.EFF(1),r.nI1(2,"date"),r.k0s()),2&c){const t=r.XpG().$implicit;r.R7$(),r.SpI("",r.i5U(2,1,t.dateCreation,"dd/MM/yyyy HH:mm")," \u29bf ")}}function Oo(c,e){1&c&&(r.j41(0,"span",165),r.EFF(1,"Modifi\xe9e"),r.k0s())}function Ro(c,e){if(1&c){const t=r.RV6();r.j41(0,"li")(1,"div",149)(2,"div",150)(3,"i",151),r.bIt("click",function(){const n=r.eBV(t).index,s=r.XpG(2);return r.Njj(s.toggleNoteMenu(n))}),r.k0s(),r.DNE(4,Io,6,2,"div",152),r.k0s(),r.j41(5,"div",153),r.EFF(6),r.k0s(),r.j41(7,"div",154),r.DNE(8,Fo,3,4,"span",155),r.j41(9,"span",156),r.EFF(10),r.k0s(),r.DNE(11,Oo,2,0,"span",157),r.j41(12,"span",158),r.EFF(13),r.k0s()()()()}if(2&c){const t=e.$implicit,i=e.index,n=r.XpG(2);r.R7$(4),r.Y8G("ngIf",n.activeMenuIndex===i),r.R7$(2),r.JRh(t.content),r.R7$(2),r.Y8G("ngIf",t.dateCreation),r.R7$(2),r.JRh(t.auteur),r.R7$(),r.Y8G("ngIf",t.modifiee),r.R7$(2),r.JRh(t.numeroIdentifiant)}}function Do(c,e){if(1&c&&(r.j41(0,"div",133)(1,"div",134)(2,"span",135),r.EFF(3,"\u{1f5d2}\ufe0f Mes notes"),r.k0s(),r.DNE(4,Eo,1,0,"i",136)(5,wo,1,0,"i",137)(6,Po,1,0,"i",138),r.k0s(),r.DNE(7,So,2,1,"div",139),r.j41(8,"ul",140),r.DNE(9,Mo,2,1,"span",141)(10,Ro,14,6,"li",142),r.k0s()()),2&c){const t=r.XpG();r.R7$(4),r.Y8G("ngIf",!t.isAddNoteInputVisible),r.R7$(),r.Y8G("ngIf",t.isAddNoteInputVisible&&""!==t.noteModification.trim()),r.R7$(),r.Y8G("ngIf",t.isAddNoteInputVisible&&""===t.noteModification.trim()),r.R7$(),r.Y8G("ngIf",t.isAddNoteInputVisible),r.R7$(2),r.Y8G("ngIf",t.infoMessage),r.R7$(),r.Y8G("ngForOf",t.notes)}}function Lo(c,e){if(1&c&&(r.j41(0,"div",177),r.EFF(1),r.k0s()),2&c){const t=r.XpG().$implicit;r.R7$(),r.SpI(" ",t.status," ")}}function No(c,e){if(1&c&&(r.j41(0,"span"),r.EFF(1),r.k0s()),2&c){const t=e.$implicit;r.R7$(),r.SpI(" ",t.nomComplet," ")}}function jo(c,e){if(1&c&&(r.j41(0,"div",178),r.DNE(1,No,2,1,"span",142),r.k0s()),2&c){const t=r.XpG(2);r.R7$(),r.Y8G("ngForOf",t.factureProForma.approbateurs)}}function Bo(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",166)(1,"div",167)(2,"img",168),r.bIt("error",function(){const n=r.eBV(t).$implicit;return r.Njj(n.user.photo="assets/img/profil.png")}),r.k0s()(),r.j41(3,"div",169)(4,"div",170)(5,"span",171),r.EFF(6),r.k0s(),r.j41(7,"span",172),r.EFF(8),r.nI1(9,"date"),r.k0s()(),r.j41(10,"div",173),r.nrm(11,"i",174),r.EFF(12),r.DNE(13,Lo,2,1,"div",175)(14,jo,2,1,"div",176),r.k0s()()()}if(2&c){const t=e.$implicit;r.R7$(2),r.Y8G("src",t.user.photo||"assets/img/profil.png",r.B4B),r.R7$(4),r.JRh(t.user.nomComplet),r.R7$(2),r.JRh(r.i5U(9,8,t.date,"dd/MM/yyyy HH:mm")),r.R7$(2),r.Y8G("ngClass",r.ziG(11,Kr,"creation"===t.type,"approbation"===t.type,"envoi"===t.type,"validation"===t.type)),r.R7$(),r.Y8G("ngClass",r.ziG(16,Jr,"creation"===t.type,"approbation"===t.type,"envoi"===t.type,"validation"===t.type)),r.R7$(),r.SpI(" ",t.description," "),r.R7$(),r.Y8G("ngIf",t.status),r.R7$(),r.Y8G("ngIf","APPROBATION"===t.status)}}function $o(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",179)(1,"div",80)(2,"p"),r.EFF(3,"Ce produit est d\xe9j\xe0 dans la liste."),r.k0s(),r.j41(4,"button",160),r.bIt("click",function(){r.eBV(t);const n=r.XpG();return r.Njj(n.closePopup())}),r.EFF(5,"OK"),r.k0s()()()}}function Go(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",182)(1,"label",183),r.EFF(2,"Date de relance (facultative) :"),r.k0s(),r.j41(3,"input",184),r.mxI("ngModelChange",function(n){r.eBV(t);const s=r.XpG(2);return r.DH7(s.dateRelance,n)||(s.dateRelance=n),r.Njj(n)}),r.k0s()()}if(2&c){const t=r.XpG(2);r.R7$(3),r.R50("ngModel",t.dateRelance)}}function Uo(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",79)(1,"div",80)(2,"h4"),r.EFF(3,"Confirmer le changement de statut"),r.k0s(),r.j41(4,"p"),r.EFF(5,"\xcates-vous s\xfbr de vouloir "),r.j41(6,"span",180),r.EFF(7),r.k0s(),r.EFF(8," cette facture ?"),r.k0s(),r.DNE(9,Go,4,1,"div",181),r.j41(10,"div",81)(11,"button",82),r.bIt("click",function(){r.eBV(t);const n=r.XpG();return r.Njj(n.cancelStatusChange())}),r.EFF(12,"Annuler"),r.k0s(),r.j41(13,"button",83),r.bIt("click",function(){r.eBV(t);const n=r.XpG();return r.Njj(n.confirmStatusChange())}),r.EFF(14,"Confirmer"),r.k0s()()()()}if(2&c){const t=r.XpG();r.R7$(7),r.JRh(t.selectedStatutLabel),r.R7$(2),r.Y8G("ngIf","ENVOYE"===t.pendingStatut)}}function Vo(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",182)(1,"label",183),r.EFF(2,"Date de relance (facultative) :"),r.k0s(),r.j41(3,"input",184),r.mxI("ngModelChange",function(n){r.eBV(t);const s=r.XpG(2);return r.DH7(s.dateRelance,n)||(s.dateRelance=n),r.Njj(n)}),r.k0s()()}if(2&c){const t=r.XpG(2);r.R7$(3),r.R50("ngModel",t.dateRelance)}}function Ho(c,e){1&c&&(r.j41(0,"div"),r.EFF(1,"Aucun utilisateur \xe0 afficher"),r.k0s())}function zo(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",187)(1,"input",188),r.mxI("ngModelChange",function(n){const s=r.eBV(t).$implicit;return r.DH7(s.selected,n)||(s.selected=n),r.Njj(n)}),r.k0s(),r.j41(2,"label",189),r.EFF(3),r.k0s()()}if(2&c){const t=e.$implicit;r.R7$(),r.Mz_("id","user_",t.id,""),r.R50("ngModel",t.selected),r.R7$(),r.Mz_("for","user_",t.id,""),r.R7$(),r.Lme(" ",t.nomComplet," - ",t.phone," ")}}function Xo(c,e){if(1&c&&(r.j41(0,"div",182)(1,"label",185),r.EFF(2,"S\xe9lectionnez les utilisateurs \xe0 notifier :"),r.k0s(),r.DNE(3,Ho,2,0,"div",42)(4,zo,4,7,"div",186),r.k0s()),2&c){const t=r.XpG(2);r.R7$(3),r.Y8G("ngIf",0===t.users.length),r.R7$(),r.Y8G("ngForOf",t.users)}}function Wo(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",79)(1,"div",80)(2,"h4"),r.EFF(3,"Confirmer le changement de statut"),r.k0s(),r.j41(4,"p"),r.EFF(5," \xcates-vous s\xfbr de vouloir "),r.j41(6,"span",180),r.EFF(7),r.k0s(),r.EFF(8," cette facture ? "),r.k0s(),r.DNE(9,Vo,4,1,"div",181)(10,Xo,5,2,"div",181),r.j41(11,"div",81)(12,"button",82),r.bIt("click",function(){r.eBV(t);const n=r.XpG();return r.Njj(n.cancelStatusChange())}),r.EFF(13,"Annuler"),r.k0s(),r.j41(14,"button",83),r.bIt("click",function(){r.eBV(t);const n=r.XpG();return r.Njj(n.confirmStatusChange())}),r.EFF(15,"Confirmer"),r.k0s()()()()}if(2&c){const t=r.XpG();r.R7$(7),r.JRh(t.selectedStatutLabel),r.R7$(2),r.Y8G("ngIf","ENVOYE"===t.pendingStatut),r.R7$(),r.Y8G("ngIf","APPROBATION"===t.pendingStatut)}}function Yo(c,e){if(1&c){const t=r.RV6();r.j41(0,"span",229),r.EFF(1),r.j41(2,"span",230),r.bIt("click",function(){const n=r.eBV(t).index,s=r.XpG(3);return r.Njj(s.removeEmail(n))}),r.EFF(3,"\u2716"),r.k0s()()}if(2&c){const t=e.$implicit;r.R7$(),r.SpI(" ",t," ")}}function qo(c,e){if(1&c){const t=r.RV6();r.j41(0,"span",230),r.bIt("click",function(){r.eBV(t);const n=r.XpG().index,s=r.XpG(3);return r.Njj(s.removeCcEmail(n))}),r.EFF(1,"\u2716"),r.k0s()}}function Ko(c,e){if(1&c&&(r.j41(0,"span",231),r.EFF(1),r.DNE(2,qo,2,0,"span",232),r.k0s()),2&c){const t=e.$implicit,i=r.XpG(3);r.R7$(),r.SpI(" ",t," "),r.R7$(),r.Y8G("ngIf",t!==i.emailUtilisateur)}}function Jo(c,e){if(1&c){const t=r.RV6();r.j41(0,"li",233)(1,"span",234),r.EFF(2),r.k0s(),r.j41(3,"button",235),r.bIt("click",function(){const n=r.eBV(t).index,s=r.XpG(3);return r.Njj(s.removeAttachment(n))}),r.nrm(4,"i",236),r.k0s()()}if(2&c){const t=e.$implicit;r.R7$(2),r.JRh(t.name)}}function Qo(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",212)(1,"div",213)(2,"div",214),r.EFF(3," \xc0 "),r.k0s(),r.j41(4,"div",215)(5,"div",50)(6,"div",216),r.DNE(7,Yo,4,1,"span",217),r.j41(8,"input",218),r.mxI("ngModelChange",function(n){r.eBV(t);const s=r.XpG(2);return r.DH7(s.currentEmail,n)||(s.currentEmail=n),r.Njj(n)}),r.bIt("keydown.enter",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.addEmail())})("keydown.backspace",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.handleBackspace())}),r.k0s()()()()(),r.j41(9,"div",213)(10,"div",214),r.EFF(11," Cc "),r.k0s(),r.j41(12,"div",215)(13,"div",50)(14,"div",216),r.DNE(15,Ko,3,2,"span",219),r.j41(16,"input",220),r.mxI("ngModelChange",function(n){r.eBV(t);const s=r.XpG(2);return r.DH7(s.currentCcEmail,n)||(s.currentCcEmail=n),r.Njj(n)}),r.bIt("keydown.enter",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.addCcEmail())})("keydown.backspace",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.handleCcBackspace())}),r.k0s()()()()(),r.j41(17,"div",213)(18,"div",221),r.EFF(19," Objet "),r.k0s(),r.j41(20,"div",215)(21,"div",50),r.nrm(22,"input",222,1),r.k0s()()(),r.j41(24,"div",223)(25,"div",224,2),r.EFF(27),r.nrm(28,"br")(29,"br"),r.EFF(30," Suite \xe0 notre \xe9change, veuillez trouver ci-joint "),r.j41(31,"strong"),r.EFF(32),r.k0s(),r.EFF(33," correspondant \xe0 votre demande."),r.nrm(34,"br"),r.EFF(35," N\u2019h\xe9sitez pas \xe0 revenir vers nous si vous avez besoin d\u2019informations compl\xe9mentaires ou si des ajustements sont n\xe9cessaires."),r.nrm(36,"br")(37,"br"),r.EFF(38," Nous restons \xe0 votre disposition pour finaliser la commande d\xe8s validation de votre part."),r.nrm(39,"br")(40,"br"),r.EFF(41," vous pouvez nous r\xe9pondre sur ce mail: "),r.j41(42,"a",225),r.EFF(43),r.k0s(),r.nrm(44,"br")(45,"br"),r.EFF(46," Bien cordialement,"),r.nrm(47,"br")(48,"br"),r.EFF(49," ---"),r.nrm(50,"br"),r.EFF(51),r.k0s()(),r.j41(52,"div",226)(53,"ul"),r.DNE(54,Jo,5,1,"li",227),r.k0s(),r.j41(55,"input",228,3),r.bIt("change",function(n){r.eBV(t);const s=r.XpG(2);return r.Njj(s.onFileSelected(n))}),r.k0s()()()}if(2&c){const t=r.XpG(2);r.R7$(7),r.Y8G("ngForOf",t.emailDestinatairesList),r.R7$(),r.R50("ngModel",t.currentEmail),r.R7$(7),r.Y8G("ngForOf",t.emailCcList),r.R7$(),r.R50("ngModel",t.currentCcEmail),r.R7$(6),r.Y8G("value","Facture pro forma "+(t.factureProForma.numeroFacture||"")),r.R7$(5),r.SpI(" Bonjour ",t.destinataire.nom," ,"),r.R7$(5),r.SpI("la facture proforma ",t.factureProForma.numeroFacture,""),r.R7$(10),r.Y8G("href","mailto:"+t.emailCcList,r.B4B),r.R7$(),r.JRh(t.emailCcList),r.R7$(8),r.SpI(" ",t.nomEntreprise," "),r.R7$(3),r.Y8G("ngForOf",t.attachments)}}function Zo(c,e){if(1&c&&(r.j41(0,"tr")(1,"td",123),r.EFF(2,"Si\xe8ge :"),r.k0s(),r.j41(3,"td",244),r.EFF(4),r.k0s()()),2&c){const t=r.XpG(3);r.R7$(4),r.JRh(t.destinataire.siege)}}function ta(c,e){if(1&c&&(r.j41(0,"tr")(1,"td",123),r.EFF(2,"Ville :"),r.k0s(),r.j41(3,"td",244),r.EFF(4),r.k0s()()),2&c){const t=r.XpG(3);r.R7$(4),r.JRh(t.destinataire.ville)}}function ea(c,e){if(1&c&&(r.j41(0,"div",237)(1,"div",238),r.nrm(2,"img",239),r.j41(3,"p",240),r.EFF(4,"TCHAK3DA"),r.k0s()(),r.j41(5,"div",241)(6,"p",242),r.EFF(7,"\u{1f4cd} Veuillez d\xe9poser la facture \xe0 l'adresse suivante :"),r.k0s(),r.j41(8,"table",243)(9,"tr")(10,"td",123),r.EFF(11),r.k0s(),r.j41(12,"td",244),r.EFF(13),r.k0s()(),r.DNE(14,Zo,5,1,"tr",42),r.j41(15,"tr")(16,"td",123),r.EFF(17,"Adresse :"),r.k0s(),r.j41(18,"td",244),r.EFF(19),r.k0s()(),r.DNE(20,ta,5,1,"tr",42),r.j41(21,"tr")(22,"td",123),r.EFF(23,"Pays :"),r.k0s(),r.j41(24,"td",244),r.EFF(25),r.k0s()(),r.j41(26,"tr")(27,"td",123),r.EFF(28,"T\xe9l\xe9phone :"),r.k0s(),r.j41(29,"td",244),r.EFF(30),r.k0s()(),r.j41(31,"tr")(32,"td",123),r.EFF(33,"Email :"),r.k0s(),r.j41(34,"td",244),r.EFF(35),r.k0s()()()()()),2&c){const t=r.XpG(2);r.R7$(11),r.SpI("",t.labelNom," :"),r.R7$(2),r.JRh(t.destinataire.nom),r.R7$(),r.Y8G("ngIf",t.destinataire.siege),r.R7$(5),r.JRh(t.destinataire.adresse),r.R7$(),r.Y8G("ngIf",t.destinataire.ville),r.R7$(5),r.JRh(t.destinataire.pays),r.R7$(5),r.JRh(t.destinataire.telephone),r.R7$(5),r.JRh(t.destinataire.email)}}function ia(c,e){1&c&&(r.j41(0,"span"),r.EFF(1,"Envoyer"),r.k0s())}function na(c,e){1&c&&r.nrm(0,"div",247)}function sa(c,e){if(1&c){const t=r.RV6();r.j41(0,"button",245),r.bIt("click",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.confirmEmailSend())}),r.DNE(1,ia,2,0,"span",42)(2,na,1,0,"div",246),r.k0s()}if(2&c){const t=r.XpG(2);r.Y8G("disabled",!t.emailDestinatairesList.length||t.isSending),r.R7$(),r.Y8G("ngIf",!t.isSending),r.R7$(),r.Y8G("ngIf",t.isSending)}}function ra(c,e){1&c&&(r.j41(0,"span"),r.EFF(1,"Confirmer"),r.k0s())}function oa(c,e){1&c&&r.nrm(0,"div",247)}function aa(c,e){if(1&c){const t=r.RV6();r.j41(0,"button",245),r.bIt("click",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.confirmEmailSend())}),r.DNE(1,ra,2,0,"span",42)(2,oa,1,0,"div",246),r.k0s()}if(2&c){const t=r.XpG(2);r.Y8G("disabled",t.isSending),r.R7$(),r.Y8G("ngIf",!t.isSending),r.R7$(),r.Y8G("ngIf",t.isSending)}}function la(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",248),r.bIt("click",function(){r.eBV(t);const n=r.XpG(2);return r.Njj(n.triggerFileInput())}),r.nrm(1,"i",249),r.k0s()}}function ca(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",190)(1,"div",191)(2,"div",192),r.bIt("mousedown",function(n){r.eBV(t);const s=r.XpG();return r.Njj(s.startDrag(n))}),r.j41(3,"div",193)(4,"p"),r.EFF(5,"Methode d'envoi : "),r.k0s(),r.j41(6,"div",194),r.bIt("mousedown",function(n){return r.eBV(t),r.Njj(n.stopPropagation())}),r.j41(7,"label",195)(8,"input",196),r.mxI("ngModelChange",function(n){r.eBV(t);const s=r.XpG();return r.DH7(s.methodeEnvoi,n)||(s.methodeEnvoi=n),r.Njj(n)}),r.bIt("change",function(){r.eBV(t);const n=r.XpG();return r.Njj(n.onMethodeEnvoiChange())}),r.k0s(),r.nrm(9,"span",197),r.EFF(10," Physique "),r.k0s(),r.j41(11,"label",195)(12,"input",198),r.mxI("ngModelChange",function(n){r.eBV(t);const s=r.XpG();return r.DH7(s.methodeEnvoi,n)||(s.methodeEnvoi=n),r.Njj(n)}),r.bIt("change",function(){r.eBV(t);const n=r.XpG();return r.Njj(n.onMethodeEnvoiChange())}),r.k0s(),r.nrm(13,"span",197),r.EFF(14," Email "),r.k0s()()(),r.j41(15,"div",199),r.bIt("click",function(){r.eBV(t);const n=r.XpG();return r.Njj(n.showEmailPopup=!1)})("mousedown",function(n){return r.eBV(t),r.Njj(n.stopPropagation())}),r.nrm(16,"i",200),r.k0s()(),r.nrm(17,"div",201),r.DNE(18,Qo,57,11,"div",202)(19,ea,36,8,"div",203),r.j41(20,"div",204)(21,"div",205)(22,"div",206)(23,"div",207),r.DNE(24,sa,3,3,"button",208)(25,aa,3,3,"button",208),r.k0s(),r.DNE(26,la,2,0,"div",209),r.k0s(),r.j41(27,"div",182)(28,"label",210),r.EFF(29,"Date de relance :"),r.k0s(),r.j41(30,"input",211),r.mxI("ngModelChange",function(n){r.eBV(t);const s=r.XpG();return r.DH7(s.dateRelance,n)||(s.dateRelance=n),r.Njj(n)}),r.k0s()()()()()()}if(2&c){const t=r.XpG();r.R7$(),r.Y8G("ngStyle",r.eq3(9,Qr,"translate3d("+t.popupOffset.x+"px, "+t.popupOffset.y+"px, 0)")),r.R7$(7),r.R50("ngModel",t.methodeEnvoi),r.R7$(4),r.R50("ngModel",t.methodeEnvoi),r.R7$(6),r.Y8G("ngIf","email"===t.methodeEnvoi),r.R7$(),r.Y8G("ngIf","physique"===t.methodeEnvoi),r.R7$(5),r.Y8G("ngIf","email"===t.methodeEnvoi),r.R7$(),r.Y8G("ngIf","physique"===t.methodeEnvoi),r.R7$(),r.Y8G("ngIf","email"===t.methodeEnvoi),r.R7$(4),r.R50("ngModel",t.dateRelance)}}function ha(c,e){if(1&c){const t=r.RV6();r.j41(0,"div",79)(1,"div",80)(2,"h4"),r.EFF(3,"Confirmer l'annulation"),r.k0s(),r.j41(4,"p"),r.EFF(5," \xcates-vous s\xfbr de vouloir annuler cette facture ? Cette action est irr\xe9versible. "),r.k0s(),r.j41(6,"div",81)(7,"button",82),r.bIt("click",function(){r.eBV(t);const n=r.XpG();return r.Njj(n.cancelAnnulation())}),r.EFF(8,"Retour"),r.k0s(),r.j41(9,"button",250),r.bIt("click",function(){r.eBV(t);const n=r.XpG();return r.Njj(n.confirmAnnulation())}),r.EFF(10," Confirmer "),r.k0s()()()()}}let da=(()=>{class c{constructor(t,i,n,s,o,a,l,h,d,u){this.router=t,this.produitService=i,this.route=n,this.factureProFormaService=s,this.usersService=o,this.cdr=a,this.renderer=l,this.entrepriseService=h,this.previewService=d,this.dialog=u,this.enLettresPipe=new jr.X,this.isLoading=!1,this.activeRemise=!1,this.activeTva=!1,this.remisePourcentage=0,this.tva=0,this.errorMessage=null,this.nomEntreprise="",this.produits=[],this.pendingAdjustments=[],this.newProduitId=null,this.inputLignes=[{produitId:null,quantite:1,ligneDescription:null,isDuplicate:!1}],this.confirmedLignes=[],this.showDuplicatePopup=!1,this.showStatusConfirmation=!1,this.pendingStatut=null,this.showEmailPopup=!1,this.previewPDFUrl=null,this.loadingPreview=!1,this.selectedStatutLabel="",this.statusOptions=M.K,this.users=[],this.filteredUsers=[],this.emailDestinataires="",this.emailSujet="",this.emailMessage="",this.methodeEnvoi="physique",this.isDragging=!1,this.startX=0,this.startY=0,this.initialX=0,this.initialY=0,this.popupOffset={x:0,y:0},this.selectedFile=null,this.emailDestinatairesList=[],this.currentEmail="",this.emailCcList=[],this.currentCcEmail="",this.emailUtilisateur="",this.facture=null,this.nom=null,this.role=null,this.entrprisePhone=null,this.noteEditingIndex=null,this.email="",this.logo=null,this.historicalEvents=[],this.isSending=!1,this.attachments=[],this.currentAttachment=null,this.successMessage=null,this.showAnnulationConfirmation=!1,this.annulationReason="",this.isNotebookOpen=!1,this.isAddNotePopupOpen=!1,this.newNote="",this.notes=[],this.noteModification="",this.isAddNoteInputVisible=!1,this.infoMessage=null,this.confirmDeleteIndex=null,this.apiUrl=Br.c.imgUrl,this.factureProForma={id:0,numeroFacture:"",siege:"",dateCreation:"",description:"",totalHT:0,tva:!1,totalFacture:0,lignesFacture:[],statut:M.K.BROUILLON},this.onMouseMove=p=>{this.isDragging&&requestAnimationFrame(()=>{const g=p.clientY-this.startY;this.popupOffset.x=this.initialX+(p.clientX-this.startX),this.popupOffset.y=this.initialY+g,this.cdr.detectChanges()})},this.onMouseUp=()=>{this.isDragging=!1,document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},this.activeMenuIndex=null}ngOnInit(){this.getUserEntrepriseInfo(),this.getProduits(),this.getUserInfo(),this.setDefaultDateRelance();const t=this.route.snapshot.paramMap.get("id");t&&(this.factureId=+t,this.getUserInfo(),this.loadNotes())}get isValidated(){return this.factureProForma.statut===this.statusOptions.VALIDE}onRemiseChange(){this.remisePourcentage=Number(this.remisePourcentage)}getMontantRemise(){return this.getTotalHT()*this.remisePourcentage/100}getTotalApresRemise(){return this.getTotalHT()-this.getMontantRemise()}getMontantTVA(){return this.activeTva?this.getTotalApresRemise()*(this.tauxTva??0):0}getTotalCommercial(){return this.getTotalApresRemise()}getTotalTTC(){return this.getTotalApresRemise()+this.getMontantTVA()}loadHistoricalEvents(){this.factureProFormaService.getHistoriqueFacture(this.factureId).subscribe({next:t=>{this.historicalEvents=t.historiqueActions.map(i=>({date:new Date(i.date),user:{nomComplet:i.utilisateur||"Utilisateur inconnu",photo:i.photo?`${this.apiUrl}${i.photo}`:null},type:this.mapActionType(i.action),description:i.details,status:this.mapActionToStatus(i.action)})),this.historicalEvents.some(i=>"creation"===i.type)||(this.historicalEvents.push({date:new Date(this.factureProForma.dateCreation),montant:this.factureProForma.totalHT,user:{nomComplet:this.factureProForma.utilisateurCreateur?.nomComplet||"Syst\xe8me",photo:this.factureProForma.utilisateurCreateur?.photo||null},type:"creation",description:"Cr\xe9ation de la facture "+this.factureProForma.totalFacture}),console.log("les information ",this.historicalEvents)),this.historicalEvents.sort((i,n)=>n.date.getTime()-i.date.getTime())},error:t=>console.error("Erreur historique",t)})}mapActionType(t){return{Cr\u00e9ation:"creation",Modification:"modification",Approbation:"approbation",Approuver:"approbation",Validation:"validation",Envoi:"envoi",Annulation:"modification"}[t]||"modification"}mapActionToStatus(t){return{"Facture approuv\xe9e":M.K.APPROUVE,"Facture envoy\xe9e":M.K.ENVOYE,"Facture valid\xe9e":M.K.VALIDE}[t]}loadFactureProforma(t){this.factureProFormaService.getFactureProformaById(t).subscribe({next:i=>{this.factureProForma=i,this.loadHistoricalEvents(),this.confirmedLignes=i.lignesFacture.map(n=>({produitId:n.produit.id,quantite:n.quantite,ligneDescription:n.ligneDescription??""})),this.activeRemise=(i.remise??0)>0,this.remisePourcentage=this.activeRemise?(i.remise??0)/(i.totalHT||1)*100:0,this.activeTva=i.tva,this.isLoading=!1},error:i=>{console.error("Erreur:",i),this.errorMessage="Impossible de charger la facture",this.isLoading=!1}})}getPrixVente(t){if(!t)return 0;const i=this.produits.find(n=>n.id===t);return i&&i.prixVente||0}getMontantTotal(t){return this.getPrixVente(t.produitId)*(t.quantite||0)}getTotalHT(){return this.confirmedLignes.reduce((n,s)=>n+this.getMontantTotal(s),0)+this.inputLignes.reduce((n,s)=>s.produitId&&s.quantite>0?n+this.getMontantTotal(s):n,0)}getProduits(){var t=this;return(0,E.A)(function*(){return new Promise(i=>{t.userEntrepriseId&&t.produitService.getProduitsParEntreprise(t.userEntrepriseId).subscribe({next:n=>{t.produits=n,i()},error:n=>console.error("Erreur r\xe9cup\xe9ration produits :",n)})})})()}getUserInfo(){this.usersService.getUserInfo().subscribe({next:t=>{this.nomEntreprise=t.nomEntreprise,this.userEntrepriseId=t.entrepriseId,this.siege=t.siege,this.email=t.email,this.nom=t.nomComplet,this.role=t.roleType,this.email&&!this.emailCcList.includes(this.email)&&this.emailCcList.push(this.email),this.getProduits().then(()=>{this.loadFactureProforma(this.factureId)})},error:t=>{console.error("Erreur lors de la r\xe9cup\xe9ration des infos utilisateur :",t)}})}closePopup(){this.showDuplicatePopup=!1,this.updateCalculs()}updateCalculs(){this.inputLignes=[...this.inputLignes]}getProduitNom(t){return t&&this.produits.find(n=>n.id===t)?.nom||""}onToggleRemise(){this.activeRemise||(this.remisePourcentage=0)}onToggleTVA(){this.activeTva||(this.tva=0)}ajouterLigneFacture(t){const i=this.inputLignes[t];if(i.produitId&&i.quantite>0){if(this.confirmedLignes.some(s=>s.produitId===i.produitId))return void(this.showDuplicatePopup=!0);this.confirmedLignes.push({...i}),this.inputLignes=[{produitId:null,quantite:1,ligneDescription:null,isDuplicate:!1}]}}supprimerLigneConfirmee(t){this.factureProForma.lignesFacture.splice(t,1),this.confirmedLignes.splice(t,1)}trackByFn(t,i){return t}getFirstApprobateurName(){return this.factureProForma?.approbateurs?.[0]?.nomComplet}cleanFactureForUpdate(t){return{client:t.client?{id:t.client.id}:null,description:t.description,lignesFacture:t.lignesFacture.map(i=>({id:i.id,produit:{id:i.produit.id},quantite:i.quantite,prixUnitaire:i.prixUnitaire,ligneDescription:i.ligneDescription}))}}submitUpdateForm(){this.errorMessage=null,this.successMessage=null;const t={client:this.factureProForma.client?{id:this.factureProForma.client.id}:null,description:this.factureProForma.description,lignesFacture:this.confirmedLignes.map(n=>({produit:{id:n.produitId},quantite:n.quantite,prixUnitaire:this.getPrixVente(n.produitId),ligneDescription:n.ligneDescription})),remise:this.activeRemise?this.remisePourcentage:null,noteModification:this.noteModification||null},i=this.inputLignes.filter(n=>n.produitId&&n.quantite>0).map(n=>({produit:{id:n.produitId},quantite:n.quantite,prixUnitaire:this.getPrixVente(n.produitId),ligneDescription:n.ligneDescription}));t.lignesFacture=[...t.lignesFacture,...i],this.factureProFormaService.updateFactureProforma(this.factureId,this.activeRemise?this.remisePourcentage:void 0,this.activeTva,t).subscribe({next:n=>{console.log("Mise \xe0 jour r\xe9ussie !",n),this.router.navigate(["/facture-proforma"])},error:n=>{console.error("\xc9chec de la mise \xe0 jour",n);const s=n.error?.error||"Erreur lors de la modification",o=s.split(":");this.errorMessage=o.length>1?o[1].trim():s}})}openAnnulationConfirmation(){this.annulationReason="",this.showAnnulationConfirmation=!0}closeAnnulationPopup(){this.showAnnulationConfirmation=!1}cancelAnnulation(){this.showAnnulationConfirmation=!1}confirmAnnulation(){this.updateFactureStatut({statut:M.K.ANNULE,noteModification:this.annulationReason})}get isAnnule(){return this.factureProForma?.statut===this.statusOptions.ANNULE}updateFactureStatut(t){this.factureProFormaService.updateFactureProforma(this.factureId,void 0,void 0,t).subscribe({next:i=>{this.factureProForma=i,this.showAnnulationConfirmation=!1,this.loadHistoricalEvents(),this.successMessage="Facture annul\xe9e avec succ\xe8s",setTimeout(()=>this.successMessage=null,3e3)},error:i=>{console.error("Erreur lors de l'annulation",i),this.errorMessage=i.error?.message||"\xc9chec de l'annulation",this.showAnnulationConfirmation=!1}})}submitNote(){if(this.errorMessage=null,this.successMessage=null,null!==this.noteEditingIndex&&this.notes[this.noteEditingIndex]){const t=this.notes[this.noteEditingIndex];console.log("Note \xe0 modifier dans submitNote:",t);const i=Number(t.id);if(!i)return void(this.errorMessage="ID invalide pour la note s\xe9lectionn\xe9e");this.factureProFormaService.updateNote(this.factureId,i,this.noteModification||"").subscribe({next:n=>{console.log("Note mise \xe0 jour avec succ\xe8s !",n),this.successMessage="Note modifi\xe9e avec succ\xe8s.",this.loadNotes();const s=n?.noteId||n?.id||null;s?this.factureProFormaService.getNoteById(this.factureId,s).subscribe({next:o=>{this.notes.unshift(o)},error:o=>{console.error("Erreur lors de la r\xe9cup\xe9ration de la note ajout\xe9e",o)}}):console.warn("ID de la note non retourn\xe9 dans la r\xe9ponse."),this.notes[this.noteEditingIndex].content=this.noteModification,this.notes[this.noteEditingIndex].dateModification=new Date,this.noteModification="",this.isAddNoteInputVisible=!1,this.noteEditingIndex=null},error:n=>{console.error("\xc9chec de la mise \xe0 jour de la note",n);const s=n.error?.error||"Erreur lors de la modification de la note",o=s.split(":");this.errorMessage=o.length>1?o[1].trim():s}})}else{const t={noteModification:this.noteModification||null},i={id:Date.now(),content:this.noteModification,dateCreation:new Date,auteur:this.getCurrentUser().nomComplet||"Utilisateur inconnu",numeroIdentifiant:this.noteModification||""};this.factureProFormaService.updateFactureProforma(this.factureId,void 0,void 0,t).subscribe({next:n=>{console.log("Note ajout\xe9e avec succ\xe8s !",n),this.successMessage="Note enregistr\xe9e avec succ\xe8s.",this.loadNotes(),this.notes.unshift(i),this.noteModification="",this.isAddNoteInputVisible=!1},error:n=>{console.error("\xc9chec de l'ajout de la note",n);const s=n.error?.error||"Erreur lors de l'ajout de la note",o=s.split(":");this.errorMessage=o.length>1?o[1].trim():s}})}}canApprove(){return this.factureProForma.statut===M.K.BROUILLON}canSendToApproval(){return this.factureProForma.statut===M.K.APPROBATION}canSend(){return this.factureProForma.statut===M.K.APPROUVE}canValidate(){return this.factureProForma.statut===M.K.ENVOYE}openStatusConfirmation(t){t!==M.K.ENVOYE?this.isStatusTransitionAllowed(t)&&(this.pendingStatut=t,this.selectedStatutLabel=this.getStatusLabel(t),this.showStatusConfirmation=!0,t===M.K.APPROBATION&&this.loadUsersOfEntreprise(this.userEntrepriseId)):this.openEmailPopup()}loadPDFPreview(t){var i=this;return(0,E.A)(function*(){i.loadingPreview=!0,i.previewPDFUrl=null;try{const s=yield(yield Cn(t).promise).getPage(1),o=document.createElement("canvas"),a=o.getContext("2d");if(!a)throw new Error("Context Canvas 2D non disponible");const l=s.getViewport({scale:.5});o.height=l.height,o.width=l.width,yield s.render({canvasContext:a,viewport:l}).promise,i.previewPDFUrl=o.toDataURL()}catch(n){console.error("Erreur de pr\xe9visualisation PDF:",n)}finally{i.loadingPreview=!1}})()}openEmailPopup(){var t=this;return(0,E.A)(function*(){t.showEmailPopup=!0;const i=yield t.generatePDFAttachment();if(t.attachments=[],t.attachments.push({name:i.name,file:i}),t.emailDestinatairesList=[],t.factureProForma.client?.email){const n=t.factureProForma.client.email;t.emailDestinatairesList.includes(n)||t.emailDestinatairesList.push(n)}if(t.factureProForma.entrepriseClient?.email){const n=t.factureProForma.entrepriseClient.email;t.emailDestinatairesList.includes(n)||t.emailDestinatairesList.push(n)}})()}get destinataire(){const t=this.factureProForma.entrepriseClient,i=this.factureProForma.client;return{nom:t?.nom??i?.nomComplet??"",adresse:t?.adresse??i?.adresse??"",siege:t?.siege??"",ville:t?"":i?.ville??"",pays:t?.pays??i?.pays??"",telephone:t?.telephone??i?.telephone??"",email:t?.email??i?.email??""}}get labelNom(){return this.factureProForma.entrepriseClient?"Entreprise":"Nom"}isStatusTransitionAllowed(t){if(!this.factureProForma?.statut)return!1;const i={[M.K.BROUILLON]:[M.K.APPROUVE,M.K.APPROBATION,M.K.ENVOYE,M.K.VALIDE,M.K.ANNULE],[M.K.APPROBATION]:[M.K.APPROUVE,M.K.BROUILLON,M.K.ANNULE],[M.K.APPROUVE]:[M.K.ENVOYE,M.K.BROUILLON,M.K.VALIDE,M.K.ANNULE],[M.K.ENVOYE]:[M.K.VALIDE,M.K.APPROUVE,M.K.BROUILLON,M.K.ANNULE],[M.K.VALIDE]:[M.K.ANNULE],[M.K.ANNULE]:[]},n=this.factureProForma.statut;return i[n]?.includes(t)||!1}canTransitionTo(t){return this.isStatusTransitionAllowed(t)}confirmStatusChange(){if(!this.pendingStatut)return;const t=this.users.filter(o=>o.selected).map(o=>o.id),s={statut:this.pendingStatut,...this.pendingStatut===M.K.ENVOYE&&this.dateRelance?{dateRelance:this.dateRelance}:{},...this.pendingStatut!==M.K.APPROBATION&&{approbateurs:[]}};this.factureProFormaService.updateFactureProforma(this.factureId,this.activeRemise?this.remisePourcentage:0,this.activeTva,s,this.pendingStatut===M.K.APPROBATION?t:void 0).subscribe({next:o=>{const a={date:new Date,montant:this.factureProForma.totalHT,user:this.getCurrentUser(),type:this.getEventType(this.pendingStatut),description:this.getStatusDescription(this.pendingStatut),status:this.pendingStatut};this.historicalEvents=this.historicalEvents.filter(l=>l.status!==a.status),this.historicalEvents.unshift(a),this.factureProForma=o,this.activeRemise=(o.remise??0)>0,this.remisePourcentage=this.activeRemise?(o.remise??0)/(o.totalHT||1)*100:0,this.activeTva=o.tva,this.showStatusConfirmation=!1,this.pendingStatut=null,this.dateRelance=void 0},error:o=>{console.error("Erreur de mise \xe0 jour",o),alert("\xc9chec de la mise \xe0 jour du statut"),this.showStatusConfirmation=!1}})}getStatusDescription(t){return{[M.K.BROUILLON]:"Retour au brouillon",[M.K.APPROBATION]:"Demande d'approbation envoy\xe9e",[M.K.APPROUVE]:"Facture approuv\xe9e",[M.K.ENVOYE]:"Facture envoy\xe9e au client",[M.K.VALIDE]:"Facture valid\xe9e d\xe9finitivement",[M.K.ANNULE]:"Facture annul\xe9e"}[t]}getCurrentUser(){return{nomComplet:"Utilisateur Actuel",id:123}}getEventType(t){return{[M.K.BROUILLON]:"modification",[M.K.APPROBATION]:"approbation",[M.K.APPROUVE]:"approbation",[M.K.ENVOYE]:"envoi",[M.K.VALIDE]:"validation",[M.K.ANNULE]:"annulation"}[t]||"modification"}cancelStatusChange(){this.showStatusConfirmation=!1,this.pendingStatut=null}getStatusLabel(t){return{[M.K.BROUILLON]:"Brouillon",[M.K.APPROBATION]:"Approbation",[M.K.APPROUVE]:"Approuv\xe9",[M.K.ENVOYE]:"Envoy\xe9",[M.K.VALIDE]:"Valid\xe9",[M.K.ANNULE]:"Annul\xe9"}[t]}loadUsersOfEntreprise(t){null!=t?(this.isLoading=!0,this.usersService.getAllUsersOfEntreprise(t).subscribe({next:i=>{this.users=i.map(n=>({...n,selected:!1})),this.filteredUsers=this.users,this.isLoading=!1,console.log("Utilisateurs r\xe9cup\xe9r\xe9s:",this.users)},error:i=>{console.error("Erreur lors du chargement des utilisateurs",i),this.isLoading=!1}})):console.error("ID d\u2019entreprise invalide:",t)}onProduitChange(t,i,n){if(i.produitId=t,i.isDuplicate=!1,t){const s=this.confirmedLignes.some(l=>l.produitId===t),o=this.inputLignes.filter((l,h)=>h!==n).some(l=>l.produitId===t);if(s||o)return this.showDuplicatePopup=!0,i.isDuplicate=!0,void setTimeout(()=>{i.produitId=null,i.ligneDescription=null,i.isDuplicate=!1,this.updateCalculs()},0);const a=this.produits.find(l=>l.id===t);i.ligneDescription=a?.description??null}else i.ligneDescription=null;this.updateCalculs()}getAnnulerDetail(){this.router.navigate(["/facture-proforma"])}confirmEmailSend(){var t=this;return(0,E.A)(function*(){t.isSending=!0,yield new Promise(i=>setTimeout(i,3e3));try{const i={statut:M.K.ENVOYE,methodeEnvoi:t.methodeEnvoi.toUpperCase(),dateRelance:t.dateRelance?new Date(t.dateRelance).toISOString():void 0};yield t.factureProFormaService.updateFactureProforma(t.factureId,t.activeRemise?t.remisePourcentage:void 0,t.activeTva,i).toPromise(),"email"===t.methodeEnvoi&&(yield t.handleEmailSending()),t.showEmailPopup=!1,t.router.navigate(["/facture-proforma"])}catch(i){t.handleError(i)}})()}handleEmailSending(){var t=this;return(0,E.A)(function*(){const i={to:t.emailDestinatairesList.join(","),cc:t.emailCcList.join(","),subject:t.subjectInput.nativeElement.value.trim(),body:t.editableContent.nativeElement.innerHTML,attachments:yield t.prepareAttachments()};console.log("les donner du mail",i),yield t.factureProFormaService.envoyerFactureEmail(t.factureId,i).toPromise(),t.resetEmailForm()})()}prepareAttachments(){var t=this;return(0,E.A)(function*(){return Promise.all(t.attachments.map(function(){var i=(0,E.A)(function*(n){return n.file});return function(n){return i.apply(this,arguments)}}()))})()}processEmailSending(){var t=this;return(0,E.A)(function*(){if(t.currentEmail.trim()&&(t.emailDestinatairesList.push(t.currentEmail.trim()),t.currentEmail=""),0===t.emailDestinatairesList.length)throw new Error("Veuillez ajouter au moins un destinataire");const i=t.subjectInput.nativeElement.value.trim(),n=t.editableContent.nativeElement.innerHTML;if(!i||!n)throw new Error("Sujet et contenu du mail sont obligatoires");yield t.factureProFormaService.envoyerFactureEmail(t.factureId,{to:t.emailDestinatairesList.join(","),cc:t.emailCcList.join(","),subject:i,body:n}).toPromise(),t.emailDestinatairesList=[],t.currentEmail="",t.editableContent.nativeElement.innerHTML=""})()}handleError(t){console.error("Erreur:",t),this.errorMessage=t.message||"Une erreur est survenue",this.showEmailPopup=!1}resetEmailForm(){this.emailDestinatairesList=[],this.emailCcList=[],this.emailCcList=[],this.currentEmail="",this.attachments=[],this.editableContent.nativeElement.innerHTML=""}startDrag(t){t.preventDefault(),this.isDragging=!0,this.startX=t.clientX,this.startY=t.clientY,this.initialX=this.popupOffset.x,this.initialY=this.popupOffset.y,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}triggerFileInput(){this.fileInput?.nativeElement&&this.fileInput.nativeElement.click()}onFileSelected(t){const i=t.target;i.files&&i.files.length>0&&(Array.from(i.files).forEach(s=>{this.attachments.some(a=>a.name===s.name)||this.attachments.push({name:s.name,file:s})}),i.value="")}removeAttachment(t){this.attachments.splice(t,1)}addEmail(){const t=this.currentEmail.trim();t&&this.validateEmail(t)&&(this.emailDestinatairesList.includes(t)||this.emailDestinatairesList.push(t),this.currentEmail="")}addCcEmail(){const t=this.currentCcEmail.trim();t&&this.validateEmail(t)&&(this.emailCcList.includes(t)||this.emailCcList.push(t),this.currentCcEmail="")}removeEmail(t){this.emailDestinatairesList.splice(t,1)}removeCcEmail(t){this.emailCcList.splice(t,1)}validateEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}handleBackspace(){!this.currentEmail&&this.emailDestinatairesList.length>0&&this.emailDestinatairesList.pop()}handleCcBackspace(){!this.currentCcEmail&&this.emailCcList.length>0&&this.emailCcList.pop()}onMethodeEnvoiChange(){}generatePDFAttachment(){var t=this;return(0,E.A)(function*(){try{const H=yield function Nr(c,e){const t="object"==typeof e;return new Promise((i,n)=>{const s=new Lr.Ms({next:o=>{i(o),s.unsubscribe()},error:n,complete:()=>{t?i(e.defaultValue):n(new Dr.G)}});c.subscribe(s)})}(t.entrepriseService.getEntrepriseInfo());t.nomEntreprise=H.nom??"\u2014",t.siege=H.siege??"\u2014",t.email=H.email??"\u2014",t.logo=H.logo?H.logo.startsWith("http")||H.logo.startsWith("data:image/")?H.logo:`${t.apiUrl.replace(/\/$/,"")}/${H.logo.replace(/^\//,"")}`:null,t.secteur=H.secteur??"\u2014",t.telephone=H.telephone??"\u2014",t.adresse=H.adresse??"\u2014",t.nif=H.nif??"\u2014",t.banque=H.banque??"\u2014",t.nina=H.nina??"\u2014",t.pays=H.pays??"\u2014",t.rccm=H.rccm??"\u2014",t.siteWeb=H.siteWeb??"\u2014",t.signataire=H.signataire??"\u2014",t.signataireNom=H.signataireNom??"\u2014"}catch(H){console.error("Erreur de r\xe9cup\xe9ration des infos entreprise :",H)}const i=new rt.default({unit:"mm",format:"a4"});try{if(t.logo){const H=t.logo.startsWith("data:image/")?t.logo:yield t.getBase64ImageFromURL(t.logo),Re=H.match(/^data:image\/(png|jpeg|gif);/),ei=Re?Re[1].toUpperCase():"PNG";i.addImage(H,ei,15,10,47,17)}}catch(H){console.error("Erreur lors du chargement ou de l\u2019ajout du logo :",H)}i.setFontSize(10),i.setFont("helvetica","bold"),i.text(t.nomEntreprise||"Nom Entreprise",70,12),i.setFont("helvetica","normal"),i.text(`Secteur : ${t.secteur||"default"}`,70,17);const o=`Email : ${t.email||"default"}`;i.text(o,70,22);const a=i.getTextWidth(o);i.text(`T\xe9l\xe9phone : ${t.telephone||"default"}`,70+a+5,22),i.setDrawColor(200),i.line(15,29,195,29),i.line(15,30.5,195,30.5),i.setFontSize(14),i.setFont("helvetica","bold"),i.setTextColor(85,85,85),i.text(`FACTURE PROFORMA ${t.factureProForma.numeroFacture||"XXX\u2011XX\u2011XXXX"}`,105,37,{align:"center"}),i.setDrawColor(0),i.setFontSize(10),i.setFont("helvetica","normal"),i.text(`${t.siege||"default"}, le ${t.factureProForma.dateCreation?new Date(t.factureProForma.dateCreation).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"}):""}`,195,47,{align:"right"});let y=57;if(t.factureProForma){const Re=!!t.factureProForma.entrepriseClient,ei="Doit :",ma=t.factureProForma.client?t.factureProForma.client?.nomComplet??"Non sp\xe9cifi\xe9":Re?t.factureProForma.entrepriseClient?.nom??"Non sp\xe9cifi\xe9":"Non sp\xe9cifi\xe9";i.setFont("helvetica","bold"),i.text(ei,15,y),i.setFont("helvetica","normal"),i.text(ma,15+i.getTextWidth(ei)+2,y)}y+=7;const x="Objet :";i.setFont("helvetica","bold"),i.text(x,15,y),i.setFont("helvetica","normal"),i.text(t.factureProForma.description||"Objet",15+i.getTextWidth(x)+2,y);const A=y+10,C=t.confirmedLignes.map(H=>[t.getProduitNom(H.produitId)||"N/A",H.ligneDescription||"",t.getPrixVente(H.produitId).toString().replace(/\B(?=(\d{3})+(?!\d))/g," "),H.quantite.toString(),t.getMontantTotal(H).toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")]),P=t.getTotalHT(),S=t.getMontantRemise(),O=t.activeRemise&&S>0,tt=Math.max(0,O?P-S:P),st=t.getMontantTVA(),q=t.activeTva&&st>0,bt=tt+st;if(C.push([{content:"Total HT",colSpan:4,styles:{fontStyle:"normal",halign:"center"}},{content:P.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "),styles:{halign:"right"}}]),O&&(C.push([{content:`Remise (${t.remisePourcentage?t.remisePourcentage+" %":"Montant"})`,colSpan:4,styles:{fontStyle:"normal",halign:"center"}},{content:S.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "),styles:{halign:"right"}}]),C.push([{content:"Montant Commercial",colSpan:4,styles:{fontStyle:"normal",halign:"center"}},{content:tt.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "),styles:{halign:"right"}}])),q){const H=Math.round(100*(t.tauxTva??0));C.push([{content:`TVA (${H} %)`,colSpan:4,styles:{fontStyle:"normal",halign:"center"}},{content:st.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "),styles:{halign:"right"}}])}C.push([{content:"Montant TTC",colSpan:4,styles:{fontStyle:"normal",halign:"center"}},{content:bt.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "),styles:{fontStyle:"normal",halign:"right"}}]),i.autoTable({head:[["D\xe9signation","Description","Prix Unitaire (FCFA)","Quantit\xe9","Montant (FCFA)"]],body:C,startY:A,theme:"grid",styles:{fontSize:9,cellPadding:2,lineWidth:.1,lineColor:[221,221,221]},headStyles:{fillColor:[242,242,242],textColor:[0,0,0],fontSize:8,halign:"center",fontStyle:"bold"},bodyStyles:{textColor:[0,0,0],fillColor:null},margin:{left:15,right:15},columnStyles:{0:{halign:"left",cellWidth:30},1:{halign:"left",cellWidth:60},2:{halign:"center",cellWidth:33},3:{halign:"center",cellWidth:20},4:{halign:"right",cellWidth:35}},tableStyle:{borderColor:[200,200,200],borderWidth:.1}});let L=i.lastAutoTable.finalY+18;const lt="Arr\xeat\xe9 la pr\xe9sente facture \xe0 la somme de : ";i.setFont("helvetica","bold"),i.setFontSize(8),i.text(lt,15,L);const Bt=15+i.getTextWidth(lt);i.setFont("helvetica","normal"),i.setFontSize(9);const mt=t.enLettresPipe.transform(bt),Dt=i.splitTextToSize(mt,195-Bt);i.text(Dt[0],Bt,L);let Ot=L;for(let H=1;H<Dt.length;H++)Ot+=6,i.text(Dt[H],15,Ot);let kt=Ot+30;kt=Math.max(kt,i.internal.pageSize.height-70),i.setFontSize(10),i.setFont("helvetica","bold");const qt=t.signataire||"Directeur",se=i.getTextWidth(qt);i.text(qt,180-se/2,kt),i.setFontSize(12),i.setFont("helvetica","normal");const Ht=t.signataireNom||"Nom du signataire",ti=i.getTextWidth(Ht);i.text(Ht,180-ti/2,kt+8);const fa=i.internal.pageSize.width-15,Gn=i.internal.pageSize.height-20,Un=Gn-5;i.setLineWidth(.2),i.setDrawColor(150),i.line(15,Un,fa,Un),i.setFontSize(8),i.setFont("helvetica","normal"),i.setTextColor(100);let ge=Gn;t.siteWeb&&(i.text(t.siteWeb,105,ge,{align:"center"}),ge+=4);const me=[];t.nina&&me.push(`NINA : ${t.nina}`),t.rccm&&me.push(`RCCM : ${t.rccm}`),t.nif&&me.push(`NIF : ${t.nif}`),t.banque&&me.push(`Banque : ${t.banque}`),me.length>0&&(i.text(me.join(" ; "),105,ge,{align:"center"}),ge+=4);const Kt=t.adresse,Jt=t.siege,Qt=t.pays;let zt="";Kt&&Jt&&Qt?zt=`Adresse : ${Kt} / ${Jt}-${Qt}`:Kt&&Jt?zt=`Adresse : ${Kt} / ${Jt}`:Kt&&Qt?zt=`Adresse : ${Kt} / ${Qt}`:Jt&&Qt?zt=`Adresse : ${Jt} / ${Qt}`:Kt?zt=`Adresse : ${Kt}`:Jt?zt=`Adresse : ${Jt}`:Qt&&(zt=`Adresse : ${Qt}`),zt&&(i.text(zt,105,ge,{align:"center"}),ge+=4),i.setTextColor(0);const ga=i.output("blob");return new File([ga],`Facture proforma - ${t.factureProForma.numeroFacture||"XXX-XX-XXXX"}.pdf`,{type:"application/pdf"})})()}getUserEntrepriseInfo(){this.entrepriseService.getEntrepriseInfo().subscribe({next:t=>{console.log("Entreprise re\xe7ue :",t),this.userEntrepriseId=t.id??null,this.loadFactureProforma(this.factureId),this.nom=t.nom,this.siege=t.siege,this.email=t.email,this.logo=t.logo,this.secteur=t.secteur,this.telephone=t.telephone,this.adresse=t.adresse,this.nif=t.nif,this.banque=t.banque,this.nina=t.nina,this.pays=t.pays,this.rccm=t.rccm,this.siteWeb=t.siteWeb,this.signataire=t.signataire,this.signataireNom=t.signataireNom,this.tauxTva=t.tauxTva,this.logo=`${this.apiUrl}${t.logo}`,this.userEntrepriseId?this.loadUsersOfEntreprise(this.userEntrepriseId):(console.error("ID entreprise manquant apr\xe8s chargement"),console.log("Entreprise re\xe7ue :",JSON.stringify(t,null,2)))},error:t=>{console.error("Erreur lors de la r\xe9cup\xe9ration des infos utilisateur :",t)}})}loadFontScript(){return new Promise((t,i)=>{const n=document.createElement("script");n.src="assets/fonts/police/brittany.js",n.onload=()=>t(),n.onerror=()=>i("Erreur lors du chargement de la police"),document.body.appendChild(n)})}getBase64ImageFromURL(t){return(0,E.A)(function*(){const i=yield fetch(t);if(!i.ok)throw new Error(`Erreur lors du chargement de l'image : ${i.statusText}`);const n=yield i.blob();return new Promise((s,o)=>{const a=new FileReader;a.onloadend=()=>{s(a.result)},a.onerror=o,a.readAsDataURL(n)})})()}goToPreview(){this.router.navigate(["/detail-facture-proforma-apercu",this.factureId])}apercuFactureProformaDansDetail(){const t=[...this.confirmedLignes.map(n=>({produit:{id:n.produitId,nom:this.getProduitNom(n.produitId)},quantite:n.quantite,ligneDescription:n.ligneDescription,prixUnitaire:this.getPrixVente(n.produitId)})),...this.inputLignes.filter(n=>n.produitId&&n.quantite>0).map(n=>({produit:{id:n.produitId,nom:this.getProduitNom(n.produitId)},quantite:n.quantite,ligneDescription:n.ligneDescription,prixUnitaire:this.getPrixVente(n.produitId)}))],i={...this.factureProForma,totalHT:this.getTotalHT(),remise:this.activeRemise?this.remisePourcentage:0,tva:this.activeTva,totalFacture:this.getTotalTTC(),lignesFacture:t};this.previewService.setPreview(i),this.router.navigate(["/detail-facture-proforma-apercu"])}loadNotes(){this.factureProFormaService.getNotesFactureProforma(this.factureId).subscribe({next:t=>{console.log("R\xe9ponse des notes :",t);const i=t?.filter(n=>n.note?.trim());if(!i||0===i.length)return this.infoMessage="Aucune note trouv\xe9e pour cette facture",void(this.notes=[]);i.sort((n,s)=>{const o=new Date(n.dateCreation).getTime();return new Date(s.dateCreation).getTime()-o}),this.notes=i.map(n=>({id:n.id,content:n.note,dateCreation:n.dateCreation?new Date(n.dateCreation):null,auteur:n.auteur,modifiee:n.modifiee,numeroIdentifiant:n.numeroIdentifiant||n.id})),this.infoMessage=null},error:t=>{console.error("Erreur lors du chargement des notes",t),this.infoMessage=t.error?.message||"Erreur lors de la r\xe9cup\xe9ration des notes."}})}toggleNotebook(){this.isNotebookOpen=!this.isNotebookOpen,this.activeMenuIndex=null}toggleAddNoteInput(){this.isAddNoteInputVisible=!this.isAddNoteInputVisible,this.activeMenuIndex=null}addNote(){this.newNote.trim()&&(this.notes.push({id:Date.now(),content:this.newNote.trim(),dateCreation:new Date,auteur:this.getCurrentUser().nomComplet,numeroIdentifiant:this.newNote.trim()}),this.newNote="",this.isAddNotePopupOpen=!1)}closeNoteInput(){this.noteModification="",this.isAddNoteInputVisible=!1}toggleNoteMenu(t){this.activeMenuIndex=this.activeMenuIndex===t?null:t,this.confirmDeleteIndex=null}editNote(t){const i=this.notes[t];console.log("Note s\xe9lectionn\xe9e pour modification:",i),this.noteModification=i.content,this.isAddNoteInputVisible=!0,this.activeMenuIndex=null,this.noteEditingIndex=t}askDelete(t){this.confirmDeleteIndex=t}confirmDelete(t){this.errorMessage=null;const i=this.notes[t];!i||!i.id||this.factureProFormaService.deletNoteFactureProforma(this.factureId,i.id).subscribe({next:()=>{const n=this.notes.findIndex(s=>s.id===i.id);-1!==n&&this.notes.splice(n,1),this.confirmDeleteIndex=null,this.activeMenuIndex=null,console.log("Note supprim\xe9e avec succ\xe8s"),this.loadHistoricalEvents(),this.loadNotes()},error:n=>{console.error("Erreur lors de la suppression de la note :",n),this.errorMessage=n.error?.message||"Erreur lors de la suppression de la note.",this.activeMenuIndex=null}})}cancelDelete(){this.confirmDeleteIndex=null,this.activeMenuIndex=null}setDefaultDateRelance(){const i=new Date((new Date).getTime()+2592e5);this.dateRelance=this.formatDateForInput(i)}formatDateForInput(t){const i=n=>n.toString().padStart(2,"0");return`${t.getFullYear()}-${i(t.getMonth()+1)}-${i(t.getDate())}T${i(t.getHours())}:${i(t.getMinutes())}`}navigateBack(){this.router.navigate(["/facture-proforma"])}static{this.\u0275fac=function(i){return new(i||c)(r.rXU(Bn.Ix),r.rXU($r.D),r.rXU(Bn.nX),r.rXU(Gr.c),r.rXU(Ur.g),r.rXU(r.gRc),r.rXU(r.sFG),r.rXU(Vr.r),r.rXU(Hr.Q),r.rXU(zr.j))}}static{this.\u0275cmp=r.VBU({type:c,selectors:[["app-detail-facture-proforma"]],viewQuery:function(i,n){if(1&i&&(r.GBs(Xr,5),r.GBs(Wr,5),r.GBs(Yr,5)),2&i){let s;r.mGM(s=r.lsd())&&(n.editableContent=s.first),r.mGM(s=r.lsd())&&(n.subjectInput=s.first),r.mGM(s=r.lsd())&&(n.fileInput=s.first)}},decls:23,vars:10,consts:[["showDeleteButton",""],["subjectInput",""],["editableContent",""],["fileInput",""],[1,"toast-container"],["class","alert alert-danger toast-message-danger",4,"ngIf"],["title","Retour sur la page facture pro forma",1,"retour_icon_text",2,"cursor","pointer","color","#0672E4",3,"click"],[1,"ri-arrow-left-s-line"],[2,"margin-left","8px","font-size","12px"],[1,"container_global"],["class","loading-overlay",4,"ngIf"],["class","content_formulaire",4,"ngIf"],[1,"container_brouillon_facture"],[1,"historical-timeline"],[1,"title_historique",2,"display","flex","align-items","center","justify-content","space-between"],[2,"margin","0"],["title","Voir le cahier de notes",1,"ri-file-edit-line",2,"font-size","1.1rem","cursor","pointer","color","#555",3,"click"],["class","note-notebook",4,"ngIf"],[1,"timeline-container"],["class","timeline-event",4,"ngFor","ngForOf"],["class","duplicate-popup",4,"ngIf"],["class","status-confirmation-popup",4,"ngIf"],["class","status-confirmation-popup-envoyer email-popup",4,"ngIf"],[1,"alert","alert-danger","toast-message-danger"],[1,"loading-overlay"],[1,"loading-content"],[1,"spinner"],[1,"content_formulaire"],[1,"modal-body"],[1,"container_formulaire"],[1,"Title"],[1,"information_cadre"],[1,"info_titre_etat"],[1,"etat_container"],["class","etat_content",4,"ngIf"],["class","annule-message",4,"ngIf"],[1,"info_titre_input","info_titre_input_proforma"],[2,"text-align","right"],[1,"info_titre_input"],[1,"champ_input"],["autocomplete","off","type","text","required","","placeholder","Saisis l'objet",1,"input_focus2",3,"ngModelChange","disabled","ngModel","ngModelOptions"],["for","object",1,"label"],[4,"ngIf"],[1,"add_new_quantite_stock"],[1,"containerTable"],[1,"titleTableProduit"],[1,"title_table_name"],[1,""],["class","tr_stock","style","border-top: 1px solid #f0f2f5;",4,"ngFor","ngForOf"],[1,"tr_stock"],[1,"champ_input",2,"margin-right","15px"],["type","text","disabled","",1,"input_focus_type",2,"cursor","no-drop","text-align","center",3,"value"],[1,"champ_input_inventaire"],[1,"switch"],["type","checkbox",3,"ngModelChange","change","disabled","ngModel","ngModelOptions"],[1,"slider","round"],["class","double_input_grid","style","margin-top: 15px;",4,"ngIf"],[1,"double_input_ttc"],[1,"montantTTC"],[1,"information_cadre",2,"display","flex","align-items","center","justify-content","space-between","padding","10px 20px 10px"],[2,"cursor","pointer","text-align","left","margin-left","20px"],["title","Voir l'aper\xe7u de facture proforma",1,"btn_apercu",3,"click"],[1,"ri-eye-2-line"],["class","info_titre_input info_titre_input_btn","style","padding: 0;",4,"ngIf"],[1,"container_error_message"],["class","error-message",4,"ngIf"],[1,"etat_content"],["class","etat_brouillon",4,"ngIf"],["class","etat_approbation",4,"ngIf"],["class","etat_approuver",4,"ngIf"],["class","etat_envoyer",4,"ngIf"],[1,"etat_valider"],[1,"btn_etat",3,"click","disabled"],[1,"etat_brouillon"],[1,"etat_approbation"],[1,"etat_approuver"],[1,"etat_envoyer"],[1,"annule-message"],[1,"ri-information-line"],[1,"status-confirmation-popup"],[1,"popup-content"],[1,"popup-actions"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click"],[1,"double_input_grid"],["autocomplete","off","readonly","","type","email","required","","placeholder","Saisis l'email",1,"input_focus",2,"cursor","no-drop",3,"value"],["for","email",1,"label"],["autocomplete","off","readonly","","type","text","required","","placeholder","Saisis le nom et pr\xe9nom",1,"input_focus",2,"cursor","no-drop",3,"value"],["for","nomComplet",1,"label"],["autocomplete","off","disabled","","readonly","","type","text","required","","placeholder","Saisis l'adresse",1,"input_focus",2,"cursor","no-drop",3,"value"],["for","adresse",1,"label"],["autocomplete","off","disabled","","readonly","","type","tel","required","","placeholder","00 00 00 00",1,"input_focus",2,"cursor","no-drop",3,"value"],["for","numero",1,"label"],[1,"name_icon"],[1,"iconEntrepriseList"],["title","Affiliation d'Entreprise",1,"ri-git-branch-fill"],["autocomplete","off","readonly","","type","text","required","","placeholder","Saisis le nom ",1,"input_focus",2,"cursor","no-drop",3,"value"],["for","nom",1,"label"],["for","totalFacture",1,"label"],["autocomplete","off","readonly","","type","text","required","","placeholder","Saisis l'adresse",1,"input_focus",2,"cursor","no-drop",3,"value"],["autocomplete","off","readonly","","type","tel","required","","placeholder","00 00 00 00",1,"input_focus",2,"cursor","no-drop",3,"value"],[1,"tr_stock",2,"border-top","1px solid #f0f2f5"],[1,"input_focus_type_select"],["type","text","readonly","","placeholder","Nom produit",1,"input_table",3,"value"],["type","text","placeholder","Description",1,"input_focus_type",2,"margin-bottom","-7px","min-width","120px","resize","none",3,"ngModelChange","disabled","ngModel","ngModelOptions"],["type","number","id","addQuantite","name","addQuantite","placeholder","Quantit\xe9",1,"input_focus_type",3,"ngModelChange","disabled","ngModel","ngModelOptions"],["type","text","placeholder","Prix unitaire","readonly","",1,"input_focus_type",2,"cursor","no-drop",3,"value"],["type","text","disabled","",1,"input_focus_type",2,"cursor","no-drop",3,"value"],["class","btn_delete_icon_add",3,"click",4,"ngIf"],[1,"btn_delete_icon_add",3,"click"],[1,"ri-delete-bin-5-fill"],["class","tr_stock","style","border-top: 1px solid #f0f2f5;",4,"ngFor","ngForOf","ngForTrackBy"],["required","",1,"input_focus_type","input_focus_type_select",3,"ngModelChange","disabled","name","ngModel","ngModelOptions","ngClass"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["type","number","placeholder","Quantit\xe9",1,"input_focus_type",3,"ngModelChange","disabled","ngModel","ngModelOptions"],["readonly","",1,"input_focus_type",2,"cursor","no-drop",3,"value"],["class","btn_ajouter_icon_add",3,"click",4,"ngIf"],[1,"btn_ajouter_icon_add",3,"click"],[1,"ri-add-fill"],[1,"double_input_grid",2,"margin-top","15px"],[1,"champ_input","champ_input2"],["type","number","step","0.01","name","remisePourcentage","placeholder","Remise en %",1,"input_focus",3,"ngModelChange","value","ngModel"],[1,"label"],["type","text","readonly","",1,"input_focus",2,"cursor","no-drop",3,"value"],["type","text","readonly","",1,"input_focus",3,"value"],[1,"info_titre_input","info_titre_input_btn",2,"padding","0"],[1,"btn_annuler"],[1,"btn_cancel",3,"click"],[1,"btn_ajouter"],["class","btn_save","type","submit",3,"click",4,"ngIf"],["type","submit",1,"btn_save",3,"click"],[1,"error-message"],[1,"note-notebook"],[1,"notebook-header"],[1,"title"],["class","ri-add-line add-icon icon","title","Ajouter une note",3,"click",4,"ngIf"],["class","ri-save-line add-icon icon","title","Enregistrer",3,"click",4,"ngIf"],["class","ri-close-line close-icon icon","title","Annuler",3,"click",4,"ngIf"],["class","add-note-inline",4,"ngIf"],[1,"note-list"],["class","message-notes",4,"ngIf"],[4,"ngFor","ngForOf"],["title","Ajouter une note",1,"ri-add-line","add-icon","icon",3,"click"],["title","Enregistrer",1,"ri-save-line","add-icon","icon",3,"click"],["title","Annuler",1,"ri-close-line","close-icon","icon",3,"click"],[1,"add-note-inline"],["placeholder","\xc9cris quelque chose...","rows","4",3,"ngModelChange","ngModel"],[1,"message-notes"],[1,"note-item","position-relative"],[1,"note-options"],["title","Options",1,"ri-more-2-fill",3,"click"],["class","note-menu",4,"ngIf"],[1,"note-text"],[1,"note-meta"],["class","meta-date",4,"ngIf"],[1,"meta-author"],["class","badge-modified",4,"ngIf"],[1,"meta-numeroIdentifiant"],[1,"note-menu"],[3,"click"],[4,"ngIf","ngIfElse"],[1,"confirm-dialog"],[1,"confirm-dialog-buttons"],[1,"meta-date"],[1,"badge-modified"],[1,"timeline-event"],[1,"event-avatar"],["alt","Avatar",1,"avatar",3,"error","src"],[1,"event-content"],[1,"event-header"],[1,"user-name"],[1,"event-date"],[1,"event-action",3,"ngClass"],[1,"action-icon",3,"ngClass"],["class","status-badge",4,"ngIf"],["class","approbateurs-list",4,"ngIf"],[1,"status-badge"],[1,"approbateurs-list"],[1,"duplicate-popup"],[1,"highlighted-status"],["class","form-group",4,"ngIf"],[1,"form-group"],["for","relanceDate",2,"font-size","12px"],["type","datetime-local","id","relanceDate",1,"form-control",3,"ngModelChange","ngModel"],[2,"font-size","12px"],["style","display: flex; align-items: center;",4,"ngFor","ngForOf"],[2,"display","flex","align-items","center"],["type","checkbox",2,"margin-right","8px","margin-bottom","8px",3,"ngModelChange","ngModel","id"],[3,"for"],[1,"status-confirmation-popup-envoyer","email-popup"],[1,"popup-content-envoyer",3,"ngStyle"],[1,"envoyer_croix",3,"mousedown"],[1,"titre_etat"],[1,"checkbox-group",3,"mousedown"],[1,"custom-radio"],["type","radio","name","methodeEnvoi","value","physique",3,"ngModelChange","change","ngModel"],[1,"radio-mark"],["type","radio","name","methodeEnvoi","value","email",3,"ngModelChange","change","ngModel"],[1,"icon_croix",3,"click","mousedown"],[1,"ri-close-large-line"],[1,"barre"],["class","contenue_form_envoyer",4,"ngIf"],["class","contenue_form_envoyer contenue_form_image_physique conteneur_horizontal",4,"ngIf"],[1,"footer_btn"],[1,"content_footer"],[1,"contenue_footer_btn"],[1,"btn_envoie_save"],["class","btn",3,"disabled","click",4,"ngIf"],["class","icon_attach","title","Ajouter des pi\xe8ces jointes",3,"click",4,"ngIf"],["for","relanceDate"],["type","datetime-local","id","relanceDate",1,"form-control","form-control-date",3,"ngModelChange","ngModel"],[1,"contenue_form_envoyer"],[1,"email_field"],[1,"titre_email_field","titre_email_field_vers"],[1,"input_email_field"],[1,"email-input-container"],["class","email-chip  email-chip-cc",4,"ngFor","ngForOf"],["type","text","placeholder","Ajouter des destinataires...",1,"inline-email-input",3,"ngModelChange","keydown.enter","keydown.backspace","ngModel"],["class","email-chip",4,"ngFor","ngForOf"],["type","text","placeholder","Ajouter des adresses en copie...",1,"inline-email-input",3,"ngModelChange","keydown.enter","keydown.backspace","ngModel"],[1,"titre_email_field"],["type","text","placeholder","Bienvenue \xe0 MyCompany !",1,"input_focus_type","input_table_des",3,"value"],[1,"email-body"],["contenteditable","true",1,"editable-content"],[3,"href"],[1,"section_img_pdf"],["class","cadre_pdf",4,"ngFor","ngForOf"],["type","file","hidden","","multiple","","accept",".pdf,.doc,.docx,.xls,.xlsx,.jpg,.png",3,"change"],[1,"email-chip","email-chip-cc"],[1,"remove-chip",3,"click"],[1,"email-chip"],["class","remove-chip",3,"click",4,"ngIf"],[1,"cadre_pdf"],[1,"text-truncate"],[1,"btn","flex-shrink-0",3,"click"],[1,"fa","fa-fw","fa-times"],[1,"contenue_form_envoyer","contenue_form_image_physique","conteneur_horizontal"],[1,"image_delivery"],["src","assets/img/physique.png","alt","Physique"],[1,"tchia"],[1,"infos-physique"],[1,"instruction"],[1,"infos-table"],[1,"value"],[1,"btn",3,"click","disabled"],["class","mini-spinner",4,"ngIf"],[1,"mini-spinner"],["title","Ajouter des pi\xe8ces jointes",1,"icon_attach",3,"click"],[1,"ri-attachment-2"],[1,"btn","btn-danger",3,"click"]],template:function(i,n){1&i&&(r.j41(0,"div",4),r.DNE(1,Zr,2,1,"div",5),r.k0s(),r.j41(2,"p",6),r.bIt("click",function(){return n.navigateBack()}),r.nrm(3,"i",7),r.j41(4,"span",8),r.EFF(5,"Facture pro forma"),r.k0s()(),r.j41(6,"div",9),r.DNE(7,to,5,0,"div",10)(8,Co,111,40,"div",11),r.j41(9,"div",12)(10,"div",13)(11,"div",14)(12,"h6",15),r.EFF(13,"Historique des actions"),r.k0s(),r.j41(14,"i",16),r.bIt("click",function(){return n.toggleNotebook()}),r.k0s()(),r.DNE(15,Do,11,6,"div",17),r.j41(16,"div",18),r.DNE(17,Bo,15,21,"div",19),r.k0s()()()(),r.DNE(18,$o,6,0,"div",20)(19,Uo,15,2,"div",21)(20,Wo,16,3,"div",21)(21,ca,31,11,"div",22)(22,ha,11,0,"div",21)),2&i&&(r.R7$(),r.Y8G("ngIf",n.errorMessage),r.R7$(6),r.Y8G("ngIf",n.isLoading),r.R7$(),r.Y8G("ngIf",n.factureProForma),r.R7$(7),r.Y8G("ngIf",n.isNotebookOpen),r.R7$(2),r.Y8G("ngForOf",n.historicalEvents),r.R7$(),r.Y8G("ngIf",n.showDuplicatePopup),r.R7$(),r.Y8G("ngIf",n.showStatusConfirmation),r.R7$(),r.Y8G("ngIf",n.showStatusConfirmation),r.R7$(),r.Y8G("ngIf",n.showEmailPopup),r.R7$(),r.Y8G("ngIf",n.showAnnulationConfirmation))},dependencies:[Y.YN,Y.qT,Y.xH,Y.y7,Y.me,Y.Q0,Y.Zm,Y.wz,Y.Fm,Y.BC,Y.cb,Y.YS,Y.vS,Y.cV,et.MD,et.YU,et.Sq,et.bT,et.B3,et.QX,et.vh,Y.X1,X.v],styles:['@charset "UTF-8";.container_global[_ngcontent-%COMP%]{display:grid;grid-template-columns:72% 28%}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%]{padding:10px 0}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f9f9f9}.loading-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center;color:#fff;font-size:18px;z-index:1000}.name_icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.iconEntrepriseList[_ngcontent-%COMP%]{padding-left:20px}.iconEntrepriseList[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px;cursor:pointer}.loading-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:10px}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(255,255,255,.3);border-top:4px solid white;border-radius:50%;width:40px;height:40px;animation:_ngcontent-%COMP%_spin 1s linear infinite}.content_formulaire[_ngcontent-%COMP%]{display:flex}.Title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px}.modal-body[_ngcontent-%COMP%]{margin-right:30px}.information_cadre[_ngcontent-%COMP%]{width:100%;height:auto;background-color:#fff;box-shadow:2px 2px 30px #0000001c;border-radius:5px;margin-top:20px;margin-bottom:20px}.info_titre_etat[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;padding:20px}.etat_content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.btn_etat[_ngcontent-%COMP%]{border:none;padding:6px 20px;background-color:#00000030;color:#fff;border-radius:5px;transition:all ease .2s}.btn_etat[_ngcontent-%COMP%]:hover{background-color:#e9d421;color:#000}.btn_etat_annuler[_ngcontent-%COMP%]{background-color:red!important;color:#fff}.btn_etat_annuler[_ngcontent-%COMP%]:hover{background-color:#cb0505!important;color:#fff}.has-active[_ngcontent-%COMP%]   .btn_etat[_ngcontent-%COMP%]:not(.active):hover{background-color:#00000030;color:#fff;cursor:pointer}.btn_etat.active[_ngcontent-%COMP%]{background-color:#e9d421;color:#000}.btn_etat_annuler.active[_ngcontent-%COMP%]{color:#fff}.info_titre_input[_ngcontent-%COMP%]{padding:10px 20px}.info_titre_input[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#0672e4}.info_titre_input_proforma[_ngcontent-%COMP%]{padding:15px 20px;position:relative}.info_titre_input[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;margin-bottom:10px;letter-spacing:.5px;text-align:center}.info_titre_input[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center;margin:0}.champ_input[_ngcontent-%COMP%]{position:relative;margin-bottom:6px;margin-right:0}.double_input_grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:20px}.double_input_grid_3[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px}.input_focus[_ngcontent-%COMP%]{width:100%;min-width:250px;height:49px;outline:none;border-bottom:1px solid rgb(53,50,50);border-top:none;border-left:none;border-right:none;margin:10px 0 0;transition:all .3s;font-size:14px;background:none;color:#0672e4}.champ_input[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{position:absolute;top:22px;left:4px;pointer-events:none;color:#6b6666}.input_focus[_ngcontent-%COMP%]:hover{border-bottom:1px solid #0672E4;border-top:none;border-left:none;border-right:none}.input_focus[_ngcontent-%COMP%]:not(:placeholder-shown) + .label[_ngcontent-%COMP%], .input_focus[_ngcontent-%COMP%]:focus + .label[_ngcontent-%COMP%]{color:#423838;top:0;left:0;transition:all .3s ease-in-out;background:none;font-size:11px;padding:0}.input_focus[_ngcontent-%COMP%]::placeholder{opacity:0}.input_focus[_ngcontent-%COMP%]:focus::placeholder{opacity:1;animation-delay:1s;font-size:12px;transition:all .2s ease-in-out}.input_focus2[_ngcontent-%COMP%]{width:100%;min-width:250px;height:70px;outline:none;border-top:none;border-left:none;border-right:none;margin:10px 0 0;transition:all .3s;font-size:14px;background:none;border-radius:5px;padding-top:10px;border-bottom:1px solid rgb(53,50,50);color:#0672e4}.input_focus2[_ngcontent-%COMP%]:hover{border-bottom:1px solid #0672E4;border-top:none;border-left:none;border-right:none}.champ_input2[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{position:absolute;top:22px;left:0;pointer-events:none;color:#423838}.champ_input[_ngcontent-%COMP%]   .labelCategory[_ngcontent-%COMP%]{color:#423838;left:0;font-size:14px}.input_focus2[_ngcontent-%COMP%]:not(:placeholder-shown) + .label[_ngcontent-%COMP%], .input_focus2[_ngcontent-%COMP%]:focus + .label[_ngcontent-%COMP%]{color:#423838;top:0;left:0;transition:all .3s ease-in-out;background:none;font-size:11px;padding:0}.input_focus2[_ngcontent-%COMP%]::placeholder{opacity:0}.input_focus2[_ngcontent-%COMP%]:focus::placeholder{opacity:1;animation-delay:1s;font-size:12px;transition:all .2s ease-in-out}.input_focus_type_select[_ngcontent-%COMP%]{min-width:200px}.input_focus_type_non_select[_ngcontent-%COMP%]{max-width:90px}.input_focus_type[_ngcontent-%COMP%]{width:100%;height:49px;outline:none;border-bottom:1px solid rgb(53,50,50);border-top:none;border-left:none;border-right:none;margin:10px 0 0;transition:all .3s;font-size:14px;background:none;color:#000}.input_table[_ngcontent-%COMP%]{width:100%;height:49px;outline:none;border-bottom:1px solid rgb(53,50,50);border-top:none;border-left:none;border-right:none;margin:10px 0 0;transition:all .3s;font-size:14px;background:none;color:#695c5c}.add_new_quantite_stock[_ngcontent-%COMP%]{margin-bottom:20px}.add_new_quantite_stock[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:13px;letter-spacing:.6px;color:#0000008e}.switch[_ngcontent-%COMP%]{position:relative;display:inline-block;width:50px;height:24px}.switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;inset:0;background-color:#ccc;transition:.4s;border-radius:24px}.slider[_ngcontent-%COMP%]:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:#fff;transition:.4s;border-radius:50%}input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:#0672e4}input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(26px)}.input_cursor[_ngcontent-%COMP%]{cursor:pointer}.icon_arrow[_ngcontent-%COMP%]{position:absolute;right:10px;top:25px}.icon_arrow[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:17px;color:#000}.champ_input_inventaire[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.champ_input_inventaire[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.error-message[_ngcontent-%COMP%]{font-size:10px;color:red;font-weight:700;margin-top:10px;margin-bottom:10px}.info_titre_input_btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:end;gap:20px}.btn_annuler[_ngcontent-%COMP%]   .btn_cancel[_ngcontent-%COMP%]{padding:8px 30px;border:none;border-radius:5px;background-color:red;color:#fff}.btn_annuler[_ngcontent-%COMP%]   .btn_cancel[_ngcontent-%COMP%]:hover{background-color:#d80101;transition:all ease-in .5s}.btn_ajouter[_ngcontent-%COMP%]   .btn_save[_ngcontent-%COMP%]{padding:8px 30px;border:none;border-radius:5px;background-color:#0672e4;color:#fff}.btn_ajouter[_ngcontent-%COMP%]   .btn_save[_ngcontent-%COMP%]:hover{background-color:#0863c5;transition:all .5s}.containerTable[_ngcontent-%COMP%]{position:relative;background-color:#fff;border-radius:10px}.titleTableProduit[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:13px;font-weight:500}.btn_ajouter_icon_add[_ngcontent-%COMP%]{margin-left:30px}.btn_ajouter_icon_add[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px;background-color:transparent;color:#0672e4;padding:2px;border-radius:50%;cursor:pointer;border:3px solid #0672E4}.btn_ajouter_icon_add[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:hover{background-color:#0863c50e;transition:all ease .5s}.btn_delete_icon_add[_ngcontent-%COMP%]{margin-left:30px;margin-top:10px}.btn_delete_icon_add[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px;color:red;cursor:pointer}.btn_delete_icon_add[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:hover{color:#ca0000;transition:all ease .5s}.champ_input_list_stock[_ngcontent-%COMP%]{display:block;position:relative;margin-bottom:10px}.double_input_ttc[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.btn_apercu[_ngcontent-%COMP%]{border:none;padding:2px 20px;border-radius:5px;background-color:#d0d0d0;color:#001225}.info_titre_input[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;margin-bottom:0;letter-spacing:.6px}.status-confirmation-popup[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000048;display:flex;justify-content:center;align-items:center;z-index:1000;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{background:#f9f9f9;border:1px solid rgba(0,0,0,.05);border-radius:1rem;padding:1.5rem;width:90%;max-width:350px;box-shadow:0 4px 12px #00000014;text-align:center;animation:_ngcontent-%COMP%_popUp .25s ease-in-out}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;font-weight:600;margin-bottom:.75rem;color:#222}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:11px;margin-bottom:1.25rem;color:#555}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .highlighted-status[_ngcontent-%COMP%]{background-color:#e7f1ff;color:#007bff;padding:.2rem .5rem;border-radius:.4rem;font-weight:600;text-transform:uppercase}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:.5rem;margin-bottom:1.25rem}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;font-size:.85rem;color:#444}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=datetime-local][_ngcontent-%COMP%]{width:100%;padding:.6rem .85rem;font-size:.95rem;font-weight:500;font-family:inherit;color:#2c3e50;background-color:#fdfdfd;border:1px solid #d1d5db;border-radius:8px;outline:none;transition:all .25s ease;box-shadow:inset 0 1px 2px #0000000d}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=datetime-local][_ngcontent-%COMP%]::placeholder{color:#9ca3af;font-weight:400}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=datetime-local][_ngcontent-%COMP%]:hover{border-color:#7aaef7;background-color:#fcfcfc}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=datetime-local][_ngcontent-%COMP%]:focus{border-color:#007bff;background-color:#fff;box-shadow:0 0 0 3px #007bff33}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=datetime-local][_ngcontent-%COMP%]::-webkit-calendar-picker-indicator{filter:invert(.5);cursor:pointer;-webkit-transition:filter .3s;transition:filter .3s;margin-left:4px}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=datetime-local][_ngcontent-%COMP%]:hover::-webkit-calendar-picker-indicator{filter:invert(.2)}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .popup-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:.75rem}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .popup-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;padding:.5rem 0;font-size:.95rem;border:none;border-radius:6px;cursor:pointer;transition:background .25s,transform .1s}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .popup-actions[_ngcontent-%COMP%]   button.btn-secondary[_ngcontent-%COMP%]{background-color:#e4e4e4;color:#333}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .popup-actions[_ngcontent-%COMP%]   button.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#d4d4d4}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .popup-actions[_ngcontent-%COMP%]   button.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .popup-actions[_ngcontent-%COMP%]   button.btn-primary[_ngcontent-%COMP%]:hover{background-color:#0056b3}.status-confirmation-popup[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]   .popup-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active{transform:scale(.98)}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_popUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(20);opacity:1}}.brouillon_facture[_ngcontent-%COMP%]{margin-top:40px;background-color:transparent;box-shadow:2px 2px 30px #00000028;border-radius:5px;padding:10px 0}.brouillon_double[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin:10px;background-color:#fff;padding:15px 10px;border-radius:5px;box-shadow:2px 2px 30px #0000000f}.titre_brouillont[_ngcontent-%COMP%]{font-size:12px;margin:0}.contenue_brouillont[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:11px;font-weight:400;margin:0}.duplicate-popup[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000;border-radius:4px;gap:15px;color:#d32f2f;animation:_ngcontent-%COMP%_shake .4s ease-in-out}.popup-content[_ngcontent-%COMP%]{background:#fff;padding:30px;border-radius:10px;text-align:center;width:90%;max-width:400px;box-shadow:0 5px 15px #0000004d;animation:fadeInDown .3s ease;position:relative}.popup-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px;padding:8px 15px;background:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer}.modal-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px}.modal-content-text[_ngcontent-%COMP%]{margin:0;font-size:14px}.modal-content-text-button[_ngcontent-%COMP%]{background:none;border:1px solid #d32f2f;color:#d32f2f;padding:5px 15px;border-radius:4px;cursor:pointer;transition:all .3s}.modal-content-text-button[_ngcontent-%COMP%]:hover{background:#d32f2f;color:#fff}.input_focus_type_select.duplicate[_ngcontent-%COMP%]{border-color:#f44!important;animation:_ngcontent-%COMP%_shake .5s}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:translate(0)}25%{transform:translate(5px)}75%{transform:translate(-5px)}}.email-popup[_ngcontent-%COMP%]   .popup-content-envoyer[_ngcontent-%COMP%]{max-width:600px}.email-popup[_ngcontent-%COMP%]{contain:strict}.status-confirmation-popup-envoyer[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000048;display:flex;justify-content:center;align-items:center;z-index:1000;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.popup-content-envoyer[_ngcontent-%COMP%]{background-color:#f9f9f9;border:1px solid rgba(0,0,0,.05);border-radius:5px;width:90%;box-shadow:0 4px 12px #00000014;text-align:center;animation:_ngcontent-%COMP%_popUp .25s ease-in-out;display:flex;flex-direction:column;height:66vh;will-change:transform}.envoyer_croix[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px 15px;border-radius:8px;cursor:move;-webkit-user-select:none;user-select:none;width:600px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.titre_etat[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-weight:600;color:#333;font-size:12px}.titre_etat[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.icon_croix[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;color:#888;font-size:18px;cursor:pointer;transition:color .3s ease}.icon_croix[_ngcontent-%COMP%]:hover{color:#ff4d4d}.tchia[_ngcontent-%COMP%]{transform:rotate3d(0,0,1,90deg);left:39%;position:relative;top:-39%;color:#495057}.checkbox-group[_ngcontent-%COMP%]{display:flex;gap:20px;align-items:center}.custom-radio[_ngcontent-%COMP%]{position:relative;padding-left:24px;cursor:pointer;font-size:13px;-webkit-user-select:none;user-select:none;color:#333;display:flex;align-items:center}.custom-radio[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{position:absolute;opacity:0;cursor:pointer}.radio-mark[_ngcontent-%COMP%]{position:absolute;left:0;top:50%;transform:translateY(-50%);height:12px;width:12px;background-color:#e0e0e0;border-radius:50%;transition:background-color .3s ease;border:1.5px solid #bbb}.custom-radio[_ngcontent-%COMP%]:hover   .radio-mark[_ngcontent-%COMP%]{background-color:#d3d3d3}.custom-radio[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .radio-mark[_ngcontent-%COMP%]{background-color:#007bff;border-color:#007bff}.radio-mark[_ngcontent-%COMP%]:after{content:"";position:absolute;display:none}.custom-radio[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .radio-mark[_ngcontent-%COMP%]:after{display:block}.custom-radio[_ngcontent-%COMP%]   .radio-mark[_ngcontent-%COMP%]:after{top:2px;left:2px;width:5px;height:5px;border-radius:50%;background:#fff;position:absolute}.barre[_ngcontent-%COMP%]{background-color:#0000001a;width:100%;height:1px}.contenue_form_envoyer[_ngcontent-%COMP%]{flex:1;overflow-y:auto;margin-top:10px;padding:0 20px}.envoyer_croix[_ngcontent-%COMP%], .barre[_ngcontent-%COMP%]{flex-shrink:0}.input_table_des[_ngcontent-%COMP%]{width:100%;outline:none;border-bottom:1px solid #f9f9f9;border-top:none;border-left:none;border-right:none;margin:10px 0 0;transition:all .3s;font-size:13px;background:none;color:#000;flex-grow:1;min-width:150px;padding:15px}.input_table_des[_ngcontent-%COMP%]:hover{border-bottom:1px solid rgba(0,0,0,.5529411765);transition:all ease-in-out}.email_field[_ngcontent-%COMP%]{display:grid;grid-template-columns:10% 90%;align-items:center}.titre_email_field[_ngcontent-%COMP%]{margin-bottom:-5px;text-align:left;margin-left:15px}.titre_email_field_vers[_ngcontent-%COMP%]{position:relative;top:-6px}.editable-content[_ngcontent-%COMP%]{border:none;padding:12px;min-height:200px;white-space:pre-wrap;text-align:left;line-height:1.5;font-size:12px}.editable-content[contenteditable=true][_ngcontent-%COMP%]:empty:before{content:attr(data-placeholder);color:#999;text-align:left}.editable-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{background:#fff3d6;padding:2px 4px;border-radius:3px;display:inline-block}.footer_btn[_ngcontent-%COMP%]{position:static;flex-shrink:0;border-top:1px solid rgba(0,0,0,.1019607843);background:#fff}.content_footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.contenue_footer_btn[_ngcontent-%COMP%]{display:flex;align-items:center;margin:15px 0 15px 10px;gap:10px}.contenue_form_envoyer[_ngcontent-%COMP%]::-webkit-scrollbar{width:2px}.contenue_form_envoyer[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#ccc;border-radius:4px}.btn_envoie_save[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%], .btn_envoie_ignore[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border:none;padding:5px 20px;border-radius:5px}.btn_envoie_save[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{background-color:#0672e4;color:#fff}.btn_envoie_ignore[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{background-color:#d7d7d7}.status-confirmation-popup-envoyer[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;z-index:1000;display:flex;justify-content:center;align-items:center}.pdf-preview-container[_ngcontent-%COMP%]{margin:20px 0;border:1px solid #ddd;border-radius:4px;padding:10px;text-align:center}.pdf-preview-image[_ngcontent-%COMP%]{max-width:100%;height:auto;box-shadow:0 2px 4px #0000001a}.loading-pdf[_ngcontent-%COMP%]{padding:20px;color:#666}.section_img_pdf[_ngcontent-%COMP%]{display:flex;justify-content:left}.section_img_pdf[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:0 0 0 15px;margin:0}.cadre_pdf[_ngcontent-%COMP%]{background-color:#e2e2e2;border-radius:5px;position:relative;padding:0 0 0 10px;margin-bottom:10px;display:flex;align-items:center;justify-content:space-between}.text-truncate[_ngcontent-%COMP%]{color:#0672e4}.icon_attach[_ngcontent-%COMP%]{margin-left:5px}.icon_attach[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .icon_relance[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px;cursor:pointer;padding:5px;border-radius:5px}ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{list-style-type:none;text-align:left}.form-group[_ngcontent-%COMP%]{display:flex;margin:0;gap:10px;align-items:center}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin:0}.form-group[_ngcontent-%COMP%]   .form-control-date[_ngcontent-%COMP%]{width:57%}.email-chips-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:5px;align-items:center}.email-input-container[_ngcontent-%COMP%]{border-radius:4px;min-height:38px;display:flex;flex-wrap:wrap;gap:5px;align-items:center}.email-chip[_ngcontent-%COMP%]{background:#d4d8e7;padding:0 10px;border-radius:15px;position:relative;font-size:11px}.email-chip-cc[_ngcontent-%COMP%]{background:#d6e6ff!important}.remove-chip[_ngcontent-ng-c3765948371][_ngcontent-%COMP%]{position:relative;right:0;top:44%;transform:translateY(0);cursor:pointer;color:#666;font-size:12px}.inline-email-input[_ngcontent-%COMP%]{border:none!important;outline:none!important;flex-grow:1;min-width:120px;padding:5px 0;height:20px;background-color:transparent}input.input_focus_type[_ngcontent-%COMP%]:focus{box-shadow:none!important}.notifications[_ngcontent-%COMP%]{list-style:none;padding:0;max-width:600px;margin:auto}.notification[_ngcontent-%COMP%]{display:flex;align-items:flex-start;margin-bottom:15px;padding:10px;border-radius:10px;background-color:#f1f1f1;box-shadow:0 2px 5px #0000000d}.media[_ngcontent-%COMP%]{display:flex;align-items:flex-start;width:100%}.img-radius[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;margin-right:10px;object-fit:cover}.media-body[_ngcontent-%COMP%]{background-color:#fff;padding:10px 15px;border-radius:10px;position:relative;width:100%}.media-body[_ngcontent-%COMP%]:before{content:"";position:absolute;top:15px;left:-10px;width:0;height:0;border-top:10px solid transparent;border-right:10px solid #ffffff;border-bottom:10px solid transparent}.user-info[_ngcontent-%COMP%]{margin:0;font-size:14px}.user-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#333}.user-info[_ngcontent-%COMP%]   .role[_ngcontent-%COMP%]{font-size:10px;color:#ff000075;margin-left:5px}.n-time[_ngcontent-%COMP%]{font-size:10px;color:#888;margin-left:10px}.icon[_ngcontent-%COMP%]{margin-right:5px}.action-info[_ngcontent-%COMP%]{font-size:13px;margin:5px 0;color:#000}.description[_ngcontent-%COMP%]{font-size:12px;color:#555}.chat-container[_ngcontent-%COMP%]{padding:1rem;background-color:#f9f9f9;border-radius:10px;max-height:400px;overflow-y:auto}.chat-bubble[_ngcontent-%COMP%]{background-color:#e1f5fe;border-left:4px solid #0288d1;padding:1rem;margin-bottom:1rem;border-radius:5px}.chat-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:.9rem;margin-bottom:.5rem;color:#0288d1}.chat-message[_ngcontent-%COMP%]{font-size:1rem;color:#333}.conteneur_horizontal[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px;margin:44px}.image_delivery[_ngcontent-%COMP%]{width:250px;height:auto;flex-shrink:0;text-align:center}.image_delivery[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;object-fit:cover;border-radius:8px}.tchia[_ngcontent-%COMP%]{bottom:101px;font-weight:700;font-size:14px}.infos-physique[_ngcontent-%COMP%]{font-family:Segoe UI,sans-serif;font-size:10px;background-color:#fff;padding:16px;border-left:4px solid #ffb64d;border-radius:10px;max-width:360px;color:#222}.infos-physique[_ngcontent-%COMP%]   .instruction[_ngcontent-%COMP%]{font-weight:600;margin-bottom:12px;font-size:10px;text-align:center}.infos-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:8px}.infos-table[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:700;padding:4px 3px;text-align:left;white-space:nowrap;vertical-align:top}.infos-table[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{padding:4px 8px;text-align:left;color:#444;word-break:break-word}.btn[disabled][_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed;background-color:#ccc}.email-chip[_ngcontent-%COMP%]{background-color:#e0e0e0;border-radius:12px;margin:2px;display:inline-flex;align-items:center}.email-chip[_ngcontent-%COMP%]   .remove-chip[_ngcontent-%COMP%]{margin-left:5px;cursor:pointer}.email-chip[_ngcontent-%COMP%]   .remove-chip[_ngcontent-%COMP%]:hover{color:#f44}.form-control-date[_ngcontent-%COMP%]{margin-top:8px;padding:4px;border:1px solid #ddd;border-radius:4px}.mini-spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:3px solid #f3f3f3;border-radius:50%;border-top:3px solid #3498db;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.btn[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.container_brouillon_facture[_ngcontent-%COMP%]{margin-top:40px;background:#fff;margin-bottom:20px;height:95%}.timeline-container[_ngcontent-%COMP%]{max-height:1100px;overflow-y:auto;padding-right:8px;margin-top:10px}.timeline-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.timeline-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#ccc;border-radius:4px}.title_historique[_ngcontent-%COMP%]{padding:10px}.timeline-event[_ngcontent-%COMP%]{display:flex;margin-bottom:14px;position:relative;padding:10px}.timeline-event[_ngcontent-%COMP%]:not(:last-child):after{content:"";position:absolute;left:19px;top:40px;bottom:-25px;width:2px;background:#e0e0e0}.event-avatar[_ngcontent-%COMP%]{margin-right:15px}.event-avatar[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:35px;height:35px;border-radius:50%;border:2px solid #fff;box-shadow:0 2px 4px #0000001a}.event-content[_ngcontent-%COMP%]{flex-grow:1}.event-content[_ngcontent-%COMP%]   .event-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:8px}.event-content[_ngcontent-%COMP%]   .event-header[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-weight:600;color:#2c3e50;margin-right:10px;font-size:12px}.event-content[_ngcontent-%COMP%]   .event-header[_ngcontent-%COMP%]   .event-date[_ngcontent-%COMP%]{color:#95a5a6;font-size:8px}.event-action[_ngcontent-%COMP%]{padding:12px;border-radius:8px;background:#f8f9fa;margin-left:10px;border:1px solid #eee;position:relative;font-size:11px}.event-action[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{position:absolute;right:-8px;top:4%;transform:translateY(-50%);background:#ffffffe6;padding:2px 8px;border-radius:12px;font-size:.75em;border:1px solid #eee}.event-action[_ngcontent-%COMP%]:before{content:"";position:absolute;left:-10px;top:12px;width:0;height:0;border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:10px solid #f8f9fa}.event-action[_ngcontent-%COMP%]   .action-icon[_ngcontent-%COMP%]{margin-right:4px;font-size:1.2em;vertical-align:middle}.event-action.creation[_ngcontent-%COMP%]{background:#e8f4ff}.event-action.creation[_ngcontent-%COMP%]:before{border-right-color:#e8f4ff}.event-action.creation[_ngcontent-%COMP%]   .action-icon[_ngcontent-%COMP%]{color:#3498db}.event-action.modification[_ngcontent-%COMP%]{background:#fff8e1}.event-action.modification[_ngcontent-%COMP%]:before{border-right-color:#fff8e1}.event-action.modification[_ngcontent-%COMP%]   .action-icon[_ngcontent-%COMP%]{color:#f1c40f}.event-action.approval[_ngcontent-%COMP%]{background:#e8f6ef}.event-action.approval[_ngcontent-%COMP%]:before{border-right-color:#e8f6ef}.event-action.approval[_ngcontent-%COMP%]   .action-icon[_ngcontent-%COMP%]{color:#2ecc71}.event-action.validation[_ngcontent-%COMP%]{background:#e8f6ff}.event-action.validation[_ngcontent-%COMP%]:before{border-right-color:#e8f6ff}.event-action.validation[_ngcontent-%COMP%]   .action-icon[_ngcontent-%COMP%]{color:#2980b9}.event-action.envoi[_ngcontent-%COMP%]{background:#f9ebff}.event-action.envoi[_ngcontent-%COMP%]:before{border-right-color:#f9ebff}.event-action.envoi[_ngcontent-%COMP%]   .action-icon[_ngcontent-%COMP%]{color:#9b59b6}.ri-send-plane-line[_ngcontent-%COMP%]{font-size:1.1em}.ri-shield-check-line[_ngcontent-%COMP%]{font-size:1.3em}.creation[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{color:#3498db}.approbation[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{color:#2ecc71}.envoi[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{color:#9b59b6}.validation[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{color:#2980b9}.approbateurs-list[_ngcontent-%COMP%]{margin-top:5px;font-size:.9em;color:#666}.approbateurs-list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-block;margin-right:8px;padding:2px 5px;background:#f0f2f5;border-radius:3px}.note-notebook[_ngcontent-%COMP%]{margin-bottom:11%;margin-top:.5rem;padding:.75rem;background-color:#f9f9f9;border-left:4px solid #007bff;border-radius:8px;font-size:.9rem;box-shadow:0 2px 6px #0000000d}.notebook-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-weight:600;margin-bottom:.5rem}.notebook-header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:10px}.add-icon[_ngcontent-%COMP%]{font-size:1.2rem;cursor:pointer;color:#007bff}.close-icon[_ngcontent-%COMP%]{font-size:1.2rem;cursor:pointer;color:#ff1500}.note-item[_ngcontent-%COMP%]{background:#f0d6b273;padding:.5rem;border-radius:6px;border:1px solid #eee;margin-bottom:.5rem}.note-text[_ngcontent-%COMP%]{font-size:11px;margin-bottom:.25rem;color:#494c4e}.note-meta[_ngcontent-%COMP%]{font-size:8px;color:#666}.add-note-inline[_ngcontent-%COMP%]{margin:1rem 0}.add-note-inline[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:.5rem;font-size:.6rem;border:1px solid #ccc;border-radius:6px;font-family:inherit;resize:vertical}.icon-save[_ngcontent-%COMP%]{display:inline-block;margin-top:.5rem;padding:.3rem .6rem;background-color:#007bff;color:#fff;border-radius:4px;cursor:pointer;font-size:1rem}.icon-save.disabled[_ngcontent-%COMP%]{background-color:#ccc;cursor:not-allowed;pointer-events:none}.note-list[_ngcontent-%COMP%]{max-height:460px;overflow-y:auto;padding-right:8px;margin:0;padding-left:0;list-style:none}.note-item[_ngcontent-%COMP%]{position:relative;padding:1rem;border:1px solid #eee;border-radius:6px;margin-bottom:30px;background-color:#f7f1ea}.note-options[_ngcontent-%COMP%]{position:absolute;top:.5rem;right:.5rem}.note-options[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{cursor:pointer;font-size:1rem;padding:.2rem}.note-menu[_ngcontent-%COMP%]{position:absolute;top:1.8rem;right:0;background:#fff;border:1px solid #ddd;border-radius:4px;box-shadow:0 2px 6px #0000001a;z-index:10;min-width:110px;font-size:10px}.note-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:block;padding:.4rem .8rem;background:none;border:none;width:100%;text-align:left;cursor:pointer}.note-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#f0f0f0}.toast-container[_ngcontent-%COMP%]{position:fixed;top:60px;right:35px;z-index:9999}.toast-message-danger[_ngcontent-%COMP%]{background-color:#f3d8da;border:1px solid #E7B1B6;color:#000;padding:10px;border-radius:8px;font-size:13px;box-shadow:0 4px 6px #0000001a;opacity:0;animation:_ngcontent-%COMP%_fadeInOut 4s ease-in-out;transform:translateY(-20px)}@keyframes _ngcontent-%COMP%_fadeInOut{0%{opacity:0;transform:translateY(-20px)}20%{opacity:1;transform:translateY(0)}80%{opacity:1}to{opacity:0;transform:translateY(2px)}}.badge-modified[_ngcontent-%COMP%]{background-color:#f93b2d;color:#fff;font-size:6px;font-weight:700;padding:2px 6px;border-radius:4px;margin-left:30px}.confirm-dialog[_ngcontent-%COMP%]{position:absolute;left:-41px;top:-21px;width:150px;padding:8px;background-color:#fff3f3;border:1px solid #f44336;border-radius:4px;font-size:6px;z-index:10}.confirm-dialog[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 8px;font-size:10px}.confirm-dialog[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer;border:none;border-radius:3px;padding:4px 12px;margin-right:8px;font-weight:600}.confirm-dialog[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{background-color:#f44336;color:#fff}.confirm-dialog[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{background-color:#ccc;color:#000}.confirm-dialog[_ngcontent-%COMP%]{display:block;font-size:9px;justify-items:center}.confirm-dialog-buttons[_ngcontent-%COMP%]{display:flex;gap:8px}.message-notes[_ngcontent-%COMP%]{position:relative;color:#6c757d;display:flex;align-items:center;justify-content:center;font-size:9px}.meta-numeroIdentifiant[_ngcontent-%COMP%]{right:5%;position:absolute;bottom:2px;color:#4099ff;font-size:10px;font-weight:bolder}.annule-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;color:#d32f2f;font-weight:500;padding:8px 12px;background-color:#ffebee;border-radius:4px;font-size:14px}.annule-message[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px}']})}}return c})()}}]);
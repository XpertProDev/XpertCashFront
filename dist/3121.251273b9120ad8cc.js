"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[3121],{3121:(v,p,a)=>{a.r(p),a.d(p,{PosCaisseHeaderComponent:()=>O});var i=a(9417),c=a(177),g=a(7726),l=a(9192),e=a(4438),_=a(2719),b=a(4864),C=a(7788);function m(s,d){if(1&s&&(e.j41(0,"option",25),e.EFF(1),e.k0s()),2&s){const n=d.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.nomBoutique," ")}}function f(s,d){if(1&s&&(e.j41(0,"option",25),e.EFF(1),e.k0s()),2&s){const n=d.$implicit;e.Y8G("value",n.id),e.R7$(),e.SpI(" ",n.nomBoutique," ")}}function h(s,d){if(1&s&&(e.j41(0,"div",42),e.nrm(1,"i",43)(2,"span",44),e.nI1(3,"safeHtml"),e.k0s()),2&s){const n=e.XpG(2);e.R7$(2),e.Y8G("innerHTML",e.bMT(3,1,n.errorMessage),e.npT)}}function M(s,d){1&s&&(e.j41(0,"span"),e.EFF(1,"Ouvrir la caisse"),e.k0s())}function x(s,d){1&s&&e.nrm(0,"span",45)}function P(s,d){if(1&s){const n=e.RV6();e.j41(0,"div",26)(1,"div",27)(2,"div",28)(3,"h3"),e.EFF(4,"Ouvrir une nouvelle caisse"),e.k0s(),e.j41(5,"button",29),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.closeModal())}),e.nrm(6,"i",30),e.k0s()(),e.j41(7,"div",31)(8,"form",32),e.bIt("ngSubmit",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.submitForm())}),e.j41(9,"div",33)(10,"label"),e.EFF(11,"Boutique assign\xe9e"),e.k0s(),e.j41(12,"select",34),e.mxI("ngModelChange",function(t){e.eBV(n);const r=e.XpG();return e.DH7(r.selectedBoutiqueId,t)||(r.selectedBoutiqueId=t),e.Njj(t)}),e.j41(13,"option",25),e.EFF(14,"S\xe9lectionnez une boutique"),e.k0s(),e.DNE(15,f,2,2,"option",10),e.k0s()(),e.j41(16,"div",33)(17,"label"),e.EFF(18,"Esp\xe8ces \xe0 l'ouverture"),e.k0s(),e.j41(19,"input",35),e.mxI("ngModelChange",function(t){e.eBV(n);const r=e.XpG();return e.DH7(r.montantOuverture,t)||(r.montantOuverture=t),e.Njj(t)}),e.k0s()(),e.DNE(20,h,4,3,"div",36),e.k0s()(),e.j41(21,"div",37)(22,"button",38),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.closeModal())}),e.EFF(23,"Annuler"),e.k0s(),e.j41(24,"button",39),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.submitForm())}),e.DNE(25,M,2,0,"span",40)(26,x,1,0,"span",41),e.k0s()()()()}if(2&s){const n=e.XpG();e.R7$(12),e.R50("ngModel",n.selectedBoutiqueId),e.Y8G("disabled",n.isLoading),e.R7$(),e.Y8G("value",null),e.R7$(2),e.Y8G("ngForOf",n.boutiques),e.R7$(4),e.R50("ngModel",n.montantOuverture),e.Y8G("disabled",n.isLoading),e.R7$(),e.Y8G("ngIf",n.errorMessage),e.R7$(2),e.Y8G("disabled",n.isLoading),e.R7$(2),e.Y8G("disabled",n.isLoading),e.R7$(),e.Y8G("ngIf",!n.isLoading),e.R7$(),e.Y8G("ngIf",n.isLoading)}}let O=(()=>{class s{constructor(n,o,t,r){this.boutiqueService=n,this.posCaisseService=o,this.boutiqueState=t,this.router=r,this.showModal=!1,this.boutiques=[],this.selectedBoutiqueId=null,this.montantOuverture=0,this.isLoading=!1,this.errorMessage=null,this.caisses=[],this.selectedBoutiqueIdForList=0,this.isLoadingCaisses=!1,this.openMenuId=null}ngOnInit(){this.loadBoutiques();const n=this.boutiqueState.getCurrentValue();n&&(this.selectedBoutiqueIdForList=n)}loadBoutiques(){this.boutiqueService.getBoutiquesByEntreprise().subscribe({next:n=>{this.boutiques=n,this.boutiques.length>0&&(this.selectedBoutiqueIdForList=this.getValidBoutiqueId(),this.boutiqueState.setSelectedBoutique(this.selectedBoutiqueIdForList),null!==this.selectedBoutiqueIdForList&&this.loadDerniereCaisseVendeur(this.selectedBoutiqueIdForList))},error:n=>{console.error("Erreur lors du chargement des boutiques",n),this.errorMessage="Erreur lors du chargement des boutiques"}})}getValidBoutiqueId(){return this.boutiqueState.getCurrentValue()||(this.boutiques.length>0?this.boutiques[0].id:0)}loadCaisses(n){this.isLoadingCaisses=!0,this.caisses=[],this.posCaisseService.getCaissesByBoutique(n).subscribe({next:o=>{this.caisses=o,this.isLoadingCaisses=!1},error:o=>{console.error("Erreur lors du chargement des caisses",o),this.isLoadingCaisses=!1,this.errorMessage="Erreur lors du chargement des caisses"}})}loadDerniereCaisseVendeur(n){this.isLoadingCaisses=!0,this.caisses=[],this.errorMessage=null;const o=n;this.posCaisseService.getDerniereCaisseVendeur(n).subscribe({next:t=>{this.selectedBoutiqueIdForList===o?("string"==typeof t?this.errorMessage=t:t&&t.boutiqueId===n?this.caisses=[t]:this.errorMessage="Aucune caisse disponible pour cette boutique",this.isLoadingCaisses=!1):this.isLoadingCaisses=!1},error:t=>{this.selectedBoutiqueIdForList===o?(console.error("Erreur lors du chargement de la derni\xe8re caisse",t),this.isLoadingCaisses=!1,this.errorMessage=t.message||"Erreur lors du chargement de la derni\xe8re caisse"):this.isLoadingCaisses=!1}})}onBoutiqueChange(){null!==this.selectedBoutiqueIdForList&&(this.boutiqueState.setSelectedBoutique(this.selectedBoutiqueIdForList),this.caisses=[],this.errorMessage=null,this.loadDerniereCaisseVendeur(this.selectedBoutiqueIdForList))}openModal(){this.showModal=!0}closeModal(){this.showModal=!1,this.selectedBoutiqueId=null,this.montantOuverture=0,this.errorMessage=null}goToPosJournalCaisse(){this.router.navigate(["/pos-caisse/pos-journal-caisse"])}submitForm(){this.selectedBoutiqueId?this.montantOuverture<0?this.errorMessage="Le montant ne peut pas \xeatre n\xe9gatif":(this.isLoading=!0,this.errorMessage=null,this.posCaisseService.ouvrirCaisse({boutiqueId:this.selectedBoutiqueId,montantInitial:this.montantOuverture}).subscribe({next:o=>{console.log("Caisse ouverte avec succ\xe8s",o),this.isLoading=!1,this.closeModal(),null!==this.selectedBoutiqueIdForList&&this.loadDerniereCaisseVendeur(this.selectedBoutiqueIdForList)},error:o=>{console.error("Erreur lors de l'ouverture de la caisse",o),this.isLoading=!1;let t="";t=o.error?.error?o.error.error:o.error?.message?o.error.message:o.message?o.message:"Erreur inconnue lors de l'ouverture de la caisse";const r=t.indexOf(": ");this.errorMessage=r>0?t.substring(r+2):t}})):this.errorMessage="Veuillez s\xe9lectionner une boutique"}static{this.\u0275fac=function(o){return new(o||s)(e.rXU(_.c),e.rXU(b.U),e.rXU(C.j),e.rXU(l.Ix))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-pos-caisse-header"]],decls:36,vars:3,consts:[[1,"container_pos_caisse"],[1,"content_pos_caisse"],[1,"header_pos_caisse"],[1,"content_header_pos_caisse_left"],[1,"double"],[1,"icon_retour"],[1,"ri-arrow-left-s-line"],[1,"name_pos"],[2,"font-size","16px"],["name","boutique",1,"content_select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"content_header_pos_caisse_right"],[1,"add-task",3,"click"],[1,"barre"],[1,"o_pager_counter"],[1,""],[1,"o_pager_limit"],["aria-atomic","true",1,"btn-group","d-print-none"],["type","button","aria-label","Pr\xe9c\xe9dent","data-tooltip","Pr\xe9c\xe9dent",1,"o_pager_previous"],["type","button","aria-label","Suivant","data-tooltip","Suivant",1,"o_pager_next"],[1,"ri-arrow-right-s-line"],[1,"inputSearch"],[1,"ri-search-2-line"],["type","text","placeholder","Recherche...."],["class","modal-backdrop",4,"ngIf"],[3,"value"],[1,"modal-backdrop"],[1,"modal-container"],[1,"modal-header"],[1,"close-button",3,"click"],[1,"ri-close-line"],[1,"modal-body"],[3,"ngSubmit"],[1,"form-group"],["name","boutique",3,"ngModelChange","ngModel","disabled"],["type","number","name","montant","placeholder","Entrez le montant","required","","min","0","step","0.01",3,"ngModelChange","ngModel","disabled"],["class","error-message",4,"ngIf"],[1,"modal-footer"],[1,"btn-cancel",3,"click","disabled"],[1,"btn-submit",3,"click","disabled"],[4,"ngIf"],["class","loading-spinner",4,"ngIf"],[1,"error-message"],[1,"ri-error-warning-line"],[3,"innerHTML"],[1,"loading-spinner"]],template:function(o,t){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"nav",2)(3,"div",3)(4,"ul")(5,"li")(6,"div",4)(7,"div",5),e.nrm(8,"i",6),e.k0s(),e.j41(9,"div",7)(10,"p",8),e.EFF(11,"Point de vente"),e.k0s()(),e.j41(12,"select",9),e.mxI("ngModelChange",function(u){return e.DH7(t.selectedBoutiqueIdForList,u)||(t.selectedBoutiqueIdForList=u),u}),e.bIt("ngModelChange",function(){return t.onBoutiqueChange()}),e.DNE(13,m,2,2,"option",10),e.k0s()()()()(),e.j41(14,"div",11)(15,"button",12),e.bIt("click",function(){return t.openModal()}),e.EFF(16,"Nouveau caisse"),e.k0s(),e.nrm(17,"div",13),e.j41(18,"span",14)(19,"span",15),e.EFF(20,"1-1"),e.k0s(),e.j41(21,"span"),e.EFF(22," / "),e.k0s(),e.j41(23,"span",16),e.EFF(24,"1"),e.k0s()(),e.j41(25,"span",17)(26,"button",18),e.nrm(27,"i",6),e.k0s(),e.j41(28,"button",19),e.nrm(29,"i",20),e.k0s()(),e.nrm(30,"div",13),e.j41(31,"div",21),e.nrm(32,"i",22)(33,"input",23),e.k0s()()(),e.nrm(34,"router-outlet"),e.k0s()(),e.DNE(35,P,27,11,"div",24)),2&o&&(e.R7$(12),e.R50("ngModel",t.selectedBoutiqueIdForList),e.R7$(),e.Y8G("ngForOf",t.boutiques),e.R7$(22),e.Y8G("ngIf",t.showModal))},dependencies:[i.YN,i.qT,i.xH,i.y7,i.me,i.Q0,i.wz,i.BC,i.cb,i.YS,i.VZ,i.vS,i.cV,c.MD,c.Sq,c.bT,i.X1,l.iI,l.n3,g.$],styles:['@charset "UTF-8";.content_pos_caisse[_ngcontent-%COMP%]{position:relative}.header_pos_caisse[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:10px;width:100%;height:60px;background-color:#fff;box-shadow:#0000000d 0 1px 2px;padding:0 15px;position:sticky;top:0;z-index:999}.content_header_pos_caisse_right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}ul[_ngcontent-%COMP%]{list-style:none;margin:0;padding:0}p[_ngcontent-%COMP%]{margin:0}.double[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.icon_retour[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px}.inputSearch[_ngcontent-%COMP%]{position:relative;width:250px;height:40px;display:flex;align-items:center}.inputSearch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:100%;padding-left:10px;border-radius:5px;border:1px solid #000}.inputSearch[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;right:0;margin-right:15px;font-size:17px}.barre[_ngcontent-%COMP%]{height:25px;width:1px;background-color:#0000003f;margin:8px 10px}.add-task[_ngcontent-%COMP%]{padding:10px 30px;background-color:#0672e4;color:#fff;border-radius:5px;border:none}.add-task[_ngcontent-%COMP%]:hover{background-color:#0361c6}.caisse-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;padding:20px}.caisse-card[_ngcontent-%COMP%]{border:1px solid #ddd;padding:20px;border-radius:4px;min-height:150px;display:flex;flex-direction:column;justify-content:space-between}.caisse-nom[_ngcontent-%COMP%]{font-weight:700;font-size:18px;color:#1a1a1a}.caisse-btn[_ngcontent-%COMP%]{background-color:#0672e4;color:#fff;border:none;padding:10px 14px;border-radius:6px;cursor:pointer;font-weight:500;align-self:flex-start;transition:background-color .2s ease}.caisse-btn[_ngcontent-%COMP%]:hover{background-color:#0361c6}.profil[_ngcontent-%COMP%]{background-color:#e9d421;padding:0 12px;border-radius:4px;cursor:pointer}.profil[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;color:#000}.icon_more[_ngcontent-%COMP%]{cursor:pointer;display:none;position:absolute;top:-11px;right:-12px}.block[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;position:relative}.caisse-card[_ngcontent-%COMP%]:hover   .icon_more[_ngcontent-%COMP%]{display:block}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;width:500px;max-width:90%;box-shadow:0 4px 20px #00000026;animation:_ngcontent-%COMP%_modalAppear .3s ease-out}@keyframes _ngcontent-%COMP%_modalAppear{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.modal-header[_ngcontent-%COMP%]{padding:16px 24px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px;color:#333}.close-button[_ngcontent-%COMP%]{background:none;border:none;font-size:24px;cursor:pointer;color:#666;transition:color .2s}.close-button[_ngcontent-%COMP%]:hover{color:red}.modal-body[_ngcontent-%COMP%]{padding:24px}.modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:20px}.modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:500;color:#555}.modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #ddd;border-radius:4px;font-size:15px}.modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#3498db;outline:none;box-shadow:0 0 0 2px #3498db33}.modal-footer[_ngcontent-%COMP%]{padding:16px 24px;border-top:1px solid #eee;display:flex;justify-content:flex-end;gap:12px}.modal-footer[_ngcontent-%COMP%]   .btn-cancel[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]   .btn-submit[_ngcontent-%COMP%]{padding:10px 24px;border-radius:4px;cursor:pointer;font-weight:500;transition:all .2s}.modal-footer[_ngcontent-%COMP%]   .btn-cancel[_ngcontent-%COMP%]{background-color:#f5f5f5;border:1px solid #ddd;color:#444}.modal-footer[_ngcontent-%COMP%]   .btn-cancel[_ngcontent-%COMP%]:hover{background-color:#eaeaea}.modal-footer[_ngcontent-%COMP%]   .btn-submit[_ngcontent-%COMP%]{background-color:#0672e4;color:#fff;border:none}.modal-footer[_ngcontent-%COMP%]   .btn-submit[_ngcontent-%COMP%]:hover{background-color:#0361c6}.error-message[_ngcontent-%COMP%]{background-color:#ffebee;color:#b71c1c;padding:12px;border-radius:4px;margin-top:15px;display:flex;align-items:center;gap:8px}.error-message[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px}.loading-spinner[_ngcontent-%COMP%]{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:_ngcontent-%COMP%_spin 1s ease-in-out infinite}button[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.o_pager_previous[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .o_pager_next[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px;padding:0 5px}.d-print-none[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:1px solid #000}.d-print-none[_ngcontent-%COMP%]   .o_pager_previous[_ngcontent-%COMP%]{border-top:1px solid #000;border-right:none;border-bottom:1px solid #000;border-left:1px solid #000;border-top-left-radius:5px;border-bottom-left-radius:5px}.d-print-none[_ngcontent-%COMP%]   .o_pager_next[_ngcontent-%COMP%]{border-top:1px solid #000;border-left:1px solid #000;border-bottom:1px solid #000;border-top-right-radius:5px;border-bottom-right-radius:5px}.content_select[_ngcontent-%COMP%]{border:none;padding:6px 30px 6px 7px;background:#efefef;border-radius:5px;box-shadow:#0000000d 0 6px 24px,#00000014 0 0 0 1px;cursor:pointer}.loading-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:20px;color:#64748b}.loading-indicator[_ngcontent-%COMP%]   .spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-right:10px}.no-caisses[_ngcontent-%COMP%]{text-align:center;padding:30px;border:1px dashed #ddd;border-radius:8px;color:#888}.no-caisses[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;margin-bottom:10px;display:block}.caisse-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.caisse-status[_ngcontent-%COMP%]{font-size:12px;padding:2px 8px;border-radius:4px;display:inline-block;width:fit-content}.caisse-status.open[_ngcontent-%COMP%]{background-color:#e3f2ed;color:#0a8150}.caisse-status.closed[_ngcontent-%COMP%]{background-color:#fbebec;color:#de3618}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.icon_more[_ngcontent-%COMP%]{position:relative;cursor:pointer}.icon_more[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px}.icon_more[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;background:#fff;border:1px solid #ddd;border-radius:4px;box-shadow:0 2px 10px #0000001a;z-index:100;display:flex;flex-direction:column;min-width:120px;margin-top:6px;padding:0}.icon_more[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;padding:8px 12px;text-align:left;cursor:pointer;width:100%;font-size:12px}.icon_more[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.icon_more[_ngcontent-%COMP%]:hover   .dropdown-menu[_ngcontent-%COMP%]{color:red}.caisse-status[_ngcontent-%COMP%]{font-size:.85rem;padding:4px 8px;border-radius:12px;font-weight:500}.caisse-status.open[_ngcontent-%COMP%]{background-color:#e3fcef;color:#0e9f6e}.caisse-status.closed[_ngcontent-%COMP%]{background-color:#fde8e8;color:#c81e1e}.caisse-btn.disabled[_ngcontent-%COMP%]{background-color:#e5e7eb;color:#6b7280;cursor:not-allowed}.selected-boutique[_ngcontent-%COMP%]{padding:10px;background-color:#f0f4f8;border-radius:4px;border:1px solid #d1d5db;font-weight:500;color:#1e293b}']})}}return s})()}}]);
{"version":3,"file":"src_app_POS_pos-caisse-header_pos-caisse-header_component_ts.js","mappings":"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","sources":["./src/app/POS/pos-caisse-header/pos-caisse-header.component.ts","./src/app/POS/pos-caisse-header/pos-caisse-header.component.html"],"sourcesContent":["import { Component } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\nimport { SafeHtmlPipe } from 'src/app/admin-page/MODELS/CaisseModel/safe-html.pipe';\nimport { ClickOutsideDirective } from 'src/app/admin-page/MODELS/click-outside.directive';\nimport { Router, RouterModule } from '@angular/router';\nimport { BoutiqueService } from 'src/app/admin-page/SERVICES/boutique-service';\nimport { PosCaisseService } from 'src/app/admin-page/SERVICES/CaisseService/pos-caisse-service';\nimport { CaisseResponse, OuvrirCaisseRequest } from 'src/app/admin-page/MODELS/CaisseModel/caisse.model';\nimport { BoutiqueStateService } from 'src/app/admin-page/SERVICES/CaisseService/boutique-state.service';\nimport { CaisseStateService } from 'src/app/admin-page/SERVICES/CaisseService/caisse-state.service';\nimport { UsersService } from 'src/app/admin-page/SERVICES/users.service';\nimport { Subject, takeUntil } from 'rxjs';\nimport { PaginationService } from 'src/app/admin-page/SERVICES/CaisseService/pagination.service';\n\n@Component({\n  selector: 'app-pos-caisse-header',\n  imports: [FormsModule, CommonModule, ReactiveFormsModule, RouterModule, SafeHtmlPipe],\n  templateUrl: './pos-caisse-header.component.html',\n  styleUrl: './pos-caisse-header.component.scss'\n})\nexport class PosCaisseHeaderComponent {\n\n  private destroy$ = new Subject<void>();\n\n  showMenuDropdown = false;\n  showAllCaissesSection = true;\n  isAllowedToViewAllCaisses = false;\n\n  showModal = false;\n  boutiques: any[] = [];\n  montantOuverture: number = 0;\n  isLoading = false;\n  errorMessage: string | null = null;\n  caisses: CaisseResponse[] = [];\n  \n  selectedBoutiqueIdForList: number | null = null;\n  selectedBoutiqueId: number | null = null;\n  // selectedBoutiqueIdForList: number = 0; \n  isLoadingCaisses = false;\n\n  openMenuId: number | null = null;\n\n  currentPage = 1;\n  itemsPerPage = 10;\n  totalItems = 0;\n\n  displayStart = 0;\n  displayEnd = 0;\n  pageCount = 0;\n  isFirstPage = true;\n  isLastPage = true;\n\n  constructor(\n    private boutiqueService: BoutiqueService,\n    private caisseState: CaisseStateService,\n    private posCaisseService: PosCaisseService,\n    private boutiqueState: BoutiqueStateService,\n    private router: Router,\n    private usersService: UsersService,\n     private paginationService: PaginationService,\n  ) {}\n\n  ngOnInit(): void {\n    this.loadBoutiques();\n    this.initBoutique();\n    this.initStateCaisse();\n    this.initPaginationService();\n  }\n\n  initBoutique() {\n     // Initialiser avec la boutique sauvegardée\n    const savedBoutiqueId = this.boutiqueState.getCurrentValue();\n    if (savedBoutiqueId) {\n      this.selectedBoutiqueIdForList = savedBoutiqueId;\n    }\n  }\n\n  initStateCaisse() {\n    this.caisseState.showAllCaisses$\n      .pipe(takeUntil(this.destroy$))\n      .subscribe(val => {\n        this.showAllCaissesSection = !!val;\n        console.log('[Header] showAllCaisses$ ->', val);\n      });\n\n      // Ajouter cette ligne pour synchroniser avec l'état initial du service\n    this.caisseState.showAllCaisses$.pipe(takeUntil(this.destroy$))\n      .subscribe(val => {\n        this.showAllCaissesSection = !!val;\n      });\n  }\n\n  initPaginationService() {\n    // Subscribe to pagination changes\n    this.paginationService.state$\n      .pipe(takeUntil(this.destroy$))\n      .subscribe(state => {\n        this.currentPage = state.currentPage;\n        this.itemsPerPage = state.itemsPerPage;\n        this.totalItems = state.totalItems;\n        this.recomputeDisplay();\n      });\n  }\n\n  // helper pour recalculer l'affichage\n  private recomputeDisplay() {\n    this.pageCount = Math.max(1, Math.ceil(this.totalItems / this.itemsPerPage || 1));\n    this.displayStart = this.totalItems === 0 ? 0 : (this.currentPage - 1) * this.itemsPerPage + 1;\n    this.displayEnd = Math.min(this.totalItems, this.currentPage * this.itemsPerPage);\n    this.isFirstPage = this.currentPage <= 1;\n    this.isLastPage = this.currentPage >= this.pageCount;\n  }\n\n  // handlers appelés par le template\n  prevPage() {\n    if (this.isFirstPage) return;\n    this.paginationService.setPage(this.currentPage - 1);\n  }\n\n  nextPage() {\n    if (this.isLastPage) return;\n    this.paginationService.setPage(this.currentPage + 1);\n  }\n\n  ngOnDestroy(): void {\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n\n  toggleMenuDropdown() {\n    this.showMenuDropdown = !this.showMenuDropdown;\n  }\n\n  loadBoutiques(): void {\n    this.isLoading = true;\n    this.boutiques = [];\n    this.errorMessage = null;\n\n    // Essayer d'obtenir l'utilisateur depuis l'API\n    this.usersService.getUserInfo()\n      .pipe(takeUntil(this.destroy$))\n      .subscribe({\n        next: (user) => {\n          // Définit si l'utilisateur peut voir \"Toutes les caisses\"\n          this.isAllowedToViewAllCaisses = !!(user && ['ADMIN', 'MANAGER'].includes(user.roleType));\n          console.log('[loadBoutiques] user from API ->', user?.roleType);\n\n          if (user && user.roleType === 'VENDEUR') {\n            // Vendeur : utiliser uniquement ses boutiques\n            this.boutiques = user.boutiques || [];\n            this.selectedBoutiqueIdForList = this.getValidBoutiqueId();\n            this.boutiqueState.setSelectedBoutique(this.selectedBoutiqueIdForList);\n\n            // Charger la dernière caisse si on a une boutique sélectionnée\n            if (this.selectedBoutiqueIdForList) {\n              this.loadDerniereCaisseVendeur(this.selectedBoutiqueIdForList);\n            } else {\n              // Pas de boutique disponible pour ce vendeur\n              this.caisses = [];\n            }\n\n            this.isLoading = false;\n          } else {\n            // Admin/Manager (ou user non-vendeur) : récupérer toutes les boutiques de l'entreprise\n            this.boutiqueService.getBoutiquesByEntreprise()\n              .pipe(takeUntil(this.destroy$))\n              .subscribe({\n                next: (boutiques) => {\n                  this.boutiques = boutiques || [];\n                  this.selectedBoutiqueIdForList = this.getValidBoutiqueId();\n                  this.boutiqueState.setSelectedBoutique(this.selectedBoutiqueIdForList);\n\n                  if (this.selectedBoutiqueIdForList) {\n                    this.loadDerniereCaisseVendeur(this.selectedBoutiqueIdForList);\n                  } else {\n                    this.caisses = [];\n                  }\n\n                  this.isLoading = false;\n                },\n                error: (err) => {\n                  console.error('[loadBoutiques] erreur getBoutiquesByEntreprise', err);\n                  this.errorMessage = 'Erreur lors du chargement des boutiques';\n                  this.isLoading = false;\n                }\n              });\n          }\n        },\n        error: (err) => {\n          console.error('[loadBoutiques] getUserInfo() failed', err);\n\n          // Fallback : essayer de récupérer l'utilisateur depuis le localStorage\n          const localUser = this.usersService.getCurrentUser();\n          if (localUser) {\n            console.log('[loadBoutiques] using local user fallback ->', localUser?.roleType);\n            this.isAllowedToViewAllCaisses = !!(['ADMIN', 'MANAGER'].includes(localUser.roleType));\n            if (localUser.roleType === 'VENDEUR') {\n              this.boutiques = localUser.boutiques || [];\n              this.selectedBoutiqueIdForList = this.getValidBoutiqueId();\n              this.boutiqueState.setSelectedBoutique(this.selectedBoutiqueIdForList);\n              if (this.selectedBoutiqueIdForList) {\n                this.loadDerniereCaisseVendeur(this.selectedBoutiqueIdForList);\n              }\n              this.isLoading = false;\n              return;\n            }\n          }\n\n          // Si pas de user local, retenter de charger toutes les boutiques (dégradation)\n          this.boutiqueService.getBoutiquesByEntreprise()\n            .pipe(takeUntil(this.destroy$))\n            .subscribe({\n              next: (boutiques) => {\n                this.boutiques = boutiques || [];\n                this.selectedBoutiqueIdForList = this.getValidBoutiqueId();\n                this.boutiqueState.setSelectedBoutique(this.selectedBoutiqueIdForList);\n                if (this.selectedBoutiqueIdForList) {\n                  this.loadDerniereCaisseVendeur(this.selectedBoutiqueIdForList);\n                }\n                this.isLoading = false;\n              },\n              error: (err2) => {\n                console.error('[loadBoutiques] fallback getBoutiquesByEntreprise failed', err2);\n                this.errorMessage = 'Impossible de charger les boutiques';\n                this.boutiques = [];\n                this.isLoading = false;\n              }\n            });\n        }\n      });\n  }\n\n  private getValidBoutiqueId(): number {\n    return this.boutiqueState.getCurrentValue() || \n          (this.boutiques.length > 0 ? this.boutiques[0].id : 0);\n  }\n\n\n  // Nouvelle méthode pour charger les caisses\n  loadCaisses(boutiqueId: number): void {\n    this.isLoadingCaisses = true;\n    this.caisses = [];\n    \n    this.posCaisseService.getCaissesByBoutique(boutiqueId).subscribe({\n      next: (caisses) => {\n        this.caisses = caisses;\n        this.isLoadingCaisses = false;\n      },\n      error: (error) => {\n        console.error('Erreur lors du chargement des caisses', error);\n        this.isLoadingCaisses = false;\n        this.errorMessage = 'Erreur lors du chargement des caisses';\n      }\n    });\n  }\n\n  // Ajouter cette nouvelle méthode dans PosCaisseComponent\n  loadDerniereCaisseVendeur(boutiqueId: number): void {\n    this.isLoadingCaisses = true;\n    this.caisses = [];\n    this.errorMessage = null;\n    \n    const currentBoutiqueId = boutiqueId; // Sauvegarder l'ID actuel\n\n    this.posCaisseService.getDerniereCaisseVendeur(boutiqueId).subscribe({\n      next: (response) => {\n        // Vérifier si la sélection n'a pas changé pendant la requête\n        if (this.selectedBoutiqueIdForList !== currentBoutiqueId) {\n          this.isLoadingCaisses = false;\n          return;\n        }\n\n        if (typeof response === 'string') {\n          this.errorMessage = response;\n        } else if (response && response.boutiqueId === boutiqueId) { // Filtrer par boutique\n          this.caisses = [response];\n        } else {\n          this.errorMessage = 'Aucune caisse disponible pour cette boutique';\n        }\n        this.isLoadingCaisses = false;\n      },\n      error: (error) => {\n        // Vérifier si la sélection n'a pas changé pendant la requête\n        if (this.selectedBoutiqueIdForList !== currentBoutiqueId) {\n          this.isLoadingCaisses = false;\n          return;\n        }\n        \n        console.error('Erreur lors du chargement de la dernière caisse', error);\n        this.isLoadingCaisses = false;\n        this.errorMessage = error.message || 'Erreur lors du chargement de la dernière caisse';\n      }\n    });\n  }\n\n// Modifier onBoutiqueChange\n  onBoutiqueChange(): void {\n    if (this.selectedBoutiqueIdForList === null) return;\n    \n    this.boutiqueState.setSelectedBoutique(this.selectedBoutiqueIdForList);\n    this.caisses = [];\n    this.errorMessage = null;\n    this.loadDerniereCaisseVendeur(this.selectedBoutiqueIdForList);\n  }\n\n  /**\n   * Ouvre le modal et initialise `selectedBoutiqueId`.\n   * @param preferDifferent si true -> sélectionne la première boutique différente de la sélection d'en-tête (comportement \"autre boutique\")\n   *                         si false (par défaut) -> sélectionne la même boutique que l'en-tête si disponible, sinon la première disponible.\n   */\n  openModal(preferDifferent: boolean = false) {\n    console.log('openModal() called. headerSelected=', this.selectedBoutiqueIdForList, 'boutiques length=', this.boutiques?.length);\n\n    // Forcer le type number si la valeur vient en string\n    if (this.selectedBoutiqueIdForList != null) {\n      this.selectedBoutiqueIdForList = Number(this.selectedBoutiqueIdForList);\n    }\n\n    // Si les boutiques ne sont pas encore chargées, ouvrir modal sans sélection\n    if (!this.boutiques || this.boutiques.length === 0) {\n      console.warn('Boutiques non chargées au moment de openModal(). Ouvrir modal sans sélection.');\n      this.selectedBoutiqueId = null;\n      this.errorMessage = null;\n      this.showModal = true;\n      return;\n    }\n\n    // Filtrer boutiques actives (adapter si tu veux inclure les inactives)\n    const available = (this.boutiques || [])\n      .filter(b => b && b.actif !== false)\n      .map(b => ({ ...b, id: Number(b.id) })); // forcer id en number\n\n    // Trier pour comportement déterministe (optionnel)\n    available.sort((a, b) => a.id - b.id);\n\n    if (available.length === 0) {\n      // Aucune boutique disponible après filtre\n      this.selectedBoutiqueId = null;\n    } else if (preferDifferent) {\n      // Option : sélectionner la première boutique différente de l'en-tête\n      const firstDifferent = available.find(b => b.id !== this.selectedBoutiqueIdForList);\n      this.selectedBoutiqueId = firstDifferent ? firstDifferent.id : available[0].id;\n    } else {\n      // Option par défaut : sélectionner la même boutique que l'en-tête si possible, sinon la première disponible\n      this.selectedBoutiqueId = (this.selectedBoutiqueIdForList != null && available.some(b => b.id === this.selectedBoutiqueIdForList))\n        ? this.selectedBoutiqueIdForList\n        : available[0].id;\n    }\n\n    console.log('Modal selection computed -> header:', this.selectedBoutiqueIdForList, 'modal:', this.selectedBoutiqueId, 'available:', available.map(x => ({id: x.id, nom: x.nomBoutique})));\n\n    this.errorMessage = null;\n    this.showModal = true;\n  }\n\n  closeModal() {\n    this.showModal = false;\n    this.selectedBoutiqueId = null;\n    this.montantOuverture = 0;\n    this.errorMessage = null;\n  }\n\n  goToPosJournalCaisse() {\n    this.router.navigate(['/pos-caisse/pos-journal-caisse'])\n  }\n\n  submitForm() {\n    if (!this.selectedBoutiqueId) {\n      this.errorMessage = 'Veuillez sélectionner une boutique';\n      return;\n    }\n\n    if (this.montantOuverture < 0) {\n      this.errorMessage = 'Le montant ne peut pas être négatif';\n      return;\n    }\n\n    this.isLoading = true;\n    this.errorMessage = null;\n\n    const request: OuvrirCaisseRequest = {\n      boutiqueId: this.selectedBoutiqueId,\n      montantInitial: this.montantOuverture\n    };\n\n    this.posCaisseService.ouvrirCaisse(request).subscribe({\n      next: (response) => {\n        console.log('Caisse ouverte avec succès', response);\n        this.isLoading = false;\n        this.closeModal();\n\n        // CORRECTION : Utiliser triggerRefresh() au lieu de notifyCaissesUpdated()\n        this.caisseState.notifyCaisseCreated(response);\n        this.caisseState.triggerRefresh();\n        \n        // Rediriger vers l'interface de vente\n        // this.router.navigate(['/pos/vente'], {\n        //   state: { caisse: response }\n        // });\n        // Recharger les caisses pour la boutique actuellement sélectionnée\n        if (this.selectedBoutiqueIdForList !== null) {\n          this.loadDerniereCaisseVendeur(this.selectedBoutiqueIdForList);\n        }\n      },\n      error: (error) => {\n      console.error('Erreur lors de l\\'ouverture de la caisse', error);\n      this.isLoading = false;\n      \n      let rawError = '';\n      \n      if (error.error?.error) rawError = error.error.error;\n      else if (error.error?.message) rawError = error.error.message;\n      else if (error.message) rawError = error.message;\n      else rawError = 'Erreur inconnue lors de l\\'ouverture de la caisse';\n      \n      // Supprime le préfixe avant \" : \"\n      const prefixIndex = rawError.indexOf(': ');\n      this.errorMessage = prefixIndex > 0 \n        ? rawError.substring(prefixIndex + 2) \n        : rawError;\n    }\n    });\n  }\n\n  goToDashboard() {\n    this.router.navigate(['/analytics'])\n  }\n\n  onVoirToutesLesCaisses(event: MouseEvent) {\n    event.stopPropagation();            // empêche toggle parent\n    this.showMenuDropdown = false;      // ferme le menu\n\n    // Si actuellement visible -> forcer fermeture, sinon ouvrir\n    if (this.showAllCaissesSection) {\n      // force close (assure la disparition du *ngIf)\n      this.caisseState.showAllCaisses(false);\n      console.log('[Header] clicked -> fermer toutes les caisses');\n    } else {\n      this.caisseState.showAllCaisses(true);\n      console.log('[Header] clicked -> voir toutes les caisses');\n    }\n  }\n\n\n\n}\n","<div class=\"container_pos_caisse\">\n    <div class=\"content_pos_caisse\">\n\n        <nav class=\"header_pos_caisse\">\n            <div class=\"content_header_pos_caisse_left\">\n                <ul>\n                    <li>\n                        <div class=\"double\">\n                            <div class=\"icon_retour\" (click)=\"goToDashboard()\">\n                                <i class=\"ri-arrow-left-s-line\"></i>\n                            </div>\n                            <div class=\"name_pos\">\n                                <p style=\"font-size: 16px;\">Point de vente</p>\n                            </div>\n                            <select class=\"content_select\" name=\"boutique\" \n                                    [(ngModel)]=\"selectedBoutiqueIdForList\"\n                                    (ngModelChange)=\"onBoutiqueChange()\">\n                                <option *ngFor=\"let boutique of boutiques\" [ngValue]=\"boutique.id\" [disabled]=\"!boutique.actif\">\n                                    {{ boutique.nomBoutique }}\n                                </option>\n                            </select>\n                        </div>\n                    </li>\n                </ul>\n            </div>\n            <div class=\"content_header_pos_caisse_right\">\n                <button class=\"add-task\" (click)=\"openModal()\">Nouveau caisse</button>\n  \n                <div class=\"barre\"></div>\n\n                <!-- pager -->\n                <div class=\"pager\" aria-label=\"Pagination\">\n                    <div class=\"pager-info\" aria-live=\"polite\">\n                        <span class=\"o_pager_counter\">\n                            <span>{{ displayStart }} - {{ displayEnd }}</span>\n                                <span> / </span>\n                            <span class=\"o_pager_limit\">{{ totalItems }}</span>\n                        </span>\n                    </div>\n\n                    <div class=\"btn-group d-print-none\" aria-atomic=\"true\" role=\"group\" aria-label=\"Navigation pages\">\n                        <button\n                        type=\"button\"\n                        class=\"o_pager_previous\"\n                        (click)=\"prevPage()\"\n                        [disabled]=\"isFirstPage\"\n                        aria-label=\"Précédent\"\n                        title=\"Page précédente\">\n                        <i class=\"ri-arrow-left-s-line\"></i>\n                        </button>\n\n                        <button\n                        type=\"button\"\n                        class=\"o_pager_next\"\n                        (click)=\"nextPage()\"\n                        [disabled]=\"isLastPage\"\n                        aria-label=\"Suivant\"\n                        title=\"Page suivante\">\n                        <i class=\"ri-arrow-right-s-line\"></i>\n                        </button>\n                    </div>\n                </div>\n  \n                <div class=\"barre\"></div>\n                \n                <div class=\"inputSearch\">\n                    <i class=\"ri-search-2-line\"></i>\n                    <input \n                        type=\"text\"\n                        placeholder=\"Recherche....\"\n                    />\n                </div>\n  \n                <div class=\"barre\"></div>\n\n                <!-- // Menu  -->\n                <div class=\"menu\" \n                    (click)=\"toggleMenuDropdown()\" \n                    clickOutside \n                    (clickOutside)=\"showMenuDropdown = false\">\n                    <i class=\"ri-menu-line\"></i>\n                    \n                    <!-- Dropdown Menu -->\n                    <div class=\"menu-dropdown\" *ngIf=\"showMenuDropdown\">\n                        <div class=\"dropdown-item\"\n                            *ngIf=\"isAllowedToViewAllCaisses\"\n                            [ngStyle]=\"{'color': showAllCaissesSection ? 'red' : 'inherit'}\"\n                            (click)=\"onVoirToutesLesCaisses($event)\">\n                            <i class=\"ri-eye-2-line\"></i>\n                            {{ showAllCaissesSection ? 'Cacher toutes les caisses' : 'Voir toutes les caisses' }}\n                        </div>\n\n                        <div class=\"dropdown-item\">\n                            <i class=\"ri-restart-line\"></i>\n                           Autres\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </nav>\n        <!-- // Route  -->\n        <router-outlet></router-outlet>\n    </div>\n</div>\n\n<!-- Popup Modal -->\n<div class=\"modal-backdrop\" *ngIf=\"showModal\">\n    <div class=\"modal-container\">\n        <div class=\"modal-header\">\n            <h3>Ouvrir une nouvelle caisse</h3>\n            <button (click)=\"closeModal()\" class=\"close-button\">\n                <i class=\"ri-close-line\"></i>\n            </button>\n        </div>\n        \n        <div class=\"modal-body\">\n            <form (ngSubmit)=\"submitForm()\">\n                <div class=\"form-group\">\n                    <label>Boutique assignée</label>\n                    <select [(ngModel)]=\"selectedBoutiqueId\" name=\"boutique\" [disabled]=\"isLoading\">\n                        <option [ngValue]=\"null\">Sélectionnez une boutique</option>\n                        <option *ngFor=\"let boutique of boutiques\" [ngValue]=\"boutique.id\">\n                            {{ boutique.nomBoutique }}\n                        </option>\n                    </select>\n                </div>\n\n                <div class=\"form-group\">\n                    <label>Espèces à l'ouverture</label>\n                    <input \n                        type=\"number\" \n                        [(ngModel)]=\"montantOuverture\" \n                        name=\"montant\"\n                        placeholder=\"Entrez le montant\" \n                        required\n                        min=\"0\"\n                        step=\"0.01\"\n                        [disabled]=\"isLoading\"\n                    >\n                </div>\n                \n                <!-- Affichage des erreurs -->\n                <div *ngIf=\"errorMessage\" class=\"error-message\">\n                    <i class=\"ri-error-warning-line\"></i> \n                    <span [innerHTML]=\"errorMessage | safeHtml\"></span>\n                </div>\n            </form>\n        </div>\n        \n        <div class=\"modal-footer\">\n            <button (click)=\"closeModal()\" class=\"btn-cancel\" [disabled]=\"isLoading\">Annuler</button>\n            <button (click)=\"submitForm()\" class=\"btn-submit\" [disabled]=\"isLoading\">\n                <span *ngIf=\"!isLoading\">Ouvrir la caisse</span>\n                <span *ngIf=\"isLoading\" class=\"loading-spinner\"></span>\n            </button>\n        </div>\n    </div>\n</div>\n\n<!-- <div *ngIf=\"!isLoadingCaisses && caisses.length === 0\" class=\"no-caisses\">\n    <i class=\"ri-information-line\"></i>\n    <p>{{ errorMessage || 'Aucune caisse disponible pour cette boutique' }}</p>\n  </div> -->"],"names":["FormsModule","ReactiveFormsModule","CommonModule","SafeHtmlPipe","RouterModule","Subject","takeUntil","i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵproperty","boutique_r1","id","actif","ɵɵadvance","ɵɵtextInterpolate1","nomBoutique","ɵɵlistener","PosCaisseHeaderComponent_div_39_div_1_Template_div_click_0_listener","$event","ɵɵrestoreView","_r2","ctx_r2","ɵɵnextContext","ɵɵresetView","onVoirToutesLesCaisses","ɵɵelement","ɵɵpureFunction1","_c0","showAllCaissesSection","ɵɵtemplate","PosCaisseHeaderComponent_div_39_div_1_Template","isAllowedToViewAllCaisses","boutique_r5","ɵɵpipeBind1","errorMessage","ɵɵsanitizeHtml","PosCaisseHeaderComponent_div_41_Template_button_click_5_listener","_r4","closeModal","PosCaisseHeaderComponent_div_41_Template_form_ngSubmit_8_listener","submitForm","ɵɵtwoWayListener","PosCaisseHeaderComponent_div_41_Template_select_ngModelChange_12_listener","ɵɵtwoWayBindingSet","selectedBoutiqueId","PosCaisseHeaderComponent_div_41_option_15_Template","PosCaisseHeaderComponent_div_41_Template_input_ngModelChange_19_listener","montantOuverture","PosCaisseHeaderComponent_div_41_div_20_Template","PosCaisseHeaderComponent_div_41_Template_button_click_22_listener","PosCaisseHeaderComponent_div_41_Template_button_click_24_listener","PosCaisseHeaderComponent_div_41_span_25_Template","PosCaisseHeaderComponent_div_41_span_26_Template","ɵɵtwoWayProperty","isLoading","boutiques","PosCaisseHeaderComponent","constructor","boutiqueService","caisseState","posCaisseService","boutiqueState","router","usersService","paginationService","destroy$","showMenuDropdown","showModal","caisses","selectedBoutiqueIdForList","isLoadingCaisses","openMenuId","currentPage","itemsPerPage","totalItems","displayStart","displayEnd","pageCount","isFirstPage","isLastPage","ngOnInit","loadBoutiques","initBoutique","initStateCaisse","initPaginationService","savedBoutiqueId","getCurrentValue","showAllCaisses$","pipe","subscribe","val","console","log","state$","state","recomputeDisplay","Math","max","ceil","min","prevPage","setPage","nextPage","ngOnDestroy","next","complete","toggleMenuDropdown","getUserInfo","user","includes","roleType","getValidBoutiqueId","setSelectedBoutique","loadDerniereCaisseVendeur","getBoutiquesByEntreprise","error","err","localUser","getCurrentUser","err2","length","loadCaisses","boutiqueId","getCaissesByBoutique","currentBoutiqueId","getDerniereCaisseVendeur","response","message","onBoutiqueChange","openModal","preferDifferent","Number","warn","available","filter","b","map","sort","a","firstDifferent","find","some","x","nom","goToPosJournalCaisse","navigate","request","montantInitial","ouvrirCaisse","notifyCaisseCreated","triggerRefresh","rawError","prefixIndex","indexOf","substring","goToDashboard","event","stopPropagation","showAllCaisses","ɵɵdirectiveInject","i1","BoutiqueService","i2","CaisseStateService","i3","PosCaisseService","i4","BoutiqueStateService","i5","Router","i6","UsersService","i7","PaginationService","selectors","decls","vars","consts","template","PosCaisseHeaderComponent_Template","rf","ctx","PosCaisseHeaderComponent_Template_div_click_7_listener","PosCaisseHeaderComponent_Template_select_ngModelChange_12_listener","PosCaisseHeaderComponent_option_13_Template","PosCaisseHeaderComponent_Template_button_click_15_listener","PosCaisseHeaderComponent_Template_button_click_28_listener","PosCaisseHeaderComponent_Template_button_click_30_listener","PosCaisseHeaderComponent_Template_div_click_37_listener","PosCaisseHeaderComponent_Template_div_clickOutside_37_listener","PosCaisseHeaderComponent_div_39_Template","PosCaisseHeaderComponent_div_41_Template","ɵɵtextInterpolate2","ɵɵtextInterpolate","i8","ɵNgNoValidate","NgSelectOption","ɵNgSelectMultipleOption","DefaultValueAccessor","NumberValueAccessor","SelectControlValueAccessor","NgControlStatus","NgControlStatusGroup","RequiredValidator","MinValidator","NgModel","NgForm","i9","NgForOf","NgIf","NgStyle","RouterOutlet","styles"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}
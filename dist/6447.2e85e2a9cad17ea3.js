"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[6447],{46447:(O,y,l)=>{l.r(y),l.d(y,{PosPaiementComponent:()=>I});var m=l(60177),c=l(89417),g=l(22525),t=l(54438),d=l(49192),v=l(44413),P=l(92120);const E=["receipt"];function M(s,u){1&s&&(t.j41(0,"div",31)(1,"div",32),t.EFF(2,"\u2714\ufe0e"),t.k0s(),t.j41(3,"div",33),t.EFF(4,"Paiement r\xe9ussi"),t.k0s()())}function x(s,u){if(1&s&&(t.j41(0,"div",34)(1,"div",35),t.EFF(2),t.nI1(3,"currency"),t.k0s(),t.j41(4,"div",36),t.EFF(5),t.k0s()()),2&s){const n=t.XpG();t.R7$(2),t.JRh(t.ii3(3,2,n.vente.montantTotal,"CFA ","symbol","1.0-0")),t.R7$(3),t.SpI("/ ",n.paymentMethod,"")}}function h(s,u){if(1&s&&(t.j41(0,"li",37)(1,"span",38),t.EFF(2),t.k0s(),t.j41(3,"div",39)(4,"div",40),t.EFF(5),t.k0s(),t.j41(6,"div",41),t.EFF(7),t.nI1(8,"currency"),t.k0s()(),t.j41(9,"span",42),t.EFF(10),t.nI1(11,"currency"),t.k0s()()),2&s){const n=u.$implicit;t.R7$(2),t.JRh(n.quantite),t.R7$(3),t.JRh(n.nomProduit),t.R7$(2),t.SpI("",t.ii3(8,4,n.prixUnitaire,"CFA ","symbol","1.0-0")," / Unit\xe9(s)"),t.R7$(3),t.JRh(t.ii3(11,9,n.montantLigne,"CFA ","symbol","1.0-0"))}}function k(s,u){1&s&&(t.j41(0,"li",43),t.EFF(1,"Aucun produit trouv\xe9"),t.k0s())}function o(s,u){if(1&s&&(t.j41(0,"div",24)(1,"span"),t.EFF(2,"Monnaie"),t.k0s(),t.j41(3,"span",25),t.EFF(4),t.nI1(5,"currency"),t.k0s()()),2&s){const n=t.XpG();t.R7$(4),t.JRh(t.ii3(5,1,n.changeDue,"CFA ","symbol","1.0-0"))}}function r(s,u){if(1&s&&(t.j41(0,"div",24)(1,"span"),t.EFF(2,"Reste \xe0 payer"),t.k0s(),t.j41(3,"span",25),t.EFF(4),t.nI1(5,"currency"),t.k0s()()),2&s){const n=t.XpG();t.R7$(4),t.JRh(t.ii3(5,1,n.changeDue,"CFA ","symbol","1.0-0"))}}function a(s,u){1&s&&(t.j41(0,"div",44),t.EFF(1,"Chargement du re\xe7u..."),t.k0s())}function _(s,u){if(1&s&&(t.j41(0,"div",47)(1,"label"),t.EFF(2),t.nI1(3,"currency"),t.k0s()()),2&s){let n;const i=t.XpG(2);t.R7$(2),t.SpI("Monnaie \xe0 rendre: ",t.ii3(3,1,i.tempPaymentAmount-(null!==(n=null==i.vente?null:i.vente.montantTotal)&&void 0!==n?n:0),"CFA ","symbol","1.0-0"),"")}}function j(s,u){if(1&s&&(t.j41(0,"div",47)(1,"label"),t.EFF(2),t.nI1(3,"currency"),t.k0s()()),2&s){let n;const i=t.XpG(2);t.R7$(2),t.SpI("Reste \xe0 payer: ",t.ii3(3,1,(null!==(n=null==i.vente?null:i.vente.montantTotal)&&void 0!==n?n:0)-i.tempPaymentAmount,"CFA ","symbol","1.0-0"),"")}}function T(s,u){if(1&s){const n=t.RV6();t.j41(0,"div",45)(1,"div",46)(2,"h5"),t.EFF(3,"Modifier le re\xe7u"),t.k0s(),t.j41(4,"div",47)(5,"label"),t.EFF(6),t.nI1(7,"currency"),t.k0s()(),t.j41(8,"div",47)(9,"label"),t.EFF(10,"Montant pay\xe9"),t.k0s(),t.j41(11,"input",48),t.mxI("ngModelChange",function(e){t.eBV(n);const p=t.XpG();return t.DH7(p.tempPaymentAmount,e)||(p.tempPaymentAmount=e),t.Njj(e)}),t.bIt("input",function(){t.eBV(n);const e=t.XpG();return t.Njj(e.calculateChange())}),t.k0s()(),t.j41(12,"div",47)(13,"label"),t.EFF(14,"Mode de paiement"),t.k0s(),t.j41(15,"select",49),t.mxI("ngModelChange",function(e){t.eBV(n);const p=t.XpG();return t.DH7(p.tempPaymentMethod,e)||(p.tempPaymentMethod=e),t.Njj(e)}),t.j41(16,"option",50),t.EFF(17,"Esp\xe8ces"),t.k0s(),t.j41(18,"option",51),t.EFF(19,"Carte"),t.k0s(),t.j41(20,"option",52),t.EFF(21,"Virement"),t.k0s(),t.j41(22,"option",53),t.EFF(23,"Mobile Money"),t.k0s()()(),t.DNE(24,_,4,6,"div",54)(25,j,4,6,"div",54),t.j41(26,"div",55)(27,"button",8),t.bIt("click",function(){t.eBV(n);const e=t.XpG();return t.Njj(e.cancelModify())}),t.EFF(28,"Annuler"),t.k0s(),t.j41(29,"button",13),t.bIt("click",function(){t.eBV(n);const e=t.XpG();return t.Njj(e.updatePayment())}),t.EFF(30,"Valider et Imprimer"),t.k0s()()()()}if(2&s){let n,i;const e=t.XpG();t.R7$(6),t.SpI("Montant total: ",t.ii3(7,5,null==e.vente?null:e.vente.montantTotal,"CFA ","symbol","1.0-0"),""),t.R7$(5),t.R50("ngModel",e.tempPaymentAmount),t.R7$(4),t.R50("ngModel",e.tempPaymentMethod),t.R7$(9),t.Y8G("ngIf",e.tempPaymentAmount>=(null!==(n=null==e.vente?null:e.vente.montantTotal)&&void 0!==n?n:0)),t.R7$(),t.Y8G("ngIf",e.tempPaymentAmount<(null!==(i=null==e.vente?null:e.vente.montantTotal)&&void 0!==i?i:0))}}let I=(()=>{class s{constructor(n,i,e){this.router=n,this.venteService=i,this.entrepriseService=e,this.imgUrl=g.c.imgUrl,this.logo=null,this.fallbackLogo="assets/img/TCHAKEDA.png",this.vente=null,this.paymentAmount=0,this.changeDue=0,this.paymentMethod="Esp\xe8ces",this.loading=!1,this.errorMessage=null,this.showModifyModal=!1,this.tempPaymentAmount=0,this.tempPaymentMethod="Esp\xe8ces"}ngOnInit(){const n=localStorage.getItem("entreprise");if(n)try{const e=JSON.parse(n);this.logo=e.logo?this.ensureAbsoluteLogoUrl(e.logo):null}catch{this.logo=null}this.logo||this.entrepriseService.getEntrepriseInfo().subscribe({next:e=>{this.logo=e.logo?this.ensureAbsoluteLogoUrl(e.logo):null;try{localStorage.setItem("entreprise",JSON.stringify(e))}catch{}},error:e=>{console.warn("Impossible de charger info entreprise pour logo",e),this.logo=null}});const i=history&&history.state?history.state:{};if(i&&i.vente)return this.vente=i.vente,this.paymentAmount=i.paymentAmount??this.vente?.montantPaye??0,this.changeDue=i.changeDue??this.paymentAmount-(this.vente?.montantTotal??0),void(this.paymentMethod=i.paymentMethod??this.vente?.modePaiement??this.paymentMethod);i&&i.venteId&&this.loadVenteById(i.venteId)}ensureAbsoluteLogoUrl(n){return n?n.startsWith("http")||n.startsWith("data:")||n.startsWith("blob:")||this.imgUrl&&n.startsWith(this.imgUrl)?n:(this.imgUrl.endsWith("/")?this.imgUrl.slice(0,-1):this.imgUrl)+(n.startsWith("/")?n:`/${n}`):this.fallbackLogo}onLogoError(){this.logo=this.fallbackLogo}loadVenteById(n){this.loading=!0,this.venteService.getVenteById(n).subscribe({next:i=>{this.vente=i,this.paymentAmount=i.montantPaye??i.montantTotal??0,this.changeDue=this.paymentAmount-(i.montantTotal??0),this.paymentMethod=i.modePaiement??this.paymentMethod,this.loading=!1},error:i=>{console.error("Erreur chargement vente",i),this.errorMessage=i?.error?.message||i?.message||"Erreur chargement vente",this.loading=!1}})}impressionReceipt(){if(!this.receiptEl)return;const n=window.location.origin;let i=this.receiptEl.nativeElement.innerHTML;i=i.replace(/src="assets\//g,`src="${n}/assets/`);const e=window.open("","_blank","left=0,top=0,width=380,height=500,toolbar=0,scrollbars=0,status=0");e?.document.write(`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Re\xe7u de paiement</title>\n        <style>\n          * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n            font-family: Arial, sans-serif;\n            -webkit-print-color-adjust: exact !important;\n            print-color-adjust: exact !important;\n          }\n          body { \n            padding: 10px; \n            background: white;\n          }\n          .paiement_right {\n            width: 100%\n            display: flex !important;\n            align-items: center !important;\n            justify-content: center;\n          }\n          .receipt {\n            width: 100% !important;\n            min-width: 350px !important; /* Largeur augment\xe9e */\n            min-height: 0 !important;\n            margin: 0 auto;\n            padding: 15px !important;\n            box-shadow: none !important;\n          }\n          .no-print { display: none !important; }\n          .paleft { padding-left: 5px !important; }\n          /* Centrage du header */\n          .receipt-header {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            text-align: center;\n            margin-bottom: 15px !important;\n          }\n          .receipt-header .logo {\n            max-width: 100px !important; /* Taille originale */\n            margin-bottom: 10px !important;\n          }\n          .ticket-info div {\n            font-size: 10px !important;\n            line-height: 1.4 !important; \n            margin-top: 4px !important; /* Espacement r\xe9duit */\n          }\n          \n          .items-list { \n            margin-bottom: 10px !important; \n            width: 100%;\n          }\n          .item .qty {\n              width: 8px !important;\n            }\n          .item {\n            display: flex !important;\n            align-items: flex-start !important;\n            margin-bottom: 8px !important;\n          }\n          .divider {\n            border-top: 1px dotted #000 !important;\n            margin: 8px 0 !important;\n          }\n          .line span {\n            font-size: 11px !important; /* Taille de police augment\xe9e */\n          }\n          \n          /* Centrage du footer */\n          .receipt-footer { \n            position: relative !important; \n            bottom: 0 !important;\n            margin-top: 20px !important;\n            font-size: 10px !important;\n            text-align: center !important;\n            width: 100%;\n          }\n          \n          .qty, .name, .total {\n            font-size: 10px !important; /* Taille de police augment\xe9e */\n          }\n          .unit-price {\n            font-size: 10px !important; /* Taille de police augment\xe9e */\n          }\n          \n          @page { \n            size: auto; \n            margin: 0; \n          }\n          @media print {\n            body { padding: 0 !important; }\n          }\n        </style>\n      </head>\n      <body>\n        ${i}\n        <div class="no-print" style="text-align:center;margin-top:20px;">\n          <button onclick="window.print()" style="padding:8px 16px;background:#1976D2;color:white;border:none;border-radius:4px;cursor:pointer;">\n            Imprimer\n          </button>\n          <button onclick="window.close()" style="padding:8px 16px;margin-left:10px;background:#f44336;color:white;border:none;border-radius:4px;cursor:pointer;">\n            Fermer\n          </button>\n        </div>\n        <script>\n          window.onload = function() {\n            window.print();\n            setTimeout(function() {\n              window.close();\n            }, 1000);\n          };\n        <\/script>\n      </body>\n      </html>\n    `),e?.document.close()}newOrder(){this.router.navigate(["/pos-accueil"])}getLignes(){return this.vente?.lignes??[]}modifyPaymentRecu(){this.tempPaymentAmount=this.paymentAmount,this.tempPaymentMethod=this.paymentMethod,this.showModifyModal=!0}updatePayment(){this.paymentAmount=this.tempPaymentAmount,this.paymentMethod=this.tempPaymentMethod,this.changeDue=this.paymentAmount-(this.vente?.montantTotal??0),this.showModifyModal=!1,setTimeout(()=>{this.impressionReceipt()},100)}cancelModify(){this.showModifyModal=!1}calculateChange(){this.changeDue=this.tempPaymentAmount-(this.vente?.montantTotal??0)}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(d.Ix),t.rXU(v.W),t.rXU(P.r))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-pos-paiement"]],viewQuery:function(i,e){if(1&i&&t.GBs(E,5),2&i){let p;t.mGM(p=t.lsd())&&(e.receiptEl=p.first)}},decls:63,vars:35,consts:[["receipt",""],["loadingTpl",""],[1,"container_paiement"],[1,"content_paiement"],[1,"paiement_left"],[1,"content_paiement_left"],["class","card status-card",4,"ngIf","ngIfElse"],["class","card amount-card",4,"ngIf"],[1,"btn","btn-secondary",3,"click"],[1,"email-send"],["type","email","placeholder","example@gmail.com"],[1,"btn-send"],[1,"ri-send-plane-fill"],[1,"btn","btn-primary","btn-new-order",3,"click"],[1,"paiement_right"],[1,"receipt"],[1,"receipt-header"],["alt","Logo XpertPro",1,"logo",3,"error","src"],[1,"ticket-info"],[1,"items-list"],["class","item",4,"ngFor","ngForOf"],["class","no-items",4,"ngIf"],[1,"divider"],[1,"totals"],[1,"line"],[1,"paleft"],[1,"line","total-line"],[1,"payments-breakdown"],["class","line",4,"ngIf"],[1,"receipt-footer"],["class","modal-overlay",4,"ngIf"],[1,"card","status-card"],[1,"status-icon"],[1,"status-text"],[1,"card","amount-card"],[1,"amount"],[1,"method"],[1,"item"],[1,"qty"],[1,"desc"],[1,"name"],[1,"unit-price"],[1,"total"],[1,"no-items"],[1,"loading"],[1,"modal-overlay"],[1,"modal-content"],[1,"form-group"],["type","number","min","0","step","100",3,"ngModelChange","input","ngModel"],[3,"ngModelChange","ngModel"],["value","Esp\xe8ces"],["value","Carte"],["value","Virement"],["value","Mobile Money"],["class","form-group",4,"ngIf"],[1,"modal-actions"]],template:function(i,e){if(1&i){const p=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5),t.DNE(4,M,5,0,"div",6)(5,x,6,7,"div",7),t.j41(6,"button",8),t.bIt("click",function(){return t.eBV(p),t.Njj(e.modifyPaymentRecu())}),t.EFF(7,"Modifier le re\xe7u"),t.k0s(),t.j41(8,"button",8),t.bIt("click",function(){return t.eBV(p),t.Njj(e.impressionReceipt())}),t.EFF(9,"Imprimer le re\xe7u"),t.k0s(),t.j41(10,"div",9),t.nrm(11,"input",10),t.j41(12,"button",11),t.nrm(13,"i",12),t.k0s()(),t.j41(14,"button",13),t.bIt("click",function(){return t.eBV(p),t.Njj(e.newOrder())}),t.EFF(15,"Nouvelle commande"),t.k0s()()(),t.j41(16,"div",14)(17,"div",15,0)(19,"div",16)(20,"img",17),t.bIt("error",function(){return t.eBV(p),t.Njj(e.onLogoError())}),t.k0s(),t.j41(21,"div",18)(22,"div"),t.EFF(23),t.k0s(),t.j41(24,"div"),t.EFF(25),t.nI1(26,"date"),t.k0s(),t.j41(27,"div"),t.EFF(28),t.k0s(),t.j41(29,"div"),t.EFF(30),t.k0s()()(),t.j41(31,"ul",19),t.DNE(32,h,12,14,"li",20)(33,k,2,0,"li",21),t.k0s(),t.nrm(34,"div",22),t.j41(35,"div",23)(36,"div",24)(37,"span"),t.EFF(38,"Sous-total"),t.k0s(),t.j41(39,"span",25),t.EFF(40),t.nI1(41,"currency"),t.k0s()(),t.j41(42,"div",26)(43,"span"),t.EFF(44,"Total"),t.k0s(),t.j41(45,"span",25),t.EFF(46),t.nI1(47,"currency"),t.k0s()()(),t.nrm(48,"div",22),t.j41(49,"div",27)(50,"div",24)(51,"span"),t.EFF(52),t.k0s(),t.j41(53,"span",25),t.EFF(54),t.nI1(55,"currency"),t.k0s()(),t.DNE(56,o,6,6,"div",28)(57,r,6,6,"div",28),t.k0s(),t.j41(58,"div",29),t.EFF(59," G\xe9n\xe9r\xe9 par Tchakeda "),t.k0s()(),t.DNE(60,a,2,0,"ng-template",null,1,t.C5r),t.k0s()()(),t.DNE(62,T,31,10,"div",30)}if(2&i){let p,f,b,C,F;const A=t.sdS(61);t.R7$(4),t.Y8G("ngIf",e.vente)("ngIfElse",A),t.R7$(),t.Y8G("ngIf",e.vente),t.R7$(15),t.Y8G("src",e.logo||"assets/logo/rec\u0327u.png",t.B4B),t.R7$(3),t.SpI("Ticket : ",null!==(p=null==e.vente?null:e.vente.venteId)&&void 0!==p?p:"\u2014",""),t.R7$(2),t.JRh(t.i5U(26,17,null==e.vente?null:e.vente.dateVente,"dd/MM/yyyy HH:mm")),t.R7$(3),t.SpI("Servi par : ",null!==(f=null==e.vente?null:e.vente.nomVendeur)&&void 0!==f?f:"\u2014",""),t.R7$(2),t.SpI("Boutique : ",null!==(b=null==e.vente?null:e.vente.nomBoutique)&&void 0!==b?b:"\u2014",""),t.R7$(2),t.Y8G("ngForOf",e.getLignes()),t.R7$(),t.Y8G("ngIf",0===e.getLignes().length),t.R7$(7),t.JRh(t.ii3(41,20,null==e.vente?null:e.vente.montantTotal,"CFA ","symbol","1.0-0")),t.R7$(6),t.JRh(t.ii3(47,25,null==e.vente?null:e.vente.montantTotal,"CFA ","symbol","1.0-0")),t.R7$(6),t.JRh(e.paymentMethod),t.R7$(2),t.JRh(t.ii3(55,30,e.paymentAmount,"CFA ","symbol","1.0-0")),t.R7$(2),t.Y8G("ngIf",e.paymentAmount>=(null!==(C=null==e.vente?null:e.vente.montantTotal)&&void 0!==C?C:0)),t.R7$(),t.Y8G("ngIf",e.paymentAmount<(null!==(F=null==e.vente?null:e.vente.montantTotal)&&void 0!==F?F:0)),t.R7$(5),t.Y8G("ngIf",e.showModifyModal)}},dependencies:[c.YN,c.xH,c.y7,c.me,c.Q0,c.wz,c.BC,c.VZ,c.vS,m.MD,m.Sq,m.bT,m.oe,m.vh,c.X1],styles:[".container_paiement[_ngcontent-%COMP%]{width:100%}.content_paiement[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;height:100vh;background:#fff}.paiement_left[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.content_paiement_left[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:stretch;gap:15px;width:60%;position:relative;top:-10%}.card[_ngcontent-%COMP%]{border:1px solid #A5D6A7;border-radius:4px;padding:16px;display:flex;align-items:center;flex-direction:row}.status-card[_ngcontent-%COMP%]{background:#e8f5e9;margin-bottom:0;padding:30px 20px}.status-icon[_ngcontent-%COMP%]{width:24px;height:24px;background:#4caf50;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-right:12px;font-size:16px}.status-text[_ngcontent-%COMP%]{font-size:16px;font-weight:500;color:#2e7d32}.amount-card[_ngcontent-%COMP%]{justify-content:space-between;margin-bottom:0}.amount[_ngcontent-%COMP%], .method[_ngcontent-%COMP%]{font-size:18px;color:#2e7d32}.btn[_ngcontent-%COMP%]{padding:14px 20px;border:none;border-radius:4px;font-size:16px;cursor:pointer}.btn-secondary[_ngcontent-%COMP%]{background:#f9f9f9;color:#333}.email-send[_ngcontent-%COMP%]{display:flex;align-items:center;border:1px solid #ddd;border-radius:4px;overflow:hidden;position:relative}.email-send[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border:none;padding:12px;font-size:14px}.email-send[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none}.btn-send[_ngcontent-%COMP%]{background:#1976d2;color:#fff;font-size:20px;border:none;border-radius:4px 0 0 4px;padding:8px 22px}.btn-primary[_ngcontent-%COMP%]{background:#1976d2;color:#fff}.btn-new-order[_ngcontent-%COMP%]{margin-top:auto}.paiement_right[_ngcontent-%COMP%]{padding:40px;background:#ececec;overflow-y:auto;margin-bottom:8%}.receipt[_ngcontent-%COMP%]{max-width:350px;min-height:80vh;margin:0 auto;background:#fff;padding:24px 15px;box-shadow:0 2px 6px #0000001a;position:relative}.receipt-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:15px}.receipt-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{max-width:130px}.ticket-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:12px;color:#555;line-height:2px;margin-top:20px}.items-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0 0 16px}.item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;margin-bottom:12px}.item[_ngcontent-%COMP%]   .qty[_ngcontent-%COMP%]{width:14px;font-weight:700;font-size:12px}.desc[_ngcontent-%COMP%]{flex:1;margin:0 12px}.name[_ngcontent-%COMP%]{font-weight:500;font-size:13px}.unit-price[_ngcontent-%COMP%]{font-size:10px;color:#777}.total[_ngcontent-%COMP%]{white-space:nowrap;font-size:13px}.divider[_ngcontent-%COMP%]{border-top:1px dotted #bbb;margin:12px 0}.totals[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%], .payments-breakdown[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px;font-size:13px}.total-line[_ngcontent-%COMP%]{font-weight:600}.receipt-footer[_ngcontent-%COMP%]{position:absolute;bottom:10px;left:0;width:100%;font-size:8px;color:#888;text-align:center;font-style:italic}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;width:400px;box-shadow:0 4px 20px #00000026}.form-group[_ngcontent-%COMP%]{margin-bottom:15px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:500}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:20px}"]})}}return s})()},92120:(O,y,l)=>{l.d(y,{r:()=>x});var m=l(21626),c=l(84412),g=l(25558),t=l(99437),d=l(18810),v=l(88141),P=l(22525),E=l(54438),M=l(88026);let x=(()=>{class h{constructor(o,r){this.http=o,this.usersService=r,this.apiUrl=P.c.apiBaseUrl,this.entrepriseSubject=new c.t([]),this.entreprise$=this.entrepriseSubject.asObservable()}getListEntreprises(){return this.usersService.getValidAccessToken().pipe((0,g.n)(o=>{const r=new m.Lr({Authorization:`Bearer ${o}`,"Content-Type":"application/json"});return this.http.get(`${this.apiUrl}/entreprises`,{headers:r})}),(0,t.W)(o=>{let r="Erreur inconnue";return o.error instanceof ErrorEvent?r=`Erreur: ${o.error.message}`:404===o.status&&(r="Aucune entreprise trouv\xe9e"),(0,d.$)(()=>new Error(r))}))}addEntreprise(o){return this.usersService.getValidAccessToken().pipe((0,g.n)(r=>{const a=new m.Lr({Authorization:`Bearer ${r}`,"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}/entreprise-clients`,o,{headers:a})}),(0,v.M)(r=>{this.entrepriseSubject.next([...this.entrepriseSubject.value,r])}),(0,t.W)(r=>{let a="Erreur inconnue";return r.error instanceof ErrorEvent?a=`Erreur: ${r.error.message}`:400===r.status&&(a=r.error||"Donn\xe9es invalides"),(0,d.$)(()=>new Error(a))}))}getListEntreprise(){return this.usersService.getValidAccessToken().pipe((0,g.n)(o=>{if(!o)return console.error("Token vide ou non d\xe9fini ! V\xe9rifiez que l'utilisateur est bien connect\xe9."),(0,d.$)(()=>new Error("Token manquant"));const r=(new m.Lr).set("Authorization",`Bearer ${o}`);return console.log("En-t\xeates envoy\xe9s : ",r),this.http.get(`${this.apiUrl}/entreprises`,{headers:r})}),(0,v.M)(o=>{this.entrepriseSubject.next(o)}),(0,t.W)(o=>(console.error("Erreur lors de la r\xe9cup\xe9ration des entreprises:",o),(0,d.$)(()=>o))))}getEntrepriseById(o){return this.usersService.getValidAccessToken().pipe((0,g.n)(r=>{if(!r)return console.error("Token manquant"),(0,d.$)(()=>new Error("Token manquant"));const a=new m.Lr({Authorization:`Bearer ${r}`,"Content-Type":"application/json"});return this.http.get(`${this.apiUrl}/entreprises/${o}`,{headers:a})}),(0,t.W)(r=>{let a="Erreur inconnue";return r.error instanceof ErrorEvent?a=`Erreur: ${r.error.message}`:404===r.status&&(a="Entreprise non trouv\xe9e"),(0,d.$)(()=>new Error(a))}))}updateEntreprise(o,r){return this.usersService.getValidAccessToken().pipe((0,g.n)(a=>{if(!a)return(0,d.$)(()=>new Error("Token manquant"));const _=new m.Lr({Authorization:`Bearer ${a}`});return this.http.patch(`${this.apiUrl}/updateEntreprise/${o}`,r,{headers:_,responseType:"text"})}),(0,t.W)(a=>{let _="Erreur inconnue";return a.error instanceof ErrorEvent?_=`Erreur: ${a.error.message}`:400===a.status&&(_=a.error||"Donn\xe9es invalides"),(0,d.$)(()=>new Error(_))}))}getEntrepriseInfo(){return this.usersService.getValidAccessToken().pipe((0,g.n)(o=>{if(!o)return(0,d.$)(()=>new Error("Aucun token trouv\xe9"));const r=new m.Lr({Authorization:`Bearer ${o}`});return this.http.get(`${this.apiUrl}/myEntreprise`,{headers:r}).pipe((0,v.M)(a=>{localStorage.setItem("entreprise",JSON.stringify(a))}))}),(0,t.W)(o=>(console.error("Erreur r\xe9cup\xe9ration info entreprise:",o),(0,d.$)(()=>o))))}decodeJwt(o){return JSON.parse(atob(o.split(".")[1]))}isTokenExpired(o){return new Date(1e3*o.exp)<new Date}getNewTokenFromApi(){const o=localStorage.getItem("refreshToken");return this.http.post(`${this.apiUrl}/refresh-token`,{refreshToken:o})}static{this.\u0275fac=function(r){return new(r||h)(E.KVO(m.Qq),E.KVO(M.g))}}static{this.\u0275prov=E.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})()}}]);
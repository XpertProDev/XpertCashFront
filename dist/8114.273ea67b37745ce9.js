"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[8114],{6375:(D,v,c)=>{c.d(v,{D:()=>x});var a=c(1626),t=c(9437),_=c(8810),C=c(2525),E=c(4438);let x=(()=>{class f{constructor(r){this.http=r,this.apiUrl=C.c.apiBaseUrl}ajouterProduit(r,l,d,h,p,b){const k=`${this.apiUrl}/create?addToStock=${b}`,g=new FormData;g.append("boutiqueIds",JSON.stringify(r)),g.append("quantites",JSON.stringify(l)),g.append("produit",JSON.stringify(h)),g.append("seuilAlert",JSON.stringify(d)),p&&g.append("image",p,p.name);const s=localStorage.getItem("authToken")||"",m=new a.Lr({Authorization:`Bearer ${s}`});return this.http.post(k,g,{headers:m})}modifierProduit(r,l){const d=localStorage.getItem("authToken")||"",h=new a.Lr({Authorization:`Bearer ${d}`}),p=new FormData,{id:b,...k}=r;return p.append("produit",JSON.stringify(k)),p.append("addToStock",r.enStock?"true":"false"),l&&p.append("image",l,l.name),this.http.patch(`${this.apiUrl}/updateProduit/${r.id}`,p,{headers:h})}getProduitById(r){const l=localStorage.getItem("authToken")||"",d=new a.Lr({Authorization:`Bearer ${l}`});return this.http.get(`${this.apiUrl}/produits/${r}`,{headers:d})}getProduitsEntreprise(r){const l=localStorage.getItem("authToken"),d=new a.Lr({Authorization:`Bearer ${l}`});return this.http.get(`${this.apiUrl}/produits/${r}/stock`,{headers:d}).pipe((0,t.W)(h=>(0,_.$)(400===h.status&&"Cette boutique est d\xe9sactiv\xe9e, ses produits ne sont pas accessibles !"===h.error?.error?()=>new Error("BOUTIQUE_DESACTIVEE"):()=>h)))}getProduitBoutique(r){const l=localStorage.getItem("authToken");if(!l)return console.error("Aucun token trouv\xe9"),(0,_.$)("Aucun token trouv\xe9");const d=new a.Lr({Authorization:`Bearer ${l}`});return this.http.get(`${this.apiUrl}/produits/${r}/totaux-stock`,{headers:d})}getProduitsByEntrepriseId(r){return this.http.get(`${this.apiUrl}/produits/entreprise/${r}`)}getProduitsParEntreprise(r){return this.http.get(`${this.apiUrl}/produits/entreprise/${r}`)}getFournisseurs(){const r=localStorage.getItem("authToken")||"",l=new a.Lr({Authorization:`Bearer ${r}`});return this.http.get(`${this.apiUrl}/get-fournisseurs`,{headers:l})}static{this.\u0275fac=function(l){return new(l||f)(E.KVO(a.Qq))}}static{this.\u0275prov=E.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}}return f})()},8114:(D,v,c)=>{c.r(v),c.d(v,{DetailStockComponent:()=>g});var a=c(177),t=c(4438),_=c(9192),C=c(9107),E=c(4941),x=c.n(E),f=c(8026),O=c(6375),r=c(933);function l(s,m){1&s&&t.nrm(0,"i",48)}function d(s,m){1&s&&t.nrm(0,"i",49)}function h(s,m){if(1&s){const e=t.RV6();t.j41(0,"div",50)(1,"div",51),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.downloadBoutiqueProduitPDF())}),t.EFF(2,"T\xe9l\xe9charger en PDF"),t.k0s(),t.j41(3,"div",52),t.EFF(4,"Imprimer"),t.k0s()()}}function p(s,m){if(1&s&&(t.j41(0,"div",53),t.nrm(1,"textarea",54),t.k0s()),2&s){const e=t.XpG();t.R7$(),t.Y8G("value",e.getDisplayedDescription())}}function b(s,m){if(1&s&&(t.j41(0,"div")(1,"p",55),t.EFF(2),t.k0s()()),2&s){const e=t.XpG();t.R7$(2),t.JRh(e.boutiqueName)}}function k(s,m){if(1&s&&(t.j41(0,"p",55),t.EFF(1),t.k0s()),2&s){const e=t.XpG();t.R7$(),t.SpI(" ",e.allBoutiqueNames.join(", ")||"Aucune boutique"," ")}}let g=(()=>{class s{constructor(e,n,o,i,u,P){this.locale=e,this.userService=n,this.produitService=o,this.stockService=i,this.router=u,this.route=P,this.boutiqueName="",this.nomComplet="",this.nomEntreprise="",this.email="",this.stockHistory=[],this.showExportDropdown=!1,this.showDescription=!1,this.allBoutiqueNames=[],this.totalQuantity=0,this.selectedBoutiqueId=null,this.adjustedStocks=[],this.stock=null,console.log("Langue actuelle:",this.locale)}toggleExportDropdown(){this.showExportDropdown=!this.showExportDropdown}onClickOutside(e){e.target.closest(".export-container")||(this.showExportDropdown=!1)}ngOnInit(){this.route.queryParams.subscribe(e=>{this.selectedBoutiqueId=e.boutiqueId?+e.boutiqueId:null,this.getProduit()}),this.getUserInfo(),this.loadStockById(),this.loadStockHistory()}loadAdjustedStock(){const e=this.userService.getToken();e?this.stockService.getAllStocks(e).subscribe({next:n=>{console.log("recuperer",n);const o=n.filter(i=>i.quantiteAjoute&&i.quantiteAjoute>0||i.quantiteRetirer&&i.quantiteRetirer>0);this.stock=o.length>0?o[0]:null},error:n=>{console.error("Erreur lors du chargement du stock ajust\xe9",n)}}):console.error("Token introuvable")}loadStockById(){const e=this.route.snapshot.paramMap.get("id"),n=e?+e:null;if(!n)return void console.error("ID du stock invalide");const o=this.userService.getToken();o?this.stockService.getAllStocks(o).subscribe({next:i=>{const u=i.find(P=>P.id===n);u?(console.log("Stock trouv\xe9 :",u),this.stock=u):console.error(`Aucun stock trouv\xe9 avec l'ID ${n}`)},error:i=>{console.error("Erreur lors du chargement des stocks",i)}}):console.error("Token introuvable")}getBoutiqueName(){this.userService.getUserInfo().subscribe(e=>{console.log(e),e&&e.boutiques&&e.boutiques.length>0?(console.log(e.boutiques[0]),this.boutiqueName=e.boutiques[0].nomBoutique||"Nom de la boutique non trouv\xe9"):(console.error("Aucune boutique trouv\xe9e pour cet utilisateur"),this.boutiqueName="Aucune boutique")},e=>{console.error("Erreur lors de la r\xe9cup\xe9ration des informations utilisateur",e)})}getUserInfo(){this.userService.getUserInfo().subscribe({next:e=>{this.nomComplet=e.nomComplet,this.nomEntreprise=e.nomEntreprise,this.email=e.email},error:e=>{console.error("Erreur lors de la r\xe9cup\xe9ration des infos utilisateur :",e)}})}getProduit(){const e=this.route.snapshot.paramMap.get("id"),n=e?+e:0;n>0&&this.produitService.getProduitById(n).subscribe({next:o=>{if(this.produit=o,o.boutiques&&o.boutiques.length>0&&(this.allBoutiqueNames=o.boutiques.map(i=>i.nom),this.selectedBoutiqueId||(this.totalQuantity=o.boutiques.reduce((i,u)=>i+(u.quantite||0),0))),this.selectedBoutiqueId&&o.boutiques){const i=o.boutiques.find(u=>u.id===this.selectedBoutiqueId);i&&(this.boutiqueName=i.nom,this.produit.quantite=i.quantite||0)}this.loadStockHistory()},error:o=>console.error("Erreur:",o)})}loadStockHistory(){const e=this.produit?.id;if(!e)return void console.error("Produit non d\xe9fini pour charger l'historique");const n=this.userService.getToken();n?this.stockService.getAllstockhistorique(e,n).subscribe({next:o=>{console.log("Historique de stock:",o),this.stockHistory=o},error:o=>{console.error("Erreur lors du chargement de l'historique de stock",o)}}):console.error("Token introuvable")}getLastStockAction(){return this.stockHistory&&0!==this.stockHistory.length&&this.stockHistory[this.stockHistory.length-1]?.action||"Non activitit\xe9"}downloadBoutiqueProduitPDF(){const e=new C.default;if(!(this.boutiqueName&&this.nomComplet&&this.email&&this.produit))return void console.error("Informations incompl\xe8tes !");let n="";n=this.produit.createdAt?new Date(this.produit.createdAt).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"Date non disponible",e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Fiche Produit et Stock",80,15),e.setFontSize(12),e.text("Informations de la boutique",14,30),e.setLineWidth(.5),e.line(14,32,195,32),e.setFontSize(10),e.text(`Nom de la Boutique : ${this.boutiqueName}`,14,40),e.text("Adresse : Rue 414",14,45),e.text(`Date de cr\xe9ation : ${n}`,14,50),e.text(`Cr\xe9\xe9 par : ${this.nomComplet}`,14,55),e.text(`Email : ${this.email}`,14,60),e.setLineWidth(.5),e.line(14,65,195,65),e.setFontSize(12),e.text(`D\xe9tails du Produit N\xb0: ${this.produit.codeGenerique}`,14,75),e.line(14,77,195,77);const i=[[this.produit.nom||"N/A",this.produit.quantite??0,"_____",`${this.produit.prixAchat??0}`]];x()(e,{head:[["Mes produits","Stock actuel","Quantit\xe9 \xe0 ajouter","Quantit\xe9 \xe0 retir\xe9","Co\xfbt du produit"]],body:i,startY:80,theme:"grid",headStyles:{fillColor:[64,153,255],textColor:[255,255,255],fontSize:12},bodyStyles:{fontSize:10}});const u=e.lastAutoTable?.finalY||120;e.setLineWidth(.5),e.line(14,u+5,195,u+5),e.setFontSize(10),e.text("Signature:",14,u+15),e.text("Approuv\xe9 par:",100,u+15),e.text("Re\xe7u par:",140,u+15),e.save(`Fiche_Produit_${this.produit.nom}.pdf`)}getDisplayedDescription(){const e=(this.getLastStockAction()||"").toLowerCase();return console.log("descriptionAjout:",this.stock?.descriptionAjout,"descriptionRetire:",this.stock?.descriptionRetire),e.includes("ajout")&&this.stock?.descriptionAjout?this.stock.descriptionAjout:(e.includes("retire")||e.includes("reduction"))&&this.stock?.descriptionRetire?this.stock.descriptionRetire:"Aucune description..."}toggleDescription(){this.showDescription=!this.showDescription}static{this.\u0275fac=function(n){return new(n||s)(t.rXU(t.xe9),t.rXU(f.g),t.rXU(O.D),t.rXU(r.Q),t.rXU(_.Ix),t.rXU(_.nX))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-detail-stock"]],hostBindings:function(n,o){1&n&&t.bIt("click",function(u){return o.onClickOutside(u)},!1,t.EBC)},decls:103,vars:23,consts:[["openIcon",""],["allBoutiques",""],[1,"container_global"],[1,"content_detail_stock"],[1,"modal-body"],[1,"content_retour_icon"],["routerLink","/stocks",1,"retour_icon"],[1,"ri-arrow-left-fill"],[1,"icon_export"],[1,"export-container",2,"display","flex","align-items","center"],[1,"iconDrop",2,"margin-right","20px",3,"click"],["class","ri-chat-check-line","title","Afficher la description",4,"ngIf","ngIfElse"],[1,"iconDrop"],[1,"ri-printer-cloud-line",3,"click"],["class","export-dropdown",4,"ngIf"],[1,"iconDrop",2,"margin-left","20px"],[1,"ri-history-line"],[1,"container_imprimate"],[1,"content_imprimate"],[1,"codeProduit"],[1,"codeId",2,"letter-spacing","2px"],["class","description_detail",4,"ngIf"],[1,"info_content"],[1,"info"],[1,"info_title"],[4,"ngIf","ngIfElse"],[1,"info_value"],[2,"color","#9b9b9b"],[1,"info_value_position"],[1,"containerTable"],[1,"table_title"],[1,"titleTableProduit"],[1,"title_table_name"],[1,"title_table_contenu"],[1,"title_table_contenu",2,"color","#0672E4"],[1,"title_table_contenu4",2,"color","#ff0000"],[1,"champ_input",2,"margin-right","10px"],["type","text","readonly","",1,"input_table1",3,"value"],[1,"champ_input",2,"margin-right","15px"],["type","text","readonly","",1,"input_table",3,"value"],["type","text","readonly","",1,"input_table",2,"color","#0672E4",3,"value"],[1,"champ_input","i4"],["type","text","readonly","",1,"input_table",2,"color","#ff0000",3,"value"],[1,"container_signature"],[1,"content_signature"],[1,"signature"],[1,"approuve"],[1,"recu"],["title","Afficher la description",1,"ri-chat-check-line"],["title","Fermer la description",1,"ri-chat-off-line"],[1,"export-dropdown"],[1,"export-option",3,"click"],[1,"export-option"],[1,"description_detail"],["readonly","",3,"value"],[1,"info_value",2,"color","#0672E4"]],template:function(n,o){if(1&n){const i=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),t.nrm(5,"i",7),t.k0s(),t.j41(6,"div",8)(7,"div",9)(8,"div",10),t.bIt("click",function(){return t.eBV(i),t.Njj(o.toggleDescription())}),t.DNE(9,l,1,0,"i",11)(10,d,1,0,"ng-template",null,0,t.C5r),t.k0s(),t.j41(12,"div",12)(13,"i",13),t.bIt("click",function(){return t.eBV(i),t.Njj(o.toggleExportDropdown())}),t.k0s()(),t.DNE(14,h,5,0,"div",14),t.j41(15,"div",15),t.nrm(16,"i",16),t.k0s()()()(),t.j41(17,"div",17)(18,"div",18)(19,"div",19)(20,"p",20),t.EFF(21),t.k0s()(),t.DNE(22,p,2,1,"div",21),t.k0s(),t.j41(23,"div",22)(24,"div",23)(25,"p",24),t.EFF(26,"Boutique :"),t.k0s(),t.DNE(27,b,3,1,"div",25)(28,k,2,1,"ng-template",null,1,t.C5r),t.k0s(),t.j41(30,"div",23)(31,"p",24),t.EFF(32,"Date de creation :"),t.k0s(),t.j41(33,"p",26),t.EFF(34),t.nI1(35,"date"),t.k0s()(),t.j41(36,"div",23)(37,"p",24),t.EFF(38,"Cr\xe9\xe9 par :"),t.k0s(),t.j41(39,"p",26),t.EFF(40),t.k0s()(),t.j41(41,"div",23)(42,"p",24),t.EFF(43,"Email :"),t.k0s(),t.j41(44,"p",26),t.EFF(45),t.k0s()(),t.j41(46,"div",23)(47,"p",27),t.EFF(48,"Derni\xe8re activit\xe9"),t.k0s()(),t.j41(49,"div",23)(50,"p"),t.EFF(51,"Type de mouvement : "),t.k0s(),t.j41(52,"p",26),t.EFF(53),t.k0s()(),t.j41(54,"div",23)(55,"p",28),t.EFF(56),t.nI1(57,"date"),t.k0s()()(),t.j41(58,"div",29)(59,"div",30)(60,"p"),t.EFF(61,"Produit"),t.k0s()(),t.j41(62,"table")(63,"thead")(64,"tr",31)(65,"th",32),t.EFF(66,"Mes produits"),t.k0s(),t.j41(67,"th",33),t.EFF(68,"Stock actuel"),t.k0s(),t.j41(69,"th",34),t.EFF(70,"Quantit\xe9 \xe0 ajouter"),t.k0s(),t.j41(71,"th",33),t.EFF(72,"Co\xfbt du produit"),t.k0s(),t.j41(73,"th",35),t.EFF(74,"Quantit\xe9 \xe0 retirer"),t.k0s()()(),t.j41(75,"tbody")(76,"tr")(77,"td")(78,"div",36),t.nrm(79,"input",37),t.k0s()(),t.j41(80,"td")(81,"div",38),t.nrm(82,"input",39),t.k0s()(),t.j41(83,"td")(84,"div",38),t.nrm(85,"input",40),t.k0s()(),t.j41(86,"td")(87,"div",38),t.nrm(88,"input",39),t.k0s()(),t.j41(89,"td")(90,"div",41),t.nrm(91,"input",42),t.k0s()()()()()(),t.j41(92,"div",43)(93,"div",44)(94,"div",45)(95,"p"),t.EFF(96,"Signature"),t.k0s()(),t.j41(97,"div",46)(98,"p"),t.EFF(99,"Approuv\xe9 par"),t.k0s()(),t.j41(100,"div",47)(101,"p"),t.EFF(102,"Re\xe7u par"),t.k0s()()()()()()()()}if(2&n){const i=t.sdS(11),u=t.sdS(29);t.R7$(9),t.Y8G("ngIf",!o.showDescription)("ngIfElse",i),t.R7$(5),t.Y8G("ngIf",o.showExportDropdown),t.R7$(7),t.SpI(" ",null==o.produit?null:o.produit.codeGenerique," "),t.R7$(),t.Y8G("ngIf",o.showDescription),t.R7$(5),t.Y8G("ngIf",o.selectedBoutiqueId)("ngIfElse",u),t.R7$(7),t.JRh(t.i5U(35,17,null==o.produit?null:o.produit.createdAt,"dd-MM-yyyy '\xe0' HH:mm")),t.R7$(6),t.JRh(o.nomComplet),t.R7$(5),t.JRh(o.email),t.R7$(8),t.JRh(o.getLastStockAction()),t.R7$(3),t.JRh(t.i5U(57,20,null==o.stock?null:o.stock.lastUpdated,"dd-MM-yyyy '\xe0' HH:mm")),t.R7$(23),t.Y8G("value",null==o.produit?null:o.produit.nom),t.R7$(3),t.Y8G("value",o.selectedBoutiqueId?(null==o.produit?null:o.produit.quantite)||0:o.totalQuantity),t.R7$(3),t.Y8G("value",null==o.stock?null:o.stock.quantiteAjoute),t.R7$(3),t.Y8G("value",null==o.produit?null:o.produit.prixVente),t.R7$(3),t.Y8G("value",null==o.stock?null:o.stock.quantiteRetirer)}},dependencies:[a.MD,a.bT,a.vh,_.Wk],styles:[".content_detail_stock[_ngcontent-%COMP%]{width:80%;height:85vh;background-color:#fff;box-shadow:2px 2px 30px #0000001c;border-radius:5px;margin-top:20px;margin-bottom:20px}.content_retour_icon[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid rgba(60,60,60,.1607843137)}.retour_icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px;cursor:pointer}.description_detail[_ngcontent-%COMP%]{float:right}.description_detail[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;height:160px;padding:10px 20px 12px 8px;box-sizing:border-box;border:2px solid #ccc;border-radius:4px;background-color:#f8f8f8;font-size:13px;resize:none}.export-container[_ngcontent-%COMP%]{position:relative;display:inline-block}.export-dropdown[_ngcontent-%COMP%]{position:absolute;background-color:#f9f9f9;min-width:180px;box-shadow:0 8px 16px #00000063;z-index:1;top:100%;left:0;border-radius:5px}.export-dropdown[_ngcontent-%COMP%]   .export-option[_ngcontent-%COMP%]{padding:12px 16px;cursor:pointer}.export-dropdown[_ngcontent-%COMP%]   .export-option[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}.iconDrop[_ngcontent-%COMP%]{display:flex;align-items:center}.iconDrop[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px;cursor:pointer}.container_imprimate[_ngcontent-%COMP%]{margin:20px}.codeProduit[_ngcontent-%COMP%]   .codeId[_ngcontent-%COMP%]{font-size:25px}.personne[_ngcontent-%COMP%], .info[_ngcontent-%COMP%]{display:flex;align-items:center}.info_email[_ngcontent-%COMP%]{margin-left:10%}.info_title[_ngcontent-%COMP%]{font-weight:600}.info[_ngcontent-%COMP%]   .info_value[_ngcontent-%COMP%]{padding-left:10px}.info[_ngcontent-%COMP%]   .info_value_position[_ngcontent-%COMP%]{position:relative;top:-10px;font-size:9px;letter-spacing:1px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.title[_ngcontent-%COMP%]{font-size:18px}.title_table_contenu4[_ngcontent-%COMP%]{text-align:right;padding-right:0}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f9f9f9}.containerTable[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;margin-top:0}.titleTableProduit[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:12px;font-weight:500}.table_title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:20px 0}.input_table[_ngcontent-%COMP%]{width:100%;height:49px;outline:none;border-bottom:1px solid rgb(53,50,50);border-top:none;border-left:none;border-right:none;transition:all .3s;font-size:14px;background:none;color:#695c5c;text-align:right;cursor:pointer}.input_table1[_ngcontent-%COMP%]{width:100%;height:49px;outline:none;border-bottom:1px solid rgb(53,50,50);border-top:none;border-left:none;border-right:none;transition:all .3s;font-size:14px;background:none;color:#695c5c;text-align:left}.title_table_name[_ngcontent-%COMP%]{width:30%}.title_table_contenu[_ngcontent-%COMP%]{text-align:right;padding-right:18px}.container_signature[_ngcontent-%COMP%]{margin:55px 0}.content_signature[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-evenly}.signature[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .approuve[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .recu[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px;font-weight:600}.blue-text[_ngcontent-%COMP%]{color:#0672e4}.red-text[_ngcontent-%COMP%]{color:red}"]})}}return s})()}}]);
"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[6447],{6447:(O,u,r)=>{r.r(u),r.d(u,{PosPaiementComponent:()=>F});var l=r(177),g=r(9417),f=r(2525),t=r(4438),h=r(9192),_=r(4413);const v=["receipt"];function x(o,s){1&o&&(t.j41(0,"div",30)(1,"div",31),t.EFF(2,"\u2714\ufe0e"),t.k0s(),t.j41(3,"div",32),t.EFF(4,"Paiement r\xe9ussi"),t.k0s()())}function y(o,s){if(1&o&&(t.j41(0,"div",33)(1,"div",34),t.EFF(2),t.nI1(3,"currency"),t.k0s(),t.j41(4,"div",35),t.EFF(5),t.k0s()()),2&o){const e=t.XpG();t.R7$(2),t.JRh(t.ii3(3,2,e.vente.montantTotal,"CFA ","symbol","1.0-0")),t.R7$(3),t.SpI("/ ",e.paymentMethod,"")}}function b(o,s){if(1&o&&(t.j41(0,"li",36)(1,"span",37),t.EFF(2),t.k0s(),t.j41(3,"div",38)(4,"div",39),t.EFF(5),t.k0s(),t.j41(6,"div",40),t.EFF(7),t.nI1(8,"currency"),t.k0s()(),t.j41(9,"span",41),t.EFF(10),t.nI1(11,"currency"),t.k0s()()),2&o){const e=s.$implicit;t.R7$(2),t.JRh(e.quantite),t.R7$(3),t.JRh(e.nomProduit),t.R7$(2),t.SpI("",t.ii3(8,4,e.prixUnitaire,"CFA ","symbol","1.0-0")," / Unit\xe9(s)"),t.R7$(3),t.JRh(t.ii3(11,9,e.montantLigne,"CFA ","symbol","1.0-0"))}}function P(o,s){1&o&&(t.j41(0,"li",42),t.EFF(1,"Aucun produit trouv\xe9"),t.k0s())}function C(o,s){if(1&o&&(t.j41(0,"div",24)(1,"span"),t.EFF(2,"Monnaie"),t.k0s(),t.j41(3,"span",25),t.EFF(4),t.nI1(5,"currency"),t.k0s()()),2&o){const e=t.XpG();t.R7$(4),t.JRh(t.ii3(5,1,e.changeDue,"CFA ","symbol","1.0-0"))}}function E(o,s){if(1&o&&(t.j41(0,"div",24)(1,"span"),t.EFF(2,"Reste \xe0 payer"),t.k0s(),t.j41(3,"span",25),t.EFF(4),t.nI1(5,"currency"),t.k0s()()),2&o){const e=t.XpG();t.R7$(4),t.JRh(t.ii3(5,1,e.changeDue,"CFA ","symbol","1.0-0"))}}function M(o,s){1&o&&(t.j41(0,"div",43),t.EFF(1,"Chargement du re\xe7u..."),t.k0s())}let F=(()=>{class o{constructor(e,i){this.router=e,this.venteService=i,this.imgUrl=f.c.imgUrl,this.vente=null,this.paymentAmount=0,this.changeDue=0,this.paymentMethod="Esp\xe8ces",this.loading=!1,this.errorMessage=null}ngOnInit(){const e=history&&history.state?history.state:{};if(e&&e.vente)return this.vente=e.vente,this.paymentAmount=e.paymentAmount??this.vente?.montantPaye??0,this.changeDue=e.changeDue??this.paymentAmount-(this.vente?.montantTotal??0),void(this.paymentMethod=e.paymentMethod??this.vente?.modePaiement??this.paymentMethod);e&&e.venteId&&this.loadVenteById(e.venteId)}loadVenteById(e){this.loading=!0,this.venteService.getVenteById(e).subscribe({next:i=>{this.vente=i,this.paymentAmount=i.montantPaye??i.montantTotal??0,this.changeDue=this.paymentAmount-(i.montantTotal??0),this.paymentMethod=i.modePaiement??this.paymentMethod,this.loading=!1},error:i=>{console.error("Erreur chargement vente",i),this.errorMessage=i?.error?.message||i?.message||"Erreur chargement vente",this.loading=!1}})}impressionReceipt(){if(!this.receiptEl)return;const e=window.location.origin;let i=this.receiptEl.nativeElement.innerHTML;i=i.replace(/src="assets\//g,`src="${e}/assets/`);const n=window.open("","_blank","left=0,top=0,width=380,height=500,toolbar=0,scrollbars=0,status=0");n?.document.write(`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Re\xe7u de paiement</title>\n        <style>\n          * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n            font-family: Arial, sans-serif;\n            -webkit-print-color-adjust: exact !important;\n            print-color-adjust: exact !important;\n          }\n          body { \n            padding: 10px; \n            background: white;\n          }\n          .paiement_right {\n            width: 100%\n            display: flex !important;\n            align-items: center !important;\n            justify-content: center;\n          }\n          .receipt {\n            width: 100% !important;\n            min-width: 350px !important; /* Largeur augment\xe9e */\n            min-height: 0 !important;\n            margin: 0 auto;\n            padding: 15px !important;\n            box-shadow: none !important;\n          }\n          .no-print { display: none !important; }\n          .paleft { padding-left: 5px !important; }\n          /* Centrage du header */\n          .receipt-header {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            text-align: center;\n            margin-bottom: 15px !important;\n          }\n          .receipt-header .logo {\n            max-width: 100px !important; /* Taille originale */\n            margin-bottom: 0px !important;\n          }\n          .ticket-info div {\n            font-size: 10px !important;\n            line-height: 1.4 !important; \n            margin-top: 4px !important; /* Espacement r\xe9duit */\n          }\n          \n          .items-list { \n            margin-bottom: 10px !important; \n            width: 100%;\n          }\n          .item .qty {\n              width: 8px !important;\n            }\n          .item {\n            display: flex !important;\n            align-items: flex-start !important;\n            margin-bottom: 8px !important;\n          }\n          .divider {\n            border-top: 1px dotted #000 !important;\n            margin: 8px 0 !important;\n          }\n          .line span {\n            font-size: 11px !important; /* Taille de police augment\xe9e */\n          }\n          \n          /* Centrage du footer */\n          .receipt-footer { \n            position: relative !important; \n            bottom: 0 !important;\n            margin-top: 20px !important;\n            font-size: 10px !important;\n            text-align: center !important;\n            width: 100%;\n          }\n          \n          .qty, .name, .total {\n            font-size: 10px !important; /* Taille de police augment\xe9e */\n          }\n          .unit-price {\n            font-size: 10px !important; /* Taille de police augment\xe9e */\n          }\n          \n          @page { \n            size: auto; \n            margin: 0; \n          }\n          @media print {\n            body { padding: 0 !important; }\n          }\n        </style>\n      </head>\n      <body>\n        ${i}\n        <div class="no-print" style="text-align:center;margin-top:20px;">\n          <button onclick="window.print()" style="padding:8px 16px;background:#1976D2;color:white;border:none;border-radius:4px;cursor:pointer;">\n            Imprimer\n          </button>\n          <button onclick="window.close()" style="padding:8px 16px;margin-left:10px;background:#f44336;color:white;border:none;border-radius:4px;cursor:pointer;">\n            Fermer\n          </button>\n        </div>\n        <script>\n          window.onload = function() {\n            window.print();\n            setTimeout(function() {\n              window.close();\n            }, 1000);\n          };\n        <\/script>\n      </body>\n      </html>\n    `),n?.document.close()}newOrder(){this.router.navigate(["/pos-accueil"])}modifyPayment(){this.router.navigate(["/pos-accueil"],{state:{editVente:this.vente}})}getLignes(){return this.vente?.lignes??[]}static{this.\u0275fac=function(i){return new(i||o)(t.rXU(h.Ix),t.rXU(_.W))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-pos-paiement"]],viewQuery:function(i,n){if(1&i&&t.GBs(v,5),2&i){let a;t.mGM(a=t.lsd())&&(n.receiptEl=a.first)}},decls:62,vars:33,consts:[["receipt",""],["loadingTpl",""],[1,"container_paiement"],[1,"content_paiement"],[1,"paiement_left"],[1,"content_paiement_left"],["class","card status-card",4,"ngIf","ngIfElse"],["class","card amount-card",4,"ngIf"],[1,"btn","btn-secondary",3,"click"],[1,"email-send"],["type","email","placeholder","example@gmail.com"],[1,"btn-send"],[1,"ri-send-plane-fill"],[1,"btn","btn-primary","btn-new-order",3,"click"],[1,"paiement_right"],[1,"receipt"],[1,"receipt-header"],["src","assets/img/TCHAKEDA.png","alt","Logo XpertPro",1,"logo"],[1,"ticket-info"],[1,"items-list"],["class","item",4,"ngFor","ngForOf"],["class","no-items",4,"ngIf"],[1,"divider"],[1,"totals"],[1,"line"],[1,"paleft"],[1,"line","total-line"],[1,"payments-breakdown"],["class","line",4,"ngIf"],[1,"receipt-footer"],[1,"card","status-card"],[1,"status-icon"],[1,"status-text"],[1,"card","amount-card"],[1,"amount"],[1,"method"],[1,"item"],[1,"qty"],[1,"desc"],[1,"name"],[1,"unit-price"],[1,"total"],[1,"no-items"],[1,"loading"]],template:function(i,n){if(1&i){const a=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5),t.DNE(4,x,5,0,"div",6)(5,y,6,7,"div",7),t.j41(6,"button",8),t.bIt("click",function(){return t.eBV(a),t.Njj(n.modifyPayment())}),t.EFF(7,"Modifier le paiement"),t.k0s(),t.j41(8,"button",8),t.bIt("click",function(){return t.eBV(a),t.Njj(n.impressionReceipt())}),t.EFF(9,"Imprimer le re\xe7u"),t.k0s(),t.j41(10,"div",9),t.nrm(11,"input",10),t.j41(12,"button",11),t.nrm(13,"i",12),t.k0s()(),t.j41(14,"button",13),t.bIt("click",function(){return t.eBV(a),t.Njj(n.newOrder())}),t.EFF(15,"Nouvelle commande"),t.k0s()()(),t.j41(16,"div",14)(17,"div",15,0)(19,"div",16),t.nrm(20,"img",17),t.j41(21,"div",18)(22,"div"),t.EFF(23),t.k0s(),t.j41(24,"div"),t.EFF(25),t.nI1(26,"date"),t.k0s(),t.j41(27,"div"),t.EFF(28),t.k0s(),t.j41(29,"div"),t.EFF(30),t.k0s()()(),t.j41(31,"ul",19),t.DNE(32,b,12,14,"li",20)(33,P,2,0,"li",21),t.k0s(),t.nrm(34,"div",22),t.j41(35,"div",23)(36,"div",24)(37,"span"),t.EFF(38,"Sous-total"),t.k0s(),t.j41(39,"span",25),t.EFF(40),t.nI1(41,"currency"),t.k0s()(),t.j41(42,"div",26)(43,"span"),t.EFF(44,"Total"),t.k0s(),t.j41(45,"span",25),t.EFF(46),t.nI1(47,"currency"),t.k0s()()(),t.nrm(48,"div",22),t.j41(49,"div",27)(50,"div",24)(51,"span"),t.EFF(52),t.k0s(),t.j41(53,"span",25),t.EFF(54),t.nI1(55,"currency"),t.k0s()(),t.DNE(56,C,6,6,"div",28)(57,E,6,6,"div",28),t.k0s(),t.j41(58,"div",29),t.EFF(59," G\xe9n\xe9r\xe9 par Tchakeda "),t.k0s()(),t.DNE(60,M,2,0,"ng-template",null,1,t.C5r),t.k0s()()()}if(2&i){let a,p,m,d,c;const k=t.sdS(61);t.R7$(4),t.Y8G("ngIf",n.vente)("ngIfElse",k),t.R7$(),t.Y8G("ngIf",n.vente),t.R7$(18),t.SpI("Ticket : ",null!==(a=null==n.vente?null:n.vente.venteId)&&void 0!==a?a:"\u2014",""),t.R7$(2),t.JRh(t.i5U(26,15,null==n.vente?null:n.vente.dateVente,"dd/MM/yyyy HH:mm")),t.R7$(3),t.SpI("Servi par : ",null!==(p=null==n.vente?null:n.vente.nomVendeur)&&void 0!==p?p:"\u2014",""),t.R7$(2),t.SpI("Boutique : ",null!==(m=null==n.vente?null:n.vente.nomBoutique)&&void 0!==m?m:"\u2014",""),t.R7$(2),t.Y8G("ngForOf",n.getLignes()),t.R7$(),t.Y8G("ngIf",0===n.getLignes().length),t.R7$(7),t.JRh(t.ii3(41,18,null==n.vente?null:n.vente.montantTotal,"CFA ","symbol","1.0-0")),t.R7$(6),t.JRh(t.ii3(47,23,null==n.vente?null:n.vente.montantTotal,"CFA ","symbol","1.0-0")),t.R7$(6),t.JRh(n.paymentMethod),t.R7$(2),t.JRh(t.ii3(55,28,n.paymentAmount,"CFA ","symbol","1.0-0")),t.R7$(2),t.Y8G("ngIf",n.paymentAmount>=(null!==(d=null==n.vente?null:n.vente.montantTotal)&&void 0!==d?d:0)),t.R7$(),t.Y8G("ngIf",n.paymentAmount<(null!==(c=null==n.vente?null:n.vente.montantTotal)&&void 0!==c?c:0))}},dependencies:[g.YN,l.MD,l.Sq,l.bT,l.oe,l.vh,g.X1],styles:[".container_paiement[_ngcontent-%COMP%]{width:100%}.content_paiement[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;height:100vh;background:#fff}.paiement_left[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.content_paiement_left[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:stretch;gap:15px;width:60%;position:relative;top:-10%}.card[_ngcontent-%COMP%]{border:1px solid #A5D6A7;border-radius:4px;padding:16px;display:flex;align-items:center;flex-direction:row}.status-card[_ngcontent-%COMP%]{background:#e8f5e9;margin-bottom:0;padding:30px 20px}.status-icon[_ngcontent-%COMP%]{width:24px;height:24px;background:#4caf50;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-right:12px;font-size:16px}.status-text[_ngcontent-%COMP%]{font-size:16px;font-weight:500;color:#2e7d32}.amount-card[_ngcontent-%COMP%]{justify-content:space-between;margin-bottom:0}.amount[_ngcontent-%COMP%], .method[_ngcontent-%COMP%]{font-size:18px;color:#2e7d32}.btn[_ngcontent-%COMP%]{padding:14px 20px;border:none;border-radius:4px;font-size:16px;cursor:pointer}.btn-secondary[_ngcontent-%COMP%]{background:#f9f9f9;color:#333}.email-send[_ngcontent-%COMP%]{display:flex;align-items:center;border:1px solid #ddd;border-radius:4px;overflow:hidden;position:relative}.email-send[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border:none;padding:12px;font-size:14px}.email-send[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none}.btn-send[_ngcontent-%COMP%]{background:#1976d2;color:#fff;font-size:20px;border:none;border-radius:4px 0 0 4px;padding:8px 22px}.btn-primary[_ngcontent-%COMP%]{background:#1976d2;color:#fff}.btn-new-order[_ngcontent-%COMP%]{margin-top:auto}.paiement_right[_ngcontent-%COMP%]{padding:40px;background:#ececec;overflow-y:auto;margin-bottom:8%}.receipt[_ngcontent-%COMP%]{max-width:350px;min-height:80vh;margin:0 auto;background:#fff;padding:24px 15px;box-shadow:0 2px 6px #0000001a;position:relative}.receipt-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:24px}.receipt-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{max-width:160px;margin-bottom:12px}.ticket-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:12px;color:#555;line-height:2px;margin-top:20px}.items-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0 0 16px}.item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;margin-bottom:12px}.item[_ngcontent-%COMP%]   .qty[_ngcontent-%COMP%]{width:14px;font-weight:700;font-size:12px}.desc[_ngcontent-%COMP%]{flex:1;margin:0 12px}.name[_ngcontent-%COMP%]{font-weight:500;font-size:13px}.unit-price[_ngcontent-%COMP%]{font-size:10px;color:#777}.total[_ngcontent-%COMP%]{white-space:nowrap;font-size:13px}.divider[_ngcontent-%COMP%]{border-top:1px dotted #bbb;margin:12px 0}.totals[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%], .payments-breakdown[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px;font-size:13px}.total-line[_ngcontent-%COMP%]{font-weight:600}.receipt-footer[_ngcontent-%COMP%]{position:absolute;bottom:10px;left:0;width:100%;font-size:10px;color:#888;text-align:center;font-style:italic}"]})}}return o})()}}]);
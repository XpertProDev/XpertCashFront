"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[4968],{3868:(S,M,c)=>{c.d(M,{X:()=>x});var f=c(4438);let x=(()=>{class m{constructor(){this.unite=["z\xe9ro","un","deux","trois","quatre","cinq","six","sept","huit","neuf"],this.dizaine=["","","vingt","trente","quarante","cinquante","soixante"],this.dizaineSpecial=["dix","onze","douze","treize","quatorze","quinze","seize"]}transform(r){if(isNaN(r))return"";const u=Math.floor(r),p=this.numberToWords(u)+" Francs CFA";return p.charAt(0).toUpperCase()+p.slice(1)}numberToWords(r){if(r<10)return this.unite[r];if(r<17)return this.dizaineSpecial[r-10];if(r<20)return"dix-"+this.unite[r-10];if(r<70){const u=Math.floor(r/10),p=r%10;return this.dizaine[u]+(p?"-"+this.unite[p]:"")}if(r<80)return"soixante-"+this.numberToWords(r-60);if(r<100)return"quatre-vingt"+(r%20?"-"+this.numberToWords(r%20):"");if(r<1e3){const u=Math.floor(r/100),p=r%100;return(u>1?this.unite[u]+"-cent":"cent")+(p?"-"+this.numberToWords(p):"")}if(r<1e6){const u=Math.floor(r/1e3),p=r%1e3;return(u>1?this.numberToWords(u)+" mille":"mille")+(p?" "+this.numberToWords(p):"")}if(r<1e9){const u=Math.floor(r/1e6),p=r%1e6;return(u>1?this.numberToWords(u)+" millions":"un million")+(p?" "+this.numberToWords(p):"")}return"nombre trop grand"}static{this.\u0275fac=function(u){return new(u||m)}}static{this.\u0275pipe=f.EJ8({name:"enLettres",type:m,pure:!0})}}return m})()},2120:(S,M,c)=>{c.d(M,{r:()=>t});var f=c(1626),x=c(4412),m=c(5558),d=c(9437),r=c(8810),u=c(8141),p=c(2525),R=c(4438),w=c(8026);let t=(()=>{class O{constructor(a,s){this.http=a,this.usersService=s,this.apiUrl=p.c.apiBaseUrl,this.entrepriseSubject=new x.t([]),this.entreprise$=this.entrepriseSubject.asObservable()}getListEntreprises(){return this.usersService.getValidAccessToken().pipe((0,m.n)(a=>{const s=new f.Lr({Authorization:`Bearer ${a}`,"Content-Type":"application/json"});return this.http.get(`${this.apiUrl}/entreprises`,{headers:s})}),(0,d.W)(a=>{let s="Erreur inconnue";return a.error instanceof ErrorEvent?s=`Erreur: ${a.error.message}`:404===a.status&&(s="Aucune entreprise trouv\xe9e"),(0,r.$)(()=>new Error(s))}))}addEntreprise(a){return this.usersService.getValidAccessToken().pipe((0,m.n)(s=>{const g=new f.Lr({Authorization:`Bearer ${s}`,"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}/entreprise-clients`,a,{headers:g})}),(0,u.M)(s=>{this.entrepriseSubject.next([...this.entrepriseSubject.value,s])}),(0,d.W)(s=>{let g="Erreur inconnue";return s.error instanceof ErrorEvent?g=`Erreur: ${s.error.message}`:400===s.status&&(g=s.error||"Donn\xe9es invalides"),(0,r.$)(()=>new Error(g))}))}getListEntreprise(){return this.usersService.getValidAccessToken().pipe((0,m.n)(a=>{if(!a)return console.error("Token vide ou non d\xe9fini ! V\xe9rifiez que l'utilisateur est bien connect\xe9."),(0,r.$)(()=>new Error("Token manquant"));const s=(new f.Lr).set("Authorization",`Bearer ${a}`);return console.log("En-t\xeates envoy\xe9s : ",s),this.http.get(`${this.apiUrl}/entreprises`,{headers:s})}),(0,u.M)(a=>{this.entrepriseSubject.next(a)}),(0,d.W)(a=>(console.error("Erreur lors de la r\xe9cup\xe9ration des entreprises:",a),(0,r.$)(()=>a))))}getEntrepriseById(a){return this.usersService.getValidAccessToken().pipe((0,m.n)(s=>{if(!s)return console.error("Token manquant"),(0,r.$)(()=>new Error("Token manquant"));const g=new f.Lr({Authorization:`Bearer ${s}`,"Content-Type":"application/json"});return this.http.get(`${this.apiUrl}/entreprises/${a}`,{headers:g})}),(0,d.W)(s=>{let g="Erreur inconnue";return s.error instanceof ErrorEvent?g=`Erreur: ${s.error.message}`:404===s.status&&(g="Entreprise non trouv\xe9e"),(0,r.$)(()=>new Error(g))}))}updateEntreprise(a,s){return this.usersService.getValidAccessToken().pipe((0,m.n)(g=>{if(!g)return(0,r.$)(()=>new Error("Token manquant"));const E=new f.Lr({Authorization:`Bearer ${g}`});return this.http.patch(`${this.apiUrl}/updateEntreprise/${a}`,s,{headers:E,responseType:"text"})}),(0,d.W)(g=>{let E="Erreur inconnue";return g.error instanceof ErrorEvent?E=`Erreur: ${g.error.message}`:400===g.status&&(E=g.error||"Donn\xe9es invalides"),(0,r.$)(()=>new Error(E))}))}getEntrepriseInfo(){return this.usersService.getValidAccessToken().pipe((0,m.n)(a=>{if(!a)return(0,r.$)(()=>new Error("Aucun token trouv\xe9"));const s=new f.Lr({Authorization:`Bearer ${a}`});return this.http.get(`${this.apiUrl}/myEntreprise`,{headers:s}).pipe((0,u.M)(g=>{localStorage.setItem("entreprise",JSON.stringify(g))}))}),(0,d.W)(a=>(console.error("Erreur r\xe9cup\xe9ration info entreprise:",a),(0,r.$)(()=>a))))}decodeJwt(a){return JSON.parse(atob(a.split(".")[1]))}isTokenExpired(a){return new Date(1e3*a.exp)<new Date}getNewTokenFromApi(){const a=localStorage.getItem("refreshToken");return this.http.post(`${this.apiUrl}/refresh-token`,{refreshToken:a})}static{this.\u0275fac=function(s){return new(s||O)(R.KVO(f.Qq),R.KVO(w.g))}}static{this.\u0275prov=R.jDH({token:O,factory:O.\u0275fac,providedIn:"root"})}}return O})()},1068:(S,M,c)=>{c.d(M,{Q:()=>m});var f=c(4412),x=c(4438);let m=(()=>{class d{constructor(){this.previewSubject=new f.t(null)}setPreview(u){this.previewSubject.next(u)}getPreview(){return this.previewSubject.asObservable()}static{this.\u0275fac=function(p){return new(p||d)}}static{this.\u0275prov=x.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})()},4968:(S,M,c)=>{c.r(M),c.d(M,{DetailFactureProformaApercuComponent:()=>ct});var f=c(467),x=c(3868),m=c(177),d=c(9417),r=c(6115),u=c(9107),w=(c(4941),c(2525)),t=c(4438),O=c(1068),q=c(9192),a=c(2120);function s(o,h){if(1&o&&(t.j41(0,"div",40)(1,"h4"),t.EFF(2,"Doit :"),t.k0s(),t.j41(3,"p"),t.EFF(4),t.k0s()()),2&o){const e=t.XpG().ngIf;t.R7$(4),t.JRh(e.client.nomComplet)}}function g(o,h){if(1&o&&(t.j41(0,"div",40)(1,"h4"),t.EFF(2,"Doit :"),t.k0s(),t.j41(3,"p"),t.EFF(4),t.k0s()()),2&o){const e=t.XpG().ngIf;t.R7$(4),t.JRh(e.entrepriseClient.nom)}}function E(o,h){if(1&o&&(t.j41(0,"tr")(1,"td",41),t.EFF(2),t.k0s(),t.nrm(3,"td",42),t.j41(4,"td"),t.EFF(5),t.nI1(6,"customNumber"),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.nI1(11,"customNumber"),t.k0s()()),2&o){const e=h.$implicit,n=t.XpG(2);t.R7$(2),t.JRh(e.produit.nom),t.R7$(),t.Y8G("innerHTML",n.transformerLigne(e.ligneDescription||""),t.npT),t.R7$(2),t.JRh(t.bMT(6,5,e.prixUnitaire)),t.R7$(3),t.JRh(e.quantite),t.R7$(2),t.JRh(t.bMT(11,7,e.prixUnitaire*e.quantite))}}function Z(o,h){if(1&o&&(t.j41(0,"tr")(1,"td",27),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.nI1(5,"customNumber"),t.k0s()()),2&o){const e=t.XpG().ngIf;t.R7$(2),t.SpI("Remise (",e.remise,"%)"),t.R7$(2),t.JRh(t.bMT(5,2,e.totalHT*e.remise/100))}}function tt(o,h){if(1&o&&(t.j41(0,"tr")(1,"td",27),t.EFF(2,"Montant commercial"),t.k0s(),t.j41(3,"td"),t.EFF(4),t.nI1(5,"customNumber"),t.k0s()()),2&o){const e=t.XpG().ngIf;t.R7$(4),t.JRh(t.bMT(5,1,e.totalHT-e.totalHT*e.remise/100))}}function et(o,h){if(1&o&&(t.j41(0,"tr")(1,"td",27),t.EFF(2),t.nI1(3,"number"),t.k0s(),t.j41(4,"td"),t.EFF(5),t.nI1(6,"customNumber"),t.k0s()()),2&o){let e;const n=t.XpG().ngIf,i=t.XpG();t.R7$(2),t.SpI("TVA (",t.i5U(3,2,100*i.tauxTva,"1.0-2")," %)"),t.R7$(3),t.JRh(t.bMT(6,5,(n.totalHT-n.totalHT*(null!==(e=n.remise)&&void 0!==e?e:0)/100)*i.tauxTva))}}function nt(o,h){if(1&o&&(t.j41(0,"tr")(1,"td",27),t.EFF(2,"Montant TTC"),t.k0s(),t.j41(3,"td"),t.EFF(4),t.nI1(5,"customNumber"),t.k0s()()),2&o){const e=t.XpG().ngIf;t.R7$(4),t.JRh(t.bMT(5,1,e.totalFacture))}}function rt(o,h){if(1&o&&(t.j41(0,"p")(1,"strong"),t.EFF(2),t.k0s()()),2&o){const e=t.XpG(2);t.R7$(2),t.JRh(e.siteWeb)}}function ot(o,h){if(1&o&&(t.j41(0,"div")(1,"em"),t.EFF(2),t.k0s()()),2&o){const e=t.XpG(2);t.R7$(2),t.JRh(e.getLegalInfo())}}function it(o,h){if(1&o&&(t.j41(0,"div",43)(1,"em"),t.EFF(2),t.k0s()()),2&o){const e=t.XpG(2);t.R7$(2),t.JRh(e.getAddressInfo())}}function at(o,h){if(1&o){const e=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.navigateBack())}),t.nrm(4,"i",6),t.k0s(),t.j41(5,"div",7),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.download())}),t.nrm(6,"i",8),t.k0s()(),t.j41(7,"div",9)(8,"div",10)(9,"div",11)(10,"div",12)(11,"img",13),t.bIt("error",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.logo=i.fallbackLogo)}),t.k0s()(),t.j41(12,"div",14)(13,"div",15)(14,"p",16),t.EFF(15),t.k0s(),t.j41(16,"p",17),t.EFF(17),t.k0s(),t.j41(18,"div",18),t.EFF(19,"Email : "),t.j41(20,"a",19),t.EFF(21),t.k0s(),t.EFF(22),t.k0s()()()(),t.nrm(23,"hr")(24,"hr"),t.j41(25,"div",20)(26,"h2"),t.EFF(27),t.k0s()(),t.j41(28,"div",21)(29,"p"),t.EFF(30),t.k0s()(),t.DNE(31,s,5,1,"div",22)(32,g,5,1,"div",22),t.j41(33,"div",23)(34,"h4"),t.EFF(35,"Objet :"),t.k0s(),t.j41(36,"p"),t.EFF(37),t.k0s()(),t.j41(38,"table",24)(39,"thead")(40,"tr")(41,"th"),t.EFF(42,"D\xe9signation"),t.k0s(),t.j41(43,"th",25),t.EFF(44,"Description"),t.k0s(),t.j41(45,"th"),t.EFF(46,"Prix Unitaire (FCFA)"),t.k0s(),t.j41(47,"th"),t.EFF(48,"Quantit\xe9"),t.k0s(),t.j41(49,"th"),t.EFF(50,"Montant (FCFA)"),t.k0s()()(),t.j41(51,"tbody"),t.DNE(52,E,12,9,"tr",26),t.k0s(),t.j41(53,"tfoot")(54,"tr")(55,"td",27),t.EFF(56,"Total HT"),t.k0s(),t.j41(57,"td"),t.EFF(58),t.nI1(59,"customNumber"),t.k0s()(),t.DNE(60,Z,6,4,"tr",28)(61,tt,6,3,"tr",28)(62,et,7,7,"tr",28)(63,nt,6,3,"tr",28),t.k0s()(),t.j41(64,"div",29)(65,"p")(66,"span",30),t.EFF(67,"Arr\xeat\xe9 la pr\xe9sente facture \xe0 la somme de : "),t.k0s(),t.EFF(68),t.nI1(69,"enLettres"),t.k0s()(),t.j41(70,"div",31)(71,"h6"),t.EFF(72),t.k0s(),t.j41(73,"div",32)(74,"img",33),t.bIt("error",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.signaturNum="assets/img/sinum.png")}),t.k0s(),t.j41(75,"img",34),t.bIt("error",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.cachetNum="assets/img/tampon.png")}),t.k0s()(),t.j41(76,"h6",35),t.EFF(77),t.k0s()()()(),t.j41(78,"div",36)(79,"div",37),t.nrm(80,"hr",38),t.DNE(81,rt,3,1,"p",28)(82,ot,3,1,"div",28)(83,it,3,1,"div",39),t.k0s()()()()}if(2&o){const e=h.ngIf,n=t.XpG();t.R7$(11),t.Y8G("src",n.logo,t.B4B),t.R7$(4),t.JRh(n.nom),t.R7$(2),t.SpI("Secteur: ",n.secteur,""),t.R7$(3),t.Mz_("href","mailto:",n.email,"",t.B4B),t.R7$(),t.JRh(n.email),t.R7$(),t.SpI(" T\xe9l\xe9phone : ",n.telephone,""),t.R7$(5),t.SpI("Facture proforma ",e.numeroFacture,""),t.R7$(3),t.Lme("",n.siege,", le ",n.formatDateFr(e.dateCreation),""),t.R7$(),t.Y8G("ngIf",e.client),t.R7$(),t.Y8G("ngIf",e.entrepriseClient),t.R7$(5),t.JRh(e.description),t.R7$(15),t.Y8G("ngForOf",e.lignesFacture),t.R7$(6),t.JRh(t.bMT(59,27,e.totalHT)),t.R7$(2),t.Y8G("ngIf",e.remise),t.R7$(),t.Y8G("ngIf",e.remise&&e.remise>0),t.R7$(),t.Y8G("ngIf",e.tva),t.R7$(),t.Y8G("ngIf",e.tva),t.R7$(5),t.SpI("",t.bMT(69,29,e.totalFacture),"."),t.R7$(4),t.JRh(n.signataire),t.R7$(2),t.Y8G("src",n.signaturNum,t.B4B),t.R7$(),t.Y8G("src",n.cachetNum,t.B4B),t.R7$(2),t.JRh(n.signataireNom),t.R7$(4),t.Y8G("ngIf",n.siteWeb),t.R7$(),t.Y8G("ngIf",n.getLegalInfo()),t.R7$(),t.Y8G("ngIf",n.getAddressInfo())}}function st(o,h){if(1&o){const e=t.RV6();t.j41(0,"p"),t.EFF(1,"Aucune donn\xe9e d\u2019aper\xe7u\u2026 "),t.j41(2,"a",44),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.router.navigate(["/facture-proforma"]))}),t.EFF(3,"Retour"),t.k0s()()}}let ct=(()=>{class o{constructor(e,n,i){this.previewService=e,this.router=n,this.entrepriseService=i,this.facture=null,this.nom=null,this.logo=null,this.signaturNum=null,this.cachetNum=null,this.apiUrl=w.c.imgUrl,this.fallbackLogo=`${this.apiUrl}/defaultLogo/Votre.png`}ngOnInit(){this.getFacturePreview(),this.getUserEntrepriseInfo()}getFacturePreview(){this.previewService.getPreview().subscribe(e=>{e?this.facture=e:this.router.navigate(["/facture-proforma"])})}navigateBack(){this.facture?.id?this.router.navigate(["/facture-proforma-details",this.facture.id]):(console.error("ID de la facture non disponible"),this.router.navigate(["/facture-proforma"]))}getUserEntrepriseInfo(){this.entrepriseService.getEntrepriseInfo().subscribe({next:e=>{this.nom=e.nom,this.siege=e.siege,this.email=e.email,this.logo=`${this.apiUrl}${e.logo}`,this.secteur=e.secteur,this.telephone=e.telephone,this.adresse=e.adresse,this.nif=e.nif,this.banque=e.banque,this.nina=e.nina,this.pays=e.pays,this.rccm=e.rccm,this.siteWeb=e.siteWeb,this.signataire=e.signataire,this.signataireNom=e.signataireNom,this.tauxTva=e.tauxTva,this.signaturNum=e.signaturNum?`${this.apiUrl}${e.signaturNum}`:"assets/img/sinum.png",this.cachetNum=e.cachetNum?`${this.apiUrl}${e.cachetNum}`:"assets/img/tampon.png"},error:e=>{console.error("Erreur lors de la r\xe9cup\xe9ration des infos utilisateur :",e)}})}getLegalInfo(){const e=[];return this.nina&&e.push(`NINA : ${this.nina}`),this.rccm&&e.push(`RCCM : ${this.rccm}`),this.nif&&e.push(`NIF : ${this.nif}`),this.banque&&e.push(`Banque : ${this.banque}`),e.join(" ; ")}getAddressInfo(){const e=this.adresse,n=this.siege,i=this.pays;return e&&n&&i?`Adresse : ${e} / ${n}-${i}`:e&&n?`Adresse : ${e} / ${n}`:e&&i?`Adresse : ${e} / ${i}`:n&&i?`Adresse : ${n} / ${i}`:e?`Adresse : ${e}`:n?`Adresse : ${n}`:i?`Adresse : ${i}`:""}getImageFromUrl(e){return new Promise((n,i)=>{const _=new Image;_.setAttribute("crossOrigin","anonymous"),_.onload=()=>{const C=document.createElement("canvas");C.width=_.width,C.height=_.height,C.getContext("2d")?.drawImage(_,0,0),n(C.toDataURL("image/png"))},_.onerror=C=>i(C),_.src=e})}download(){var e=this;return(0,f.A)(function*(){const n=new u.jsPDF({unit:"mm",format:"a4"});try{if(e.logo){const l=e.logo.startsWith("data:image/")?e.logo:yield e.getImageFromUrl(e.logo),j=l.match(/^data:image\/(png|jpeg|gif);/),y=j?j[1].toUpperCase():"PNG";n.addImage(l,y,15,10,47,17)}}catch{}n.setFontSize(10),n.setFont("helvetica","bold"),n.text(e.nom||"Nom Entreprise",70,12),n.setFont("helvetica","normal"),n.text(`Secteur : ${e.secteur||""}`,70,17);const C=`Email : ${e.email||""}`;n.text(C,70,22);const z=n.getTextWidth(C);n.text(`T\xe9l\xe9phone : ${e.telephone||""}`,70+z+5,22),n.setDrawColor(200),n.line(15,29,195,29),n.line(15,30.5,195,30.5),n.setFontSize(14),n.setFont("helvetica","bold"),n.setTextColor(85,85,85),n.text(`FACTURE PROFORMA ${e.facture?.numeroFacture}`,105,37,{align:"center"}),n.setDrawColor(0),n.setFontSize(10),n.setFont("helvetica","normal"),n.text(`${e.siege||""}, le ${e.facture?.dateCreation?new Date(e.facture?.dateCreation).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"}):""}`,195,47,{align:"right"});let v=57;if(e.facture){const j=!!e.facture.entrepriseClient,y="Doit :",Ct=e.facture.client?e.facture.client?.nomComplet??"Non sp\xe9cifi\xe9":j?e.facture.entrepriseClient?.nom??"Non sp\xe9cifi\xe9":"Non sp\xe9cifi\xe9";n.setFont("helvetica","bold"),n.text(y,15,v),n.setFont("helvetica","normal"),n.text(Ct,15+n.getTextWidth(y)+2,v)}v+=7,n.setFont("helvetica","bold"),n.text("Objet :",15,v),n.setFont("helvetica","normal"),n.text(e.facture?.description||"",15+n.getTextWidth("Object :")+2,v);const lt=v+10,F=new r.v,b=e.facture?.lignesFacture.map(l=>[l.produit.nom,l.ligneDescription,F.transform(l.prixUnitaire),l.quantite.toString(),F.transform(l.prixUnitaire*l.quantite)]);if(b?.push([{content:"Total HT",colSpan:4,styles:{fontStyle:"normal",halign:"center"}},{content:F.transform(e.facture?.totalHT||0),styles:{halign:"right"}}]),e.facture?.remise&&e.facture.remise>0&&(b?.push([{content:`Remise (${e.facture.remise}%)`,colSpan:4,styles:{fontStyle:"normal",halign:"center"}},{content:F.transform(e.facture.totalHT*e.facture.remise/100),styles:{halign:"right"}}]),b?.push([{content:"Montant Commercial",colSpan:4,styles:{fontStyle:"normal",halign:"center"}},{content:F.transform(e.facture.totalHT-e.facture.totalHT*e.facture.remise/100),styles:{halign:"right"}}])),e.facture?.tva){const l=Math.round(100*(e.tauxTva??0));b?.push([{content:`TVA (${l} %)`,colSpan:4,styles:{fontStyle:"normal",halign:"center"}},{content:F.transform((e.facture.totalHT-e.facture.totalHT*(e.facture.remise??0)/100)*e.tauxTva),styles:{halign:"right"}}]),b?.push([{content:"Montant TTC",colSpan:4,styles:{fontStyle:"normal",halign:"center"}},{content:F.transform(e.facture.totalFacture),styles:{fontStyle:"normal",halign:"right"}}])}n.autoTable({head:[["D\xe9signation","Description","Prix Unitaire (FCFA)","Quantit\xe9","Montant (FCFA)"]],body:b,startY:lt,theme:"grid",styles:{fontSize:9,cellPadding:2,lineWidth:.1,lineColor:[221,221,221]},headStyles:{fillColor:[242,242,242],textColor:[0,0,0],fontSize:8,halign:"center",fontStyle:"bold"},bodyStyles:{textColor:[0,0,0],fillColor:null},margin:{left:15,right:15},columnStyles:{0:{halign:"left",cellWidth:30},1:{halign:"left",cellWidth:60},2:{halign:"center",cellWidth:33},3:{halign:"center",cellWidth:20},4:{halign:"right",cellWidth:35}},tableStyle:{borderColor:[200,200,200],borderWidth:.1}});let k=n.lastAutoTable.finalY+18;const G="Arr\xeat\xe9 la pr\xe9sente facture \xe0 la somme de : ";n.setFont("helvetica","bold"),n.setFontSize(8),n.text(G,15,k);const X=15+n.getTextWidth(G);n.setFont("helvetica","normal"),n.setFontSize(9);const gt=(new x.X).transform(e.facture?.totalFacture||0),N=n.splitTextToSize(gt,195-X);n.text(N[0],X,k);let U=k;for(let l=1;l<N.length;l++)U+=6,n.text(N[l],15,U);let T=U+30;T=Math.max(T,n.internal.pageSize.height-100),n.setFontSize(9),n.setFont("helvetica");const K=e.signataire||"Directeur",L=n.getTextWidth(K),B=180-L/2;n.text(K,B,T),n.setFontSize(9),n.setFont("helvetica","normal");const J=e.signataireNom||"Nom du signataire",mt=n.getTextWidth(J);n.text(J,180-mt/2,T+8);try{if(e.signaturNum){const l=e.signaturNum.startsWith("data:image/")?e.signaturNum:yield e.getImageFromUrl(e.signaturNum);l?n.addImage(l,"PNG",B+L-35,T+10,40,20):console.error("Impossible de charger l'image de la signature")}if(e.cachetNum){const l=e.cachetNum.startsWith("data:image/")?e.cachetNum:yield e.getImageFromUrl(e.cachetNum);l?n.addImage(l,"PNG",B+L-50,T+5,40,40):console.error("Impossible de charger l'image du cachet")}}catch(l){console.error("Erreur lors de l'ajout de la signature ou du cachet : ",l)}const ht=n.internal.pageSize.width-15,H=n.internal.pageSize.height-20,Q=H-5;n.setLineWidth(.2),n.setDrawColor(150),n.line(15,Q,ht,Q),n.setFontSize(8),n.setFont("helvetica","normal"),n.setTextColor(100);let $=H;e.siteWeb&&(n.text(e.siteWeb,105,$,{align:"center"}),$+=4);const D=[];e.nina&&D.push(`NINA : ${e.nina}`),e.rccm&&D.push(`RCCM : ${e.rccm}`),e.nif&&D.push(`NIF : ${e.nif}`),e.banque&&D.push(`Banque : ${e.banque}`),D.length>0&&(n.text(D.join(" ; "),105,$,{align:"center"}),$+=4);let P="";e.adresse&&e.siege&&e.pays?P=`Adresse : ${e.adresse} / ${e.siege}-${e.pays}`:e.adresse&&e.siege?P=`Adresse : ${e.adresse} / ${e.siege}`:e.adresse&&e.pays?P=`Adresse : ${e.adresse} / ${e.pays}`:e.siege&&e.pays?P=`Adresse : ${e.siege} / ${e.pays}`:e.adresse?P=`Adresse : ${e.adresse}`:e.siege?P=`Adresse : ${e.siege}`:e.pays&&(P=`Adresse : ${e.pays}`),P&&(n.text(P,105,$,{align:"center"}),$+=4),n.setTextColor(0),n.save(`Facture_Proforma_${e.facture?.numeroFacture}.pdf`)})()}formatDateFr(e){return new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"})}transformerLigne(e){return e.replace(/-\s*/g,"<br> - <span></span>")}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(O.Q),t.rXU(q.Ix),t.rXU(a.r))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-detail-facture-proforma-apercu"]],decls:3,vars:2,consts:[["noData",""],["class","container_global",4,"ngIf","ngIfElse"],[1,"container_global"],[1,"information_cadre",2,"position","relative"],[1,"cadre_retour"],[1,"retour_icon",3,"click"],[1,"ri-arrow-left-long-fill"],[1,"download_icon",3,"click"],[1,"ri-download-2-fill"],[1,"info_titre_input"],[1,"content"],[1,"header_apercu"],[1,"logo_entreprise"],["alt","Logo de l'entreprise",3,"error","src"],[1,"entete_entreprise"],[1,"content_entete"],[1,"para1"],[1,"para2"],[1,"para3"],[3,"href"],[1,"titre"],[1,"date"],["class","droit",4,"ngIf"],[1,"object"],[1,"table"],[2,"width","260px!important"],[4,"ngFor","ngForOf"],["colspan","4"],[4,"ngIf"],[1,"contenu_bottom"],[2,"font-weight","600"],[1,"signature_bloc",2,"position","relative","text-align","center","margin-top","40px","margin-right","40px"],[1,"signaturNum"],["alt","Signature",1,"img",2,"position","relative","z-index","1","width","120px",3,"error","src"],["alt","Cachet",1,"cachetNum",2,"position","absolute","top","0","left","-30%","transform","translateX(-50%)","z-index","2","width","200px",3,"error","src"],[1,"name_directeur"],[1,"container_footer"],[1,"footer"],[2,"margin-top","40px"],["style","margin-top: -4px;",4,"ngIf"],[1,"droit"],[1,"td_left"],[1,"td_left",3,"innerHTML"],[2,"margin-top","-4px"],[3,"click"]],template:function(n,i){if(1&n&&t.DNE(0,at,84,31,"div",1)(1,st,4,0,"ng-template",null,0,t.C5r),2&n){const _=t.sdS(2);t.Y8G("ngIf",i.facture)("ngIfElse",_)}},dependencies:[m.MD,m.Sq,m.bT,m.QX,d.YN,r.v,x.X],styles:['@charset "UTF-8";p[_ngcontent-%COMP%], h4[_ngcontent-%COMP%]{margin:0}.container_global[_ngcontent-%COMP%]{display:flex;justify-content:center}.cadre_retour[_ngcontent-%COMP%]{width:100%;height:50px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(60,60,60,.1607843137);padding:10px 10px 10px 15px}.btn_ajouter[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-right:10px;cursor:pointer;font-weight:600;font-size:14px;letter-spacing:.6px}.retour_icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .download_icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px;cursor:pointer}.btn_ajouter[_ngcontent-%COMP%]   .btn_save[_ngcontent-%COMP%]{border:none;background-color:transparent;color:#0672e4;font-size:15px}.content[_ngcontent-%COMP%]{margin-top:5px}.information_cadre[_ngcontent-%COMP%]{width:800px;height:1223px;background-color:#fff;box-shadow:2px 2px 30px #0000001c}.info_titre_input[_ngcontent-%COMP%]{padding:20px}.header_apercu[_ngcontent-%COMP%]{display:flex;align-items:center}.logo_entreprise[_ngcontent-%COMP%]{width:180px;height:70px}.entete_entreprise[_ngcontent-%COMP%]{margin-left:5%}.logo_entreprise[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain}.content_entete[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:12px;letter-spacing:.5px}.content_entete[_ngcontent-%COMP%]   .para1[_ngcontent-%COMP%], .content_entete[_ngcontent-%COMP%]   .para2[_ngcontent-%COMP%]{font-weight:600}hr[_ngcontent-%COMP%]{margin:3px 0}.titre[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px;text-transform:uppercase;letter-spacing:.6px;text-align:center;margin:20px}.date[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:right;margin-right:5%;font-size:12px}.droit[_ngcontent-%COMP%], .object[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:10px;margin-left:37px}.droit[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .object[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:13px;font-weight:700}.droit[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .object[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:12px}.header[_ngcontent-%COMP%]{margin-bottom:30px}h1[_ngcontent-%COMP%]{font-size:1.4em;margin:0}h2[_ngcontent-%COMP%]{font-size:1.2em;color:#555;margin:10px 0}table[_ngcontent-%COMP%]{width:90%;border-collapse:collapse;margin:20px 37px;font-size:11px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #ddd;padding:12px;text-align:center}th[_ngcontent-%COMP%]{background-color:#f5f5f5}.total-section[_ngcontent-%COMP%]{margin-top:30px;width:50%;margin-left:auto}.total-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:8px 0}.bold[_ngcontent-%COMP%]{font-weight:700}.separator[_ngcontent-%COMP%]{border-top:2px solid #333;margin:20px 0}td.table_td_1[_ngcontent-%COMP%]{border-right:none}td.table_td[_ngcontent-%COMP%]{border-right:none;border-top:none;border-left:none}.table_td_descripton[_ngcontent-%COMP%]{text-align:center}td.td_left[_ngcontent-%COMP%]{text-align:left!important}.contenu_bottom[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px;margin:0 0 0 37px}.cachet_container[_ngcontent-%COMP%]{height:150px;width:100%;margin-top:20px;display:flex;justify-content:space-between}.cachet[_ngcontent-%COMP%]{position:relative;top:30px;right:41px}.cachet[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{text-align:center;font-size:16px}.cachet[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{text-align:center;font-size:14px;margin-bottom:4px}.cachet[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;text-align:center;font-size:12px;font-weight:600;color:#000;font-family:brittany;margin-top:52%}.container_footer[_ngcontent-%COMP%]{display:flex;justify-content:center}.footer[_ngcontent-%COMP%]{text-align:center;position:absolute;bottom:45px;width:96%}.footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{letter-spacing:.6px}.footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:12px}.footer[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-size:11px}.facture-container[_ngcontent-%COMP%]{max-width:210mm;margin:20px auto;padding:20px;background:#fff;box-shadow:0 0 10px #0000001a;font-family:Arial,sans-serif}.facture-container[_ngcontent-%COMP%]   .loading-overlay[_ngcontent-%COMP%]{text-align:center;padding:2rem}.facture-container[_ngcontent-%COMP%]   .loading-overlay[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto}.facture-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{color:#dc3545;padding:1rem;border:1px solid #dc3545;margin:1rem 0;border-radius:4px}.facture-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:2rem;border-bottom:2px solid #333;padding-bottom:1rem}.facture-header[_ngcontent-%COMP%]   .company-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;color:#2c3e50}.facture-header[_ngcontent-%COMP%]   .company-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#7f8c8d}.facture-header[_ngcontent-%COMP%]   .facture-meta[_ngcontent-%COMP%]{text-align:right}.facture-header[_ngcontent-%COMP%]   .facture-meta[_ngcontent-%COMP%]   .facture-number[_ngcontent-%COMP%]{font-weight:700;color:#2c3e50}.facture-header[_ngcontent-%COMP%]   .facture-meta[_ngcontent-%COMP%]   .facture-date[_ngcontent-%COMP%]{color:#7f8c8d}.client-info[_ngcontent-%COMP%]{margin-bottom:2rem}.client-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#2c3e50;margin-bottom:.5rem}.client-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:1.1rem}.products-section[_ngcontent-%COMP%]{margin-bottom:2rem}.products-section[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.products-section[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .products-section[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:left;border-bottom:1px solid #ecf0f1}.products-section[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f8f9fa;color:#2c3e50}.products-section[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.totals-section[_ngcontent-%COMP%]{margin-top:2rem;text-align:right}.totals-section[_ngcontent-%COMP%]   .total-line[_ngcontent-%COMP%]{margin:10px 0}.totals-section[_ngcontent-%COMP%]   .total-line[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{margin-right:20px;color:#7f8c8d}.totals-section[_ngcontent-%COMP%]   .total-line.grand-total[_ngcontent-%COMP%]{font-size:1.2em;font-weight:700;color:#2c3e50}.signature_bloc[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end}.signaturNum[_ngcontent-%COMP%]{width:100px;height:80px;position:relative}.signaturNum[_ngcontent-%COMP%]   .img[_ngcontent-%COMP%]{position:absolute;top:-7px;right:14px;width:34%;height:auto;object-fit:contain;z-index:1;opacity:.7}.signaturNum[_ngcontent-%COMP%]   .cachetNum[_ngcontent-%COMP%]{position:absolute;right:30px;width:40%;height:auto;object-fit:contain;z-index:2;opacity:.7;margin-top:-7px}.name_directeur[_ngcontent-%COMP%]{position:relative;right:0;top:0}']})}}return o})()}}]);
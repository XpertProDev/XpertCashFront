"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[4074],{76822:(F,m,s)=>{s.d(m,{K:()=>a});var a=function(l){return l.BROUILLON="BROUILLON",l.APPROBATION="APPROBATION",l.APPROUVE="APPROUVE",l.ENVOYE="ENVOYE",l.VALIDE="VALIDE",l.ANNULE="ANNULE",l}(a||{})},13868:(F,m,s)=>{s.d(m,{X:()=>l});var a=s(54438);let l=(()=>{class _{constructor(){this.unite=["z\xe9ro","un","deux","trois","quatre","cinq","six","sept","huit","neuf"],this.dizaine=["","","vingt","trente","quarante","cinquante","soixante"],this.dizaineSpecial=["dix","onze","douze","treize","quatorze","quinze","seize"]}transform(i){if(isNaN(i))return"";const t=Math.floor(i),f=this.numberToWords(t)+" Francs CFA";return f.charAt(0).toUpperCase()+f.slice(1)}numberToWords(i){if(i<10)return this.unite[i];if(i<17)return this.dizaineSpecial[i-10];if(i<20)return"dix-"+this.unite[i-10];if(i<70){const t=Math.floor(i/10),f=i%10;return this.dizaine[t]+(f?"-"+this.unite[f]:"")}if(i<80)return"soixante-"+this.numberToWords(i-60);if(i<100)return"quatre-vingt"+(i%20?"-"+this.numberToWords(i%20):"");if(i<1e3){const t=Math.floor(i/100),f=i%100;return(t>1?this.unite[t]+"-cent":"cent")+(f?"-"+this.numberToWords(f):"")}if(i<1e6){const t=Math.floor(i/1e3),f=i%1e3;return(t>1?this.numberToWords(t)+" mille":"mille")+(f?" "+this.numberToWords(f):"")}if(i<1e9){const t=Math.floor(i/1e6),f=i%1e6;return(t>1?this.numberToWords(t)+" millions":"un million")+(f?" "+this.numberToWords(f):"")}return"nombre trop grand"}static{this.\u0275fac=function(t){return new(t||_)}}static{this.\u0275pipe=a.EJ8({name:"enLettres",type:_,pure:!0})}}return _})()},92120:(F,m,s)=>{s.d(m,{r:()=>A});var a=s(21626),l=s(84412),_=s(25558),g=s(99437),i=s(18810),t=s(88141),f=s(22525),v=s(54438),$=s(88026);let A=(()=>{class E{constructor(o,n){this.http=o,this.usersService=n,this.apiUrl=f.c.apiBaseUrl,this.entrepriseSubject=new l.t([]),this.entreprise$=this.entrepriseSubject.asObservable()}getListEntreprises(){return this.usersService.getValidAccessToken().pipe((0,_.n)(o=>{const n=new a.Lr({Authorization:`Bearer ${o}`,"Content-Type":"application/json"});return this.http.get(`${this.apiUrl}/entreprises`,{headers:n})}),(0,g.W)(o=>{let n="Erreur inconnue";return o.error instanceof ErrorEvent?n=`Erreur: ${o.error.message}`:404===o.status&&(n="Aucune entreprise trouv\xe9e"),(0,i.$)(()=>new Error(n))}))}addEntreprise(o){return this.usersService.getValidAccessToken().pipe((0,_.n)(n=>{const r=new a.Lr({Authorization:`Bearer ${n}`,"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}/entreprise-clients`,o,{headers:r})}),(0,t.M)(n=>{this.entrepriseSubject.next([...this.entrepriseSubject.value,n])}),(0,g.W)(n=>{let r="Erreur inconnue";return n.error instanceof ErrorEvent?r=`Erreur: ${n.error.message}`:400===n.status&&(r=n.error||"Donn\xe9es invalides"),(0,i.$)(()=>new Error(r))}))}getListEntreprise(){return this.usersService.getValidAccessToken().pipe((0,_.n)(o=>{if(!o)return console.error("Token vide ou non d\xe9fini ! V\xe9rifiez que l'utilisateur est bien connect\xe9."),(0,i.$)(()=>new Error("Token manquant"));const n=(new a.Lr).set("Authorization",`Bearer ${o}`);return console.log("En-t\xeates envoy\xe9s : ",n),this.http.get(`${this.apiUrl}/entreprises`,{headers:n})}),(0,t.M)(o=>{this.entrepriseSubject.next(o)}),(0,g.W)(o=>(console.error("Erreur lors de la r\xe9cup\xe9ration des entreprises:",o),(0,i.$)(()=>o))))}getEntrepriseById(o){return this.usersService.getValidAccessToken().pipe((0,_.n)(n=>{if(!n)return console.error("Token manquant"),(0,i.$)(()=>new Error("Token manquant"));const r=new a.Lr({Authorization:`Bearer ${n}`,"Content-Type":"application/json"});return this.http.get(`${this.apiUrl}/entreprises/${o}`,{headers:r})}),(0,g.W)(n=>{let r="Erreur inconnue";return n.error instanceof ErrorEvent?r=`Erreur: ${n.error.message}`:404===n.status&&(r="Entreprise non trouv\xe9e"),(0,i.$)(()=>new Error(r))}))}updateEntreprise(o,n){return this.usersService.getValidAccessToken().pipe((0,_.n)(r=>{if(!r)return(0,i.$)(()=>new Error("Token manquant"));const u=new a.Lr({Authorization:`Bearer ${r}`});return this.http.patch(`${this.apiUrl}/updateEntreprise/${o}`,n,{headers:u,responseType:"text"})}),(0,g.W)(r=>{let u="Erreur inconnue";return r.error instanceof ErrorEvent?u=`Erreur: ${r.error.message}`:400===r.status&&(u=r.error||"Donn\xe9es invalides"),(0,i.$)(()=>new Error(u))}))}getEntrepriseInfo(){return this.usersService.getValidAccessToken().pipe((0,_.n)(o=>{if(!o)return(0,i.$)(()=>new Error("Aucun token trouv\xe9"));const n=new a.Lr({Authorization:`Bearer ${o}`});return this.http.get(`${this.apiUrl}/myEntreprise`,{headers:n}).pipe((0,t.M)(r=>{localStorage.setItem("entreprise",JSON.stringify(r))}))}),(0,g.W)(o=>(console.error("Erreur r\xe9cup\xe9ration info entreprise:",o),(0,i.$)(()=>o))))}decodeJwt(o){return JSON.parse(atob(o.split(".")[1]))}isTokenExpired(o){return new Date(1e3*o.exp)<new Date}getNewTokenFromApi(){const o=localStorage.getItem("refreshToken");return this.http.post(`${this.apiUrl}/refresh-token`,{refreshToken:o})}static{this.\u0275fac=function(n){return new(n||E)(v.KVO(a.Qq),v.KVO($.g))}}static{this.\u0275prov=v.jDH({token:E,factory:E.\u0275fac,providedIn:"root"})}}return E})()},61068:(F,m,s)=>{s.d(m,{Q:()=>_});var a=s(84412),l=s(54438);let _=(()=>{class g{constructor(){this.previewSubject=new a.t(null)}setPreview(t){this.previewSubject.next(t)}getPreview(){return this.previewSubject.asObservable()}static{this.\u0275fac=function(f){return new(f||g)}}static{this.\u0275prov=l.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})()},72409:(F,m,s)=>{s.d(m,{c:()=>A});var a=s(21626),l=s(25558),_=s(88141),g=s(99437),i=s(18810),t=s(76822),f=s(22525),v=s(54438),$=s(88026);let A=(()=>{class E{constructor(o,n){this.http=o,this.usersService=n,this.apiUrl=f.c.apiBaseUrl}creerFactureProforma(o,n,r,u){return this.usersService.getValidAccessToken().pipe((0,l.n)(h=>{const M=new a.Lr({Authorization:`Bearer ${h}`});let O=new a.Nl;return u&&(void 0!==n&&(O=O.set("remisePourcentage",n.toString())),void 0!==r&&(O=O.set("appliquerTVA",r.toString()))),this.http.post(`${this.apiUrl}/ajouter`,o,{headers:M,params:O})}),(0,_.M)(h=>console.log("Facture cr\xe9\xe9e avec succ\xe8s:",h)),(0,g.W)(h=>(console.error("Erreur d\xe9taill\xe9e:",h),console.log("Corps de la r\xe9ponse:",h.error),(0,i.$)(()=>h))))}getAlFactproformaOfEntreprise(o){return this.usersService.getValidAccessToken().pipe((0,l.n)(n=>{const r=new a.Lr({Authorization:`Bearer ${n}`});return this.http.get(`${this.apiUrl}/mes-factures`,{headers:r})}))}getFactureProformaById(o){return this.usersService.getValidAccessToken().pipe((0,l.n)(n=>{const r=new a.Lr({Authorization:`Bearer ${n}`});return this.http.get(`${this.apiUrl}/factureProforma/${o}`,{headers:r})}))}updateFactureProforma(o,n,r,u,h){return this.usersService.getValidAccessToken().pipe((0,l.n)(M=>{const O=new a.Lr({Authorization:`Bearer ${M}`,"Content-Type":"application/json"});let C=new a.Nl;return void 0!==n&&(C=C.set("remisePourcentage",n.toString())),void 0!==r&&(C=C.set("appliquerTVA",r.toString())),h&&h.length>0&&h.forEach(x=>{C=C.append("idsApprobateurs",x.toString())}),u.statut===t.K.ANNULE&&(C=C.set("isAnnulation","true")),this.http.put(`${this.apiUrl}/updatefacture/${o}`,u,{headers:O,params:C}).pipe((0,_.M)(x=>console.log("Facture mise \xe0 jour:",x)),(0,g.W)(x=>(console.error("Erreur mise \xe0 jour:",x),(0,i.$)(()=>x))))}))}envoyerFactureEmail(o,n){const r=new FormData;return r.append("to",n.to),r.append("cc",n.cc),r.append("subject",n.subject),r.append("body",n.body),n.attachments&&n.attachments.forEach((u,h)=>{r.append("attachments",u,u.name)}),this.usersService.getValidAccessToken().pipe((0,l.n)(u=>{const h=new a.Lr({Authorization:`Bearer ${u}`});return this.http.post(`${this.apiUrl}/factures/${o}/envoyer-email`,r,{headers:h,responseType:"text"})}))}getHistoriqueFacture(o){return this.usersService.getValidAccessToken().pipe((0,l.n)(n=>{const r=new a.Lr({Authorization:`Bearer ${n}`});return this.http.get(`${this.apiUrl}/factpro/${o}/historique`,{headers:r})}),(0,g.W)(n=>(console.error("Erreur r\xe9cup\xe9ration historique facture:",n),(0,i.$)(()=>n))))}getNotesFactureProforma(o){return this.usersService.getValidAccessToken().pipe((0,l.n)(n=>{const r=new a.Lr({Authorization:`Bearer ${n}`});return this.http.get(`${this.apiUrl}/factures/${o}/notes`,{headers:r})}),(0,g.W)(n=>(console.error("Erreur r\xe9cup\xe9ration historique facture:",n),(0,i.$)(()=>n))))}getNoteById(o,n){return this.usersService.getValidAccessToken().pipe((0,l.n)(r=>{const u=new a.Lr({Authorization:`Bearer ${r}`,Accept:"application/json"});return this.http.get(`${this.apiUrl}/auth/${o}/notes/${n}`,{headers:u})}),(0,g.W)(r=>(console.error("Erreur lors de la r\xe9cup\xe9ration de la note:",r),(0,i.$)(()=>r))))}updateNote(o,n,r){return this.usersService.getValidAccessToken().pipe((0,l.n)(u=>{const h=new a.Lr({Authorization:`Bearer ${u}`,"Content-Type":"application/json"});return this.http.put(`${this.apiUrl}/${o}/notes/${n}`,{nouveauContenu:r},{headers:h})}),(0,_.M)(u=>console.log("Note modifi\xe9e avec succ\xe8s:",u)),(0,g.W)(u=>(console.error("Erreur lors de la modification de la note:",u),(0,i.$)(()=>u))))}deletNoteFactureProforma(o,n){return this.usersService.getValidAccessToken().pipe((0,l.n)(r=>{const u=new a.Lr({Authorization:`Bearer ${r}`,Accept:"application/json"});return this.http.delete(`${this.apiUrl}/${o}/notes/${n}/supprimer`,{headers:u})}),(0,g.W)(r=>(console.error("Erreur lors de la suppression de la note:",r),(0,i.$)(()=>r))))}getFacturesByClient(o,n){return this.usersService.getValidAccessToken().pipe((0,l.n)(r=>{let u=new a.Nl;void 0!==o&&(u=u.set("clientId",o.toString())),void 0!==n&&(u=u.set("entrepriseClientId",n.toString()));const h=new a.Lr({Authorization:`Bearer ${r}`});return this.http.get(`${this.apiUrl}/factures/client`,{headers:h,params:u})}),(0,g.W)(r=>(console.error("Erreur dans getFacturesByClient:",r),(0,i.$)(()=>r))))}getFacturesParPeriode(o,n,r){return this.usersService.getValidAccessToken().pipe((0,l.n)(u=>{const h=new a.Lr({Authorization:`Bearer ${u}`});let M=(new a.Nl).set("type",o);if("personnalise"===o){if(!n||!r)throw new Error("Pour 'personnalise', les dates dateDebut et dateFin sont obligatoires.");M=M.set("dateDebut",n).set("dateFin",r)}return this.http.get(`${this.apiUrl}/mes-factures/par-periode`,{headers:h,params:M})}))}deletFactureProforma(o){return this.usersService.getValidAccessToken().pipe((0,l.n)(n=>{const r=new a.Lr({Authorization:`Bearer ${n}`,Accept:"application/json"});return this.http.delete(`${this.apiUrl}/deletefactureproforma/${o}`,{headers:r})}),(0,g.W)(n=>(console.error("Erreur lors de la suppression de la note:",n),(0,i.$)(()=>n))))}static{this.\u0275fac=function(n){return new(n||E)(v.KVO(a.Qq),v.KVO($.g))}}static{this.\u0275prov=v.jDH({token:E,factory:E.\u0275fac,providedIn:"root"})}}return E})()},88704:(F,m,s)=>{s.d(m,{H:()=>l});var a=s(54438);let l=(()=>{class _{saveState(i){this.formState={...i}}getState(){return this.formState}clearState(){this.formState=null}static{this.\u0275fac=function(t){return new(t||_)}}static{this.\u0275prov=a.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()},44074:(F,m,s)=>{s.r(m),s.d(m,{FactureProformaApercuComponent:()=>R});var a=s(60177),l=s(89417),_=s(96115),g=s(13868),i=s(22525),t=s(54438),f=s(61068),v=s(88026),$=s(72409),A=s(88704),E=s(49192),b=s(92120);function o(c,P){if(1&c&&(t.j41(0,"div",37)(1,"h4"),t.EFF(2,"Client : "),t.k0s(),t.j41(3,"p"),t.EFF(4),t.k0s()()),2&c){const e=t.XpG(2);t.R7$(4),t.JRh(e.facture.client.nomComplet)}}function n(c,P){if(1&c&&(t.j41(0,"div",37)(1,"h4"),t.EFF(2,"Entreprise :"),t.k0s(),t.j41(3,"p"),t.EFF(4),t.k0s()()),2&c){const e=t.XpG(2);t.R7$(4),t.JRh(e.facture.entrepriseClient.nom)}}function r(c,P){if(1&c&&(t.j41(0,"tr")(1,"td",38),t.EFF(2),t.k0s(),t.nrm(3,"td",39),t.j41(4,"td"),t.EFF(5),t.nI1(6,"customNumber"),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.nI1(11,"customNumber"),t.k0s()()),2&c){const e=P.$implicit,p=t.XpG(2);t.R7$(2),t.JRh(e.produit.nom),t.R7$(),t.Y8G("innerHTML",p.formatDescription(e.ligneDescription||""),t.npT),t.R7$(2),t.JRh(t.bMT(6,5,e.prixUnitaire)),t.R7$(3),t.JRh(e.quantite),t.R7$(2),t.JRh(t.bMT(11,7,e.prixUnitaire*e.quantite))}}function u(c,P){if(1&c&&(t.j41(0,"tr")(1,"td",26),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.nI1(5,"customNumber"),t.k0s()()),2&c){const e=t.XpG(2);t.R7$(2),t.SpI("Remise (",e.facture.remise,"%)"),t.R7$(2),t.JRh(t.bMT(5,2,e.facture.totalHT*e.facture.remise/100))}}function h(c,P){if(1&c&&(t.j41(0,"tr")(1,"td",26),t.EFF(2,"Montant commercial"),t.k0s(),t.j41(3,"td"),t.EFF(4),t.nI1(5,"customNumber"),t.k0s()()),2&c){const e=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,1,e.facture.totalHT-e.facture.totalHT*e.facture.remise/100)," ")}}function M(c,P){if(1&c&&(t.j41(0,"tr")(1,"td",26),t.EFF(2),t.nI1(3,"number"),t.k0s(),t.j41(4,"td"),t.EFF(5),t.nI1(6,"number"),t.k0s()()),2&c){let e,p;const d=t.XpG(2);t.R7$(2),t.SpI(" TVA (",t.i5U(3,2,100*(null!==(e=d.tauxTva)&&void 0!==e?e:0),"1.0-2")," %) "),t.R7$(3),t.SpI(" ",t.i5U(6,5,(d.facture.totalHT-d.facture.totalHT*(null!==(p=d.facture.remise)&&void 0!==p?p:0)/100)*(null!==(p=d.tauxTva)&&void 0!==p?p:0),"1.0-2")," ")}}function O(c,P){if(1&c&&(t.j41(0,"tr")(1,"td",26),t.EFF(2,"Montant TTC"),t.k0s(),t.j41(3,"td"),t.EFF(4),t.nI1(5,"customNumber"),t.k0s()()),2&c){const e=t.XpG(2);t.R7$(4),t.JRh(t.bMT(5,1,e.facture.totalFacture))}}function C(c,P){if(1&c&&(t.j41(0,"p")(1,"strong"),t.EFF(2),t.k0s()()),2&c){const e=t.XpG(2);t.R7$(2),t.JRh(e.siteWeb)}}function x(c,P){if(1&c&&(t.j41(0,"div")(1,"em"),t.EFF(2),t.k0s()()),2&c){const e=t.XpG(2);t.R7$(2),t.JRh(e.getLegalInfo())}}function I(c,P){if(1&c&&(t.j41(0,"div",40)(1,"em"),t.EFF(2),t.k0s()()),2&c){const e=t.XpG(2);t.R7$(2),t.JRh(e.getAddressInfo())}}function j(c,P){if(1&c){const e=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5),t.bIt("click",function(){t.eBV(e);const d=t.XpG();return t.Njj(d.navigateBack())}),t.nrm(4,"i",6),t.k0s()(),t.j41(5,"div",7)(6,"div",8)(7,"div",9)(8,"div",10)(9,"img",11),t.bIt("error",function(){t.eBV(e);const d=t.XpG();return t.Njj(d.logo=d.fallbackLogo)}),t.k0s()(),t.j41(10,"div",12)(11,"div",13)(12,"p",14),t.EFF(13),t.k0s(),t.j41(14,"p",15),t.EFF(15),t.k0s(),t.j41(16,"div",16),t.EFF(17,"Email : "),t.j41(18,"a",17),t.EFF(19),t.k0s(),t.EFF(20),t.k0s()()()(),t.nrm(21,"hr")(22,"hr"),t.j41(23,"div",18)(24,"h2"),t.EFF(25,"Facture proforma n\u02da"),t.j41(26,"span",19),t.EFF(27,"xxx-xx-xxxx"),t.k0s()()(),t.j41(28,"div",20)(29,"p"),t.EFF(30),t.nI1(31,"date"),t.k0s()(),t.DNE(32,o,5,1,"div",21)(33,n,5,1,"div",21),t.j41(34,"div",22)(35,"h4"),t.EFF(36,"Object :"),t.k0s(),t.j41(37,"p"),t.EFF(38),t.k0s()(),t.j41(39,"table",23)(40,"thead")(41,"tr")(42,"th"),t.EFF(43,"D\xe9signation"),t.k0s(),t.j41(44,"th",24),t.EFF(45,"Description"),t.k0s(),t.j41(46,"th"),t.EFF(47,"Prix Unitaire (FCFA)"),t.k0s(),t.j41(48,"th"),t.EFF(49,"Quantit\xe9"),t.k0s(),t.j41(50,"th"),t.EFF(51,"Montant (FCFA)"),t.k0s()()(),t.j41(52,"tbody"),t.DNE(53,r,12,9,"tr",25),t.k0s(),t.j41(54,"tfoot")(55,"tr")(56,"td",26),t.EFF(57,"Total HT"),t.k0s(),t.j41(58,"td"),t.EFF(59),t.nI1(60,"customNumber"),t.k0s()(),t.DNE(61,u,6,4,"tr",27)(62,h,6,3,"tr",27)(63,M,7,8,"tr",27)(64,O,6,3,"tr",27),t.k0s()(),t.j41(65,"div",28)(66,"p")(67,"span",29),t.EFF(68,"Arr\xeat\xe9 la pr\xe9sente facture \xe0 la somme de : "),t.k0s(),t.EFF(69),t.nI1(70,"enLettres"),t.k0s()(),t.j41(71,"div",30),t.nrm(72,"div"),t.j41(73,"div",31)(74,"h6"),t.EFF(75),t.k0s(),t.j41(76,"h4",32),t.EFF(77),t.k0s(),t.j41(78,"span"),t.EFF(79),t.k0s()()()()(),t.j41(80,"div",33)(81,"div",34),t.nrm(82,"hr",35),t.DNE(83,C,3,1,"p",27)(84,x,3,1,"div",27)(85,I,3,1,"div",36),t.k0s()()()()}if(2&c){const e=t.XpG();t.R7$(9),t.Y8G("src",e.logo,t.B4B),t.R7$(4),t.JRh(e.nom),t.R7$(2),t.SpI("Secterur: ",e.secteur,""),t.R7$(4),t.JRh(e.email),t.R7$(),t.SpI(" T\xe9l\xe9phone : ",e.telephone,""),t.R7$(10),t.Lme("",e.siege,", le ",t.i5U(31,23,e.facture.dateCreation,"dd MMMM yyyy"),""),t.R7$(2),t.Y8G("ngIf",e.facture.client),t.R7$(),t.Y8G("ngIf",e.facture.entrepriseClient),t.R7$(5),t.JRh(e.facture.description),t.R7$(15),t.Y8G("ngForOf",e.facture.lignesFacture),t.R7$(6),t.JRh(t.bMT(60,26,e.facture.totalHT)),t.R7$(2),t.Y8G("ngIf",e.facture.remise),t.R7$(),t.Y8G("ngIf",e.facture.remise&&e.facture.remise>0),t.R7$(),t.Y8G("ngIf",e.facture.tva),t.R7$(),t.Y8G("ngIf",e.facture.tva),t.R7$(5),t.SpI("",t.bMT(70,28,e.facture.totalFacture),"."),t.R7$(6),t.JRh(e.signataire),t.R7$(2),t.JRh(e.signataireNom),t.R7$(2),t.SpI(" ",e.signataireNom," "),t.R7$(4),t.Y8G("ngIf",e.siteWeb),t.R7$(),t.Y8G("ngIf",e.getLegalInfo()),t.R7$(),t.Y8G("ngIf",e.getAddressInfo())}}function D(c,P){if(1&c){const e=t.RV6();t.j41(0,"p"),t.EFF(1,"Aucune donn\xe9e d\u2019aper\xe7u\u2026 "),t.j41(2,"a",41),t.bIt("click",function(){t.eBV(e);const d=t.XpG();return t.Njj(d.router.navigate(["/add-facture-proforma"]))}),t.EFF(3,"Retour"),t.k0s()()}}let R=(()=>{class c{constructor(e,p,d,T,U,L){this.previewService=e,this.userService=p,this.factureService=d,this.formStateService=T,this.router=U,this.entrepriseService=L,this.facture=null,this.nom=null,this.logo=null,this.apiUrl=i.c.imgUrl,this.fallbackLogo=`${this.apiUrl}/defaultLogo/Votre.png`}ngOnInit(){this.getFacturePreview(),this.getUserEntrepriseInfo()}getFacturePreview(){this.previewService.getPreview().subscribe(e=>{e?this.facture=e:this.router.navigate(["/addfacture-proforma"])})}onCreate(){if(!this.facture)return;const e={description:this.facture.description,client:this.facture.client?{id:this.facture.client.id}:void 0,entrepriseClient:this.facture.entrepriseClient?{id:this.facture.entrepriseClient.id}:void 0,lignesFacture:this.facture.lignesFacture.map(p=>({produit:{id:p.produit.id},quantite:p.quantite,ligneDescription:p.ligneDescription,prixUnitaire:p.prixUnitaire}))};this.factureService.creerFactureProforma(e,this.facture.remise??void 0,this.facture.tva,!!this.facture.remise||this.facture.tva).subscribe({next:p=>{this.formStateService.clearState(),this.router.navigate(["/facture-proforma"])},error:p=>console.error("Erreur cr\xe9ation facture :",p)})}navigateBack(){this.router.navigate(["/addfacture-proforma"])}getUserEntrepriseInfo(){this.entrepriseService.getEntrepriseInfo().subscribe({next:e=>{console.log("Entreprise re\xe7ue :",e),this.nom=e.nom,this.siege=e.siege,this.email=e.email,this.logo=e.logo,this.secteur=e.secteur,this.telephone=e.telephone,this.adresse=e.adresse,this.nif=e.nif,this.banque=e.banque,this.nina=e.nina,this.pays=e.pays,this.rccm=e.rccm,this.siteWeb=e.siteWeb,this.signataire=e.signataire,this.signataireNom=e.signataireNom,this.tauxTva=e.tauxTva,this.logo=`${this.apiUrl}${e.logo}`},error:e=>{console.error("Erreur lors de la r\xe9cup\xe9ration des infos utilisateur :",e)}})}getLegalInfo(){const e=[];return this.nina&&e.push(`NINA : ${this.nina}`),this.rccm&&e.push(`RCCM : ${this.rccm}`),this.nif&&e.push(`NIF : ${this.nif}`),this.banque&&e.push(`Banque : ${this.banque}`),e.join(" ; ")}getAddressInfo(){const e=this.adresse,p=this.siege,d=this.pays;return e&&p&&d?`Adresse : ${e} / ${p}-${d}`:e&&p?`Adresse : ${e} / ${p}`:e&&d?`Adresse : ${e} / ${d}`:p&&d?`Adresse : ${p} / ${d}`:e?`Adresse : ${e}`:p?`Adresse : ${p}`:d?`Adresse : ${d}`:""}formatDescription(e){return e?e.replace(/-\s*/g,"<br>- "):""}static{this.\u0275fac=function(p){return new(p||c)(t.rXU(f.Q),t.rXU(v.g),t.rXU($.c),t.rXU(A.H),t.rXU(E.Ix),t.rXU(b.r))}}static{this.\u0275cmp=t.VBU({type:c,selectors:[["app-facture-proforma-apercu"]],decls:3,vars:2,consts:[["noData",""],["class","container_global",4,"ngIf","ngIfElse"],[1,"container_global"],[1,"information_cadre",2,"position","relative"],[1,"cadre_retour"],[1,"retour_icon",3,"click"],[1,"ri-arrow-left-long-fill"],[1,"info_titre_input"],[1,"content"],[1,"header_apercu"],[1,"logo_entreprise"],["alt","Logo de l'entreprise",3,"error","src"],[1,"entete_entreprise"],[1,"content_entete"],[1,"para1"],[1,"para2"],[1,"para3"],["href","mail"],[1,"titre"],[2,"color","#0000003e"],[1,"date"],["class","droit",4,"ngIf"],[1,"object"],[1,"table"],[2,"width","260px!important"],[4,"ngFor","ngForOf"],["colspan","4"],[4,"ngIf"],[1,"contenu_bottom"],[2,"font-weight","600"],[1,"cachet_container"],[1,"cachet"],[1,"name_directeur"],[1,"container_footer"],[1,"footer"],[2,"margin-top","40px"],["style","margin-top: -4px;",4,"ngIf"],[1,"droit"],[1,"td_left"],[1,"td_left",3,"innerHTML"],[2,"margin-top","-4px"],[3,"click"]],template:function(p,d){if(1&p&&t.DNE(0,j,86,30,"div",1)(1,D,4,0,"ng-template",null,0,t.C5r),2&p){const T=t.sdS(2);t.Y8G("ngIf",d.facture)("ngIfElse",T)}},dependencies:[a.MD,a.Sq,a.bT,a.QX,a.vh,l.YN,_.v,g.X],styles:['@charset "UTF-8";p[_ngcontent-%COMP%], h4[_ngcontent-%COMP%]{margin:0}.container_global[_ngcontent-%COMP%]{display:flex;justify-content:center}.cadre_retour[_ngcontent-%COMP%]{width:100%;height:50px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(60,60,60,.1607843137);padding:10px 10px 10px 15px}.btn_ajouter[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-right:10px;cursor:pointer;font-weight:600;font-size:14px;letter-spacing:.6px}.retour_icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px;cursor:pointer}.btn_ajouter[_ngcontent-%COMP%]   .btn_save[_ngcontent-%COMP%]{border:none;background-color:transparent;color:#0672e4;font-size:15px}.content[_ngcontent-%COMP%]{margin-top:5px}.information_cadre[_ngcontent-%COMP%]{width:800px;height:1223px;background-color:#fff;box-shadow:2px 2px 30px #0000001c}.info_titre_input[_ngcontent-%COMP%]{padding:20px}.header_apercu[_ngcontent-%COMP%]{display:flex;align-items:center}.logo_entreprise[_ngcontent-%COMP%]{width:180px;height:70px}.entete_entreprise[_ngcontent-%COMP%]{margin-left:5%}.logo_entreprise[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain}.content_entete[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:12px;letter-spacing:.5px}.content_entete[_ngcontent-%COMP%]   .para1[_ngcontent-%COMP%], .content_entete[_ngcontent-%COMP%]   .para2[_ngcontent-%COMP%]{font-weight:600}hr[_ngcontent-%COMP%]{margin:3px 0}.titre[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px;text-decoration:underline;text-transform:uppercase;letter-spacing:.6px;text-align:center;margin:20px}.date[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:right;margin-right:5%;font-size:12px}.droit[_ngcontent-%COMP%], .object[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:10px;margin-left:37px}.droit[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .object[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:13px;font-weight:700}.droit[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .object[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:12}.header[_ngcontent-%COMP%]{margin-bottom:30px}h1[_ngcontent-%COMP%]{font-size:1.4em;margin:0}h2[_ngcontent-%COMP%]{font-size:1.2em;color:#555;margin:10px 0}table[_ngcontent-%COMP%]{width:90%;border-collapse:collapse;margin:20px 37px;font-size:11px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #ddd;padding:12px;text-align:center}th[_ngcontent-%COMP%]{background-color:#f5f5f5}.total-section[_ngcontent-%COMP%]{margin-top:30px;width:50%;margin-left:auto}.total-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:8px 0}.bold[_ngcontent-%COMP%]{font-weight:700}.separator[_ngcontent-%COMP%]{border-top:2px solid #333;margin:20px 0}td.table_td_1[_ngcontent-%COMP%]{border-right:none}td.table_td[_ngcontent-%COMP%]{border-right:none;border-top:none;border-left:none}.table_td_descripton[_ngcontent-%COMP%]{text-align:center}td.td_left[_ngcontent-%COMP%]{text-align:left!important}.contenu_bottom[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px;margin:0 0 0 37px}.cachet_container[_ngcontent-%COMP%]{height:150px;width:100%;margin-top:20px;display:flex;justify-content:space-between}.cachet[_ngcontent-%COMP%]{position:relative;top:30px;right:41px}.cachet[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{text-align:center;font-size:16px}.cachet[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{text-align:center;font-size:14px;margin-bottom:4px}.cachet[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;text-align:center;font-size:12px;font-weight:600;color:#000;font-family:brittany;margin-top:52%}.name_directeur[_ngcontent-%COMP%]{position:relative;top:26px}.container_footer[_ngcontent-%COMP%]{display:flex;justify-content:center}.footer[_ngcontent-%COMP%]{text-align:center;position:absolute;bottom:45px;width:96%}.footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{letter-spacing:.6px}.footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:12px}.footer[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-size:11px}.facture-container[_ngcontent-%COMP%]{max-width:210mm;margin:20px auto;padding:20px;background:#fff;box-shadow:0 0 10px #0000001a;font-family:Arial,sans-serif}.facture-container[_ngcontent-%COMP%]   .loading-overlay[_ngcontent-%COMP%]{text-align:center;padding:2rem}.facture-container[_ngcontent-%COMP%]   .loading-overlay[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto}.facture-container[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{color:#dc3545;padding:1rem;border:1px solid #dc3545;margin:1rem 0;border-radius:4px}.facture-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:2rem;border-bottom:2px solid #333;padding-bottom:1rem}.facture-header[_ngcontent-%COMP%]   .company-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;color:#2c3e50}.facture-header[_ngcontent-%COMP%]   .company-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#7f8c8d}.facture-header[_ngcontent-%COMP%]   .facture-meta[_ngcontent-%COMP%]{text-align:right}.facture-header[_ngcontent-%COMP%]   .facture-meta[_ngcontent-%COMP%]   .facture-number[_ngcontent-%COMP%]{font-weight:700;color:#2c3e50}.facture-header[_ngcontent-%COMP%]   .facture-meta[_ngcontent-%COMP%]   .facture-date[_ngcontent-%COMP%]{color:#7f8c8d}.client-info[_ngcontent-%COMP%]{margin-bottom:2rem}.client-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#2c3e50;margin-bottom:.5rem}.client-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:1.1rem}.products-section[_ngcontent-%COMP%]{margin-bottom:2rem}.products-section[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.products-section[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .products-section[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:left;border-bottom:1px solid #ecf0f1}.products-section[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f8f9fa;color:#2c3e50}.products-section[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.totals-section[_ngcontent-%COMP%]{margin-top:2rem;text-align:right}.totals-section[_ngcontent-%COMP%]   .total-line[_ngcontent-%COMP%]{margin:10px 0}.totals-section[_ngcontent-%COMP%]   .total-line[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{margin-right:20px;color:#7f8c8d}.totals-section[_ngcontent-%COMP%]   .total-line.grand-total[_ngcontent-%COMP%]{font-size:1.2em;font-weight:700;color:#2c3e50}']})}}return c})()}}]);
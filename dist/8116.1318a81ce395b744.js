"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[8116],{6822:(F,v,c)=>{c.d(v,{K:()=>l});var l=function(_){return _.BROUILLON="BROUILLON",_.APPROBATION="APPROBATION",_.APPROUVE="APPROUVE",_.ENVOYE="ENVOYE",_.VALIDE="VALIDE",_.ANNULE="ANNULE",_}(l||{})},2409:(F,v,c)=>{c.d(v,{c:()=>k});var l=c(1626),_=c(8810),O=c(8141),E=c(9437),b=c(6822),t=c(2525),x=c(4438);let k=(()=>{class u{constructor(s){this.http=s,this.apiUrl=t.c.apiBaseUrl}creerFactureProforma(s,i,a,h){const g=localStorage.getItem("authToken");if(!g)return(0,_.$)(()=>new Error("Token manquant"));const f=new l.Lr({Authorization:`Bearer ${g}`});let C=new l.Nl;return h&&(void 0!==i&&(C=C.set("remisePourcentage",i.toString())),void 0!==a&&(C=C.set("appliquerTVA",a.toString()))),this.http.post(`${this.apiUrl}/ajouter`,s,{headers:f,params:C}).pipe((0,O.M)(d=>console.log("Facture cr\xe9\xe9e avec succ\xe8s:",d)),(0,E.W)(d=>(console.error("Erreur d\xe9taill\xe9e:",d),console.log("Corps de la r\xe9ponse:",d.error),(0,_.$)(()=>d))))}getAlFactproformaOfEntreprise(s){const i=localStorage.getItem("authToken");if(!i)return console.error("Aucun token trouv\xe9"),(0,_.$)("Aucun token trouv\xe9");const a=new l.Lr({Authorization:`Bearer ${i}`});return this.http.get(`${this.apiUrl}/mes-factures`,{headers:a})}getFactureProformaById(s){const i=localStorage.getItem("authToken"),a=new l.Lr({Authorization:`Bearer ${i}`});return this.http.get(`${this.apiUrl}/factureProforma/${s}`,{headers:a})}updateFactureProforma(s,i,a,h,g){const f=localStorage.getItem("authToken");if(!f)return(0,_.$)(()=>new Error("Token manquant"));const C=new l.Lr({Authorization:`Bearer ${f}`,"Content-Type":"application/json"});let d=new l.Nl;return void 0!==i&&(d=d.set("remisePourcentage",i.toString())),void 0!==a&&(d=d.set("appliquerTVA",a.toString())),g&&g.length>0&&g.forEach(M=>{d=d.append("idsApprobateurs",M.toString())}),h.statut===b.K.ANNULE&&(d=d.set("isAnnulation","true")),this.http.put(`${this.apiUrl}/updatefacture/${s}`,h,{headers:C,params:d}).pipe((0,O.M)(M=>console.log("Facture mise \xe0 jour:",M)),(0,E.W)(M=>(console.error("Erreur mise \xe0 jour:",M),(0,_.$)(()=>M))))}envoyerFactureEmail(s,i){const a=new FormData;a.append("to",i.to),a.append("cc",i.cc),a.append("subject",i.subject),a.append("body",i.body),i.attachments&&i.attachments.forEach((f,C)=>{a.append("attachments",f,f.name)});const h=localStorage.getItem("authToken"),g=new l.Lr({Authorization:`Bearer ${h}`});return this.http.post(`${this.apiUrl}/factures/${s}/envoyer-email`,a,{headers:g,responseType:"text"})}getHistoriqueFacture(s){const i=localStorage.getItem("authToken"),a=new l.Lr({Authorization:`Bearer ${i}`});return this.http.get(`${this.apiUrl}/factpro/${s}/historique`,{headers:a})}getNotesFactureProforma(s){const i=localStorage.getItem("authToken"),a=new l.Lr({Authorization:`Bearer ${i}`});return this.http.get(`${this.apiUrl}/factures/${s}/notes`,{headers:a})}getNoteById(s,i){const a=localStorage.getItem("authToken"),h=new l.Lr({Authorization:`Bearer ${a}`,Accept:"application/json"});return this.http.get(`${this.apiUrl}/auth/${s}/notes/${i}`,{headers:h})}updateNote(s,i,a){const h=localStorage.getItem("authToken"),g=new l.Lr({Authorization:`Bearer ${h}`,"Content-Type":"application/json"});return this.http.put(`${this.apiUrl}/${s}/notes/${i}`,{nouveauContenu:a},{headers:g}).pipe((0,O.M)(d=>console.log("Note modifi\xe9e avec succ\xe8s:",d)),(0,E.W)(d=>(console.error("Erreur lors de la modification de la note:",d),(0,_.$)(()=>d))))}deletNoteFactureProforma(s,i){const a=localStorage.getItem("authToken"),h=new l.Lr({Authorization:`Bearer ${a}`,Accept:"application/json"});return this.http.delete(`${this.apiUrl}/${s}/notes/${i}/supprimer`,{headers:h})}getFacturesByClient(s,i){const a=localStorage.getItem("authToken"),h=new l.Lr({Authorization:`Bearer ${a}`});let g=new l.Nl;return s&&(g=g.set("clientId",s.toString())),i&&(g=g.set("entrepriseClientId",i.toString())),this.http.get(`${this.apiUrl}/factures/client`,{headers:h,params:g}).pipe((0,E.W)(f=>(console.error("Erreur dans getFacturesByClient:",f),(0,_.$)(()=>f))))}static{this.\u0275fac=function(i){return new(i||u)(x.KVO(l.Qq))}}static{this.\u0275prov=x.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})()},6375:(F,v,c)=>{c.d(v,{D:()=>t});var l=c(1626),_=c(9437),O=c(8810),E=c(2525),b=c(4438);let t=(()=>{class x{constructor(u){this.http=u,this.apiUrl=E.c.apiBaseUrl}ajouterProduit(u,m,s,i,a,h){const g=`${this.apiUrl}/create?addToStock=${h}`,f=new FormData;f.append("boutiqueIds",JSON.stringify(u)),f.append("quantites",JSON.stringify(m)),f.append("produit",JSON.stringify(i)),f.append("seuilAlert",JSON.stringify(s)),a&&f.append("image",a,a.name);const C=localStorage.getItem("authToken")||"",d=new l.Lr({Authorization:`Bearer ${C}`});return this.http.post(g,f,{headers:d})}modifierProduit(u,m){const s=localStorage.getItem("authToken")||"",i=new l.Lr({Authorization:`Bearer ${s}`}),a=new FormData,{id:h,...g}=u;return a.append("produit",JSON.stringify(g)),a.append("addToStock",u.enStock?"true":"false"),m&&a.append("image",m,m.name),this.http.patch(`${this.apiUrl}/updateProduit/${u.id}`,a,{headers:i})}getProduitById(u){const m=localStorage.getItem("authToken")||"",s=new l.Lr({Authorization:`Bearer ${m}`});return this.http.get(`${this.apiUrl}/produits/${u}`,{headers:s})}getProduitsEntreprise(u){const m=localStorage.getItem("authToken"),s=new l.Lr({Authorization:`Bearer ${m}`});return this.http.get(`${this.apiUrl}/produits/${u}/stock`,{headers:s}).pipe((0,_.W)(i=>(0,O.$)(400===i.status&&"Cette boutique est d\xe9sactiv\xe9e, ses produits ne sont pas accessibles !"===i.error?.error?()=>new Error("BOUTIQUE_DESACTIVEE"):()=>i)))}getProduitBoutique(u){const m=localStorage.getItem("authToken");if(!m)return console.error("Aucun token trouv\xe9"),(0,O.$)("Aucun token trouv\xe9");const s=new l.Lr({Authorization:`Bearer ${m}`});return this.http.get(`${this.apiUrl}/produits/${u}/totaux-stock`,{headers:s})}getProduitsByEntrepriseId(u){return this.http.get(`${this.apiUrl}/produits/entreprise/${u}`)}getProduitsParEntreprise(u){return this.http.get(`${this.apiUrl}/produits/entreprise/${u}`)}getFournisseurs(){const u=localStorage.getItem("authToken")||"",m=new l.Lr({Authorization:`Bearer ${u}`});return this.http.get(`${this.apiUrl}/get-fournisseurs`,{headers:m})}static{this.\u0275fac=function(m){return new(m||x)(b.KVO(l.Qq))}}static{this.\u0275prov=b.jDH({token:x,factory:x.\u0275fac,providedIn:"root"})}}return x})()},8116:(F,v,c)=>{c.r(v),c.d(v,{FactureProformaComponent:()=>G});var l=c(177),_=c(9417),O=c(6115),E=c(3509),b=c(9631),t=c(4438),x=c(9192),k=c(7746),u=c(2409),m=c(6375),s=c(8026),i=c(4173);const a=()=>[6,10,25,100];function h(r,p){if(1&r){const e=t.RV6();t.j41(0,"div",28)(1,"div",29),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.toggleView("list"))}),t.EFF(2),t.k0s(),t.j41(3,"div",29),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.toggleView("grid"))}),t.EFF(4),t.k0s()()}if(2&r){const e=t.XpG(2);t.R7$(2),t.SpI(" Liste ",e.isListView?"\u2713":""," "),t.R7$(2),t.SpI(" Cadre ",e.isListView?"":"\u2713"," ")}}function g(r,p){if(1&r){const e=t.RV6();t.j41(0,"div",30)(1,"div",31)(2,"div",32),t.qSk(),t.j41(3,"svg",33),t.nrm(4,"path",34)(5,"path",35),t.k0s()(),t.joV(),t.j41(6,"h1"),t.EFF(7,"Acc\xe8s restreint"),t.k0s(),t.j41(8,"div",36)(9,"p",37),t.EFF(10),t.k0s(),t.j41(11,"p"),t.EFF(12,"Veuillez renouveler votre abonnement pour acc\xe9der \xe0 ce module."),t.k0s()(),t.j41(13,"button",38),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.redirigerAccueil())}),t.EFF(14,"OK"),t.k0s()()()}if(2&r){const e=t.XpG(2);t.R7$(10),t.JRh(e.messageErreur)}}function f(r,p){if(1&r&&(t.j41(0,"span",39),t.EFF(1),t.k0s()),2&r){const e=t.XpG(2);t.R7$(),t.SpI(" ",e.totalAllFactures," ")}}function C(r,p){if(1&r&&(t.j41(0,"span",39),t.EFF(1),t.k0s()),2&r){const e=t.XpG().$implicit,o=t.XpG(2);t.R7$(),t.SpI(" ",o.factureCounts[e.value]," ")}}function d(r,p){1&r&&t.nrm(0,"div",43)}function M(r,p){if(1&r){const e=t.RV6();t.qex(0),t.j41(1,"div",40),t.bIt("click",function(){const n=t.eBV(e).$implicit,P=t.XpG(2);return t.Njj(P.selectStatut(n.value))}),t.j41(2,"p",41),t.EFF(3),t.DNE(4,C,2,1,"span",21),t.k0s()(),t.DNE(5,d,1,0,"div",42),t.bVm()}if(2&r){const e=p.$implicit,o=p.index,n=t.XpG(2);t.R7$(),t.AVh("name_boutique_active",n.selectedStatut===e.value),t.R7$(2),t.SpI(" ",e.label," "),t.R7$(),t.Y8G("ngIf",n.factureCounts[e.value]>0),t.R7$(),t.Y8G("ngIf",o!==n.statuts.length-1)}}function j(r,p){if(1&r&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&r){const e=p.$implicit;t.R7$(),t.Lme(" ",e.nomProduit," (x",e.quantite,") ")}}function T(r,p){1&r&&(t.j41(0,"div"),t.EFF(1,"..."),t.k0s())}function w(r,p){if(1&r){const e=t.RV6();t.j41(0,"tr",48),t.bIt("click",function(){const n=t.eBV(e).$implicit,P=t.XpG(3);return t.Njj(P.showDetails(n.id))}),t.j41(1,"td",49),t.EFF(2),t.k0s(),t.j41(3,"td",49),t.EFF(4),t.k0s(),t.j41(5,"td",49),t.EFF(6),t.nI1(7,"date"),t.k0s(),t.j41(8,"td",49),t.DNE(9,j,2,2,"div",22)(10,T,2,0,"div",23),t.k0s(),t.j41(11,"td",49)(12,"span",50),t.EFF(13),t.k0s()(),t.j41(14,"td",49),t.EFF(15),t.nI1(16,"customNumber"),t.k0s(),t.j41(17,"td",49),t.EFF(18),t.nI1(19,"date"),t.k0s()()}if(2&r){const e=p.$implicit,o=t.XpG(3);t.R7$(2),t.JRh(e.numeroFacture),t.R7$(2),t.JRh(e.client||e.entrepriseClient),t.R7$(2),t.JRh(t.i5U(7,9,e.dateCreation,"dd/MM/yyyy")),t.R7$(3),t.Y8G("ngForOf",null==e.ligneFactureProforma?null:e.ligneFactureProforma.slice(0,2)),t.R7$(),t.Y8G("ngIf",(null==e.ligneFactureProforma?null:e.ligneFactureProforma.length)>2),t.R7$(2),t.Y8G("ngClass",o.getStatutClass(e.statut)),t.R7$(),t.SpI(" ",e.statut," "),t.R7$(2),t.SpI(" ",t.bMT(16,12,e.totalFacture)," CFA "),t.R7$(3),t.SpI(" ",e.dateRelance?t.brH(19,14,e.dateRelance,"dd-MM-yyyy","fr_FR"):"pas de date"," ")}}function R(r,p){if(1&r){const e=t.RV6();t.j41(0,"table")(1,"thead")(2,"tr",44)(3,"th",45),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.sort("numeroFacture"))}),t.EFF(4," N\xb0 Facture "),t.nrm(5,"i"),t.k0s(),t.j41(6,"th",46),t.EFF(7,"Droit"),t.k0s(),t.j41(8,"th",45),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.sort("dateCreation"))}),t.EFF(9," Date "),t.nrm(10,"i"),t.k0s(),t.j41(11,"th",46),t.EFF(12,"Produits"),t.k0s(),t.j41(13,"th",46),t.EFF(14,"Statut"),t.k0s(),t.j41(15,"th",46),t.EFF(16,"Total"),t.k0s(),t.j41(17,"th",46),t.EFF(18,"Date Relance"),t.k0s()()(),t.j41(19,"tbody"),t.DNE(20,w,20,18,"tr",47),t.k0s()()}if(2&r){const e=t.XpG(2);t.R7$(5),t.HbH("numeroFacture"===e.sortField?"asc"===e.sortDirection?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-arrow-up-down-line"),t.R7$(5),t.HbH("dateCreation"===e.sortField?"asc"===e.sortDirection?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-arrow-up-down-line"),t.R7$(10),t.Y8G("ngForOf",e.paginatedFactures)}}function $(r,p){if(1&r&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td",68),t.EFF(6),t.nI1(7,"customNumber"),t.k0s()()),2&r){const e=p.$implicit;t.R7$(2),t.SpI(" ",e.nomProduit," "),t.R7$(2),t.SpI(" ",e.quantite," "),t.R7$(2),t.SpI(" ",t.bMT(7,3,e.montantTotal)," ")}}function S(r,p){1&r&&(t.j41(0,"tr",69)(1,"td"),t.EFF(2,"||"),t.k0s(),t.j41(3,"td"),t.EFF(4,"||"),t.k0s(),t.j41(5,"td",68),t.EFF(6,"||"),t.k0s()())}function A(r,p){if(1&r&&(t.qex(0),t.DNE(1,$,8,5,"tr",22)(2,S,7,0,"tr",67),t.bVm()),2&r){const e=t.XpG().$implicit;t.R7$(),t.Y8G("ngForOf",e.ligneFactureProforma.slice(0,1)),t.R7$(),t.Y8G("ngIf",e.ligneFactureProforma.length>1)}}function D(r,p){1&r&&(t.j41(0,"tr")(1,"td",70),t.EFF(2,"Aucun produit dans cette facture"),t.k0s()())}function L(r,p){if(1&r){const e=t.RV6();t.j41(0,"div",53),t.bIt("click",function(){const n=t.eBV(e).$implicit,P=t.XpG(3);return t.Njj(P.showDetails(n.id))}),t.j41(1,"div",54)(2,"h5"),t.EFF(3,"Facture Pro forma"),t.k0s()(),t.j41(4,"div",55)(5,"div",56)(6,"span"),t.EFF(7),t.k0s()(),t.j41(8,"div",57)(9,"span",58),t.EFF(10," Client(s) : "),t.k0s(),t.j41(11,"span",59),t.EFF(12),t.k0s()(),t.j41(13,"div",57)(14,"span",58),t.EFF(15," Date : "),t.k0s(),t.j41(16,"span",60),t.EFF(17),t.k0s()()(),t.j41(18,"table")(19,"thead")(20,"tr")(21,"th"),t.EFF(22," Produit "),t.k0s(),t.j41(23,"th"),t.EFF(24," Quantit\xe9 "),t.k0s(),t.j41(25,"th"),t.EFF(26," Montant Total "),t.k0s()()(),t.j41(27,"tbody"),t.DNE(28,A,3,2,"ng-container",61)(29,D,3,0,"ng-template",null,1,t.C5r),t.k0s(),t.nrm(31,"tfoot"),t.k0s(),t.j41(32,"div",62),t.nrm(33,"img",63),t.j41(34,"div",64)(35,"p",65),t.EFF(36," - Etat - "),t.k0s(),t.j41(37,"span"),t.EFF(38),t.k0s()()(),t.j41(39,"div",66)(40,"span",58),t.EFF(41," MONTANT TOTAL TTC : "),t.k0s(),t.j41(42,"span",59),t.EFF(43),t.nI1(44,"customNumber"),t.k0s()()()}if(2&r){const e=p.$implicit,o=t.sdS(30),n=t.XpG(3);t.R7$(7),t.SpI("N ",e.numeroFacture," "),t.R7$(5),t.SpI(" ",e.client||e.entrepriseClient," "),t.R7$(5),t.SpI(" ",e.dateCreation," "),t.R7$(11),t.Y8G("ngIf",null==e.ligneFactureProforma?null:e.ligneFactureProforma.length)("ngIfElse",o),t.R7$(5),t.Y8G("src",n.getImageSrc(e.statut),t.B4B),t.R7$(),t.Y8G("ngClass",n.getStatutClass(e.statut)),t.R7$(4),t.SpI(" ",e.statut," "),t.R7$(5),t.SpI(" ",t.bMT(44,9,e.totalFacture)," CFA ")}}function y(r,p){if(1&r&&(t.j41(0,"div",51),t.DNE(1,L,45,11,"div",52),t.k0s()),2&r){const e=t.XpG(2);t.R7$(),t.Y8G("ngForOf",e.paginatedFactures)}}function B(r,p){if(1&r){const e=t.RV6();t.j41(0,"mat-paginator",71),t.bIt("page",function(n){t.eBV(e);const P=t.XpG(2);return t.Njj(P.onPageChange(n))}),t.k0s()}if(2&r){const e=t.XpG(2);t.Y8G("length",e.filteredFactures.length)("pageSize",e.pageSize)("pageSizeOptions",t.lJ4(3,a))}}function N(r,p){1&r&&(t.j41(0,"div",72),t.EFF(1," Aucun facture pro forma trouv\xe9 "),t.k0s())}function U(r,p){if(1&r){const e=t.RV6();t.j41(0,"div",3)(1,"div",4)(2,"h1",5),t.EFF(3,"Facture pro forma"),t.k0s(),t.j41(4,"div",6)(5,"button",7),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.goToAddProduit())}),t.EFF(6,"Ajouter une facture "),t.k0s(),t.j41(7,"div",8),t.nrm(8,"div",9),t.k0s(),t.j41(9,"div",10),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.showDropdown=!n.showDropdown)})("clickOutside",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.showDropdown=!1)}),t.nrm(10,"i"),t.DNE(11,h,5,2,"div",11),t.k0s(),t.j41(12,"div",8),t.nrm(13,"div",9),t.k0s(),t.j41(14,"div",12)(15,"input",13),t.mxI("ngModelChange",function(n){t.eBV(e);const P=t.XpG();return t.DH7(P.searchText,n)||(P.searchText=n),t.Njj(n)}),t.bIt("ngModelChange",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onSearchChange())}),t.k0s(),t.j41(16,"i",14),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return n.searchText="",t.Njj(n.onSearchChange())}),t.k0s()()()(),t.DNE(17,g,15,1,"div",15),t.j41(18,"div",16)(19,"div",17)(20,"div",18)(21,"div",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.selectStatut(null))}),t.j41(22,"p",20),t.EFF(23," Toutes les \xe9tats "),t.DNE(24,f,2,1,"span",21),t.k0s()(),t.nrm(25,"div",9),t.DNE(26,M,6,5,"ng-container",22),t.k0s()()(),t.DNE(27,R,21,5,"table",23)(28,y,2,1,"div",24),t.j41(29,"div",25),t.DNE(30,B,1,4,"mat-paginator",26),t.k0s(),t.DNE(31,N,2,0,"div",27),t.k0s()}if(2&r){const e=t.XpG();t.R7$(10),t.HbH(e.isListView?"ri-list-check":"ri-apps-fill"),t.R7$(),t.Y8G("ngIf",e.showDropdown),t.R7$(4),t.R50("ngModel",e.searchText),t.R7$(),t.Y8G("ngClass",e.searchText?"ri-close-line red-icon":"ri-search-2-line"),t.R7$(),t.Y8G("ngIf",!e.accesAutorise),t.R7$(4),t.AVh("name_boutique_active",null===e.selectedStatut),t.R7$(3),t.Y8G("ngIf",e.totalAllFactures>0),t.R7$(2),t.Y8G("ngForOf",e.statuts),t.R7$(),t.Y8G("ngIf",e.isListView),t.R7$(),t.Y8G("ngIf",!e.isListView),t.R7$(2),t.Y8G("ngIf",e.filteredFactures.length>e.pageSize),t.R7$(),t.Y8G("ngIf",e.facturesLoaded&&0===e.filteredFactures.length)}}function V(r,p){if(1&r&&(t.j41(0,"div",74),t.EFF(1),t.k0s()),2&r){const e=t.XpG(2);t.R7$(),t.SpI(" ",e.messageErreur," ")}}function z(r,p){if(1&r&&t.DNE(0,V,2,1,"div",73),2&r){const e=t.XpG();t.Y8G("ngIf",e.messageErreur)}}let G=(()=>{class r{constructor(e,o,n,P,I,X,Y){this.router=e,this.clientService=o,this.factureProFormaService=n,this.produitService=P,this.usersService=I,this.moduleService=X,this.route=Y,this.pendingAdjustments=[],this.description="",this.typeDestinataire="client",this.selectedClientId=null,this.selectedEntrepriseId=null,this.nomEntreprise="",this.produits=[],this.lignesFacture=[{produitId:0,quantite:1}],this.clients=[],this.totalClients=0,this.noClientsAvailable=!1,this.entreprises=[],this.remiseTVAActive=!1,this.remisePourcentage=0,this.tva=0,this.entrepriseId=0,this.userEntrepriseId=null,this.isLoading=!1,this.facturesproforma=[],this.isListView=!0,this.showDropdown=!1,this.searchTerm="",this.facturesLoaded=!1,this.searchText="",this.factureCounts={},this.totalAllFactures=0,this.pageSize=10,this.currentPage=0,this.sortField="numeroFacture",this.sortDirection="asc",this.selectedStatut=null,this.statuts=[{value:"BROUILLON",label:"Brouillon"},{value:"APPROUVE",label:"Approuv\xe9"},{value:"ENVOYE",label:"Envoy\xe9"},{value:"VALIDE",label:"Valid\xe9"},{value:"ANNULE",label:"Annul\xe9"}],this.accesAutorise=!1,this.chargementFini=!1,this.messageErreur="",this.tempsRestantEssai=null}ngOnInit(){const e=localStorage.getItem("factureView");this.isListView="grid"!==e,this.getUserInfo(),this.verifierAcces(),this.route.queryParams.subscribe(o=>{const n=o.etat;n&&this.statuts.some(P=>P.value===n)&&this.selectStatut(n)})}toggleView(e){this.isListView="list"===e,localStorage.setItem("factureView",e)}goToAddProduit(){this.router.navigate(["/addfacture-proforma"])}clearSearch(){this.searchTerm=""}sort(e){this.sortField===e?this.sortDirection="asc"===this.sortDirection?"desc":"asc":(this.sortField=e,this.sortDirection="asc"),this.facturesproforma.sort((o,n)=>{const P=o[e]?.toString().toLowerCase()??"",I=n[e]?.toString().toLowerCase()??"";return P.localeCompare(I)*("asc"===this.sortDirection?1:-1)})}get filteredFactures(){let e=[...this.facturesproforma];if(this.selectedStatut&&(e=e.filter(o=>o.statut===this.selectedStatut)),this.searchText.trim()){const o=this.searchText.toLowerCase().trim();e=e.filter(n=>n.numeroFacture?.toLowerCase().includes(o)||n.client?.toLowerCase().includes(o)||n.entrepriseClient?.toLowerCase().includes(o)||n.totalFacture?.toString().includes(this.searchText))}return e}onPageChange(e){this.currentPage=e.pageIndex,this.pageSize=e.pageSize}selectStatut(e){this.selectedStatut=e,this.currentPage=0}get paginatedFactures(){const e=this.currentPage*this.pageSize;return this.filteredFactures.slice(e,e+this.pageSize)}getTotalFacture(e){return e.ligneFactureProforma?.reduce((o,n)=>o+n.montantTotal,0)||0}getUserInfo(){this.usersService.getUserInfo().subscribe({next:e=>{this.nomEntreprise=e.nomEntreprise,this.userEntrepriseId=e.entrepriseId,this.loadFactproformaOfEntreprise(this.userEntrepriseId)},error:e=>{console.error("Erreur lors de la r\xe9cup\xe9ration des infos utilisateur :",e),this.facturesLoaded=!0}})}loadFactproformaOfEntreprise(e){this.isLoading=!0,this.facturesLoaded=!1,this.factureProFormaService.getAlFactproformaOfEntreprise(e).subscribe({next:o=>{this.facturesproforma=o.map(n=>({...n})),this.calculateFactureCounts(),this.isLoading=!1,this.facturesLoaded=!0},error:o=>{console.error("Erreur lors du chargement des facture proforma",o),this.isLoading=!1,this.facturesLoaded=!0}})}showDetails(e){this.router.navigate(["/facture-proforma-details",e])}getImageSrc(e){switch(e){case'BROUILLON"':default:return"assets/etiquette/Etiquette-Sy-XPERTPRO-Gris.png";case"APPROUVE":return"assets/etiquette/Etiquette-Sy-XPERTPRO-bleu-.png";case"ENVOYE":return"assets/etiquette/Etiquette-Sy-XPERTPRO-orange.png";case"VALIDE":return"assets/etiquette/Etiquette-Sy-XPERTPRO-Vert.png";case"ANNULE":return"assets/etiquette/Etiquette-Sy-XPERTPRO-rouge.png"}}getStatutClass(e){switch(e){case"BROUILLON":default:return"etat-gris";case"APPROUVE":return"etat-bleu";case"ENVOYE":return"etat-orange";case"VALIDE":return"etat-vert";case"ANNULE":return"etat-rouge"}}verifierAcces(){this.moduleService.getModulesEntreprise().subscribe({next:e=>{const o=e.find(n=>"GESTION_FACTURATION"===n.code);o?.actif?(this.accesAutorise=!0,this.tempsRestantEssai=o.tempsRestantEssai||null):(this.accesAutorise=!1,this.messageErreur=o?.tempsRestantEssai?"Votre p\xe9riode d'essai est termin\xe9e.":"Ce module est inactif."),this.chargementFini=!0},error:e=>{this.accesAutorise=!1,this.messageErreur="Erreur lors de la v\xe9rification d'acc\xe8s.",this.chargementFini=!0}})}onSearchChange(){this.currentPage=0}redirigerAccueil(){this.router.navigate(["/"])}calculateFactureCounts(){this.factureCounts={},this.totalAllFactures=this.facturesproforma.length,this.facturesproforma.forEach(e=>{const o=e.statut;o&&(this.factureCounts[o]=(this.factureCounts[o]||0)+1)})}static{this.\u0275fac=function(o){return new(o||r)(t.rXU(x.Ix),t.rXU(k.X),t.rXU(u.c),t.rXU(m.D),t.rXU(s.g),t.rXU(i.A),t.rXU(x.nX))}}static{this.\u0275cmp=t.VBU({type:r,selectors:[["app-facture-proforma"]],decls:3,vars:1,consts:[["accesRefuse",""],["noLines",""],["class","containerTable",4,"ngIf"],[1,"containerTable"],[1,"tasks-header"],[1,"title"],[1,"actions"],[1,"add-task",3,"click"],[1,"contentIcon"],[1,"bare"],["clickOutside","",1,"contentIcon",3,"click","clickOutside"],["class","view-dropdown",4,"ngIf"],[1,"inputSearch"],["type","text","placeholder","Recherche...",3,"ngModelChange","ngModel"],[3,"click","ngClass"],["class","access-overlay",4,"ngIf"],[1,"container_list_boutique"],[1,"content_list_boutique"],[1,"name_boutique"],[1,"all_boutique",3,"click"],[1,"all_boutique",2,"display","flex","align-items","center"],["class","facture-count",4,"ngIf"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","parent",4,"ngIf"],[1,"pagination"],[3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],["class","no-client-message",4,"ngIf"],[1,"view-dropdown"],[1,"dropdown-item",3,"click"],[1,"access-overlay"],[1,"access-card"],["aria-hidden","true",1,"icon-container"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg","width","48","height","48"],["d","M18 6L6 18","stroke","white","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],["d","M6 6L18 18","stroke","white","stroke-width","2.5","stroke-linecap","round","stroke-linejoin","round"],[1,"description"],[1,"message-principal"],[1,"dashboard-button",3,"click"],[1,"facture-count"],[1,"statut-option",3,"click"],[2,"display","flex","align-items","center"],["class","barre",4,"ngIf"],[1,"barre"],[1,"tr"],[1,"th",3,"click"],[1,"th"],["class","tr",3,"click",4,"ngFor","ngForOf"],[1,"tr",3,"click"],[1,"td"],[3,"ngClass"],[1,"parent"],["class","cadre_cahier",3,"click",4,"ngFor","ngForOf"],[1,"cadre_cahier",3,"click"],[1,"title_facture"],[1,"information_cadre"],[1,"num_facture"],[1,"double_info"],[1,"left_name"],[1,"right_name"],[1,"right_name","date_name",2,"font-size","11px"],[4,"ngIf","ngIfElse"],[1,"image_etiquette"],["alt","Etiquette",3,"src"],[1,"etat",3,"ngClass"],[1,"tilte_etat"],[1,"double_info1"],["class","facture_trois",4,"ngIf"],[1,"tb_total"],[1,"facture_trois"],["colspan","3",1,"text-center"],[3,"page","length","pageSize","pageSizeOptions"],[1,"no-client-message"],["class","alert alert-warning",4,"ngIf"],[1,"alert","alert-warning"]],template:function(o,n){1&o&&t.DNE(0,U,32,14,"div",2)(1,z,1,1,"ng-template",null,0,t.C5r),2&o&&t.Y8G("ngIf",n.chargementFini)},dependencies:[l.MD,l.YU,l.Sq,l.bT,l.vh,_.YN,_.me,_.BC,_.vS,_.X1,O.v,b.fS,E.Ou,E.iy],styles:['@charset "UTF-8";.title_return[_ngcontent-%COMP%]{display:flex;align-items:center}.title[_ngcontent-%COMP%]{font-size:18px;margin:0 0 0 10px}tr.tr[_ngcontent-%COMP%]{font-size:18px}th[_ngcontent-%COMP%]{border-bottom:1px solid rgba(221,221,221,.5803921569);padding:8px}th.th[_ngcontent-%COMP%]{border-bottom:1px solid rgba(221,221,221,.5803921569);padding:10px}td[_ngcontent-%COMP%]{padding:15px 8px;border-bottom:1px solid rgba(221,221,221,.5803921569)}th[_ngcontent-%COMP%]{background-color:#f2f2f2}.containerTable[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:10px}.tasks-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:30px}.contentIcon[_ngcontent-%COMP%]{margin:0 10px;display:flex;align-items:center}.contentIcon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px;cursor:pointer}.contentIcon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:hover{color:#0672e4;transition:all .5s ease}.bare[_ngcontent-%COMP%]{width:2px;height:30px;background-color:#eee}.content_sort[_ngcontent-%COMP%]{display:flex;align-items:center}.btn_add_ligne[_ngcontent-%COMP%]{background-color:#e6f2ff;border:1px solid #007bff;padding:5px 10px;cursor:pointer;margin-top:10px;border-radius:5px}.btn_remove[_ngcontent-%COMP%]{background-color:transparent;border:none;cursor:pointer;font-size:20px;color:red}.content_cadre_double[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.imgClient[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:#f5f5f5;box-shadow:0 4px 6px #0000001a;cursor:pointer}.imgClient[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80%;height:80%;object-fit:cover;border-radius:50%;transition:transform .2s}.imgClient[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.1)}.imgClient_grid[_ngcontent-%COMP%]{width:90px;height:90px;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 6px #0000001a;cursor:pointer;border:none}.imgClient_grid[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:90%;height:90%;object-fit:cover;border-radius:50%;transition:transform .2s}.imgClient_grid[_ngcontent-%COMP%]:hover   img[_ngcontent-%COMP%]{transform:scale(1.1)}.title[_ngcontent-%COMP%]{font-size:18px;margin:0}.tasks-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}.add-task[_ngcontent-%COMP%]{padding:10px 30px;background-color:#0672e4;color:#fff;border-radius:5px;border:none}.inputSearch[_ngcontent-%COMP%]{position:relative;width:250px;height:40px;display:flex;align-items:center}.inputSearch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:100%;padding-left:10px;border-radius:5px}.inputSearch[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;right:0;margin-right:15px;font-size:17px}.contentIcon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:17px;cursor:pointer;position:relative}.actions[_ngcontent-%COMP%]{display:flex;align-items:center}.actions[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#000}.titleTableProduit[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:12px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}tr[_ngcontent-%COMP%]{font-size:13px}td[_ngcontent-%COMP%]{padding:18px 8px;border-bottom:1px solid rgba(221,221,221,.5803921569)}th[_ngcontent-%COMP%]{background-color:#f2f2f2;border-bottom:1px solid rgba(221,221,221,.5803921569);padding:12px 8px}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f9f9f9}tr[_ngcontent-%COMP%]:hover{background-color:#ddd}.facture_trois[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:4px 8px}.contentIcon[_ngcontent-%COMP%]{position:relative;cursor:pointer}.view-dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;background:#fff;border:1px solid #ddd;border-radius:4px;box-shadow:0 2px 5px #0000001a;z-index:100;min-width:150px}.dropdown-item[_ngcontent-%COMP%]{padding:8px 12px;font-size:14px;cursor:pointer}.dropdown-item[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.container_list_boutique[_ngcontent-%COMP%]{scrollbar-width:auto;overflow:auto;scrollbar-color:#888 #f1f1f1;scrollbar-width:thin}.container_list_boutique[_ngcontent-%COMP%]::-webkit-scrollbar{width:2px;height:3px}.container_list_boutique[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}.container_list_boutique[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#00f;border-radius:4px}.container_list_boutique[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:red}.name_boutique[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;cursor:pointer;margin:30px 0 20px}.name_boutique[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding:8px 15px}.name_boutique_active[_ngcontent-%COMP%]{background-color:#e9d421;border-radius:5px;color:#000}.barre[_ngcontent-%COMP%]{height:25px;width:1px;background-color:#0000003f;margin:8px 0}.name_boutique[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{cursor:pointer;padding:4px 16px;margin:4px 0;transition:all .3s ease;font-weight:500;border-radius:4px}.name_boutique[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:hover{background-color:#0000000d}.name_boutique[_ngcontent-%COMP%]   p.name_boutique_active[_ngcontent-%COMP%]{background-color:#e9d421;color:#000!important}.etat-gris[_ngcontent-%COMP%]{color:gray}.etat-bleu[_ngcontent-%COMP%]{color:#0671e4}.etat-orange[_ngcontent-%COMP%]{color:#f90}.etat-vert[_ngcontent-%COMP%]{color:green}.etat-rouge[_ngcontent-%COMP%]{color:red}.td[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;text-transform:uppercase;font-size:.9em}mat-paginator[_ngcontent-%COMP%]{background-color:#fff;border-radius:5px}.no-phone-text[_ngcontent-%COMP%]{color:#c3c3c3;font-style:italic}.info_cadre[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#000}.popup-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:16px}.cadreChoix[_ngcontent-%COMP%]{background-color:#0672e4;box-shadow:0 6px 12px #0000001a;padding:10px;border-radius:5px;cursor:pointer;color:#fff}.sizeBox[_ngcontent-%COMP%]{margin:10px 0}.statut[_ngcontent-%COMP%]{font-size:10px;margin-left:auto;font-weight:700;color:#6c757d}.parent[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px}.cadre_cahier[_ngcontent-%COMP%]{background:#fff;border-radius:5px;padding:10px;box-shadow:0 4px 6px #0000000d;transition:transform .2s ease;border:1px solid #e0e0e0;height:287px;position:relative;cursor:pointer}.cadre_cahier[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 6px 12px #0000001a}.information_cadre[_ngcontent-%COMP%]{margin-top:-5px}.title_facture[_ngcontent-%COMP%]{text-align:center;margin-top:2px}.num_facture[_ngcontent-%COMP%], .double_info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:10px}.left_name[_ngcontent-%COMP%]{font-weight:500}.title_facture[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.65px}.num_facture[_ngcontent-%COMP%]{margin:20px 0 10px}.num_facture[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#0672e4}.double_info[_ngcontent-%COMP%]{margin-bottom:10px;display:flex;align-items:center;gap:5px}.double_info1[_ngcontent-%COMP%]{align-items:center;gap:5px;font-size:6px;margin-top:2%;color:#6c757d;text-align:end;display:block}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;opacity:.7}th[_ngcontent-%COMP%]{background-color:#f5f5f5}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border-bottom:1px solid rgba(221,221,221,.5803921569);padding:8px;font-size:8px}th.th[_ngcontent-%COMP%], td.td[_ngcontent-%COMP%]{border-bottom:1px solid rgba(221,221,221,.5803921569);padding:20px;font-size:11px}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#fff}tr[_ngcontent-%COMP%]:hover{background-color:#fefefe}tr.tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#f9f9f9}tr.tr[_ngcontent-%COMP%]:hover{background-color:#ddd}.tb_total[_ngcontent-%COMP%]{text-align:right}.image_etiquette[_ngcontent-%COMP%]{width:147px;height:108px;overflow:hidden;display:flex;align-items:center;justify-content:center;cursor:pointer;position:absolute;left:-24px;transform:rotate(-19deg);bottom:-23px}.image_etiquette[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:90%;height:90%;object-fit:cover;transition:transform .2s}.etat[_ngcontent-%COMP%]{position:absolute;transform:rotate(12deg);top:45px;left:58px}.etat[_ngcontent-%COMP%]{font-size:10px}.etat[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:10px}.etat[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{text-transform:lowercase!important;font-size:12px;letter-spacing:.5px;font-weight:500}.tilte_etat[_ngcontent-%COMP%]{position:relative;top:3px;color:#ffffff89!important}.etat-gris[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#000}.etat-gris[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#0000007b!important}.etat-orange[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .etat-orange[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .etat-bleu[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .etat-bleu[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .etat-vert[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .etat-vert[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .etat-rouge[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .etat-rouge[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:right;margin-top:20px}.no-client-message[_ngcontent-%COMP%]{text-align:center;padding:40px;font-size:13px;color:#666;background-color:#f8f9fa;border-radius:8px;margin:20px;box-shadow:0 2px 4px #0000001a}.access-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);display:flex;justify-content:center;align-items:center;z-index:10;pointer-events:all}.access-card[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#fff;border-radius:16px;padding:24px;box-shadow:0 12px 20px #0000001a;max-width:300px;width:90%;display:flex;flex-direction:column;align-items:center;text-align:center;box-sizing:border-box}.icon-container[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#ef4444;border-radius:50%;display:flex;justify-content:center;align-items:center;margin-bottom:16px}.icon-container[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:24px;height:24px}.access-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:16px;font-weight:700;color:#1f2937;margin:0 0 10px;font-family:Poppins,sans-serif}.access-card[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{line-height:1.4;margin-bottom:24px;font-family:Poppins,sans-serif;font-size:11px}.access-card[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 6px;font-size:11px;font-family:Poppins,sans-serif}.dashboard-button[_ngcontent-%COMP%]{background-color:#0d6efd;color:#fff;border:none;border-radius:8px;padding:12px;font-size:14px;font-weight:500;cursor:pointer;width:100%;transition:background-color .2s ease-in-out}.dashboard-button[_ngcontent-%COMP%]:hover{background-color:#edcc3a}.facture-count[_ngcontent-%COMP%]{background-color:#ddd;color:#000;border-radius:50%;font-size:10px;min-width:18px;height:18px;display:flex;justify-content:center;align-items:center;padding:2px;margin-left:10px}.draggable-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;align-items:center}']})}}return r})()}}]);
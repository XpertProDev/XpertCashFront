"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[505],{505:(B,u,s)=>{s.r(u),s.d(u,{PosAccueilComponent:()=>I});var d=s(177),m=s(9417),p=s(9192),_=s(724),g=s(2525),e=s(4438),h=s(145),f=s(8026),C=s(4864),P=s(7022),b=s(7788),v=s(2719);function O(i,a){if(1&i){const n=e.RV6();e.j41(0,"li",26),e.bIt("click",function(){const t=e.eBV(n).$implicit,c=e.XpG();return e.Njj(c.setActiveCommande(t))}),e.EFF(1),e.k0s()}if(2&i){const n=a.$implicit,o=e.XpG();e.AVh("list_commande_active",o.activeCommande===n),e.R7$(),e.SpI(" ",n," ")}}function M(i,a){if(1&i){const n=e.RV6();e.j41(0,"li",27),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.showCommandePopup=!0)}),e.nrm(1,"i",28),e.k0s()}}function x(i,a){if(1&i){const n=e.RV6();e.j41(0,"li",26),e.bIt("click",function(){const t=e.eBV(n).$implicit,c=e.XpG(2);return e.Njj(c.setActiveCommande(t))}),e.EFF(1),e.k0s()}if(2&i){const n=a.$implicit,o=e.XpG(2);e.AVh("active",o.activeCommande===n),e.R7$(),e.SpI(" ",n," ")}}function k(i,a){if(1&i){const n=e.RV6();e.j41(0,"div",29),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.showCommandePopup=!1)}),e.j41(1,"div",30),e.bIt("click",function(t){return e.eBV(n),e.Njj(t.stopPropagation())}),e.j41(2,"div",31)(3,"h3"),e.EFF(4,"Liste des commandes"),e.k0s(),e.j41(5,"i",32),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.showCommandePopup=!1)}),e.k0s()(),e.j41(6,"div",33)(7,"ul",34),e.DNE(8,x,2,3,"li",35),e.k0s()()()()}if(2&i){const n=e.XpG();e.R7$(8),e.Y8G("ngForOf",n.commandes)}}function w(i,a){if(1&i){const n=e.RV6();e.j41(0,"div",36)(1,"div",37),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.toggleView("grid"))}),e.EFF(2),e.nI1(3,"async"),e.k0s(),e.j41(4,"div",37),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.toggleView("list"))}),e.EFF(5),e.nI1(6,"async"),e.k0s()()}if(2&i){const n=e.XpG();e.R7$(2),e.SpI(" Cadre ",e.bMT(3,2,n.isListView$)?"\u2713":""," "),e.R7$(3),e.SpI(" Liste ",e.bMT(6,4,n.isListView$)?"":"\u2713"," ")}}function E(i,a){if(1&i){const n=e.RV6();e.j41(0,"div",38)(1,"div",39),e.nrm(2,"i",40),e.EFF(3," Installer l'application "),e.k0s(),e.j41(4,"div",39),e.nrm(5,"i",41),e.EFF(6," Recharger les donnees "),e.k0s(),e.j41(7,"div",37),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.onLogout())}),e.nrm(8,"i",42),e.EFF(9," Fermer la caisse "),e.k0s()()}}let I=(()=>{class i{constructor(n,o,t,c,r,y,S){this.router=n,this.viewState=o,this.userService=t,this.posCaisseService=c,this.commandeState=r,this.boutiqueState=y,this.boutiqueService=S,this.apiUrl=g.c.imgUrl,this.showDropdown=!1,this.activeButton="vente",this.showMenuDropdown=!1,this.userName="",this.nomEntreprise="",this.photo=null,this.photoUrl=null,this.commandes=["001"],this.activeCommande="001",this.showCommandePopup=!1,this.selectedBoutiqueId=null,this.selectedBoutiqueName="Ma boutique name",this.boutiques=[],this.boutiquesLoaded=!1,this.isListView$=this.viewState.isListView$,this.commandes=this.commandeState.getAllCommandesIds(),this.commandeState.commandeUpdated$.subscribe(()=>{this.commandes=this.commandeState.getAllCommandesIds()}),this.commandeState.activeCommandeId$.subscribe(l=>{this.activeCommande=l}),this.commandeSubscription=this.commandeState.activeCommandeId$.subscribe(l=>{this.activeCommande=l})}ngOnInit(){this.activeButton=this.router.url.includes("/commandes")?"commande":"vente",this.getUserInfo(),this.loadBoutiques(),this.boutiqueService.getBoutiquesByEntreprise().subscribe({next:t=>{this.boutiques=t||[],this.boutiquesLoaded=!0,null!==this.selectedBoutiqueId&&this.updateBoutiqueName(this.selectedBoutiqueId)},error:t=>console.error("Erreur chargement boutiques",t)}),this.boutiqueSub=this.boutiqueState.selectedBoutique$.subscribe(t=>{this.selectedBoutiqueId=t,null===t?this.selectedBoutiqueName="S\xe9lectionnez une boutique":this.updateBoutiqueName(t)});const o=this.router.getCurrentNavigation()?.extras?.state;o?.caisse?.boutiqueId&&this.boutiqueState.setSelectedBoutique(o.caisse.boutiqueId)}loadBoutiques(){this.boutiqueService.getBoutiquesByEntreprise().subscribe({next:n=>{this.boutiques=n||[],this.boutiquesLoaded=!0;const o=this.boutiqueState.getCurrentValue();o&&this.updateBoutiqueName(o)},error:n=>console.error("Erreur chargement boutiques",n)})}updateBoutiqueName(n){const o=this.boutiques.find(t=>t.id===n);o?this.selectedBoutiqueName=o.nomBoutique:this.boutiqueService.getBoutiqueById(n).subscribe({next:t=>this.selectedBoutiqueName=t.nomBoutique,error:()=>this.selectedBoutiqueName="Boutique inconnue"})}ngOnDestroy(){this.boutiqueSub?.unsubscribe()}toggleView(n){this.viewState.setViewPreference("grid"===n),this.showDropdown=!0}onClickCommandes(){this.activeButton="commande",this.router.navigate(["/pos-accueil/commandes"])}onClickVente(){this.activeButton="vente",this.router.navigate(["/pos-accueil"])}toggleMenuDropdown(){this.showMenuDropdown=!this.showMenuDropdown}addCommande(){const n=this.commandeState.addNewCommande();this.commandes=this.commandeState.getAllCommandesIds(),this.setActiveCommande(n),this.showCommandePopup=!1}setActiveCommande(n){this.commandeState.setActiveCommande(n),this.activeCommande=n,this.showCommandePopup=!1}get visibleCommandes(){const n=Math.max(0,this.commandes.length-6);return this.commandes.slice(n)}get hiddenCommandes(){return this.commandes.length>6?this.commandes.slice(0,this.commandes.length-6):[]}getUserInfo(){this.userService.getUserInfo().subscribe({next:n=>{this.userName=n.nomComplet.charAt(0).toUpperCase(),this.nomEntreprise=n.nomEntreprise},error:n=>{console.error("Erreur lors de la r\xe9cup\xe9ration des infos utilisateur :",n)}})}onLogout(){console.log("D\xe9but de la proc\xe9dure de d\xe9connexion...");const n=this.boutiqueState.getCurrentValue();if(!n)return console.error("Aucune boutique active d\xe9tect\xe9e."),void this.router.navigate(["/analytics"]);this.userService.getUserInfo().subscribe({next:o=>{console.log("Utilisateur r\xe9cup\xe9r\xe9:",o);const t=o.permissions;1===t.length&&t.includes("VENDRE_PRODUITS")?(console.log('L\'utilisateur a uniquement la permission "VENDRE_PRODUITS". Tentative de fermeture de la caisse...'),this.posCaisseService.fermerCaisse(n).subscribe({next:c=>{console.log("Caisse ferm\xe9e avec succ\xe8s:",c),this.userService.logoutUser(),console.log("D\xe9connexion de l'utilisateur..."),this.router.navigate(["/connexion"]).then(r=>{console.log("D\xe9connexion r\xe9ussie ?",r)})},error:c=>{console.error("Erreur lors de la fermeture de la caisse:",c.message),this.router.navigate(["/analytics"]).then(r=>{console.log("Navigation vers analytics r\xe9ussie ?",r)})}})):(console.log("L'utilisateur n'a pas uniquement la permission \"VENDRE_PRODUITS\", fermeture de la caisse et redirection vers analytics..."),this.posCaisseService.fermerCaisse(n).subscribe({next:c=>{console.log("Caisse ferm\xe9e avec succ\xe8s:",c),this.router.navigate(["/analytics"]).then(r=>{console.log("Navigation vers analytics r\xe9ussie ?",r)})},error:c=>{console.error("Erreur lors de la fermeture de la caisse:",c.message),this.router.navigate(["/analytics"]).then(r=>{console.log("Navigation vers analytics r\xe9ussie ?",r)})}}))},error:o=>{console.error("Erreur lors de la r\xe9cup\xe9ration des informations utilisateur:",o),this.router.navigate(["/analytics"])}})}static{this.\u0275fac=function(o){return new(o||i)(e.rXU(p.Ix),e.rXU(h.C),e.rXU(f.g),e.rXU(C.U),e.rXU(P.f),e.rXU(b.j),e.rXU(v.c))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-pos-accueil"]],decls:36,vars:15,consts:[[1,"pos_container"],[1,"pos_content"],[1,"pos_header"],[1,"navBar"],[1,"header_left"],[1,"btn_vente_pos",3,"click"],[1,"btn","btn_default"],[1,"btn_commande_pos",3,"click"],[1,"btn_add_commande"],[1,"btn",3,"click"],[1,"ri-add-line"],[1,"list_commande"],[3,"list_commande_active","click",4,"ngFor","ngForOf"],["class","list_commande_plus",3,"click",4,"ngIf"],["class","commande-popup-overlay",3,"click",4,"ngIf"],[1,"header_right"],[1,"name_boutique"],[1,"inputSearch"],[1,"ri-search-2-line"],["type","text","placeholder","Recherche des produits"],["clickOutside","",1,"icon_sort",3,"click","clickOutside"],["class","view-dropdown",4,"ngIf"],[1,"profil"],["clickOutside","",1,"menu",3,"click","clickOutside"],[1,"ri-menu-line"],["class","menu-dropdown",4,"ngIf"],[3,"click"],[1,"list_commande_plus",3,"click"],[1,"ri-arrow-down-s-line"],[1,"commande-popup-overlay",3,"click"],[1,"commande-popup-content",3,"click"],[1,"popup-header"],[1,"ri-close-line",3,"click"],[1,"popup-commandes"],[1,"list_commande","commandes-grid"],[3,"active","click",4,"ngFor","ngForOf"],[1,"view-dropdown"],[1,"dropdown-item",3,"click"],[1,"menu-dropdown"],[1,"dropdown-item"],[1,"ri-download-line"],[1,"ri-restart-line"],[1,"ri-money-euro-circle-line"]],template:function(o,t){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"nav",3)(4,"div",4)(5,"div",5),e.bIt("click",function(){return t.onClickVente()}),e.j41(6,"button",6),e.EFF(7," Ventes POS "),e.k0s()(),e.j41(8,"div",7),e.bIt("click",function(){return t.onClickCommandes()}),e.j41(9,"button",6),e.EFF(10," Commandes "),e.k0s()(),e.j41(11,"div",8)(12,"button",9),e.bIt("click",function(){return t.addCommande()}),e.nrm(13,"i",10),e.k0s()(),e.j41(14,"ul",11),e.DNE(15,O,2,3,"li",12)(16,M,2,0,"li",13),e.k0s(),e.DNE(17,k,9,1,"div",14),e.k0s(),e.j41(18,"div",15)(19,"div",16)(20,"p"),e.EFF(21),e.k0s()(),e.j41(22,"div",17),e.nrm(23,"i",18)(24,"input",19),e.k0s(),e.j41(25,"div",20),e.bIt("click",function(){return t.showDropdown=!t.showDropdown})("clickOutside",function(){return t.showDropdown=!1}),e.nrm(26,"i"),e.nI1(27,"async"),e.DNE(28,w,7,6,"div",21),e.k0s(),e.j41(29,"div",22)(30,"span"),e.EFF(31),e.k0s()(),e.j41(32,"div",23),e.bIt("click",function(){return t.toggleMenuDropdown()})("clickOutside",function(){return t.showMenuDropdown=!1}),e.nrm(33,"i",24),e.DNE(34,E,10,0,"div",25),e.k0s()()()(),e.nrm(35,"router-outlet"),e.k0s()()),2&o&&(e.R7$(6),e.AVh("btn_active","vente"===t.activeButton),e.R7$(3),e.AVh("btn_active","commande"===t.activeButton),e.R7$(6),e.Y8G("ngForOf",t.visibleCommandes),e.R7$(),e.Y8G("ngIf",t.commandes.length>6),e.R7$(),e.Y8G("ngIf",t.showCommandePopup),e.R7$(4),e.JRh(t.selectedBoutiqueName),e.R7$(5),e.HbH(e.bMT(27,13,t.isListView$)?"ri-apps-fill":"ri-list-check"),e.R7$(2),e.Y8G("ngIf",t.showDropdown),e.R7$(3),e.JRh(t.userName),e.R7$(3),e.Y8G("ngIf",t.showMenuDropdown))},dependencies:[m.YN,d.MD,d.Sq,d.bT,d.Jj,p.iI,p.n3,_.z],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:flex;flex-direction:column;position:fixed;inset:0;overflow:hidden}.pos_container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}ul[_ngcontent-%COMP%]{list-style-type:none;padding:0}.pos_content[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-height:0}.pos_header[_ngcontent-%COMP%]{flex:0 0 auto}.view-dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;background:#fff;border:1px solid #ddd;border-radius:4px;box-shadow:0 2px 5px #0000001a;z-index:100;min-width:150px}.dropdown-item[_ngcontent-%COMP%]{padding:8px 12px;font-size:14px;cursor:pointer}.dropdown-item[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.navBar[_ngcontent-%COMP%]{width:100%;height:60px;display:flex;align-items:center;justify-content:space-between;background-color:#fff;border-bottom:1px solid #ddd;box-shadow:#2123261a 0 10px 10px -10px;padding:0 15px}.header_left[_ngcontent-%COMP%], .header_right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.header_right[_ngcontent-%COMP%]{gap:20px}.btn_vente_pos[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%], .btn_commande_pos[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{gap:10px}.btn_default[_ngcontent-%COMP%]{background-color:#f4f4f4}.btn_default[_ngcontent-%COMP%]:focus{background-color:#f4f4f4}.btn[_ngcontent-%COMP%]{border:none;padding:8px 16px;border-radius:4px;cursor:pointer;transition:background-color .3s}.btn.btn_active[_ngcontent-%COMP%]{background-color:#cde3fa;color:#1a73e8}.btn_add_commande[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{background-color:#f4f4f4;padding:4px 13px}.btn_add_commande[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:17px}li.list_commande_active[_ngcontent-%COMP%]{background-color:#cde3fa!important}ul.list_commande[_ngcontent-%COMP%]{list-style-type:none;display:flex;align-items:center;gap:10px;margin:0;padding:0}ul.list_commande[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{background-color:#f4f4f4;padding:7px 13px;border-radius:5px;cursor:pointer}ul.list_commande[_ngcontent-%COMP%]   li.list_commande_plus[_ngcontent-%COMP%]{padding:5px}.name_boutique[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.inputSearch[_ngcontent-%COMP%]{position:relative;width:250px;height:35px;display:flex;align-items:center}.inputSearch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;height:100%;padding-left:10px;border-radius:5px;border:1px solid #000;font-size:13px}.inputSearch[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;right:0;margin-right:15px;font-size:17px}.icon_sort[_ngcontent-%COMP%]{position:relative;background-color:#f4f4f4;padding:5px 11px;border-radius:5px;cursor:pointer}.icon_sort[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:17px}.profil[_ngcontent-%COMP%]{background-color:#0672e4;padding:0 12px;border-radius:4px;cursor:pointer}.profil[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;color:#fff}.menu[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:17px;cursor:pointer}.menu[_ngcontent-%COMP%]{position:relative;cursor:pointer}.menu[_ngcontent-%COMP%]   .menu-dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;background:#fff;border:1px solid #e1e1e1;border-radius:4px;box-shadow:0 4px 12px #0000001a;z-index:1000;min-width:200px;margin-top:8px;overflow:hidden}.menu[_ngcontent-%COMP%]   .menu-dropdown[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]{padding:10px 16px;display:flex;align-items:center;gap:12px;font-size:12px;color:#333;transition:all .2s;cursor:pointer}.menu[_ngcontent-%COMP%]   .menu-dropdown[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]:hover{background:#f5f7fa}.menu[_ngcontent-%COMP%]   .menu-dropdown[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px;color:#64748b}.commande-popup[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:300px;background:#fff;border:1px solid #e0e0e0;border-radius:8px;box-shadow:0 4px 12px #0000001a;z-index:1000;margin-top:8px}.commande-popup[_ngcontent-%COMP%]   .popup-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid #f0f0f0}.commande-popup[_ngcontent-%COMP%]   .popup-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:600}.commande-popup[_ngcontent-%COMP%]   .popup-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{cursor:pointer;font-size:20px;color:#666}.commande-popup[_ngcontent-%COMP%]   .popup-commandes[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;max-height:300px;overflow-y:auto}.commande-popup[_ngcontent-%COMP%]   .popup-commandes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;cursor:pointer;border-bottom:1px solid #f8f8f8;transition:background .2s}.commande-popup[_ngcontent-%COMP%]   .popup-commandes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background:#f4f4f4}.commande-popup[_ngcontent-%COMP%]   .popup-commandes[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{background:#e6f4ff;color:#1890ff}.commande-popup[_ngcontent-%COMP%]   .popup-commandes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#999}.commande-popup-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:10000}.commande-popup-content[_ngcontent-%COMP%]{background:#fff;border-radius:12px;width:90%;max-width:800px;max-height:40vh;overflow-y:auto;box-shadow:0 10px 30px #0000004d;animation:_ngcontent-%COMP%_popup-appear .3s ease-out}.commande-popup-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px;height:4px}.commande-popup-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#0003;border-radius:3px}.commande-popup-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}@keyframes _ngcontent-%COMP%_popup-appear{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.popup-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:5px 20px;border-bottom:1px solid #eee;position:sticky;top:0;background:#fff;z-index:10}.popup-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:600;color:#333}.popup-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;cursor:pointer;color:#666;transition:color .2s}.popup-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:hover{color:red}.popup-commandes[_ngcontent-%COMP%]{padding:15px}.popup-commandes[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.popup-commandes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:12px 15px;border-radius:6px;margin-bottom:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:all .2s;border:1px solid #f0f0f0}.popup-commandes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#f8f9fa;border-color:#e0e0e0}.popup-commandes[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{background-color:#e6f4ff;border-color:#91caff;color:#1890ff;font-weight:500}.popup-commandes[_ngcontent-%COMP%]   .commandes-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(65px,1fr));gap:10px;padding:0;margin:0;list-style:none}.popup-commandes[_ngcontent-%COMP%]   .commandes-grid[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:10px 15px;background-color:#f8f8f8;border:1px solid #e0e0e0;border-radius:6px;cursor:pointer;transition:all .2s;text-align:center;margin-bottom:0!important;display:flex;align-items:center;justify-content:center}.popup-commandes[_ngcontent-%COMP%]   .commandes-grid[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#e9e9e9}.popup-commandes[_ngcontent-%COMP%]   .commandes-grid[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{background-color:#cde3fa;border-color:#a0c5f0;color:#1a73e8;font-weight:700}']})}}return i})()}}]);
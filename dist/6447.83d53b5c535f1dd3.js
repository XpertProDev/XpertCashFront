"use strict";(self.webpackChunkskeleton=self.webpackChunkskeleton||[]).push([[6447],{46447:(O,P,l)=>{l.r(P),l.d(P,{PosPaiementComponent:()=>I});var m=l(60177),c=l(89417),g=l(22525),e=l(54438),d=l(49192),v=l(44413),y=l(92120);const E=["receipt"];function M(s,u){1&s&&(e.j41(0,"div",31)(1,"div",32),e.EFF(2,"\u2714\ufe0e"),e.k0s(),e.j41(3,"div",33),e.EFF(4,"Paiement r\xe9ussi"),e.k0s()())}function x(s,u){if(1&s&&(e.j41(0,"div",34)(1,"div",35),e.EFF(2),e.nI1(3,"currency"),e.k0s(),e.j41(4,"div",36),e.EFF(5),e.k0s()()),2&s){const n=e.XpG();e.R7$(2),e.JRh(e.ii3(3,2,n.vente.montantTotal,"CFA ","symbol","1.0-0")),e.R7$(3),e.SpI("/ ",n.paymentMethod,"")}}function h(s,u){if(1&s&&(e.j41(0,"li",37)(1,"span",38),e.EFF(2),e.k0s(),e.j41(3,"div",39)(4,"div",40),e.EFF(5),e.k0s(),e.j41(6,"div",41),e.EFF(7),e.nI1(8,"currency"),e.k0s()(),e.j41(9,"span",42),e.EFF(10),e.nI1(11,"currency"),e.k0s()()),2&s){const n=u.$implicit;e.R7$(2),e.JRh(n.quantite),e.R7$(3),e.JRh(n.nomProduit),e.R7$(2),e.SpI("",e.ii3(8,4,n.prixUnitaire,"CFA ","symbol","1.0-0")," / Unit\xe9(s)"),e.R7$(3),e.JRh(e.ii3(11,9,n.montantLigne,"CFA ","symbol","1.0-0"))}}function k(s,u){1&s&&(e.j41(0,"li",43),e.EFF(1,"Aucun produit trouv\xe9"),e.k0s())}function i(s,u){if(1&s&&(e.j41(0,"div",24)(1,"span"),e.EFF(2,"Monnaie"),e.k0s(),e.j41(3,"span",25),e.EFF(4),e.nI1(5,"currency"),e.k0s()()),2&s){const n=e.XpG();e.R7$(4),e.JRh(e.ii3(5,1,n.changeDue,"CFA ","symbol","1.0-0"))}}function r(s,u){if(1&s&&(e.j41(0,"div",24)(1,"span"),e.EFF(2,"Reste \xe0 payer"),e.k0s(),e.j41(3,"span",25),e.EFF(4),e.nI1(5,"currency"),e.k0s()()),2&s){const n=e.XpG();e.R7$(4),e.JRh(e.ii3(5,1,n.changeDue,"CFA ","symbol","1.0-0"))}}function a(s,u){1&s&&(e.j41(0,"div",44),e.EFF(1,"Chargement du re\xe7u..."),e.k0s())}function _(s,u){if(1&s&&(e.j41(0,"div",47)(1,"label"),e.EFF(2),e.nI1(3,"currency"),e.k0s()()),2&s){let n;const o=e.XpG(2);e.R7$(2),e.SpI("Monnaie \xe0 rendre: ",e.ii3(3,1,o.tempPaymentAmount-(null!==(n=null==o.vente?null:o.vente.montantTotal)&&void 0!==n?n:0),"CFA ","symbol","1.0-0"),"")}}function j(s,u){if(1&s&&(e.j41(0,"div",47)(1,"label"),e.EFF(2),e.nI1(3,"currency"),e.k0s()()),2&s){let n;const o=e.XpG(2);e.R7$(2),e.SpI("Reste \xe0 payer: ",e.ii3(3,1,(null!==(n=null==o.vente?null:o.vente.montantTotal)&&void 0!==n?n:0)-o.tempPaymentAmount,"CFA ","symbol","1.0-0"),"")}}function T(s,u){if(1&s){const n=e.RV6();e.j41(0,"div",45)(1,"div",46)(2,"h5"),e.EFF(3,"Modifier le re\xe7u"),e.k0s(),e.j41(4,"div",47)(5,"label"),e.EFF(6),e.nI1(7,"currency"),e.k0s()(),e.j41(8,"div",47)(9,"label"),e.EFF(10,"Montant pay\xe9"),e.k0s(),e.j41(11,"input",48),e.mxI("ngModelChange",function(t){e.eBV(n);const p=e.XpG();return e.DH7(p.tempPaymentAmount,t)||(p.tempPaymentAmount=t),e.Njj(t)}),e.bIt("input",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.calculateChange())}),e.k0s()(),e.j41(12,"div",47)(13,"label"),e.EFF(14,"Mode de paiement"),e.k0s(),e.j41(15,"select",49),e.mxI("ngModelChange",function(t){e.eBV(n);const p=e.XpG();return e.DH7(p.tempPaymentMethod,t)||(p.tempPaymentMethod=t),e.Njj(t)}),e.j41(16,"option",50),e.EFF(17,"Esp\xe8ces"),e.k0s(),e.j41(18,"option",51),e.EFF(19,"Carte"),e.k0s(),e.j41(20,"option",52),e.EFF(21,"Virement"),e.k0s(),e.j41(22,"option",53),e.EFF(23,"Mobile Money"),e.k0s()()(),e.DNE(24,_,4,6,"div",54)(25,j,4,6,"div",54),e.j41(26,"div",55)(27,"button",8),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.cancelModify())}),e.EFF(28,"Annuler"),e.k0s(),e.j41(29,"button",13),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.updatePayment())}),e.EFF(30,"Valider et Imprimer"),e.k0s()()()()}if(2&s){let n,o;const t=e.XpG();e.R7$(6),e.SpI("Montant total: ",e.ii3(7,5,null==t.vente?null:t.vente.montantTotal,"CFA ","symbol","1.0-0"),""),e.R7$(5),e.R50("ngModel",t.tempPaymentAmount),e.R7$(4),e.R50("ngModel",t.tempPaymentMethod),e.R7$(9),e.Y8G("ngIf",t.tempPaymentAmount>=(null!==(n=null==t.vente?null:t.vente.montantTotal)&&void 0!==n?n:0)),e.R7$(),e.Y8G("ngIf",t.tempPaymentAmount<(null!==(o=null==t.vente?null:t.vente.montantTotal)&&void 0!==o?o:0))}}let I=(()=>{class s{constructor(n,o,t){this.router=n,this.venteService=o,this.entrepriseService=t,this.imgUrl=g.c.imgUrl,this.logo=null,this.fallbackLogo="assets/logo/re\xe7u.png",this.vente=null,this.paymentAmount=0,this.changeDue=0,this.paymentMethod="Esp\xe8ces",this.loading=!1,this.errorMessage=null,this.showModifyModal=!1,this.tempPaymentAmount=0,this.tempPaymentMethod="Esp\xe8ces"}ngOnInit(){const n=localStorage.getItem("entreprise");if(n)try{const t=JSON.parse(n);this.logo=t.logo?this.ensureAbsoluteLogoUrl(t.logo):null}catch{this.logo=null}this.logo||this.entrepriseService.getEntrepriseInfo().subscribe({next:t=>{this.logo=t.logo?this.ensureAbsoluteLogoUrl(t.logo):null;try{localStorage.setItem("entreprise",JSON.stringify(t))}catch{}},error:t=>{console.warn("Impossible de charger info entreprise pour logo",t),this.logo=null}});const o=history&&history.state?history.state:{};if(o&&o.vente)return this.vente=o.vente,this.paymentAmount=o.paymentAmount??this.vente?.montantPaye??0,this.changeDue=o.changeDue??this.paymentAmount-(this.vente?.montantTotal??0),void(this.paymentMethod=o.paymentMethod??this.vente?.modePaiement??this.paymentMethod);o&&o.venteId&&this.loadVenteById(o.venteId)}ensureAbsoluteLogoUrl(n){return n?n.startsWith("http")||n.startsWith("data:")||n.startsWith("blob:")||this.imgUrl&&n.startsWith(this.imgUrl)?n:(this.imgUrl.endsWith("/")?this.imgUrl.slice(0,-1):this.imgUrl)+(n.startsWith("/")?n:`/${n}`):this.fallbackLogo}onLogoError(){this.logo=this.fallbackLogo}loadVenteById(n){this.loading=!0,this.venteService.getVenteById(n).subscribe({next:o=>{console.log("R\xe9ponse API:",o),this.vente=o,this.paymentAmount=o.montantPaye??o.montantTotal??0,this.changeDue=this.paymentAmount-(o.montantTotal??0),this.paymentMethod=o.modePaiement??this.paymentMethod,this.loading=!1,console.log("Vente charg\xe9e:",o)},error:o=>{console.error("Erreur chargement vente",o),this.errorMessage=o?.error?.message||o?.message||"Erreur chargement vente",this.loading=!1}})}impressionReceipt(){if(!this.receiptEl)return;const n=window.location.origin;let o=this.receiptEl.nativeElement.innerHTML;o=o.replace(/src="assets\//g,`src="${n}/assets/`);const t=window.open("","_blank","left=0,top=0,width=380,height=500,toolbar=0,scrollbars=0,status=0");t?.document.write(`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Re\xe7u de paiement</title>\n        <style>\n          * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n            font-family: Arial, sans-serif;\n            -webkit-print-color-adjust: exact !important;\n            print-color-adjust: exact !important;\n          }\n          body { \n            padding: 10px; \n            background: white;\n          }\n          .paiement_right {\n            width: 100%\n            display: flex !important;\n            align-items: center !important;\n            justify-content: center;\n          }\n          .receipt {\n            width: 100% !important;\n            min-width: 350px !important; /* Largeur augment\xe9e */\n            min-height: 0 !important;\n            margin: 0 auto;\n            padding: 15px !important;\n            box-shadow: none !important;\n          }\n          .no-print { display: none !important; }\n          .paleft { padding-left: 5px !important; }\n          /* Centrage du header */\n          .receipt-header {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            text-align: center;\n            margin-bottom: 15px !important;\n          }\n          .receipt-header .logo {\n            max-width: 100px !important; /* Taille originale */\n            margin-bottom: 10px !important;\n          }\n          .ticket-info div {\n            font-size: 10px !important;\n            line-height: 1.4 !important; \n            margin-top: 4px !important; /* Espacement r\xe9duit */\n          }\n          \n          .items-list { \n            margin-bottom: 10px !important; \n            width: 100%;\n          }\n          .item .qty {\n              width: 8px !important;\n            }\n          .item {\n            display: flex !important;\n            align-items: flex-start !important;\n            margin-bottom: 8px !important;\n          }\n          .divider {\n            border-top: 1px dotted #000 !important;\n            margin: 8px 0 !important;\n          }\n          .line span {\n            font-size: 11px !important; /* Taille de police augment\xe9e */\n          }\n          \n          /* Centrage du footer */\n          .receipt-footer { \n            position: relative !important; \n            bottom: 0 !important;\n            margin-top: 20px !important;\n            font-size: 10px !important;\n            text-align: center !important;\n            width: 100%;\n          }\n          \n          .qty, .name, .total {\n            font-size: 10px !important; /* Taille de police augment\xe9e */\n          }\n          .unit-price {\n            font-size: 10px !important; /* Taille de police augment\xe9e */\n          }\n          \n          @page { \n            size: auto; \n            margin: 0; \n          }\n          @media print {\n            body { padding: 0 !important; }\n          }\n        </style>\n      </head>\n      <body>\n        ${o}\n        <div class="no-print" style="text-align:center;margin-top:20px;">\n          <button onclick="window.print()" style="padding:8px 16px;background:#1976D2;color:white;border:none;border-radius:4px;cursor:pointer;">\n            Imprimer\n          </button>\n          <button onclick="window.close()" style="padding:8px 16px;margin-left:10px;background:#f44336;color:white;border:none;border-radius:4px;cursor:pointer;">\n            Fermer\n          </button>\n        </div>\n        <script>\n          window.onload = function() {\n            window.print();\n            setTimeout(function() {\n              window.close();\n            }, 1000);\n          };\n        <\/script>\n      </body>\n      </html>\n    `),t?.document.close()}newOrder(){this.router.navigate(["/pos-accueil"])}getLignes(){return this.vente?.lignes??[]}modifyPaymentRecu(){this.tempPaymentAmount=this.paymentAmount,this.tempPaymentMethod=this.paymentMethod,this.showModifyModal=!0}updatePayment(){this.paymentAmount=this.tempPaymentAmount,this.paymentMethod=this.tempPaymentMethod,this.changeDue=this.paymentAmount-(this.vente?.montantTotal??0),this.showModifyModal=!1,setTimeout(()=>{this.impressionReceipt()},100)}cancelModify(){this.showModifyModal=!1}calculateChange(){this.changeDue=this.tempPaymentAmount-(this.vente?.montantTotal??0)}static{this.\u0275fac=function(o){return new(o||s)(e.rXU(d.Ix),e.rXU(v.W),e.rXU(y.r))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-pos-paiement"]],viewQuery:function(o,t){if(1&o&&e.GBs(E,5),2&o){let p;e.mGM(p=e.lsd())&&(t.receiptEl=p.first)}},decls:63,vars:35,consts:[["receipt",""],["loadingTpl",""],[1,"container_paiement"],[1,"content_paiement"],[1,"paiement_left"],[1,"content_paiement_left"],["class","card status-card",4,"ngIf","ngIfElse"],["class","card amount-card",4,"ngIf"],[1,"btn","btn-secondary",3,"click"],[1,"email-send"],["type","email","placeholder","example@gmail.com"],[1,"btn-send"],[1,"ri-send-plane-fill"],[1,"btn","btn-primary","btn-new-order",3,"click"],[1,"paiement_right"],[1,"receipt"],[1,"receipt-header"],["alt","Logo XpertPro",1,"logo",3,"error","src"],[1,"ticket-info"],[1,"items-list"],["class","item",4,"ngFor","ngForOf"],["class","no-items",4,"ngIf"],[1,"divider"],[1,"totals"],[1,"line"],[1,"paleft"],[1,"line","total-line"],[1,"payments-breakdown"],["class","line",4,"ngIf"],[1,"receipt-footer"],["class","modal-overlay",4,"ngIf"],[1,"card","status-card"],[1,"status-icon"],[1,"status-text"],[1,"card","amount-card"],[1,"amount"],[1,"method"],[1,"item"],[1,"qty"],[1,"desc"],[1,"name"],[1,"unit-price"],[1,"total"],[1,"no-items"],[1,"loading"],[1,"modal-overlay"],[1,"modal-content"],[1,"form-group"],["type","number","min","0","step","100",3,"ngModelChange","input","ngModel"],[3,"ngModelChange","ngModel"],["value","Esp\xe8ces"],["value","Carte"],["value","Virement"],["value","Mobile Money"],["class","form-group",4,"ngIf"],[1,"modal-actions"]],template:function(o,t){if(1&o){const p=e.RV6();e.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5),e.DNE(4,M,5,0,"div",6)(5,x,6,7,"div",7),e.j41(6,"button",8),e.bIt("click",function(){return e.eBV(p),e.Njj(t.modifyPaymentRecu())}),e.EFF(7,"Modifier le re\xe7u"),e.k0s(),e.j41(8,"button",8),e.bIt("click",function(){return e.eBV(p),e.Njj(t.impressionReceipt())}),e.EFF(9,"Imprimer le re\xe7u"),e.k0s(),e.j41(10,"div",9),e.nrm(11,"input",10),e.j41(12,"button",11),e.nrm(13,"i",12),e.k0s()(),e.j41(14,"button",13),e.bIt("click",function(){return e.eBV(p),e.Njj(t.newOrder())}),e.EFF(15,"Nouvelle commande"),e.k0s()()(),e.j41(16,"div",14)(17,"div",15,0)(19,"div",16)(20,"img",17),e.bIt("error",function(){return e.eBV(p),e.Njj(t.onLogoError())}),e.k0s(),e.j41(21,"div",18)(22,"div"),e.EFF(23),e.k0s(),e.j41(24,"div"),e.EFF(25),e.nI1(26,"date"),e.k0s(),e.j41(27,"div"),e.EFF(28),e.k0s(),e.j41(29,"div"),e.EFF(30),e.k0s()()(),e.j41(31,"ul",19),e.DNE(32,h,12,14,"li",20)(33,k,2,0,"li",21),e.k0s(),e.nrm(34,"div",22),e.j41(35,"div",23)(36,"div",24)(37,"span"),e.EFF(38,"Sous-total"),e.k0s(),e.j41(39,"span",25),e.EFF(40),e.nI1(41,"currency"),e.k0s()(),e.j41(42,"div",26)(43,"span"),e.EFF(44,"Total"),e.k0s(),e.j41(45,"span",25),e.EFF(46),e.nI1(47,"currency"),e.k0s()()(),e.nrm(48,"div",22),e.j41(49,"div",27)(50,"div",24)(51,"span"),e.EFF(52),e.k0s(),e.j41(53,"span",25),e.EFF(54),e.nI1(55,"currency"),e.k0s()(),e.DNE(56,i,6,6,"div",28)(57,r,6,6,"div",28),e.k0s(),e.j41(58,"div",29),e.EFF(59," G\xe9n\xe9r\xe9 par Tchakeda "),e.k0s()(),e.DNE(60,a,2,0,"ng-template",null,1,e.C5r),e.k0s()()(),e.DNE(62,T,31,10,"div",30)}if(2&o){let p,f,b,C,F;const w=e.sdS(61);e.R7$(4),e.Y8G("ngIf",t.vente)("ngIfElse",w),e.R7$(),e.Y8G("ngIf",t.vente),e.R7$(15),e.Y8G("src",t.logo||"assets/logo/rec\u0327u.png",e.B4B),e.R7$(3),e.SpI("Ticket : ",null!==(p=null==t.vente?null:t.vente.numeroFacture)&&void 0!==p?p:"\u2014",""),e.R7$(2),e.JRh(e.i5U(26,17,null==t.vente?null:t.vente.dateVente,"dd/MM/yyyy HH:mm")),e.R7$(3),e.SpI("Servi par : ",null!==(f=null==t.vente?null:t.vente.nomVendeur)&&void 0!==f?f:"\u2014",""),e.R7$(2),e.SpI("Boutique : ",null!==(b=null==t.vente?null:t.vente.nomBoutique)&&void 0!==b?b:"\u2014",""),e.R7$(2),e.Y8G("ngForOf",t.getLignes()),e.R7$(),e.Y8G("ngIf",0===t.getLignes().length),e.R7$(7),e.JRh(e.ii3(41,20,null==t.vente?null:t.vente.montantTotal,"CFA ","symbol","1.0-0")),e.R7$(6),e.JRh(e.ii3(47,25,null==t.vente?null:t.vente.montantTotal,"CFA ","symbol","1.0-0")),e.R7$(6),e.JRh(t.paymentMethod),e.R7$(2),e.JRh(e.ii3(55,30,t.paymentAmount,"CFA ","symbol","1.0-0")),e.R7$(2),e.Y8G("ngIf",t.paymentAmount>=(null!==(C=null==t.vente?null:t.vente.montantTotal)&&void 0!==C?C:0)),e.R7$(),e.Y8G("ngIf",t.paymentAmount<(null!==(F=null==t.vente?null:t.vente.montantTotal)&&void 0!==F?F:0)),e.R7$(5),e.Y8G("ngIf",t.showModifyModal)}},dependencies:[c.YN,c.xH,c.y7,c.me,c.Q0,c.wz,c.BC,c.VZ,c.vS,m.MD,m.Sq,m.bT,m.oe,m.vh,c.X1],styles:[".container_paiement[_ngcontent-%COMP%]{width:100%}.content_paiement[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;height:100vh;background:#fff}.paiement_left[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.content_paiement_left[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:stretch;gap:15px;width:60%;position:relative;top:-10%}.card[_ngcontent-%COMP%]{border:1px solid #A5D6A7;border-radius:4px;padding:16px;display:flex;align-items:center;flex-direction:row}.status-card[_ngcontent-%COMP%]{background:#e8f5e9;margin-bottom:0;padding:30px 20px}.status-icon[_ngcontent-%COMP%]{width:24px;height:24px;background:#4caf50;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-right:12px;font-size:16px}.status-text[_ngcontent-%COMP%]{font-size:16px;font-weight:500;color:#2e7d32}.amount-card[_ngcontent-%COMP%]{justify-content:space-between;margin-bottom:0}.amount[_ngcontent-%COMP%], .method[_ngcontent-%COMP%]{font-size:18px;color:#2e7d32}.btn[_ngcontent-%COMP%]{padding:14px 20px;border:none;border-radius:4px;font-size:16px;cursor:pointer}.btn-secondary[_ngcontent-%COMP%]{background:#f9f9f9;color:#333}.email-send[_ngcontent-%COMP%]{display:flex;align-items:center;border:1px solid #ddd;border-radius:4px;overflow:hidden;position:relative}.email-send[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border:none;padding:12px;font-size:14px}.email-send[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none}.btn-send[_ngcontent-%COMP%]{background:#1976d2;color:#fff;font-size:20px;border:none;border-radius:4px 0 0 4px;padding:8px 22px}.btn-primary[_ngcontent-%COMP%]{background:#1976d2;color:#fff}.btn-new-order[_ngcontent-%COMP%]{margin-top:auto}.paiement_right[_ngcontent-%COMP%]{padding:40px;background:#ececec;overflow-y:auto;margin-bottom:8%}.receipt[_ngcontent-%COMP%]{max-width:350px;min-height:80vh;margin:0 auto;background:#fff;padding:24px 15px;box-shadow:0 2px 6px #0000001a;position:relative}.receipt-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:15px}.receipt-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{max-width:130px}.ticket-info[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:12px;color:#555;line-height:2px;margin-top:20px}.items-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0 0 16px}.item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;margin-bottom:12px}.item[_ngcontent-%COMP%]   .qty[_ngcontent-%COMP%]{width:14px;font-weight:700;font-size:12px}.desc[_ngcontent-%COMP%]{flex:1;margin:0 12px}.name[_ngcontent-%COMP%]{font-weight:500;font-size:13px}.unit-price[_ngcontent-%COMP%]{font-size:10px;color:#777}.total[_ngcontent-%COMP%]{white-space:nowrap;font-size:13px}.divider[_ngcontent-%COMP%]{border-top:1px dotted #bbb;margin:12px 0}.totals[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%], .payments-breakdown[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px;font-size:13px}.total-line[_ngcontent-%COMP%]{font-weight:600}.receipt-footer[_ngcontent-%COMP%]{position:absolute;bottom:10px;left:0;width:100%;font-size:8px;color:#888;text-align:center;font-style:italic}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;width:400px;box-shadow:0 4px 20px #00000026}.form-group[_ngcontent-%COMP%]{margin-bottom:15px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:500}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:20px}"]})}}return s})()},92120:(O,P,l)=>{l.d(P,{r:()=>x});var m=l(21626),c=l(84412),g=l(25558),e=l(99437),d=l(18810),v=l(88141),y=l(22525),E=l(54438),M=l(88026);let x=(()=>{class h{constructor(i,r){this.http=i,this.usersService=r,this.apiUrl=y.c.apiBaseUrl,this.entrepriseSubject=new c.t([]),this.entreprise$=this.entrepriseSubject.asObservable()}getListEntreprises(){return this.usersService.getValidAccessToken().pipe((0,g.n)(i=>{const r=new m.Lr({Authorization:`Bearer ${i}`,"Content-Type":"application/json"});return this.http.get(`${this.apiUrl}/entreprises`,{headers:r})}),(0,e.W)(i=>{let r="Erreur inconnue";return i.error instanceof ErrorEvent?r=`Erreur: ${i.error.message}`:404===i.status&&(r="Aucune entreprise trouv\xe9e"),(0,d.$)(()=>new Error(r))}))}addEntreprise(i){return this.usersService.getValidAccessToken().pipe((0,g.n)(r=>{const a=new m.Lr({Authorization:`Bearer ${r}`,"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}/entreprise-clients`,i,{headers:a})}),(0,v.M)(r=>{this.entrepriseSubject.next([...this.entrepriseSubject.value,r])}),(0,e.W)(r=>{let a="Erreur inconnue";return r.error instanceof ErrorEvent?a=`Erreur: ${r.error.message}`:400===r.status&&(a=r.error||"Donn\xe9es invalides"),(0,d.$)(()=>new Error(a))}))}getListEntreprise(){return this.usersService.getValidAccessToken().pipe((0,g.n)(i=>{if(!i)return console.error("Token vide ou non d\xe9fini ! V\xe9rifiez que l'utilisateur est bien connect\xe9."),(0,d.$)(()=>new Error("Token manquant"));const r=(new m.Lr).set("Authorization",`Bearer ${i}`);return console.log("En-t\xeates envoy\xe9s : ",r),this.http.get(`${this.apiUrl}/entreprises`,{headers:r})}),(0,v.M)(i=>{this.entrepriseSubject.next(i)}),(0,e.W)(i=>(console.error("Erreur lors de la r\xe9cup\xe9ration des entreprises:",i),(0,d.$)(()=>i))))}getEntrepriseById(i){return this.usersService.getValidAccessToken().pipe((0,g.n)(r=>{if(!r)return console.error("Token manquant"),(0,d.$)(()=>new Error("Token manquant"));const a=new m.Lr({Authorization:`Bearer ${r}`,"Content-Type":"application/json"});return this.http.get(`${this.apiUrl}/entreprises/${i}`,{headers:a})}),(0,e.W)(r=>{let a="Erreur inconnue";return r.error instanceof ErrorEvent?a=`Erreur: ${r.error.message}`:404===r.status&&(a="Entreprise non trouv\xe9e"),(0,d.$)(()=>new Error(a))}))}updateEntreprise(i,r){return this.usersService.getValidAccessToken().pipe((0,g.n)(a=>{if(!a)return(0,d.$)(()=>new Error("Token manquant"));const _=new m.Lr({Authorization:`Bearer ${a}`});return this.http.patch(`${this.apiUrl}/updateEntreprise/${i}`,r,{headers:_,responseType:"text"})}),(0,e.W)(a=>{let _="Erreur inconnue";return a.error instanceof ErrorEvent?_=`Erreur: ${a.error.message}`:400===a.status&&(_=a.error||"Donn\xe9es invalides"),(0,d.$)(()=>new Error(_))}))}getEntrepriseInfo(){return this.usersService.getValidAccessToken().pipe((0,g.n)(i=>{if(!i)return(0,d.$)(()=>new Error("Aucun token trouv\xe9"));const r=new m.Lr({Authorization:`Bearer ${i}`});return this.http.get(`${this.apiUrl}/myEntreprise`,{headers:r}).pipe((0,v.M)(a=>{localStorage.setItem("entreprise",JSON.stringify(a))}))}),(0,e.W)(i=>(console.error("Erreur r\xe9cup\xe9ration info entreprise:",i),(0,d.$)(()=>i))))}decodeJwt(i){return JSON.parse(atob(i.split(".")[1]))}isTokenExpired(i){return new Date(1e3*i.exp)<new Date}getNewTokenFromApi(){const i=localStorage.getItem("refreshToken");return this.http.post(`${this.apiUrl}/refresh-token`,{refreshToken:i})}static{this.\u0275fac=function(r){return new(r||h)(E.KVO(m.Qq),E.KVO(M.g))}}static{this.\u0275prov=E.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})()}}]);